import{r as t,A,j as s,h as $,a as M,f as O}from"./index-BUL6LB55.js";import{B as C}from"./Button-CqEssTF4.js";import{I}from"./Input-fEXGFBn-.js";import{C as U}from"./Card-k44aVk4n.js";import{g as z}from"./errorUtils-CUS756ws.js";const G=({accounts:l,branches:r,employees:a,onSave:c,onCancel:i})=>{var S,w;const[n,k]=t.useState(""),[p,g]=t.useState(""),[h,E]=t.useState(""),[b,L]=t.useState(new Date().toISOString().split("T")[0]),[u,D]=t.useState(0),[v,q]=t.useState(((S=r[0])==null?void 0:S.id)||""),[j,m]=t.useState(null),y=l.filter(e=>e.type===A.ASSET&&!e.isHeader),[x,B]=t.useState(((w=y.find(e=>e.code==="1050"))==null?void 0:w.id)||""),[f,T]=t.useState(""),[F,N]=t.useState(!1),P=l.filter(e=>e.type===A.ASSET&&(e.name.toLowerCase().includes("cash")||e.name.toLowerCase().includes("bank"))&&!e.isHeader),R=e=>{const d=e.target.value;k(d);const o=a.find(V=>V.id===d);g(o?o.name:"")},H=async e=>{if(e.preventDefault(),m(null),!n||!p||u<=0||!x||!f){m("Please fill all required fields.");return}N(!0);const d={id:`loan-${Date.now()}`,employeeId:n,employeeName:p,description:h,date:b,amount:u,amountRepaid:0,status:"ACTIVE",assetAccountId:x,payoutAccountId:f,branchId:v,createdAt:Date.now()};try{await c(d)}catch(o){console.error(o),m(z(o))}finally{N(!1)}};return s.jsx(U,{title:"Issue New Staff Loan",children:s.jsxs("form",{onSubmit:H,className:"space-y-6",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsxs("div",{className:"w-full",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Employee"}),s.jsxs("select",{className:"block w-full px-3 py-2 border border-gray-300 rounded-xl shadow-sm focus:outline-none focus:ring-indigo-500 sm:text-sm",value:n,onChange:R,required:!0,children:[s.jsx("option",{value:"",children:"Select Employee"}),a.map(e=>s.jsxs("option",{value:e.id,children:[e.name," ",e.position?`(${e.position})`:""]},e.id))]}),a.length===0&&s.jsx("p",{className:"text-xs text-red-500 mt-1",children:"No employees found. Please add an employee first."})]}),s.jsx(I,{label:"Date of Issue",type:"date",value:b,onChange:e=>L(e.target.value),required:!0}),s.jsx("div",{className:"md:col-span-2",children:s.jsx(I,{label:"Description / Reason",value:h,onChange:e=>E(e.target.value),placeholder:"e.g. Salary Advance for Nov",required:!0})}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Loan Amount"}),s.jsx("input",{type:"number",min:"0.01",step:"0.01",className:"block w-full px-3 py-2 border border-gray-300 rounded-xl shadow-sm focus:outline-none focus:ring-indigo-500 sm:text-sm",value:u,onChange:e=>D(parseFloat(e.target.value)),required:!0})]}),s.jsxs("div",{className:"w-full",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Branch"}),s.jsx("select",{className:"block w-full px-3 py-2 border border-gray-300 rounded-xl shadow-sm focus:outline-none focus:ring-indigo-500 sm:text-sm",value:v,onChange:e=>q(e.target.value),required:!0,children:r.map(e=>s.jsx("option",{value:e.id,children:e.name},e.id))})]})]}),s.jsxs("div",{className:"bg-indigo-50 p-4 rounded-xl border border-indigo-100",children:[s.jsx("h4",{className:"text-sm font-semibold text-indigo-900 mb-3 uppercase tracking-wide",children:"Accounting Configuration"}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsxs("div",{className:"w-full",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Loan Receivable Account (Debit)"}),s.jsxs("select",{className:"block w-full px-3 py-2 border border-gray-300 rounded-xl shadow-sm focus:outline-none focus:ring-indigo-500 sm:text-sm",value:x,onChange:e=>B(e.target.value),required:!0,children:[s.jsx("option",{value:"",children:"Select Asset Account"}),y.map(e=>s.jsxs("option",{value:e.id,children:[e.code," - ",e.name]},e.id))]}),s.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Usually '1050 - Staff Advances'"})]}),s.jsxs("div",{className:"w-full",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Paid From (Credit)"}),s.jsxs("select",{className:"block w-full px-3 py-2 border border-gray-300 rounded-xl shadow-sm focus:outline-none focus:ring-indigo-500 sm:text-sm",value:f,onChange:e=>T(e.target.value),required:!0,children:[s.jsx("option",{value:"",children:"Select Bank/Cash"}),P.map(e=>s.jsx("option",{value:e.id,children:e.name},e.id))]})]})]})]}),j&&s.jsx("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg text-sm",children:j}),s.jsxs("div",{className:"flex justify-end space-x-3",children:[s.jsx(C,{type:"button",variant:"outline",onClick:i,children:"Cancel"}),s.jsx(C,{type:"submit",isLoading:F,children:"Issue Loan"})]})]})})};function Y(){const{employees:l,accounts:r,branches:a,refreshData:c}=$(),i=M();return s.jsxs("div",{className:"p-6",children:[s.jsx("h1",{className:"text-2xl font-bold mb-6",children:"Issue Staff Loan"}),s.jsx(G,{employees:l,accounts:r,branches:a,onSave:async n=>{await O.createStaffLoan(n),await c(),i("/app/staff")},onCancel:()=>i("/app/staff")})]})}export{Y as default};
