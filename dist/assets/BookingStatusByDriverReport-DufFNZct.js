import{h as O,r as n,j as e,p as S}from"./index-BUL6LB55.js";import{C as h}from"./Card-k44aVk4n.js";import{B as I}from"./Button-CqEssTF4.js";import{T as _}from"./TrackingTimeline--cIDV8xm.js";import{D as F}from"./download-DAoIALzT.js";import{c as U}from"./createLucideIcon-CEuAjdeA.js";import{S as $}from"./search-DTZoH1GY.js";import"./toast-DfW6NkLH.js";/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const M=[["path",{d:"M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8",key:"1p45f6"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}]],V=U("rotate-cw",M),W=()=>{const{employees:g}=O(),[p,E]=n.useState([]),[y,j]=n.useState(!1),[N,f]=n.useState(null),[d,L]=n.useState(""),[v,C]=n.useState(()=>{const t=new Date;return t.setDate(t.getDate()-7),t.toISOString().split("T")[0]}),[k,P]=n.useState(()=>new Date().toISOString().split("T")[0]),[o,R]=n.useState("ALL"),T=n.useMemo(()=>g.filter(t=>t.isDriver),[g]),w=async()=>{j(!0);try{let t=[];d?t=await S.getDriverJobs(d):t=await S.getParcelBookings();const c=new Date(v).getTime(),s=new Date(k).getTime()+1440*60*1e3-1,l=t.filter(i=>{const x=i.createdAt||0,r=x>=c&&x<=s,u=o==="ALL"||i.statusId===o||i.status===o,a=!d||i.driverId===d;return r&&u&&a});E(l.sort((i,x)=>(x.createdAt||0)-(i.createdAt||0)))}catch(t){console.error("Error fetching report data:",t)}finally{j(!1)}};n.useEffect(()=>{w()},[]);const A=()=>{w()},B=()=>{window.print()},{driverSummary:D,flattenedItems:m}=n.useMemo(()=>{const t={},c=[];return p.forEach(s=>{const l=s.items&&s.items.length>0?s.items:[];l.length!==0&&l.forEach((i,x)=>{const r=i.driverId||s.driverId||"unassigned",u=i.driverName||s.driverName||"Unknown Driver";if(d&&r!==d)return;c.push({...i,bookingId:s.id,bookingDate:s.createdAt,senderName:s.senderName,senderPhone:s.senderPhone,currency:s.currency,displayStatus:i.status||s.status}),t[r]||(t[r]={driverName:u,total:0,pending:0,pickup:0,outForDelivery:0,delivered:0,cancelled:0,returned:0}),t[r].total++;const a=(i.status||s.status||"").toLowerCase();a.includes("pending")||a==="confirmed"?t[r].pending++:a.includes("pickup")||a.includes("picked")||a==="at_warehouse"?t[r].pickup++:a.includes("out")||a.includes("transit")?t[r].outForDelivery++:a.includes("delivered")||a.includes("complete")?t[r].delivered++:a.includes("cancel")?t[r].cancelled++:a.includes("return")?t[r].returned++:t[r].pending++})}),{driverSummary:Object.values(t).sort((s,l)=>l.total-s.total),flattenedItems:c.sort((s,l)=>(l.bookingDate||0)-(s.bookingDate||0))}},[p,d]),b=n.useMemo(()=>o==="ALL"?m:m.filter(t=>(t.displayStatus||"").toLowerCase()===o.toLowerCase()||t.displayStatus===o),[m,o]);return e.jsxs("div",{className:"space-y-6",children:[e.jsx(h,{children:e.jsxs("div",{className:"flex flex-col space-y-4",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center gap-4",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-800",children:"Booking Status by Driver (Parcel Level)"}),e.jsx("div",{className:"flex space-x-2",children:e.jsxs(I,{variant:"outline",onClick:B,className:"print:hidden",children:[e.jsx(F,{className:"w-4 h-4 mr-2"}),"Print / PDF"]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 pt-4 border-t border-gray-100 print:hidden",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Driver"}),e.jsxs("select",{className:"block w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-indigo-500",value:d,onChange:t=>L(t.target.value),children:[e.jsx("option",{value:"",children:"All Drivers"}),T.map(t=>e.jsxs("option",{value:t.linkedUserId||t.id,children:[t.name," (",t.phone,")"]},t.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Status"}),e.jsxs("select",{className:"block w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-indigo-500",value:o,onChange:t=>R(t.target.value),children:[e.jsx("option",{value:"ALL",children:"All Statuses"}),e.jsx("option",{value:"PENDING",children:"Pending"}),e.jsx("option",{value:"PICKED_UP",children:"Picked Up"}),e.jsx("option",{value:"IN_TRANSIT",children:"In Transit"}),e.jsx("option",{value:"OUT_FOR_DELIVERY",children:"Out for Delivery"}),e.jsx("option",{value:"DELIVERED",children:"Delivered"}),e.jsx("option",{value:"RETURN_TO_SENDER",children:"Returned"}),e.jsx("option",{value:"CANCELLED",children:"Cancelled"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Start Date"}),e.jsx("input",{type:"date",className:"block w-full px-3 py-2 border border-gray-300 rounded-lg text-sm",value:v,onChange:t=>C(t.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"End Date"}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("input",{type:"date",className:"block w-full px-3 py-2 border border-gray-300 rounded-lg text-sm",value:k,onChange:t=>P(t.target.value)}),e.jsx(I,{onClick:A,disabled:y,children:y?e.jsx(V,{className:"w-4 h-4 animate-spin"}):e.jsx($,{className:"w-4 h-4"})})]})]})]})]})}),e.jsxs(h,{children:[e.jsx("div",{className:"mb-4",children:e.jsx("h3",{className:"text-lg font-bold text-gray-800",children:"Summary by Driver"})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Driver Name"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Total Parcels"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider text-yellow-600",children:"Pending"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider text-blue-600",children:"Picked Up"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider text-purple-600",children:"Transit/Out"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider text-green-600",children:"Delivered"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider text-red-600",children:"Cancelled"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider text-orange-600",children:"Returned"})]})}),e.jsxs("tbody",{className:"bg-white divide-y divide-gray-200 text-sm",children:[D.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:8,className:"px-6 py-4 text-center text-gray-500",children:"No data available for summary."})}),D.map((t,c)=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-3 font-medium text-gray-900",children:t.driverName}),e.jsx("td",{className:"px-6 py-3 text-right font-bold",children:t.total}),e.jsx("td",{className:"px-6 py-3 text-right text-yellow-600",children:t.pending||"-"}),e.jsx("td",{className:"px-6 py-3 text-right text-blue-600",children:t.pickup||"-"}),e.jsx("td",{className:"px-6 py-3 text-right text-purple-600",children:t.outForDelivery||"-"}),e.jsx("td",{className:"px-6 py-3 text-right text-green-600",children:t.delivered||"-"}),e.jsx("td",{className:"px-6 py-3 text-right text-red-600",children:t.cancelled||"-"}),e.jsx("td",{className:"px-6 py-3 text-right text-orange-600",children:t.returned||"-"})]},c))]})]})})]}),e.jsxs(h,{children:[e.jsx("div",{className:"mb-4",children:e.jsx("h3",{className:"text-lg font-bold text-gray-800",children:"Detailed Parcel List"})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Booking / Parcel"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Driver"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Sender"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Receiver"}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Price (COD)"})]})}),e.jsxs("tbody",{className:"bg-white divide-y divide-gray-200 text-sm",children:[b.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"px-6 py-8 text-center text-gray-500",children:"No parcels found matching filters."})}),b.map((t,c)=>e.jsxs("tr",{className:"hover:bg-gray-50 cursor-pointer transition-colors",onClick:()=>{const s=p.find(l=>l.id===t.bookingId);s&&f(s)},children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-gray-900",children:new Date(t.bookingDate||0).toLocaleDateString()}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsx("div",{className:"font-medium text-indigo-600",children:t.bookingId}),e.jsx("div",{className:"text-xs text-gray-500 font-mono mt-1",children:t.barcode||t.trackingCode||"No Barcode"})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-gray-900",children:t.driverName||"-"}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-gray-500",children:[e.jsx("div",{className:"text-gray-900",children:t.senderName}),e.jsx("div",{className:"text-xs",children:t.senderPhone})]}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-gray-500",children:[e.jsx("div",{className:"text-gray-900",children:t.receiverName}),e.jsx("div",{className:"text-xs",children:t.receiverPhone})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium 
                                            ${t.displayStatus==="DELIVERED"?"bg-green-100 text-green-800":t.displayStatus==="CANCELLED"?"bg-red-100 text-red-800":t.displayStatus==="PENDING"?"bg-gray-100 text-gray-800":"bg-blue-100 text-blue-800"}`,children:t.displayStatus})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-gray-900",children:t.productPrice>0?t.codCurrency==="KHR"?`${t.productPrice.toLocaleString()} áŸ›`:`$${t.productPrice.toFixed(2)}`:"-"})]},`${t.id}-${c}`))]})]})})]}),N&&e.jsx(_,{booking:N,onClose:()=>f(null)})]})};export{W as BookingStatusByDriverReport};
