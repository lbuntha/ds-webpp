import{r as i,j as e,Z as R,a as F,f as m}from"./index-BUL6LB55.js";import{C as M}from"./Card-k44aVk4n.js";import{B}from"./Button-CqEssTF4.js";import{I as k}from"./Input-fEXGFBn-.js";import{t as u}from"./toast-DfW6NkLH.js";const O=({onComplete:N})=>{const[s,h]=i.useState(1),[l,x]=i.useState(!1),[g,a]=i.useState(""),[o,I]=i.useState(""),[v,A]=i.useState("USD"),[p,U]=i.useState("Headquarters"),[f,H]=i.useState("HQ"),[c,W]=i.useState(!1),K=()=>{if(s===1&&!o)return u.warning("Please enter a company name.");if(s===2&&(!p||!f))return u.warning("Please define at least one branch.");h(t=>Math.min(t+1,3))},E=()=>{h(t=>Math.max(t-1,1))},T=async()=>{x(!0),a("Initializing setup..."),await new Promise(t=>setTimeout(t,100));try{const t={companyName:o,setupComplete:!0},P=[{id:`br-${Date.now()}`,name:p,code:f}];a("Configuring Chart of Accounts...");let b="",S="",y="",C="",w="",D="",d="",j="";const L=R.map(r=>{const n=r.id||r.code||`acc-${Date.now()}-${Math.random()}`;return r.code==="3200002"&&(b=n),r.code==="3200001"&&(S=n),r.code==="3210102"&&(y=n),r.code==="3210101"&&(C=n),r.code==="6501002"&&(w=n),r.code==="6501001"&&(D=n),r.code==="1101002"&&(d=n),r.code==="1101001"&&(j=n),{...r,id:n}});b&&(t.customerWalletAccountUSD=b),S&&(t.customerWalletAccountKHR=S),y&&(t.driverWalletAccountUSD=y),C&&(t.driverWalletAccountKHR=C),w&&(t.driverCommissionExpenseAccountUSD=w),D&&(t.driverCommissionExpenseAccountKHR=D),d&&(t.defaultDriverSettlementBankIdUSD=d,t.defaultCustomerSettlementBankIdUSD=d,t.defaultCustomerWalletAccountId=b,t.defaultDriverWalletAccountId=y,t.defaultDriverSettlementBankId=d,t.defaultCustomerSettlementBankId=d,t.defaultSettlementBankAccountId=d),j&&(t.defaultDriverSettlementBankIdKHR=j,t.defaultCustomerSettlementBankIdKHR=j),a(c?"Clearing old data & importing...":"Importing data..."),await N(t,L,P,c)}catch(t){console.error(t),u.error(`Setup failed: ${t.message||"Unknown error"}`),x(!1)}},$=()=>e.jsx("div",{className:"flex items-center justify-center mb-10 space-x-2",children:[1,2,3].map(t=>e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center text-sm font-bold transition-all duration-300 ${s>=t?"bg-indigo-600 text-white shadow-md scale-110":"bg-gray-200 text-gray-500"}`,children:t}),t<3&&e.jsx("div",{className:`w-12 h-1 mx-2 rounded ${s>t?"bg-indigo-600":"bg-gray-200"}`})]},t))});return e.jsx("div",{className:"min-h-screen flex flex-col items-center justify-center bg-gray-50 p-4",children:e.jsxs("div",{className:"w-full max-w-2xl",children:[e.jsxs("div",{className:"text-center mb-8 animate-fade-in-up",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Setup Your Company"}),e.jsx("p",{className:"text-gray-500 mt-2",children:"Customize DS Accounting for your business needs."})]}),e.jsx($,{}),e.jsxs(M,{className:"shadow-xl border-t-4 border-indigo-600",children:[s===1&&e.jsxs("div",{className:"space-y-6 animate-fade-in-up",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-800",children:"Company Profile"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Start by telling us about your organization."})]}),e.jsx(k,{label:"Company Name",value:o,onChange:t=>I(t.target.value),placeholder:"e.g. Acme Trading Co.",autoFocus:!0}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Base Currency"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{onClick:()=>A("USD"),className:`p-4 border rounded-xl cursor-pointer text-center transition-all ${v==="USD"?"border-indigo-500 bg-indigo-50 ring-1 ring-indigo-500":"border-gray-200 hover:bg-gray-50"}`,children:[e.jsx("div",{className:"text-2xl font-bold text-gray-800 mb-1",children:"$ USD"}),e.jsx("div",{className:"text-xs text-gray-500",children:"US Dollar"})]}),e.jsxs("div",{onClick:()=>A("KHR"),className:`p-4 border rounded-xl cursor-pointer text-center transition-all ${v==="KHR"?"border-indigo-500 bg-indigo-50 ring-1 ring-indigo-500":"border-gray-200 hover:bg-gray-50"}`,children:[e.jsx("div",{className:"text-2xl font-bold text-gray-800 mb-1",children:"áŸ› KHR"}),e.jsx("div",{className:"text-xs text-gray-500",children:"Cambodian Riel"})]})]}),e.jsx("p",{className:"text-xs text-gray-400 mt-2",children:"This is the currency used for your financial reports (Balance Sheet, P&L). You can still transact in other currencies."})]})]}),s===2&&e.jsxs("div",{className:"space-y-6 animate-fade-in-up",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-800",children:"Operating Structure"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Define your primary branch/location."})]}),e.jsxs("div",{className:"bg-gray-50 p-6 rounded-xl border border-gray-200",children:[e.jsx(k,{label:"Primary Branch Name",value:p,onChange:t=>U(t.target.value),placeholder:"e.g. Headquarters"}),e.jsx("div",{className:"mt-4",children:e.jsx(k,{label:"Branch Code",value:f,onChange:t=>H(t.target.value),placeholder:"e.g. HQ"})})]}),e.jsx("p",{className:"text-xs text-gray-400",children:"You can add more branches later in Settings."})]}),s===3&&e.jsxs("div",{className:"space-y-6 animate-fade-in-up",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-800",children:"Review & Finish"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Ready to launch your system."})]}),e.jsxs("div",{className:"bg-gray-50 rounded-xl p-6 space-y-4 border border-gray-200",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Company Name"}),e.jsx("span",{className:"font-medium text-gray-900",children:o})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Base Currency"}),e.jsx("span",{className:"font-medium text-gray-900",children:v})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Primary Branch"}),e.jsxs("span",{className:"font-medium text-gray-900",children:[p," (",f,")"]})]}),e.jsxs("div",{className:"flex justify-between border-t border-gray-200 pt-4",children:[e.jsx("span",{className:"text-gray-500",children:"Chart of Accounts"}),e.jsxs("span",{className:"font-medium text-gray-900",children:[R.length," Standard Accounts"]})]})]}),e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-xl p-4 flex items-start space-x-3",children:[e.jsx("input",{type:"checkbox",id:"resetToggle",className:"mt-1 h-5 w-5 text-red-600 border-red-300 rounded focus:ring-red-500 cursor-pointer",checked:c,onChange:t=>W(t.target.checked)}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"resetToggle",className:"block text-sm font-bold text-red-800 cursor-pointer",children:"Fresh Start: Wipe existing operational data"}),e.jsxs("p",{className:"text-xs text-red-700 mt-2 leading-relaxed",children:["Check this box if you want to ",e.jsx("strong",{children:"DELETE ALL"})," existing Transactions, Invoices, Parcels, Customers, and Wallet history to start fresh.",e.jsx("br",{}),e.jsx("br",{}),e.jsx("span",{className:"font-semibold",children:"Note:"})," Your Users, Drivers, Branches, and Chart of Accounts will NOT be deleted (unless you manually reset them)."]})]})]}),l&&g&&e.jsx("div",{className:"bg-blue-50 text-blue-700 text-sm p-3 rounded-lg text-center animate-pulse border border-blue-100",children:g})]}),e.jsxs("div",{className:"flex justify-between mt-8 pt-6 border-t border-gray-100",children:[s>1?e.jsx(B,{variant:"outline",onClick:E,disabled:l,type:"button",children:"Back"}):e.jsx("div",{}),s<3?e.jsx(B,{onClick:K,type:"button",children:"Next Step"}):e.jsx(B,{onClick:T,isLoading:l,variant:c?"danger":"primary",className:c?"":"!bg-green-600 !hover:bg-green-700",type:"button",disabled:l,children:c?"Reset & Complete Setup":"Complete Setup"})]})]})]})})};function V(){const N=F(),s=async(h,l,x,g)=>{try{if(g&&await m.clearFinancialAndLogisticsData(),l.length>0)for(const a of l)try{await m.addAccount(a)}catch{await m.updateAccount(a)}if(x.length>0)for(const a of x)try{await m.addBranch(a)}catch{await m.updateBranch(a)}await m.updateSettings(h),u.success("Setup completed successfully!"),N("/app")}catch(a){throw console.error("Setup failed:",a),u.error(`Setup failed: ${a.message||"Unknown error"}`),a}};return e.jsx(O,{onComplete:s})}export{V as default};
