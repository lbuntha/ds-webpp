import{j as e,r as c,h as D,b as R,a4 as C,a5 as A}from"./index-BUL6LB55.js";import{P as I}from"./payrollService-D5oO5LUj.js";import{C as v}from"./Card-k44aVk4n.js";import{B as y}from"./Button-CqEssTF4.js";import{I as F}from"./Input-fEXGFBn-.js";import{t as f}from"./toast-DfW6NkLH.js";const L=({slip:t,onClose:x})=>{const l=(s,n)=>new Intl.NumberFormat("en-US",{style:"currency",currency:n}).format(s);return e.jsxs(v,{className:"max-w-3xl mx-auto shadow-2xl print:shadow-none print:max-w-none",children:[e.jsxs("div",{className:"flex justify-between items-start border-b border-gray-100 pb-6 mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-black text-gray-900 uppercase tracking-tight",children:"Payslip"}),e.jsxs("p",{className:"text-gray-500 text-sm mt-1",children:["ID: ",t.id]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-sm font-bold text-gray-900",children:t.employeeName}),e.jsx("div",{className:"text-xs text-gray-500",children:t.employeeRole}),e.jsx("div",{className:"text-xs text-gray-500",children:t.department})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-8 mb-8",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xs font-black text-gray-400 uppercase tracking-widest mb-4",children:"Earnings"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Base Salary"}),e.jsx("span",{className:"font-medium text-gray-900",children:l(t.baseSalary,t.currency)})]}),t.earnings.map((s,n)=>e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:s.description}),e.jsx("span",{className:"font-medium text-gray-900",children:l(s.amount,t.currency)})]},n)),e.jsxs("div",{className:"flex justify-between text-sm pt-3 border-t border-gray-100 font-bold",children:[e.jsx("span",{className:"text-gray-800",children:"Total Gross Pay"}),e.jsx("span",{className:"text-gray-900",children:l(t.grossPay,t.currency)})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xs font-black text-gray-400 uppercase tracking-widest mb-4",children:"Deductions"}),e.jsxs("div",{className:"space-y-3",children:[t.deductions.map((s,n)=>e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:s.description}),e.jsxs("span",{className:"font-medium text-red-600",children:["-",l(s.amount,t.currency)]})]},n)),t.deductions.length===0&&e.jsx("p",{className:"text-sm text-gray-400 italic",children:"No deductions"}),e.jsxs("div",{className:"flex justify-between text-sm pt-3 border-t border-gray-100 font-bold",children:[e.jsx("span",{className:"text-gray-800",children:"Total Deductions"}),e.jsxs("span",{className:"text-red-600",children:["-",l(t.totalDeductions,t.currency)]})]})]})]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-xl p-6 flex justify-between items-center border border-gray-100",children:[e.jsx("span",{className:"text-lg font-bold text-gray-700",children:"Net Pay"}),e.jsx("span",{className:"text-3xl font-black text-indigo-600",children:l(t.netPay,t.currency)})]}),x&&e.jsxs("div",{className:"mt-8 flex justify-end print:hidden",children:[e.jsx("button",{onClick:x,className:"px-4 py-2 text-sm font-bold text-gray-500 hover:text-gray-900",children:"Close"}),e.jsx("button",{onClick:()=>window.print(),className:"ml-4 px-6 py-2 bg-gray-900 text-white rounded-lg text-sm font-bold shadow-lg hover:bg-black",children:"Print Payslip"})]})]})},E=({payrollService:t,settings:x,accounts:l,currentUser:s,onComplete:n,onCancel:b})=>{const[d,p]=c.useState(1),[o,h]=c.useState(new Date().toISOString().slice(0,7)),[g,m]=c.useState(!1),[i,u]=c.useState(null),[a,N]=c.useState([]),[j,w]=c.useState(null),k=async()=>{m(!0);try{const{run:r,slips:S}=await t.generatePayrollRun(o,x,s.uid,s.name);S.length===0?f.error("No eligible employees found for payroll."):(u(r),N(S),p(2))}catch(r){console.error(r),f.error("Failed to generate payroll draft.")}finally{m(!1)}},P=async()=>{if(i){m(!0);try{await t.approvePayrollRun(i,a,s.uid,s.name,x,l),f.success("Payroll Run Approved & Posted!"),n()}catch(r){console.error(r),f.error("Failed to approve payroll run.")}finally{m(!1)}}};return j?e.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto bg-gray-900 bg-opacity-90 flex items-center justify-center p-4",children:e.jsx(L,{slip:j,onClose:()=>w(null)})}):e.jsxs(v,{className:"max-w-4xl mx-auto",children:[e.jsxs("div",{className:"border-b border-gray-100 pb-4 mb-6 flex justify-between items-center",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Run Payroll"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-bold ${d===1?"bg-indigo-600 text-white":"bg-gray-100 text-gray-500"}`,children:"1. Select Period"}),e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-bold ${d===2?"bg-indigo-600 text-white":"bg-gray-100 text-gray-500"}`,children:"2. Review"}),e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-bold ${d===3?"bg-indigo-600 text-white":"bg-gray-100 text-gray-500"}`,children:"3. Finalize"})]})]}),d===1&&e.jsxs("div",{className:"space-y-6 py-8",children:[e.jsxs("div",{className:"max-w-xs mx-auto text-center space-y-4",children:[e.jsx("label",{className:"block text-sm font-bold text-gray-700",children:"Select Month"}),e.jsx(F,{type:"month",value:o,onChange:r=>h(r.target.value),className:"text-center text-lg font-bold"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Generating payroll for all active employees with a base salary."})]}),e.jsx("div",{className:"flex justify-center pt-4",children:e.jsx(y,{onClick:k,isLoading:g,size:"lg",children:"Generate Draft"})})]}),d===2&&i&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center bg-gray-50 p-4 rounded-xl border border-gray-200",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-bold text-gray-500 uppercase",children:"Total Payroll Cost"}),e.jsx("div",{className:"text-2xl font-black text-indigo-600",children:new Intl.NumberFormat("en-US",{style:"currency",currency:i.currency}).format(i.totalAmount)})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-xs font-bold text-gray-500 uppercase",children:"Employees"}),e.jsx("div",{className:"text-xl font-bold text-gray-900",children:a.length})]})]}),e.jsx("div",{className:"overflow-x-auto border border-gray-100 rounded-xl",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-bold text-gray-500 uppercase",children:"Employee"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-bold text-gray-500 uppercase",children:"Gross"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-bold text-gray-500 uppercase",children:"Deductions"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-bold text-gray-500 uppercase",children:"Net Pay"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-bold text-gray-500 uppercase",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-100",children:a.map(r=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsxs("td",{className:"px-4 py-3",children:[e.jsx("div",{className:"text-sm font-bold text-gray-900",children:r.employeeName}),e.jsx("div",{className:"text-xs text-gray-500",children:r.employeeRole})]}),e.jsx("td",{className:"px-4 py-3 text-right text-sm font-medium text-gray-600",children:r.grossPay.toFixed(2)}),e.jsxs("td",{className:"px-4 py-3 text-right text-sm font-medium text-red-500",children:["-",r.totalDeductions.toFixed(2)]}),e.jsxs("td",{className:"px-4 py-3 text-right text-sm font-bold text-gray-900",children:[r.netPay.toFixed(2)," ",r.currency]}),e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsx("button",{onClick:()=>w(r),className:"text-indigo-600 hover:text-indigo-900 text-xs font-bold border border-indigo-100 px-2 py-1 rounded bg-indigo-50",children:"View Slip"})})]},r.id))})]})}),e.jsxs("div",{className:"flex justify-between pt-4 border-t border-gray-100",children:[e.jsx(y,{variant:"outline",onClick:()=>p(1),children:"Back"}),e.jsxs("div",{className:"space-x-4",children:[e.jsx(y,{variant:"outline",onClick:b,children:"Cancel"}),e.jsx(y,{onClick:P,isLoading:g,className:"bg-green-600 hover:bg-green-700",children:"Approve & Post to GL"})]})]})]})]})};function W(){const{settings:t,accounts:x,refreshData:l}=D(),{user:s}=R(),n=new C,b=new A,d=new I(n,b),[p,o]=c.useState("LIST"),[h,g]=c.useState([]),[m,i]=c.useState(!0),u=async()=>{i(!0);try{const a=await n.getPayrollRuns();a.sort((N,j)=>j.period.localeCompare(N.period)),g(a)}catch(a){console.error(a)}finally{i(!1)}};return c.useEffect(()=>{u()},[]),p==="WIZARD"?e.jsx(E,{payrollService:d,settings:t,accounts:x,currentUser:{uid:(s==null?void 0:s.uid)||"",name:(s==null?void 0:s.name)||"Admin"},onComplete:()=>{l(),u(),o("LIST")},onCancel:()=>o("LIST")}):e.jsxs("div",{className:"space-y-8 animate-in fade-in",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-extrabold text-gray-900 tracking-tight",children:"Payroll"}),e.jsx("p",{className:"text-gray-500 font-medium",children:"Process salaries, generate payslips, and manage staff payments."})]}),e.jsx(y,{onClick:()=>o("WIZARD"),className:"bg-indigo-600 shadow-lg shadow-indigo-200",children:"Run Payroll"})]}),e.jsxs(v,{children:[e.jsx("div",{className:"px-6 py-4 border-b border-gray-100",children:e.jsx("h3",{className:"font-bold text-gray-900",children:"Payroll History"})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-100",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-black text-gray-400 uppercase tracking-wider",children:"Period"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-black text-gray-400 uppercase tracking-wider",children:"Run Date"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-black text-gray-400 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-black text-gray-400 uppercase tracking-wider",children:"Total Amount"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-black text-gray-400 uppercase tracking-wider pl-8",children:"Approved By"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-black text-gray-400 uppercase tracking-wider",children:"GL Entry"})]})}),e.jsxs("tbody",{className:"divide-y divide-gray-50",children:[h.map(a=>e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-6 py-4 text-sm font-bold text-gray-900",children:a.period}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-500",children:new Date(a.createdAt).toLocaleDateString()}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:`px-2 py-1 rounded-md text-xs font-black uppercase tracking-wide ${a.status==="APPROVED"?"bg-green-100 text-green-700":a.status==="PAID"?"bg-blue-100 text-blue-700":"bg-gray-100 text-gray-600"}`,children:a.status})}),e.jsx("td",{className:"px-6 py-4 text-right text-sm font-bold text-indigo-900",children:new Intl.NumberFormat("en-US",{style:"currency",currency:a.currency}).format(a.totalAmount)}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-600 pl-8",children:a.approvedByName||"-"}),e.jsx("td",{className:"px-6 py-4 text-right text-xs font-mono text-gray-400",children:a.journalEntryId||"-"})]},a.id)),h.length===0&&!m&&e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"px-6 py-12 text-center text-gray-400 font-medium",children:"No payroll runs found. Start your first run above."})})]})]})})]})]})}export{W as default};
