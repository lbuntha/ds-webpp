import{r as l,j as t}from"./index-BUL6LB55.js";import{B as C}from"./Button-CqEssTF4.js";import{t as S}from"./toast-DfW6NkLH.js";const W=({initialLat:h,initialLng:x,onConfirm:z,onClose:w})=>{const d=l.useRef(null),u=l.useRef(null),[i,M]=l.useState(null),[m,E]=l.useState(null),[o,R]=l.useState(h&&x?{lat:h,lng:x}:null),[g,j]=l.useState(""),[B,y]=l.useState(!0),[I,k]=l.useState(null),b={lat:11.5564,lng:104.9282};l.useEffect(()=>{if(!document.getElementById("leaflet-css")){const e=document.createElement("link");e.id="leaflet-css",e.rel="stylesheet",e.href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css",document.head.appendChild(e)}if(window.L)setTimeout(v,100);else{const e=document.createElement("script");e.src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js",e.async=!0,e.onload=v,e.onerror=()=>k("Failed to load map resources."),document.body.appendChild(e)}return()=>{i&&i.remove()}},[]);const v=()=>{if(d.current&&!d.current._leaflet_id)try{const e=(o==null?void 0:o.lat)||b.lat,n=(o==null?void 0:o.lng)||b.lng,s=window.L.map(d.current).setView([e,n],15);window.L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"Â© OpenStreetMap contributors"}).addTo(s);const a=window.L.icon({iconUrl:"https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon.png",iconRetinaUrl:"https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon-2x.png",shadowUrl:"https://unpkg.com/leaflet@1.9.4/dist/images/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]}),r=window.L.marker([e,n],{draggable:!0,icon:a}).addTo(s);M(s),E(r),y(!1),s.on("click",c=>{f(c.latlng.lat,c.latlng.lng,r,s)}),r.on("dragend",c=>{const p=c.target.getLatLng();f(p.lat,p.lng,r,s,!1)}),o&&L(e,n)}catch(e){console.error(e),k("Map init failed"),y(!1)}},f=(e,n,s,a,r=!0)=>{R({lat:e,lng:n}),s.setLatLng([e,n]),r&&a.panTo([e,n]),L(e,n)},L=async(e,n)=>{try{const a=await(await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${e}&lon=${n}`)).json();a&&a.display_name&&(j(a.display_name),u.current&&(u.current.value=a.display_name))}catch(s){console.error("Geocoding failed",s)}},N=async()=>{var n;const e=(n=u.current)==null?void 0:n.value;if(e)try{const a=await(await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(e)}`)).json();if(a&&a.length>0){const r=a[0],c=parseFloat(r.lat),p=parseFloat(r.lon);m&&i&&(f(c,p,m,i),j(r.display_name))}else S.warning("Location not found")}catch{S.error("Search failed")}},_=()=>{navigator.geolocation&&navigator.geolocation.getCurrentPosition(e=>{const{latitude:n,longitude:s}=e.coords;m&&i&&f(n,s,m,i)})},F=()=>{o&&z(o.lat,o.lng,g)};return t.jsx("div",{className:"fixed inset-0 z-[60] flex items-center justify-center bg-gray-900 bg-opacity-75 backdrop-blur-sm p-4",children:t.jsxs("div",{className:"bg-white w-full max-w-3xl rounded-2xl shadow-2xl overflow-hidden flex flex-col h-[80vh]",children:[t.jsxs("div",{className:"px-6 py-4 border-b border-gray-100 flex justify-between items-center bg-white z-10",children:[t.jsx("h3",{className:"text-lg font-bold text-gray-900",children:"Select Location"}),t.jsx("button",{onClick:w,className:"text-gray-400 hover:text-gray-600",children:t.jsx("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})})]}),t.jsxs("div",{className:"relative flex-1 bg-gray-100",children:[B&&t.jsx("div",{className:"absolute inset-0 flex items-center justify-center z-10 bg-gray-100 text-gray-500",children:"Loading Map..."}),t.jsxs("div",{className:"absolute top-4 left-4 right-4 z-[400] mx-auto max-w-lg flex gap-2",children:[t.jsxs("div",{className:"relative flex-1 shadow-lg rounded-xl",children:[t.jsx("input",{ref:u,type:"text",placeholder:"Search address (OpenStreetMap)...",className:"w-full pl-10 pr-4 py-3 rounded-xl border-none focus:ring-2 focus:ring-indigo-500 text-sm focus:outline-none",onKeyDown:e=>e.key==="Enter"&&N()}),t.jsx("svg",{className:"w-5 h-5 text-gray-400 absolute left-3 top-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})]}),t.jsx("button",{onClick:N,className:"bg-indigo-600 text-white px-4 rounded-xl font-medium shadow-lg hover:bg-indigo-700",children:"Search"})]}),t.jsx("button",{onClick:_,className:"absolute bottom-6 right-4 z-[400] bg-white p-3 rounded-full shadow-lg text-gray-600 hover:text-indigo-600 transition-colors",title:"Current Location",children:t.jsxs("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"}),t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M15 11a3 3 0 11-6 0 3 3 0 016 0z"})]})}),t.jsx("div",{ref:d,className:"w-full h-full z-0"})]}),t.jsxs("div",{className:"p-4 border-t border-gray-100 bg-white flex flex-col sm:flex-row justify-between items-center gap-4",children:[t.jsxs("div",{className:"text-sm text-gray-600 truncate w-full sm:w-auto",children:[g?t.jsx("span",{className:"font-medium text-gray-900",children:g}):t.jsx("span",{className:"italic",children:"Click map to select"}),o&&t.jsxs("div",{className:"text-xs text-gray-400 font-mono mt-0.5",children:[(o.lat||0).toFixed(6),", ",(o.lng||0).toFixed(6)]})]}),t.jsxs("div",{className:"flex gap-2 w-full sm:w-auto",children:[t.jsx(C,{variant:"outline",onClick:w,className:"flex-1 sm:flex-none",children:"Cancel"}),t.jsx(C,{onClick:F,disabled:!o,className:"flex-1 sm:flex-none bg-indigo-600 hover:bg-indigo-700",children:"Confirm Location"})]})]})]})})};export{W as L};
