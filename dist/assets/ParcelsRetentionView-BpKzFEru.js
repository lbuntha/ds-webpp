import{r as o,j as e,f as j}from"./index-BUL6LB55.js";import{C as A}from"./Card-k44aVk4n.js";import{B as k}from"./Button-CqEssTF4.js";const S=()=>{const[b,p]=o.useState(!0),[u,v]=o.useState([]),[h,N]=o.useState([]),[a,d]=o.useState("ALL");o.useEffect(()=>{(async()=>{p(!0);try{const[r,m]=await Promise.all([j.getCustomers(),j.getParcelBookings()]);v(r),N(m)}catch(r){console.error(r)}finally{p(!1)}})()},[]);const c=o.useMemo(()=>{const t=new Date;t.setHours(0,0,0,0);const r={};return h.forEach(s=>{s.senderId&&(!r[s.senderId]||s.bookingDate>r[s.senderId])&&(r[s.senderId]=s.bookingDate)}),u.map(s=>{const n=r[s.id];let l=-1;if(n){const f=new Date(n);f.setHours(0,0,0,0);const D=t.getTime()-f.getTime();l=Math.floor(D/(1e3*60*60*24))}let i="ACTIVE";return l===-1?i="NEVER":l>7?i="OVER_7":l===7?i="7_DAYS":l>=5?i="5_DAYS":l>=2?i="2_DAYS":i="ACTIVE",{...s,lastActiveDate:n,daysInactive:l,bucket:i}}).filter(s=>s.bucket!=="NEVER").sort((s,n)=>n.daysInactive-s.daysInactive)},[u,h]),x=o.useMemo(()=>({d2:c.filter(t=>t.bucket==="2_DAYS").length,d5:c.filter(t=>t.bucket==="5_DAYS").length,d7:c.filter(t=>t.bucket==="7_DAYS").length,over7:c.filter(t=>t.bucket==="OVER_7").length}),[c]),y=c.filter(t=>a==="ALL"||t.bucket===a),g=({label:t,count:r,active:m,onClick:s,colorClass:n})=>e.jsxs("div",{onClick:s,className:`p-4 rounded-xl border cursor-pointer transition-all ${m?`ring-2 ring-offset-2 ${n.ring} bg-white`:"bg-gray-50 border-gray-200 hover:bg-white"}`,children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-bold text-gray-500 uppercase",children:t}),e.jsx("h3",{className:`text-2xl font-bold mt-1 ${n.text}`,children:r})]}),e.jsx("div",{className:`p-2 rounded-full ${n.bg} ${n.text}`,children:e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})})})]}),e.jsx("p",{className:"text-[10px] text-gray-400 mt-2",children:"Customers Inactive"})]});return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center print:hidden",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900",children:"Customer Retention Report"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Identify inactive customers who have stopped booking."})]}),e.jsx(k,{variant:"outline",onClick:()=>window.print(),children:"Print Report"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(g,{label:"2-4 Days",count:x.d2,active:a==="2_DAYS",onClick:()=>d(a==="2_DAYS"?"ALL":"2_DAYS"),colorClass:{text:"text-yellow-600",bg:"bg-yellow-100",ring:"ring-yellow-500"}}),e.jsx(g,{label:"5-6 Days",count:x.d5,active:a==="5_DAYS",onClick:()=>d(a==="5_DAYS"?"ALL":"5_DAYS"),colorClass:{text:"text-orange-600",bg:"bg-orange-100",ring:"ring-orange-500"}}),e.jsx(g,{label:"Exactly 7 Days",count:x.d7,active:a==="7_DAYS",onClick:()=>d(a==="7_DAYS"?"ALL":"7_DAYS"),colorClass:{text:"text-red-500",bg:"bg-red-100",ring:"ring-red-400"}}),e.jsx(g,{label:"> 7 Days (Churn)",count:x.over7,active:a==="OVER_7",onClick:()=>d(a==="OVER_7"?"ALL":"OVER_7"),colorClass:{text:"text-slate-600",bg:"bg-slate-200",ring:"ring-slate-500"}})]}),e.jsx(A,{children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Customer"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Phone"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Last Booking"}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase",children:"Days Inactive"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"Status"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:b?e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"text-center py-8 text-gray-500",children:"Loading analysis..."})}):y.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"text-center py-8 text-gray-500",children:"No customers found in this category."})}):y.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsxs("td",{className:"px-6 py-4",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:t.name}),e.jsx("div",{className:"text-xs text-gray-500",children:t.email})]}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-500",children:t.phone}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-900 font-mono",children:t.lastActiveDate||"N/A"}),e.jsxs("td",{className:"px-6 py-4 text-center",children:[e.jsx("span",{className:"text-lg font-bold text-gray-700",children:t.daysInactive}),e.jsx("span",{className:"text-xs text-gray-400 ml-1",children:"days"})]}),e.jsxs("td",{className:"px-6 py-4 text-right",children:[t.bucket==="ACTIVE"&&e.jsx("span",{className:"bg-green-100 text-green-800 text-xs px-2 py-1 rounded font-bold",children:"Active"}),t.bucket==="2_DAYS"&&e.jsx("span",{className:"bg-yellow-100 text-yellow-800 text-xs px-2 py-1 rounded font-bold",children:"Slipping"}),t.bucket==="5_DAYS"&&e.jsx("span",{className:"bg-orange-100 text-orange-800 text-xs px-2 py-1 rounded font-bold",children:"At Risk"}),(t.bucket==="7_DAYS"||t.bucket==="OVER_7")&&e.jsx("span",{className:"bg-red-100 text-red-800 text-xs px-2 py-1 rounded font-bold",children:"Inactive"})]})]},t.id))})]})})})]})};function E(){return e.jsx(S,{})}export{E as default};
