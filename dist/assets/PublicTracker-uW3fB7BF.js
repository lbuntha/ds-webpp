import{r as a,j as e,f as h}from"./index-BUL6LB55.js";import{B as L}from"./Button-CqEssTF4.js";import{T as C}from"./TrackingTimeline--cIDV8xm.js";const T=({onClose:l})=>{const[c,b]=a.useState(""),[y,u]=a.useState(!1),[d,m]=a.useState(null),[x,i]=a.useState(""),v=async o=>{if(o.preventDefault(),!!c.trim()){u(!0),i(""),m(null);try{const t=c.trim();let n=[],s;const f=await h.getCurrentUser();if(f&&(n=await h.getUserBookings(f)),s=n.find(r=>r.id.toLowerCase()===t.toLowerCase()||r.id.toLowerCase().endsWith(t.toLowerCase())||r.id.toLowerCase().includes(t.toLowerCase())&&t.length>5),!s&&t.startsWith("pb-")){const r=await h.getDocument("parcel_bookings",t);r&&(s=r)}let g;if(!s&&n.length>0)for(const r of n){const p=r.items.find(w=>{var k,j;return((k=w.trackingCode)==null?void 0:k.toLowerCase())===t.toLowerCase()||((j=w.trackingCode)==null?void 0:j.toLowerCase().endsWith(t.toLowerCase()))});if(p){s=r,g=p.id;break}}s?m({booking:s,highlightItemId:g}):i("No shipment found. Please check your reference number.")}catch(t){console.error(t),t.code==="permission-denied"?i("Access denied. You can only track your own shipments."):i("An error occurred while searching.")}finally{u(!1)}}};return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-gray-900 bg-opacity-70 backdrop-blur-sm p-4",onClick:l,children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-2xl overflow-hidden flex flex-col max-h-[90vh]",onClick:o=>o.stopPropagation(),children:[e.jsxs("div",{className:"bg-gradient-to-r from-red-600 to-red-800 p-6 text-white",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Track Shipment"}),e.jsx("p",{className:"text-red-100 text-sm mt-1",children:"Enter your Booking Reference or Parcel Tracking Code"})]}),e.jsx("button",{onClick:l,className:"text-white/80 hover:text-white p-1 bg-white/10 rounded-full hover:bg-white/20 transition-colors",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("form",{onSubmit:v,className:"mt-6 flex flex-col sm:flex-row gap-3",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("input",{className:"w-full pl-10 pr-4 py-3 rounded-xl border-none focus:ring-2 focus:ring-red-400 text-gray-900 placeholder-gray-400 shadow-lg",placeholder:"e.g. PB-123456 or TRK-999",value:c,onChange:o=>b(o.target.value),autoFocus:!0}),e.jsx("svg",{className:"w-5 h-5 text-gray-400 absolute left-3 top-3.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})]}),e.jsx(L,{type:"submit",isLoading:y,className:"w-full sm:w-auto bg-white text-red-700 hover:bg-red-50 font-bold px-6 py-3 shadow-lg border-none justify-center",children:"Track"})]}),x&&e.jsx("p",{className:"text-red-200 text-sm mt-2 font-medium bg-red-900/30 inline-block px-2 py-1 rounded",children:x})]}),e.jsx("div",{className:"flex-1 overflow-y-auto bg-gray-50",children:d?e.jsx("div",{className:"p-4",children:e.jsx(C,{booking:d.booking,initialChatItemId:d.highlightItemId,onClose:l,hideCloseButton:!0})}):e.jsxs("div",{className:"flex flex-col items-center justify-center h-64 text-gray-400",children:[e.jsx("div",{className:"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mb-4",children:e.jsx("svg",{className:"w-8 h-8 text-gray-300",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1.5",d:"M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 7m0 13V7m0 0L9.553 4.553A1 1 0 009 7"})})}),e.jsx("p",{children:"Enter a tracking number to see status details."})]})})]})})};export{T as P};
