import{r as o,f as l,j as e}from"./index-BUL6LB55.js";import{t as j}from"./toast-DfW6NkLH.js";const N=({itemId:a,bookingId:d,itemName:p,currentUser:i,recipientName:n,recipientId:c,onClose:x})=>{const[h,w]=o.useState([]),[r,m]=o.useState(""),u=o.useRef(null);o.useEffect(()=>{const t=l.subscribeToChat(a,s=>{w(s),setTimeout(()=>{var f;(f=u.current)==null||f.scrollIntoView({behavior:"smooth"})},100)});return()=>t()},[a]);const g=async()=>{if(!r.trim())return;const t={id:`msg-${Date.now()}`,itemId:a,bookingId:d,senderId:i.uid,senderName:i.name,senderRole:i.role==="driver"?"driver":"customer",text:r.trim(),timestamp:Date.now()};try{if(await l.sendChatMessage(t),c){const s={id:`notif-chat-${Date.now()}`,targetAudience:c,title:`New message from ${i.name}`,message:r.trim().substring(0,60)+(r.length>60?"...":""),type:"INFO",read:!1,createdAt:Date.now(),metadata:{type:"CHAT",bookingId:d,itemId:a}};await l.sendNotification(s)}m("")}catch(s){console.error(s),j.error("Failed to send message")}},b=t=>{t.key==="Enter"&&!t.shiftKey&&(t.preventDefault(),g())};return e.jsx("div",{className:"fixed inset-0 z-[60] flex items-center justify-center bg-black bg-opacity-50 p-4 backdrop-blur-sm",onClick:x,children:e.jsxs("div",{className:"bg-white w-full max-w-md h-[500px] rounded-2xl flex flex-col shadow-2xl overflow-hidden",onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{className:"px-4 py-3 bg-indigo-600 text-white flex justify-between items-center shadow-md",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-8 h-8 bg-white/20 rounded-full flex items-center justify-center text-white font-bold",children:n.charAt(0)}),e.jsx("div",{className:"absolute bottom-0 right-0 w-2.5 h-2.5 bg-green-400 border-2 border-indigo-600 rounded-full"})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-sm",children:n}),e.jsx("p",{className:"text-xs text-indigo-200 truncate max-w-[150px]",children:p})]})]}),e.jsx("button",{onClick:x,className:"text-indigo-200 hover:text-white p-1 rounded-full hover:bg-white/10 transition-colors",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 bg-gray-50 space-y-3",children:[h.length===0&&e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-gray-400 text-xs",children:[e.jsx("svg",{className:"w-12 h-12 mb-2 text-gray-300",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1.5",d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})}),e.jsxs("p",{children:["Start the conversation with ",n]})]}),h.map(t=>{const s=t.senderId===i.uid;return e.jsx("div",{className:`flex ${s?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:`max-w-[85%] rounded-2xl px-4 py-2.5 text-sm shadow-sm relative group ${s?"bg-indigo-600 text-white rounded-br-none":"bg-white text-gray-800 border border-gray-200 rounded-bl-none"}`,children:[!s&&e.jsx("div",{className:"text-[10px] font-bold text-gray-500 mb-0.5",children:t.senderName}),e.jsx("p",{className:"leading-relaxed",children:t.text}),e.jsx("div",{className:`text-[9px] mt-1 text-right opacity-70 ${s?"text-indigo-100":"text-gray-400"}`,children:new Date(t.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})},t.id)}),e.jsx("div",{ref:u})]}),e.jsx("div",{className:"p-3 bg-white border-t border-gray-200",children:e.jsxs("div",{className:"flex gap-2 items-end",children:[e.jsx("div",{className:"flex-1 relative",children:e.jsx("textarea",{className:"w-full border border-gray-300 rounded-2xl pl-4 pr-10 py-3 text-sm focus:outline-none focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 resize-none overflow-hidden",placeholder:"Type a message...",rows:1,style:{minHeight:"44px",maxHeight:"100px"},value:r,onChange:t=>m(t.target.value),onKeyDown:b,autoFocus:!0})}),e.jsx("button",{onClick:g,disabled:!r.trim(),className:"bg-indigo-600 text-white rounded-full p-3 hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors shadow-md h-11 w-11 flex items-center justify-center",children:e.jsx("svg",{className:"w-5 h-5 translate-x-0.5 translate-y-[-1px]",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"})})})]})})]})})};export{N as C};
