import{b as O,r as i,s as x,j as e}from"./index-BUL6LB55.js";import{t as m}from"./toast-DfW6NkLH.js";import{P as w}from"./package-BdetSlVF.js";import{P as I}from"./plus-rnI6Vdzr.js";import{S as $}from"./search-DTZoH1GY.js";import{P as X,T as z}from"./trash-2-CYr50t1o.js";import{X as Z,C as _}from"./x-C56ZNX5h.js";import{C as G}from"./camera-zNyZa9TX.js";import"./createLucideIcon-CEuAjdeA.js";const C={id:"",productName:"",sku:"",attributes:[{name:"Model",value:""},{name:"Color",value:""},{name:"Size",value:""}],description:"",defaultPrice:void 0,priceCurrency:"USD",image:"",isActive:!0},ie=()=>{const{user:c}=O(),[k,F]=i.useState([]),[M,g]=i.useState(!0),[P,S]=i.useState(!1),[h,L]=i.useState(""),[R,u]=i.useState(!1),[p,A]=i.useState(null),[r,a]=i.useState(C),[b,f]=i.useState(null),[y,D]=i.useState(!1);i.useEffect(()=>{const t=r.attributes.map(s=>s.value).filter(s=>s&&s.trim());if(t.length>0){const s=t.join("-").toUpperCase().replace(/\s+/g,"");a(l=>({...l,sku:s}))}},[r.attributes]);const E=(t,s,l)=>{a(d=>{const o=[...d.attributes];return o[t]={...o[t],[s]:l},{...d,attributes:o}})},T=()=>{a(t=>({...t,attributes:[...t.attributes,{name:"",value:""}]}))},B=t=>{a(s=>({...s,attributes:s.attributes.filter((l,d)=>d!==t)}))};i.useEffect(()=>{v()},[c]);const j=()=>(c==null?void 0:c.linkedCustomerId)||(c==null?void 0:c.uid),v=async()=>{const t=j();if(!t){g(!1);return}g(!0);try{const s=await x.getCustomerProducts(t);F(s)}catch(s){console.error("Error loading products:",s),m.error("Failed to load products")}finally{g(!1)}},U=k.filter(t=>{var s;return t.productName.toLowerCase().includes(h.toLowerCase())||((s=t.sku)==null?void 0:s.toLowerCase().includes(h.toLowerCase()))}),H=()=>{a({...C,id:`prod-${Date.now()}-${Math.random().toString(36).substr(2,9)}`}),A(null),u(!0)},K=t=>{a({id:t.id,productName:t.productName,sku:t.sku||"",attributes:t.attributes||[{name:"Model",value:""},{name:"Color",value:""},{name:"Size",value:""}],description:t.description||"",defaultPrice:t.defaultPrice,priceCurrency:t.priceCurrency||"USD",image:t.image||"",isActive:t.isActive}),A(r),u(!0)},V=async()=>{var s,l,d;if(!r.productName.trim()){m.warning("Please enter a product name");return}if(!j()){m.error("Customer account not found");return}S(!0);try{let o=r.image;r.image&&r.image.startsWith("data:")&&(o=await x.uploadImage(r.image));const N={id:r.id,customerId:j(),customerName:(c==null?void 0:c.name)||"",productName:r.productName.trim(),sku:((s=r.sku)==null?void 0:s.trim())||void 0,attributes:r.attributes.filter(n=>n.name.trim()&&n.value.trim()),description:((l=r.description)==null?void 0:l.trim())||void 0,defaultPrice:r.defaultPrice,priceCurrency:r.priceCurrency,image:o||void 0,isActive:r.isActive,createdAt:p&&((d=k.find(n=>n.id===r.id))==null?void 0:d.createdAt)||Date.now(),updatedAt:Date.now()};await x.saveProduct(N),m.success(p?"Product updated!":"Product added!"),u(!1),a(C),v()}catch(o){console.error("Error saving product:",o),m.error("Failed to save product")}finally{S(!1)}},W=async()=>{if(b){D(!0);try{await x.deleteProduct(b),m.success("Product deleted"),f(null),v()}catch(t){console.error("Error deleting product:",t),m.error(t.message||"Failed to delete product")}finally{D(!1)}}},q=t=>{var d;const s=(d=t.target.files)==null?void 0:d[0];if(!s)return;const l=new FileReader;l.onload=o=>{a(N=>{var n;return{...N,image:(n=o.target)==null?void 0:n.result}})},l.readAsDataURL(s)};return M?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-red-600"})}):e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(w,{className:"w-8 h-8 text-red-600"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"My Products"}),e.jsx("p",{className:"text-gray-500",children:"Manage your product catalog for stock requests"})]})]}),e.jsxs("button",{onClick:H,className:"flex items-center gap-2 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors",children:[e.jsx(I,{className:"w-5 h-5"}),"Add Product"]})]}),e.jsxs("div",{className:"relative max-w-md",children:[e.jsx($,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search products...",value:h,onChange:t=>L(t.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500"})]}),U.length===0?e.jsxs("div",{className:"text-center py-12 bg-gray-50 rounded-lg",children:[e.jsx(w,{className:"w-12 h-12 mx-auto text-gray-400 mb-3"}),e.jsx("p",{className:"text-gray-500",children:"No products registered"}),e.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"Add products to your catalog to create stock requests"})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:U.map(t=>e.jsxs("div",{className:`bg-white rounded-lg shadow border ${t.isActive?"border-gray-200":"border-gray-300 opacity-60"} overflow-hidden`,children:[e.jsx("div",{className:"h-40 bg-gray-100 flex items-center justify-center",children:t.image?e.jsx("img",{src:t.image,alt:t.productName,className:"w-full h-full object-cover"}):e.jsx(w,{className:"w-12 h-12 text-gray-300"})}),e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:t.productName}),t.sku&&e.jsxs("p",{className:"text-sm text-gray-500",children:["SKU: ",t.sku]})]}),!t.isActive&&e.jsx("span",{className:"px-2 py-1 bg-gray-100 text-gray-600 text-xs rounded",children:"Inactive"})]}),t.description&&e.jsx("p",{className:"text-sm text-gray-600 mt-2 line-clamp-2",children:t.description}),t.defaultPrice&&e.jsxs("p",{className:"text-lg font-semibold text-red-600 mt-2",children:[t.defaultPrice," ",t.priceCurrency||"USD"]}),e.jsxs("div",{className:"flex gap-2 mt-4 pt-4 border-t border-gray-100",children:[e.jsxs("button",{onClick:()=>K(t),className:"flex-1 flex items-center justify-center gap-1 px-3 py-2 text-gray-600 hover:bg-gray-100 rounded-lg transition-colors",children:[e.jsx(X,{className:"w-4 h-4"}),"Edit"]}),e.jsxs("button",{onClick:()=>f(t.id),className:"flex-1 flex items-center justify-center gap-1 px-3 py-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors",children:[e.jsx(z,{className:"w-4 h-4"}),"Delete"]})]})]})]},t.id))}),R&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-md max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b",children:[e.jsx("h2",{className:"text-lg font-semibold",children:p?"Edit Product":"Add Product"}),e.jsx("button",{onClick:()=>u(!1),className:"p-1 hover:bg-gray-100 rounded",children:e.jsx(Z,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-bold text-gray-900 uppercase tracking-wider mb-4 border-b pb-2",children:"Basic Information"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"w-1/3",children:e.jsxs("label",{className:"cursor-pointer block",children:[e.jsx("div",{className:"aspect-square bg-gray-50 rounded-lg flex flex-col items-center justify-center overflow-hidden border-2 border-dashed border-gray-300 hover:border-red-400 hover:bg-gray-100 transition-colors",children:r.image?e.jsx("img",{src:r.image,alt:"Preview",className:"w-full h-full object-cover"}):e.jsxs("div",{className:"text-center p-4",children:[e.jsx(G,{className:"w-8 h-8 mx-auto text-gray-400 mb-2"}),e.jsx("span",{className:"text-xs text-gray-500 font-medium",children:"Click to upload photo"})]})}),e.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:q})]})}),e.jsxs("div",{className:"flex-1 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Product Name *"}),e.jsx("input",{type:"text",value:r.productName,onChange:t=>a(s=>({...s,productName:t.target.value})),placeholder:"e.g. Cotton T-Shirt",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),e.jsx("textarea",{value:r.description||"",onChange:t=>a(s=>({...s,description:t.target.value})),placeholder:"Enter product description...",rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500"})]})]})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"flex items-center justify-between mb-4 border-b pb-2",children:e.jsx("h3",{className:"text-sm font-bold text-gray-900 uppercase tracking-wider",children:"Variants & Identity"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["SKU / Barcode",e.jsx("span",{className:"ml-2 text-xs text-gray-400 font-normal",children:"(Auto-generated from attributes)"})]}),e.jsx("div",{className:"flex gap-2",children:e.jsx("input",{type:"text",value:r.sku||"",onChange:t=>a(s=>({...s,sku:t.target.value})),placeholder:"e.g. PRODUCT-SIZE-COLOR",className:"flex-1 px-3 py-2 bg-gray-50 border border-gray-300 rounded-lg text-gray-600 font-mono"})})]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg border border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-900",children:"Defining Attributes"}),e.jsxs("button",{onClick:T,className:"text-xs font-medium text-blue-600 hover:text-blue-700 flex items-center gap-1 bg-white px-2 py-1 rounded border border-gray-200 shadow-sm",children:[e.jsx(I,{className:"w-3 h-3"})," Add Attribute"]})]}),e.jsxs("div",{className:"space-y-2",children:[r.attributes.map((t,s)=>e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("div",{className:"w-1/3",children:e.jsx("input",{type:"text",value:t.name,onChange:l=>E(s,"name",l.target.value),placeholder:"Name (e.g. Size)",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 text-sm"})}),e.jsx("span",{className:"text-gray-400",children:":"}),e.jsx("div",{className:"flex-1",children:e.jsx("input",{type:"text",value:t.value,onChange:l=>E(s,"value",l.target.value),placeholder:"Value (e.g. XL)",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 text-sm"})}),e.jsx("button",{onClick:()=>B(s),className:"p-2 text-gray-400 hover:text-red-500 hover:bg-gray-100 rounded-lg transition-colors",title:"Remove attribute",children:e.jsx(z,{className:"w-4 h-4"})})]},s)),r.attributes.length===0&&e.jsxs("div",{className:"text-center py-6 border-2 border-dashed border-gray-300 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"No attributes defined."}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"Add attributes like Size, Color, or Weight to define this product."})]})]})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-bold text-gray-900 uppercase tracking-wider mb-4 border-b pb-2",children:"Financials & Status"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Default Price"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"number",value:r.defaultPrice||"",onChange:t=>a(s=>({...s,defaultPrice:parseFloat(t.target.value)||void 0})),placeholder:"0.00",className:"w-full pl-3 pr-16 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500"}),e.jsx("div",{className:"absolute right-1 top-1 bottom-1",children:e.jsxs("select",{value:r.priceCurrency||"USD",onChange:t=>a(s=>({...s,priceCurrency:t.target.value})),className:"h-full px-2 bg-gray-50 border-l border-gray-200 text-sm text-gray-600 rounded-r-md focus:outline-none",children:[e.jsx("option",{value:"USD",children:"USD"}),e.jsx("option",{value:"KHR",children:"KHR"})]})})]})]}),e.jsx("div",{className:"flex items-center",children:e.jsxs("label",{className:"flex items-center gap-3 p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50 transition-colors w-full h-[42px] mt-6",children:[e.jsx("input",{type:"checkbox",checked:r.isActive,onChange:t=>a(s=>({...s,isActive:t.target.checked})),className:"w-4 h-4 text-red-600 border-gray-300 rounded focus:ring-red-500"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:"Active Status"})]})})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 p-4 border-t",children:[e.jsx("button",{onClick:()=>u(!1),className:"px-4 py-2 text-gray-600 hover:bg-gray-100 rounded-lg transition-colors",children:"Cancel"}),e.jsx("button",{onClick:V,disabled:P,className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors flex items-center gap-2 disabled:opacity-50",children:P?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"animate-spin h-4 w-4",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4",fill:"none"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(_,{className:"w-4 h-4"}),"Save Product"]})})]})]})}),b&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-sm p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Delete Product?"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Are you sure you want to delete this product from your catalog?"}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx("button",{onClick:()=>f(null),disabled:y,className:"px-4 py-2 text-gray-600 hover:bg-gray-100 rounded-lg transition-colors disabled:opacity-50",children:"Cancel"}),e.jsxs("button",{onClick:W,disabled:y,className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors flex items-center gap-2 disabled:opacity-50",children:[y&&e.jsxs("svg",{className:"animate-spin h-4 w-4",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4",fill:"none"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Delete"]})]})]})})]})};export{ie as ProductCatalog,ie as default};
