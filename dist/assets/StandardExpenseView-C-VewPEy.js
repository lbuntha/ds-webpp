import{h as Y,b as Z,a as ee,r as a,f as U,j as e}from"./index-BUL6LB55.js";import{C as te}from"./Card-k44aVk4n.js";import{B as ae}from"./Button-CqEssTF4.js";import{I as y}from"./Input-fEXGFBn-.js";import{g as se}from"./errorUtils-CUS756ws.js";import{c as ne}from"./createLucideIcon-CEuAjdeA.js";import{S as re}from"./save-Y9IUSdaF.js";/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ie=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],ce=ne("circle-alert",ie);function pe(){const{accounts:d,taxRates:u,currencies:V}=Y(),{user:m}=Z(),_=ee(),[j,M]=a.useState([]),[x,O]=a.useState(""),[X,D]=a.useState(!0),[z,C]=a.useState(!1),[w,g]=a.useState(null),[E,A]=a.useState(null),[r,v]=a.useState(0),[T,G]=a.useState(new Date().toISOString().split("T")[0]),[R,k]=a.useState(""),[L,F]=a.useState(""),[i,q]=a.useState(""),[s,P]=a.useState(null),[o,H]=a.useState("USD");a.useEffect(()=>{J()},[]);const J=async()=>{try{D(!0);const t=await U.financeService.getExpenseTemplates();M(t||[])}catch(t){console.error(t),g("Failed to load templates")}finally{D(!1)}};a.useEffect(()=>{if(x){const t=j.find(p=>p.id===x);t&&(P(t),H(t.currency||"USD"),q(t.taxRateId||""),t.fixedAmount&&v(t.fixedAmount))}else P(null)},[x,j]);const K=async t=>{var p,$;if(t.preventDefault(),g(null),A(null),!(!s||!m)){if(r<=0){g("Amount must be greater than 0");return}try{C(!0);let c=0,f=r;if(i){const n=u.find(b=>b.id===i);n&&(f=r/(1+n.rate/100),c=r-f)}const l=((p=V.find(n=>n.code===o))==null?void 0:p.exchangeRate)||1,I={accountId:s.debitAccountId,debit:f/l,credit:0,originalDebit:f,originalCredit:0},Q={accountId:s.creditAccountId,debit:0,credit:r/l,originalDebit:0,originalCredit:r},B=[I,Q];if(c>0&&i){const n=u.find(h=>h.id===i),b=d.find(h=>h.name==="VAT-Input"&&h.currency===o);b?B.push({accountId:b.id,debit:c/l,credit:0,originalDebit:c,originalCredit:0}):(I.debit=r/l,I.originalDebit=r,console.warn("No tax account found, posting full amount to expense"))}const W={id:`je-exp-${Date.now()}`,date:T,description:`${s.name} - ${L||"Standard Expense"}`,reference:R||`EXP-${Date.now().toString().slice(-6)}`,branchId:m.managedBranchId||(($=d[0])==null?void 0:$.branchId)||"b1",currency:o,exchangeRate:l,originalTotal:r,createdAt:Date.now(),lines:B.map(n=>({accountId:n.accountId,debit:n.debit,credit:n.credit,originalCurrency:o,originalExchangeRate:l,originalDebit:n.originalDebit,originalCredit:n.originalCredit}))};await U.financeService.submitForApproval(W,m.uid,m.name),A("Expense submitted for approval successfully!"),v(0),k(""),F(""),setTimeout(()=>_("/app/banking"),1500)}catch(c){g(se(c))}finally{C(!1)}}};if(X)return e.jsx("div",{children:"Loading..."});const N=s?d.find(t=>t.id===s.debitAccountId):null,S=s?d.find(t=>t.id===s.creditAccountId):null;return u.find(t=>t.id===i),e.jsxs("div",{className:"max-w-3xl mx-auto space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"Post Standard Expense"}),E&&e.jsx("div",{className:"bg-green-50 text-green-700 p-4 rounded-lg border border-green-200",children:E}),w&&e.jsx("div",{className:"bg-red-50 text-red-600 p-4 rounded-lg border border-red-200",children:w}),e.jsx(te,{children:e.jsxs("form",{onSubmit:K,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Select Expense Template"}),e.jsxs("select",{className:"w-full text-lg border-gray-300 rounded-lg shadow-sm focus:ring-indigo-500 focus:border-indigo-500 py-3",value:x,onChange:t=>O(t.target.value),required:!0,children:[e.jsx("option",{value:"",children:"-- Choose an Expense Type --"}),j.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]}),s&&e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:s.description})]}),s&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(y,{label:"Date",type:"date",value:T,onChange:t=>G(t.target.value),required:!0}),e.jsx(y,{label:"Reference #",value:R,onChange:t=>k(t.target.value),placeholder:"Invoice/Receipt #"})]}),e.jsxs("div",{className:"bg-gray-50 p-6 rounded-xl border border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("label",{className:"block text-sm font-bold text-gray-700 mb-1",children:["Total Amount (",o,")"]}),e.jsx(y,{type:"number",step:"0.01",value:r,onChange:t=>v(parseFloat(t.target.value)),required:!0,className:"text-2xl font-bold text-gray-900",placeholder:"0.00"})]}),e.jsxs("div",{className:"w-1/3",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Tax?"}),e.jsxs("select",{className:"w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500",value:i,onChange:t=>q(t.target.value),children:[e.jsx("option",{value:"",children:"No Tax"}),u.map(t=>e.jsxs("option",{value:t.id,children:[t.name," (",t.rate,"%)"]},t.id))]})]})]}),e.jsx(y,{label:"Notes / Description",value:L,onChange:t=>F(t.target.value),className:"mt-4",placeholder:"Details about this expense..."})]}),e.jsxs("div",{className:"border border-indigo-100 bg-indigo-50/50 rounded-lg p-4 text-sm",children:[e.jsxs("h4",{className:"font-bold text-indigo-900 mb-2 flex items-center gap-2",children:[e.jsx(ce,{className:"w-4 h-4"})," Accounting Preview"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("span",{className:"block text-gray-500 text-xs",children:"Debit (Expense)"}),e.jsx("span",{className:"font-medium text-gray-800",children:(N==null?void 0:N.name)||"Loading..."})]}),e.jsxs("div",{children:[e.jsx("span",{className:"block text-gray-500 text-xs",children:"Credit (Payment)"}),e.jsx("span",{className:"font-medium text-gray-800",children:(S==null?void 0:S.name)||"Loading..."})]})]})]}),e.jsx("div",{className:"flex justify-end pt-4",children:e.jsx(ae,{type:"submit",isLoading:z,icon:e.jsx(re,{className:"w-5 h-5"}),children:"Submit Expense"})})]})]})})]})}export{pe as default};
