import{r as a,f as i,A as is,p as se,j as e,a3 as cs,b as ds,h as xs,y as ms}from"./index-BUL6LB55.js";import{C as Et}from"./Card-k44aVk4n.js";import{A as At}from"./Avatar-Cwp5HxF7.js";import{B as c}from"./Button-CqEssTF4.js";import{I as d}from"./Input-fEXGFBn-.js";import{t as o}from"./toast-DfW6NkLH.js";import{P as us}from"./PlaceAutocomplete-XL2CORH3.js";import{L as hs}from"./LocationPicker-BSHbKGYS.js";const gs=({users:L,branches:H=[],rolePermissions:N,onUpdateRole:P,onUpdateStatus:k,onUpdateProfile:v,onUpdatePermissions:x,onSyncProfile:h,onDeleteUser:$})=>{var St,kt;const[j,Lt]=a.useState("ACTIVE"),[W,Pt]=a.useState(""),[l,Y]=a.useState(null),[g,Oe]=a.useState("accountant"),[z,Ve]=a.useState("APPROVED"),[He,$e]=a.useState(""),[We,Ye]=a.useState(""),[ze,Ke]=a.useState(""),[ae,re]=a.useState(!1),[Ge,Ze]=a.useState(!1),[_e,Rt]=a.useState(""),[ps,Dt]=a.useState([]),[ne,le]=a.useState(!1),[qe,K]=a.useState(null),[w,G]=a.useState(null),[oe,Je]=a.useState(null),[n,C]=a.useState(null),[m,Qe]=a.useState(null),[It,Xe]=a.useState(!1),[y,R]=a.useState("USER"),[ie,D]=a.useState(null),[et,ce]=a.useState(""),[tt,de]=a.useState(""),[st,xe]=a.useState(""),[me,ue]=a.useState(),[Tt,at]=a.useState(!1),[rt,he]=a.useState(""),[nt,ge]=a.useState(""),[lt,pe]=a.useState(""),[ot,be]=a.useState(""),[p,Z]=a.useState(null),[I,T]=a.useState([]),[ye,_]=a.useState(void 0),[Ut,fe]=a.useState(""),[Ft,ve]=a.useState(""),[Bt,je]=a.useState(""),[Mt,Ne]=a.useState(""),[S,E]=a.useState([]),[Ot,we]=a.useState(""),[Vt,q]=a.useState(!1),[Ce,Se]=a.useState(""),[it,ke]=a.useState(""),[Ee,Ae]=a.useState(""),[Ht,J]=a.useState(!1),[Le,Pe]=a.useState(""),[Re,U]=a.useState(""),[F,B]=a.useState(""),[M,O]=a.useState(""),[$t,De]=a.useState(!1),[ct,Wt]=a.useState([]),[Ie,V]=a.useState([]),[Q,dt]=a.useState(""),[X,xt]=a.useState(""),[Te,mt]=a.useState(""),[ut,ht]=a.useState(new Date().toISOString().split("T")[0]),[gt,pt]=a.useState("2099-12-31"),[Yt,bt]=a.useState(!1),[f,ee]=a.useState(!1),Ue=!!P;a.useEffect(()=>{i.getAccounts().then(t=>{Dt(t.filter(s=>s.type===is.LIABILITY&&!s.isHeader))}),se.getParcelServices().then(Wt)},[]);const Fe=t=>{if(Lt(t),t==="ACCESS"&&N){const s={};for(const r in N)Object.prototype.hasOwnProperty.call(N,r)&&(s[r]=[...N[r]]);Qe(s)}},yt=a.useMemo(()=>L.map(t=>({...t,status:t.status||"APPROVED"})),[L]),te=a.useMemo(()=>{let t=yt;if(W){const s=W.toLowerCase();t=t.filter(r=>r.name.toLowerCase().includes(s)||r.email&&r.email.toLowerCase().includes(s)||r.phone&&r.phone.includes(s))}return t},[yt,W]),Be=a.useMemo(()=>te.filter(t=>t.status==="PENDING"),[te]),ft=a.useMemo(()=>te.filter(t=>t.status==="APPROVED"||t.status==="INACTIVE"),[te]),vt=j==="ACTIVE"?ft:Be,jt=async(t,s)=>{const u=(await i.getCustomers()).find(b=>b.linkedUserId===t||s&&b.id===s);if(u){Z(u),T(u.bankAccounts||[]),_(u.customExchangeRate),fe(u.name||""),ve(u.phone||""),je(u.email||""),Ne(u.address||""),E(u.savedLocations||[]),we(u.referralCode||""),re(u.isTaxable||!1),Ze(u.excludeFeesInSettlement||!1);try{bt(!0);const b=await se.getCustomerSpecialRates(u.id);V(b)}catch(b){console.error("Failed to load rates",b)}finally{bt(!1)}}else Z(null),T([]),_(void 0),fe(""),ve(""),je(""),Ne(""),E([]),we(""),V([])},zt=async t=>{const s=await i.hrService.getEmployeeByUserId(t);s?(D(s),ce(s.position||""),de(s.department||""),xe(s.hireDate||""),ue(s.baseSalaryAmount),at(s.isDriver||!1),he(s.vehicleType||""),ge(s.vehiclePlateNumber||""),pe(s.licenseNumber||""),be(s.zone||"")):(D(null),ce(""),de(""),xe(""),ue(void 0),at(!1),he(""),ge(""),pe(""),be(""))},Kt=async t=>{Y(t),Ye(t.name),Ke(t.phone||""),re(t.isTaxable||!1),Oe(t.role),Ve(t.status||"APPROVED"),Rt(t.walletAccountId||""),$e(t.managedBranchId||""),K(null),R("USER");try{await jt(t.uid,t.linkedCustomerId)}catch(s){console.error("Failed to load customer data:",s),Z(null)}if(t.role==="driver"||t.role==="warehouse")try{await zt(t.uid)}catch(s){console.error("Failed to load employee data:",s),D(null)}},Nt=()=>{Y(null),le(!1),K(null),Z(null),T([]),_(void 0),fe(""),ve(""),je(""),Ne(""),E([]),we(""),V([]),q(!1),J(!1),R("USER")},Gt=async()=>{l&&C({uid:l.uid,name:l.name,type:"DELETE",extra:{linkedCustomerId:l.linkedCustomerId}})},Zt=async()=>{var s;if(!n||n.type!=="DELETE"||!$)return;const t=(s=n.extra)==null?void 0:s.linkedCustomerId;try{G(n.uid),await $(n.uid,t),o.success("User deleted successfully"),Y(null),C(null)}catch(r){console.error("Delete failed:",r),o.error("Failed to delete user")}finally{G(null)}},_t=async()=>{if(!p||!Ce||!Ee){o.error("Please fill in bank name and account number");return}const t={id:`bank-${Date.now()}`,bankName:Ce,accountName:it,accountNumber:Ee},s=[...I,t];T(s);try{await i.updateCustomer({...p,bankAccounts:s}),o.success("Bank account added"),q(!1),Se(""),ke(""),Ae("")}catch(r){console.error("Error adding bank account:",r),o.error("Failed to add bank account")}},qt=t=>{T(s=>s.filter(r=>r.id!==t&&r.accountNumber!==t))},Jt=async()=>{if(!Le||!Re){o.error("Label and Address are required");return}if(!l)return;const t={id:Date.now().toString(),label:Le,address:Re,coordinates:F&&M?{lat:parseFloat(F),lng:parseFloat(M)}:void 0,isPrimary:S.length===0},s=[...S,t];E(s);try{await i.configService.updateUserLocations(l.uid,s),o.success("Location saved!")}catch(r){console.error("Failed to save location",r),o.error("Failed to save location")}Pe(""),U(""),B(""),O(""),J(!1)},Qt=async t=>{if(!l)return;const s=S.filter(r=>r.id!==t);E(s);try{await i.configService.updateUserLocations(l.uid,s),o.success("Location removed")}catch(r){console.error("Failed to remove location",r),o.error("Failed to remove location")}},Xt=async t=>{if(!l)return;const s=S.map(r=>({...r,isPrimary:r.id===t}));E(s);try{await i.configService.updateUserLocations(l.uid,s),o.success("Primary location updated")}catch(r){console.error("Failed to update primary location",r),o.error("Failed to update primary location")}},es=async()=>{if(!p||!Q||!X){o.error("Please select a service and enter a price.");return}const t=ct.find(r=>r.id===Q);if(!t){o.error("Selected service not found.");return}const s={id:Date.now().toString(),customerId:p.id,serviceTypeId:t.id,serviceName:t.name,price:parseFloat(X),priceKHR:Te?parseFloat(Te):void 0,startDate:ut,endDate:gt,createdAt:Date.now()};try{await se.saveCustomerSpecialRate(s),V([...Ie,s]),dt(""),xt(""),mt(""),ht(new Date().toISOString().split("T")[0]),pt("2099-12-31"),o.success("Special rate added")}catch(r){console.error("Error adding rate:",r),o.error("Failed to add rate")}},ts=async t=>{try{await se.deleteCustomerSpecialRate(t),V(s=>s.filter(r=>r.id!==t)),o.success("Rate removed")}catch(s){console.error("Error removing rate:",s),o.error("Failed to remove rate")}},ss=async()=>{if(p){ee(!0);try{await i.updateCustomer({...p,customExchangeRate:ye||void 0}),o.success("Exchange rate updated")}catch(t){console.error("Error updating exchange rate:",t),o.error("Failed to update exchange rate")}finally{ee(!1)}}},Me=async()=>{if(p){ee(!0);try{await i.updateCustomer({...p,name:Ut,phone:Ft,email:Bt,address:Mt,customExchangeRate:ye||void 0,bankAccounts:I,savedLocations:S,referralCode:Ot,isTaxable:ae,excludeFeesInSettlement:Ge}),o.success("Customer details updated")}catch(t){console.error("Error updating customer details:",t),o.error("Failed to update customer details")}finally{ee(!1)}}},as=async()=>{if(!(!l||!P)){le(!0),K(null);try{v&&await v(l.uid,We,{phone:ze,isTaxable:ae}),g!==l.role&&await P(l.uid,g),k&&z!==l.status&&await k(l.uid,z),_e!==l.walletAccountId&&await i.updateUserWalletMapping(l.uid,_e),g==="warehouse"?await i.updateUserBranch(l.uid,He):await i.updateUserBranch(l.uid,null),Y(null)}catch(t){console.error("Failed to update user",t),K("Failed to update user configuration.")}finally{le(!1)}}},wt=(t,s,r)=>{C({uid:t,name:s,type:r})},rs=async()=>{if(!(!k||!n)&&!(n.type==="SYNC"||n.type==="DELETE")){G(n.uid);try{await k(n.uid,n.type)}catch(t){console.error(t),o.error("Failed to update status. Please try again.")}finally{G(null),C(null)}}},A=(t,s)=>{if(!m)return;const r=m[t]||[],u=r.includes(s);let b;u?b=r.filter(os=>os!==s):b=[...r,s],Qe({...m,[t]:b})},ns=async()=>{if(!(!x||!m)){Xe(!0);try{await x(m),o.success("Access permissions updated successfully.")}catch{o.error("Failed to save permissions.")}finally{Xe(!1)}}},Ct=async t=>{if(!h){o.warning("Sync capability not available.");return}C({uid:t.uid,name:t.name,type:"SYNC"})},ls=async()=>{if(!n||n.type!=="SYNC")return;const t=L.find(s=>s.uid===n.uid);if(!(!t||!h)){Je(t.uid);try{await h(t),o.success("Customer synced successfully."),l&&l.uid===t.uid&&await jt(t.uid)}catch(s){console.error(s),o.error("Failed to sync customer.")}finally{Je(null),C(null)}}};return e.jsxs("div",{className:"space-y-6 relative",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{className:"flex space-x-1 bg-white p-1 rounded-xl shadow-sm border border-gray-100 max-w-fit overflow-x-auto",children:[e.jsxs("button",{onClick:()=>Fe("ACTIVE"),className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors whitespace-nowrap ${j==="ACTIVE"?"bg-indigo-50 text-indigo-700":"text-gray-600 hover:bg-gray-50"}`,children:["User Accounts (",ft.length,")"]}),e.jsxs("button",{onClick:()=>Fe("PENDING"),className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors flex items-center whitespace-nowrap ${j==="PENDING"?"bg-yellow-50 text-yellow-700":"text-gray-600 hover:bg-gray-50"}`,children:["Pending Approval",Be.length>0&&e.jsx("span",{className:"ml-2 bg-yellow-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center animate-pulse",children:Be.length})]}),N&&x&&e.jsx("button",{onClick:()=>Fe("ACCESS"),className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors whitespace-nowrap ${j==="ACCESS"?"bg-purple-50 text-purple-700":"text-gray-600 hover:bg-gray-50"}`,children:"Role Permissions"})]}),j!=="ACCESS"&&e.jsx("div",{className:"w-full sm:w-64",children:e.jsx(d,{placeholder:"Search user...",value:W,onChange:t=>Pt(t.target.value),className:"bg-white"})})]}),j==="ACCESS"&&m?e.jsx(Et,{title:"Role-Based Feature Access Control",action:e.jsx(c,{onClick:ns,isLoading:It,children:"Save Configuration"}),children:e.jsxs("div",{className:"overflow-x-auto",children:[e.jsx("p",{className:"text-sm text-gray-500 mb-4",children:"Define which features are accessible for each user role. Changes will apply immediately for all users with that role."}),e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 border border-gray-200 rounded-lg",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-1/4",children:"Feature Module"}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Admin"}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Accountant"}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Finance Mgr"}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Driver"}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Warehouse"}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Customer"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:cs.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-6 py-4 text-sm font-medium text-gray-900",children:t.label}),e.jsx("td",{className:"px-6 py-4 text-center",children:e.jsx("input",{type:"checkbox",className:"h-5 w-5 text-purple-600 focus:ring-purple-500 border-gray-300 rounded cursor-pointer",checked:m["system-admin"].includes(t.key),onChange:()=>A("system-admin",t.key),disabled:t.key==="MANAGE_USERS"})}),e.jsx("td",{className:"px-6 py-4 text-center",children:e.jsx("input",{type:"checkbox",className:"h-5 w-5 text-green-600 focus:ring-green-500 border-gray-300 rounded cursor-pointer",checked:m.accountant.includes(t.key),onChange:()=>A("accountant",t.key)})}),e.jsx("td",{className:"px-6 py-4 text-center",children:e.jsx("input",{type:"checkbox",className:"h-5 w-5 text-blue-600 focus:ring-blue-500 border-gray-300 rounded cursor-pointer",checked:m["finance-manager"].includes(t.key),onChange:()=>A("finance-manager",t.key)})}),e.jsx("td",{className:"px-6 py-4 text-center",children:e.jsx("input",{type:"checkbox",className:"h-5 w-5 text-orange-600 focus:ring-orange-500 border-gray-300 rounded cursor-pointer",checked:m.driver?m.driver.includes(t.key):!1,onChange:()=>A("driver",t.key)})}),e.jsx("td",{className:"px-6 py-4 text-center",children:e.jsx("input",{type:"checkbox",className:"h-5 w-5 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded cursor-pointer",checked:m.warehouse?m.warehouse.includes(t.key):!1,onChange:()=>A("warehouse",t.key)})}),e.jsx("td",{className:"px-6 py-4 text-center",children:e.jsx("input",{type:"checkbox",className:"h-5 w-5 text-teal-600 focus:ring-teal-500 border-gray-300 rounded cursor-pointer",checked:m.customer?m.customer.includes(t.key):!1,onChange:()=>A("customer",t.key)})})]},t.key))})]})]})}):e.jsx(Et,{title:j==="ACTIVE"?"System Users":"Pending Approvals",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"User"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Role"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Branch/Wallet"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Last Login"}),Ue&&e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Action"})]})}),e.jsxs("tbody",{className:"bg-white divide-y divide-gray-200",children:[vt.map(t=>{var s;return e.jsxs("tr",{className:`hover:bg-gray-50 transition-colors ${t.status==="INACTIVE"?"bg-red-50/50":""}`,children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0 h-10 w-10",children:e.jsx(At,{name:t.name,size:"md"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:t.name}),e.jsx("div",{className:"text-xs text-gray-500 font-mono",children:t.email})]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full capitalize 
                        ${t.role==="system-admin"?"bg-purple-100 text-purple-800":t.role==="finance-manager"?"bg-blue-100 text-blue-800":t.role==="driver"?"bg-orange-100 text-orange-800":t.role==="warehouse"?"bg-indigo-100 text-indigo-800":t.role==="customer"?"bg-teal-100 text-teal-800":"bg-green-100 text-green-800"}`,children:(t.role||"").replace("-"," ")})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`px-2 py-0.5 rounded text-[10px] font-bold uppercase ${t.status==="APPROVED"?"bg-green-50 text-green-700 border border-green-200":"bg-red-50 text-red-700 border border-red-200"}`,children:t.status})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:[t.managedBranchId&&e.jsxs("span",{className:"text-xs bg-gray-100 text-gray-600 px-2 py-1 rounded border border-gray-200",children:["Branch: ",((s=H.find(r=>r.id===t.managedBranchId))==null?void 0:s.name)||"Unknown"]}),t.walletAccountId&&e.jsx("span",{className:"text-xs bg-gray-100 text-gray-600 px-2 py-1 rounded border border-gray-200 ml-1",children:"Custom Wallet"}),!t.managedBranchId&&!t.walletAccountId&&e.jsx("span",{className:"text-gray-300",children:"-"})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:t.lastLogin?new Date(t.lastLogin).toLocaleDateString():e.jsx("span",{className:"text-gray-400 italic",children:"Never"})}),Ue&&e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:j==="ACTIVE"?e.jsxs("div",{className:"flex justify-end items-center",children:[t.role==="customer"&&!t.linkedCustomerId&&h&&e.jsx("button",{onClick:r=>{r.stopPropagation(),Ct(t)},disabled:oe===t.uid,className:"text-xs bg-blue-50 text-blue-600 px-2 py-1 rounded border border-blue-200 hover:bg-blue-100 mr-2 disabled:opacity-50 disabled:cursor-wait",title:"Create missing CRM record",children:oe===t.uid?"Syncing...":"Sync Profile"}),e.jsx("button",{onClick:()=>Kt(t),className:"text-indigo-600 hover:text-indigo-900 font-medium",children:"Manage"})]}):e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx("button",{type:"button",onClick:r=>{r.stopPropagation(),wt(t.uid,t.name,"REJECTED")},disabled:w===t.uid,className:`text-red-600 hover:text-red-900 bg-red-50 px-3 py-1 rounded border border-red-100 text-xs font-bold ${w===t.uid?"opacity-50 cursor-wait":""}`,children:w===t.uid?"...":"Reject"}),e.jsx("button",{type:"button",onClick:r=>{r.stopPropagation(),wt(t.uid,t.name,"APPROVED")},disabled:w===t.uid,className:`text-green-600 hover:text-green-900 bg-green-50 px-3 py-1 rounded border border-green-100 text-xs font-bold ${w===t.uid?"opacity-50 cursor-wait":""}`,children:w===t.uid?"Processing...":"Approve"})]})})]},t.uid)}),vt.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:Ue?6:5,className:"px-6 py-12 text-center text-gray-500 text-sm",children:e.jsx("p",{children:"No users found in this category."})})})]})]})})}),n&&e.jsx("div",{className:"fixed inset-0 z-[60] flex items-center justify-center bg-gray-900 bg-opacity-50 backdrop-blur-sm p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl w-full max-w-sm p-6 animate-fade-in-up",children:[e.jsx("div",{className:"flex justify-center mb-4",children:n.type==="APPROVED"?e.jsx("div",{className:"bg-green-100 p-3 rounded-full",children:e.jsx("svg",{className:"w-8 h-8 text-green-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M5 13l4 4L19 7"})})}):n.type==="SYNC"?e.jsx("div",{className:"bg-blue-100 p-3 rounded-full",children:e.jsx("svg",{className:"w-8 h-8 text-blue-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})}):e.jsx("div",{className:"bg-red-100 p-3 rounded-full",children:e.jsx("svg",{className:"w-8 h-8 text-red-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})})}),e.jsx("h3",{className:"text-xl font-bold text-gray-900 text-center mb-2",children:n.type==="APPROVED"?"Confirm Approval":n.type==="SYNC"?"Sync Customer Profile":n.type==="DELETE"?"Delete User":"Confirm Rejection"}),e.jsx("p",{className:"text-center text-gray-600 mb-6 text-sm",children:n.type==="SYNC"?e.jsxs("span",{children:["Create a CRM customer record for ",e.jsx("strong",{children:n.name}),"?",e.jsx("br",{}),"This will allow them to book parcels and track history."]}):n.type==="DELETE"?e.jsxs("span",{children:["Are you sure you want to permanently delete ",e.jsx("strong",{children:n.name}),"?",((St=n.extra)==null?void 0:St.linkedCustomerId)&&e.jsx("br",{}),((kt=n.extra)==null?void 0:kt.linkedCustomerId)&&e.jsx("span",{className:"text-red-600 font-bold",children:"Warning: This will also delete their linked Customer Data!"}),e.jsx("br",{}),"This action cannot be undone."]}):e.jsxs("span",{children:["Are you sure you want to ",n.type==="APPROVED"?"approve":"reject"," ",e.jsx("strong",{children:n.name}),"?",n.type==="APPROVED"?" They will gain access to the dashboard immediately.":" Their access will be blocked."]})}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx(c,{variant:"outline",onClick:()=>C(null),className:"w-full justify-center",children:"Cancel"}),e.jsx(c,{onClick:n.type==="SYNC"?ls:n.type==="DELETE"?Zt:rs,className:`w-full justify-center ${n.type==="APPROVED"?"bg-green-600 hover:bg-green-700":n.type==="SYNC"?"bg-blue-600 hover:bg-blue-700":"bg-red-600 hover:bg-red-700"}`,isLoading:!!w||!!oe,children:n.type==="DELETE"?"Delete Permanently":"Confirm"})]})]})}),l&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-gray-900 bg-opacity-50 backdrop-blur-sm p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl w-full max-w-4xl overflow-hidden animate-fade-in-up flex flex-col max-h-[95vh]",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-gray-100 flex flex-col bg-gray-50",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Manage User Account"}),e.jsx("button",{onClick:Nt,className:"text-gray-400 hover:text-gray-500",children:e.jsx("svg",{className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"flex space-x-4 border-b border-gray-200",children:[e.jsx("button",{onClick:()=>R("USER"),className:`pb-2 text-sm font-medium ${y==="USER"?"text-indigo-600 border-b-2 border-indigo-600":"text-gray-500 hover:text-gray-700"}`,children:"User Account"}),g==="customer"&&e.jsx("button",{onClick:()=>R("CUSTOMER"),className:`pb-2 text-sm font-medium ${y==="CUSTOMER"?"text-indigo-600 border-b-2 border-indigo-600":"text-gray-500 hover:text-gray-700"}`,children:"Customer Data"}),(g==="driver"||g==="warehouse")&&e.jsx("button",{onClick:()=>R("EMPLOYEE"),className:`pb-2 text-sm font-medium ${y==="EMPLOYEE"?"text-indigo-600 border-b-2 border-indigo-600":"text-gray-500 hover:text-gray-700"}`,children:"Employee Data"})]})]}),e.jsxs("div",{className:"p-6 space-y-6 overflow-y-auto",children:[y==="USER"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"text-xs font-bold text-gray-500 uppercase tracking-wide border-b border-gray-100 pb-2",children:"Profile Information"}),e.jsxs("div",{className:"flex items-center space-x-4 bg-gray-50 p-3 rounded-lg border border-gray-100 mb-2",children:[e.jsx(At,{name:l.name,size:"md"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 font-mono",children:l.email}),e.jsxs("p",{className:"text-[10px] text-gray-400",children:["UID: ",l.uid.slice(0,8),"..."]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(d,{label:"Full Name",value:We,onChange:t=>Ye(t.target.value)}),e.jsx(d,{label:"Phone",value:ze,onChange:t=>Ke(t.target.value),placeholder:"+855..."})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"text-xs font-bold text-gray-500 uppercase tracking-wide border-b border-gray-100 pb-2",children:"Access Control"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Account Status"}),e.jsxs("select",{className:`block w-full px-3 py-2 border rounded-lg shadow-sm focus:outline-none focus:ring-2 sm:text-sm font-bold ${z==="APPROVED"?"text-green-700 border-green-200 bg-green-50":"text-red-700 border-red-200 bg-red-50"}`,value:z,onChange:t=>Ve(t.target.value),children:[e.jsx("option",{value:"APPROVED",children:"Active (Approved)"}),e.jsx("option",{value:"INACTIVE",children:"Deactivated"}),e.jsx("option",{value:"PENDING",children:"Pending Review"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"System Role"}),e.jsxs("select",{className:"block w-full px-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm capitalize",value:g,onChange:t=>Oe(t.target.value),children:[e.jsx("option",{value:"system-admin",children:"System Admin"}),e.jsx("option",{value:"accountant",children:"Accountant"}),e.jsx("option",{value:"finance-manager",children:"Finance Manager"}),e.jsx("option",{value:"warehouse",children:"Warehouse Staff"}),e.jsx("option",{value:"driver",children:"Driver"}),e.jsx("option",{value:"customer",children:"Customer"})]})]})]})]}),(g==="warehouse"||g==="driver"||g==="customer")&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"text-xs font-bold text-gray-500 uppercase tracking-wide border-b border-gray-100 pb-2",children:"Operational Context"}),g==="warehouse"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Assigned Branch (Warehouse)"}),e.jsxs("select",{className:"block w-full px-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",value:He,onChange:t=>$e(t.target.value),children:[e.jsx("option",{value:"",children:"-- Select Branch --"}),H.map(t=>e.jsxs("option",{value:t.id,children:[t.name," (",t.code,")"]},t.id))]})]})]})]}):null,y==="CUSTOMER"&&e.jsx("div",{className:"space-y-6",children:p?e.jsx(e.Fragment,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-white border text-card-foreground shadow-sm rounded-xl overflow-hidden",children:e.jsxs("div",{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold leading-none tracking-tight mb-4",children:"Exchange Rate Preferences"}),e.jsxs("div",{className:"bg-blue-50 border border-blue-100 rounded-lg p-4 mb-4",children:[e.jsx("h4",{className:"text-sm font-bold text-blue-900 mb-1",children:"Daily Exchange Rate"}),e.jsx("p",{className:"text-xs text-blue-700",children:"Set the exchange rate (USD to KHR) that drivers should use when collecting cash for your COD parcels. If you leave this blank, the system default (4,000) will be applied."})]}),e.jsxs("div",{className:"flex items-end gap-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 block mb-1",children:"Your Custom Rate (KHR)"}),e.jsx("input",{type:"number",className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm",value:ye||"",onChange:t=>_(parseFloat(t.target.value)||void 0),placeholder:"4100"})]}),e.jsx(c,{variant:"primary",className:"mb-[1px]",onClick:ss,isLoading:f,children:"Update Rate"})]})]})}),e.jsx("div",{className:"bg-white border text-card-foreground shadow-sm rounded-xl overflow-hidden",children:e.jsxs("div",{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold leading-none tracking-tight mb-4",children:"Tax Configuration"}),e.jsxs("div",{className:"flex items-center bg-blue-50 p-4 rounded-lg border border-blue-100",children:[e.jsx("input",{id:"isTaxableCust",type:"checkbox",className:"h-5 w-5 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded",checked:ae,onChange:t=>re(t.target.checked),disabled:f}),e.jsxs("div",{className:"ml-3",children:[e.jsx("label",{htmlFor:"isTaxableCust",className:"block text-sm font-bold text-gray-900",children:"Apply VAT/Tax on Transactions?"}),e.jsx("p",{className:"text-xs text-gray-500 mt-0.5",children:"If checked, transactions for this customer will automatically trigger tax calculations based on global system settings."})]})]}),e.jsx("div",{className:"mt-4 flex justify-end",children:e.jsx(c,{variant:"primary",onClick:Me,isLoading:f,children:"Save Tax Setting"})})]})}),e.jsx("div",{className:"bg-white border text-card-foreground shadow-sm rounded-xl overflow-hidden",children:e.jsxs("div",{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold leading-none tracking-tight mb-4",children:"Settlement Configuration"}),e.jsxs("div",{className:"flex items-center bg-green-50 p-4 rounded-lg border border-green-100",children:[e.jsx("input",{id:"excludeFeesSettlement",type:"checkbox",className:"h-5 w-5 text-green-600 focus:ring-green-500 border-gray-300 rounded",checked:Ge,onChange:t=>Ze(t.target.checked),disabled:f}),e.jsxs("div",{className:"ml-3",children:[e.jsx("label",{htmlFor:"excludeFeesSettlement",className:"block text-sm font-bold text-gray-900",children:"Exclude Fees from Settlement (Pay Gross)"}),e.jsx("p",{className:"text-xs text-gray-500 mt-0.5",children:"If checked, settlements for this customer will pay the full COD amount without deducting delivery fees."})]})]}),e.jsx("div",{className:"mt-4 flex justify-end",children:e.jsx(c,{variant:"primary",onClick:Me,isLoading:f,className:"bg-green-600 hover:bg-green-700",children:"Save Settlement Setting"})})]})}),e.jsx("div",{className:"bg-white border text-card-foreground shadow-sm rounded-xl overflow-hidden",children:e.jsxs("div",{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold leading-none tracking-tight mb-4",children:"Special Rates"}),e.jsxs("div",{className:"bg-purple-50 border border-purple-100 rounded-lg p-4 mb-4",children:[e.jsx("h4",{className:"text-sm font-bold text-purple-900 mb-1",children:"Custom Pricing"}),e.jsx("p",{className:"text-xs text-purple-700",children:"Override the default price for specific services. These rates will be automatically applied when this customer books a parcel."})]}),e.jsx("div",{className:"space-y-3 mb-6",children:Yt?e.jsx("p",{className:"text-sm text-gray-500 italic",children:"Loading rates..."}):Ie.length>0?Ie.map(t=>e.jsxs("div",{className:"flex items-center justify-between bg-gray-50 px-4 py-3 rounded-lg border border-gray-100",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-bold text-gray-900",children:t.serviceName}),e.jsx("div",{className:"text-xs text-gray-500",children:"Standard Price Override"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"text-xs text-gray-500 flex flex-col items-end",children:[e.jsx("span",{children:t.startDate}),e.jsxs("span",{className:"text-[10px]",children:["to ",t.endDate]})]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsxs("span",{className:"font-mono font-bold text-indigo-600 bg-indigo-50 px-2 py-1 rounded text-sm",children:["$",t.price.toFixed(2)]}),t.priceKHR&&e.jsxs("span",{className:"font-mono font-bold text-green-600 bg-green-50 px-2 py-1 rounded text-sm",children:[t.priceKHR.toLocaleString(),"áŸ›"]})]}),e.jsx("button",{onClick:()=>ts(t.id),className:"text-gray-400 hover:text-red-500 transition-colors",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]},t.id)):e.jsx("div",{className:"text-center py-4 border-2 border-dashed border-gray-100 rounded-lg",children:e.jsx("p",{className:"text-xs text-gray-400",children:"No special rates configured"})})}),e.jsxs("div",{className:"flex gap-2 items-end",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase tracking-wide mb-1 block",children:"Service"}),e.jsxs("select",{className:"block w-full px-3 py-2 border border-gray-300 rounded-lg text-sm",value:Q,onChange:t=>dt(t.target.value),children:[e.jsx("option",{value:"",children:"Select Service..."}),ct.map(t=>e.jsxs("option",{value:t.id,children:[t.name," ($",t.defaultPrice,")"]},t.id))]})]}),e.jsxs("div",{className:"w-24",children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase tracking-wide mb-1 block",children:"USD ($)"}),e.jsx("input",{type:"number",className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm",value:X,onChange:t=>xt(t.target.value),placeholder:"0.00"})]}),e.jsxs("div",{className:"w-28",children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase tracking-wide mb-1 block",children:"KHR (áŸ›)"}),e.jsx("input",{type:"number",className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm",value:Te,onChange:t=>mt(t.target.value),placeholder:"0"})]}),e.jsxs("div",{className:"w-32",children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase tracking-wide mb-1 block",children:"Start Date"}),e.jsx("input",{type:"date",className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm",value:ut,onChange:t=>ht(t.target.value)})]}),e.jsxs("div",{className:"w-32",children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase tracking-wide mb-1 block",children:"End Date"}),e.jsx("input",{type:"date",className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm",value:gt,onChange:t=>pt(t.target.value)})]}),e.jsx(c,{onClick:es,disabled:!Q||!X,className:"mb-[1px]",children:"Add"})]})]})}),e.jsx("div",{className:"bg-white border text-card-foreground shadow-sm rounded-xl overflow-hidden",children:e.jsxs("div",{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold leading-none tracking-tight mb-4",children:"Bank Accounts"}),e.jsxs("div",{className:"space-y-3",children:[I.length>0&&I.map(t=>e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-10 h-10 bg-gray-100 rounded-lg flex items-center justify-center text-gray-400",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"})})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold text-gray-900",children:t.bankName}),e.jsx("p",{className:"text-sm text-gray-500",children:t.accountNumber}),t.accountName&&e.jsx("p",{className:"text-xs text-gray-400",children:t.accountName})]})]}),e.jsx("button",{onClick:()=>qt(t.id||t.accountNumber),className:"text-sm text-red-500 hover:text-red-700 font-medium",children:"Remove"})]},t.id||t.accountNumber)),e.jsxs("button",{onClick:()=>q(!0),className:"w-full py-3 border-2 border-dashed border-gray-300 rounded-lg text-gray-500 hover:border-gray-400 hover:text-gray-600 flex items-center justify-center gap-2 text-sm font-medium transition-colors",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 4v16m8-8H4"})}),"Add Bank Account (",I.length,"/5)"]})]})]})}),e.jsx("div",{className:"bg-white border text-card-foreground shadow-sm rounded-xl overflow-hidden",children:e.jsxs("div",{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold leading-none tracking-tight mb-4",children:"Saved Locations"}),e.jsxs("div",{className:"space-y-3",children:[S.length>0&&S.map(t=>e.jsx("div",{className:"border border-gray-200 rounded-lg p-4 relative group",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h4",{className:"font-bold text-gray-900",children:t.label}),t.isPrimary&&e.jsx("span",{className:"bg-red-100 text-red-600 text-[10px] font-bold px-1.5 py-0.5 rounded",children:"PRIMARY"})]}),e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:t.address}),t.coordinates&&e.jsxs("p",{className:"text-xs text-mono text-gray-400",children:[t.coordinates.lat.toFixed(5),", ",t.coordinates.lng.toFixed(5)]})]}),e.jsxs("div",{className:"flex flex-col items-end gap-2",children:[e.jsx("button",{onClick:()=>Qt(t.id),className:"text-xs text-red-500 hover:text-red-700 font-medium",children:"Delete"}),!t.isPrimary&&e.jsx("button",{onClick:()=>Xt(t.id),className:"text-xs text-indigo-600 hover:text-indigo-800 font-medium",children:"Set Primary"})]})]})},t.id)),e.jsxs("button",{onClick:()=>J(!0),className:"w-full py-3 border-2 border-dashed border-gray-300 rounded-lg text-gray-500 hover:border-gray-400 hover:text-gray-600 flex items-center justify-center gap-2 text-sm font-medium transition-colors",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 4v16m8-8H4"})}),"Add New Location"]})]})]})})]})}):e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-yellow-800 mb-3",children:"This user doesn't have a linked customer record yet. Create one to manage custom billing and details."}),e.jsx(c,{variant:"outline",onClick:()=>{l&&Ct(l)},className:"text-sm",children:"Create Customer Record"})]})}),y==="EMPLOYEE"&&e.jsx("div",{className:"space-y-6",children:ie?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-white border text-card-foreground shadow-sm rounded-xl overflow-hidden",children:e.jsxs("div",{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold leading-none tracking-tight mb-4",children:"Employment Information"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(d,{label:"Position",value:et,onChange:t=>ce(t.target.value)}),e.jsx(d,{label:"Department",value:tt,onChange:t=>de(t.target.value)})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mt-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Hire Date"}),e.jsx("input",{type:"date",className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm",value:st,onChange:t=>xe(t.target.value)})]}),e.jsx(d,{label:"Monthly Salary (USD)",type:"number",value:me||"",onChange:t=>ue(parseFloat(t.target.value)||void 0)})]})]})}),Tt&&e.jsx("div",{className:"bg-white border text-card-foreground shadow-sm rounded-xl overflow-hidden",children:e.jsxs("div",{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold leading-none tracking-tight mb-4",children:"Driver Information"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(d,{label:"Vehicle Type",value:rt,onChange:t=>he(t.target.value)}),e.jsx(d,{label:"Plate Number",value:nt,onChange:t=>ge(t.target.value)})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mt-4",children:[e.jsx(d,{label:"License Number",value:lt,onChange:t=>pe(t.target.value)}),e.jsx(d,{label:"Zone Assignment",value:ot,onChange:t=>be(t.target.value)})]})]})}),e.jsx("div",{className:"flex justify-end",children:e.jsx(c,{onClick:async()=>{if(!ie)return;const t={...ie,position:et,department:tt,hireDate:st,baseSalaryAmount:me,hasBaseSalary:!!me,vehicleType:rt,vehiclePlateNumber:nt,licenseNumber:lt,zone:ot};await i.hrService.updateEmployee(t),D(t),o.success("Employee data updated!")},isLoading:f,children:"Save Employee Data"})})]}):e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-yellow-800 mb-3",children:"This user doesn't have a linked employee record yet. Create one to manage HR and payroll details."}),e.jsx(c,{variant:"outline",onClick:async()=>{if(l){const t=await i.hrService.createEmployeeForUser(l.uid,l.name,g==="driver");D(t),o.success("Employee record created!")}},className:"text-sm",children:"Create Employee Record"})]})}),qe&&e.jsx("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg text-sm",children:qe})]}),e.jsxs("div",{className:"px-6 py-4 bg-gray-50 border-t border-gray-100 flex justify-between items-center",children:[e.jsx("div",{children:y==="USER"&&e.jsx("button",{onClick:Gt,className:"px-4 py-2 border border-red-200 text-red-600 rounded-lg hover:bg-red-50 hover:border-red-300 transition-colors font-medium text-sm",children:"Delete User"})}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx(c,{variant:"outline",onClick:Nt,disabled:ne||f,children:"Cancel"}),y==="USER"&&e.jsx(c,{onClick:as,isLoading:ne,disabled:ne,children:"Save Changes"}),y==="CUSTOMER"&&e.jsx(c,{onClick:Me,isLoading:f,disabled:!p||f,children:"Save Customer Data"})]})]})]})}),Vt&&e.jsx("div",{className:"fixed inset-0 z-[60] flex items-center justify-center bg-gray-900 bg-opacity-50 backdrop-blur-sm p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl w-full max-w-md p-6",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-4",children:"Add Bank Account"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(d,{label:"Bank Name",value:Ce,onChange:t=>Se(t.target.value),placeholder:"e.g. ABA Bank"}),e.jsx(d,{label:"Account Name",value:it,onChange:t=>ke(t.target.value),placeholder:"Account holder name"}),e.jsx(d,{label:"Account Number",value:Ee,onChange:t=>Ae(t.target.value),placeholder:"Account number"})]}),e.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[e.jsx(c,{variant:"outline",onClick:()=>{q(!1),Se(""),ke(""),Ae("")},children:"Cancel"}),e.jsx(c,{onClick:_t,children:"Add Account"})]})]})}),Ht&&e.jsx("div",{className:"fixed inset-0 z-[60] flex items-center justify-center bg-gray-900 bg-opacity-50 backdrop-blur-sm p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl w-full max-w-md p-6",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-4",children:"Add New Location"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(d,{label:"Label (e.g. Home, Office)",value:Le,onChange:t=>Pe(t.target.value),placeholder:"Home, Office, Warehouse A..."}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Address / Coordinates"}),e.jsx(us,{value:Re,onChange:U,onSelect:t=>{U(t.address||t.name),t.location&&(B(t.location.lat.toString()),O(t.location.lng.toString()))},onPickMap:()=>De(!0),placeholder:"Enter address or select on map",className:"block w-full px-3 py-2 border border-gray-300 rounded-xl shadow-sm focus:outline-none focus:ring-red-500 focus:border-red-500 sm:text-sm"}),F&&M&&e.jsxs("p",{className:"text-xs text-gray-400 mt-1",children:["ðŸ“ ",F,", ",M]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(d,{label:"Latitude (Optional)",value:F,onChange:t=>B(t.target.value),placeholder:"11.5564"}),e.jsx(d,{label:"Longitude (Optional)",value:M,onChange:t=>O(t.target.value),placeholder:"104.9282"})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[e.jsx(c,{variant:"outline",onClick:()=>{J(!1),Pe(""),U(""),B(""),O("")},children:"Cancel"}),e.jsx(c,{onClick:Jt,children:"Add Location"})]})]})}),$t&&e.jsx(hs,{onClose:()=>De(!1),onConfirm:(t,s,r)=>{U(r||`${t.toFixed(6)}, ${s.toFixed(6)}`),B(t.toString()),O(s.toString()),De(!1)}})]})};function Ss(){const{user:L}=ds(),{branches:H,rolePermissions:N}=xs(),[P,k]=a.useState([]);a.useEffect(()=>{v()},[]);const v=async()=>{const x=await i.getUsers();k(x)};return L?e.jsx(gs,{users:P,branches:H,rolePermissions:N||ms,onUpdateRole:async(x,h)=>{await i.updateUserRole(x,h),await v()},onUpdateStatus:async(x,h)=>{await i.updateUserStatus(x,h),await v()},onUpdateProfile:async(x,h,$)=>{await i.configService.updateUserProfile(x,h,$),await v()},onUpdatePermissions:async x=>{await i.updateRolePermissions(x)},onDeleteUser:async(x,h)=>{await i.deleteUserAndCustomer(x,h),await v()}}):null}export{Ss as default};
