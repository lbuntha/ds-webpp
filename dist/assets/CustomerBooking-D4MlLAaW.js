const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/feeCalculator-CqfMMuNU.js","assets/index-BUL6LB55.js","assets/index-CY9_X8xj.css"])))=>i.map(i=>d[i]);
import{u as mt,r as n,f as N,s as Ae,j as e,_ as ht}from"./index-BUL6LB55.js";import{B as X}from"./Button-CqEssTF4.js";import{I as J}from"./Input-fEXGFBn-.js";import{C as pt}from"./Card-k44aVk4n.js";import{T as gt}from"./Toast-8q3YfUAL.js";import{L as ft}from"./LocationPicker-BSHbKGYS.js";import{P as $e}from"./PlaceAutocomplete-XL2CORH3.js";import{p as Ee}from"./imageUtils-D2x4nXU4.js";const Rt=({user:m,onComplete:be,initialMode:Oe="PHOTO"})=>{var Se;const{t:g}=mt(),[P,Z]=n.useState(1),[Te,_]=n.useState(!1),[$,ve]=n.useState([]),ye=n.useRef(null),[ee,C]=n.useState(null),[u,je]=n.useState(Oe),[y,Fe]=n.useState(""),[B,bt]=n.useState(new Date().toISOString().split("T")[0]),[R,G]=n.useState(""),[te,se]=n.useState(""),[A,Ne]=n.useState(""),[E,we]=n.useState(""),[w,W]=n.useState(null),[re,Ke]=n.useState(!1),[ae,Ue]=n.useState(""),[O,ke]=n.useState(m.savedLocations||[]),[x,j]=n.useState([]),[oe,Ce]=n.useState(""),[T,He]=n.useState([]),[F,Me]=n.useState([]),[S,q]=n.useState(""),[z,vt]=n.useState("PENDING"),[ne,_e]=n.useState([]),[K,le]=n.useState(4100),[ie,Be]=n.useState([]),[V,Ge]=n.useState([]),[U,de]=n.useState(""),[I,yt]=n.useState("SINGLE"),[ce,We]=n.useState(""),[ue,qe]=n.useState(""),[xe,ze]=n.useState(""),[jt,Nt]=n.useState("");n.useEffect(()=>{N.getParcelServices().then(ve),N.getParcelServices().then(ve),N.getCurrencies().then(_e),m.linkedCustomerId&&(Ae.getCustomerProducts(m.linkedCustomerId).then(Be),Ae.getCustomerStock(m.linkedCustomerId).then(r=>{Ge(r),r.length>0&&de(r[0].branchId)})),(async()=>{try{const r=await N.getParcelPromotions(),a=new Date().toISOString().split("T")[0],o=Date.now(),l=d=>{var he;if(!d.eligibility||d.eligibility==="ALL")return!0;if(d.eligibility==="SPECIFIC_USERS")return((he=d.allowedUserIds)==null?void 0:he.includes(m.linkedCustomerId||""))||!1;const c=m.joinedAt||m.createdAt;if(!c)return!0;const f=new Date(c),p=Math.floor((o-f.getTime())/(1e3*60*60*24));switch(d.eligibility){case"REGISTERED_LAST_7_DAYS":return p<=7;case"REGISTERED_LAST_MONTH":return p<=30;case"REGISTERED_LAST_YEAR":return p<=365;default:return!0}},i=r.filter(d=>d.startDate<=a&&d.endDate>=a&&d.isActive&&l(d));if(He(i),m.linkedCustomerId){const[d,c]=await Promise.all([N.getCustomerSpecialRates(m.linkedCustomerId),N.getDocument("customers",m.linkedCustomerId)]);if(Me(d),c&&c.customExchangeRate)le(c.customExchangeRate);else{const f=ne.find(p=>p.code==="KHR");f&&le(f.exchangeRate)}c&&c.savedLocations&&c.savedLocations.length>0&&ke(c.savedLocations)}else{const d=ne.find(c=>c.code==="KHR");d&&le(d.exchangeRate)}}catch(r){console.error("Failed to load promotions/rates",r)}})();const s=O.find(r=>r.isPrimary);G(s?s.id:"custom")},[m,ne]);const H=n.useMemo(()=>y?T.filter(t=>{var s;return!t.productScope||t.productScope==="ALL_PRODUCTS"?!0:t.productScope==="SPECIFIC_PRODUCTS"?((s=t.allowedProductIds)==null?void 0:s.includes(y))||!1:!0}):T,[T,y]);n.useEffect(()=>{S&&!H.find(t=>t.id===S)&&q("")},[H,S]);const Ve=(t,s,r)=>{if((w==null?void 0:w.type)==="PICKUP")Ne(t),we(s),se(r);else if((w==null?void 0:w.type)==="DROPOFF"&&typeof w.index=="number"){const a=w.index;j(o=>{const l=[...o];return l[a]={...l[a],destinationAddress:r,destinationLocation:{lat:t,lng:s}},l})}W(null)},Ye=t=>{Fe(t),setTimeout(()=>{var s;(s=ye.current)==null||s.scrollIntoView({behavior:"smooth"})},100)},Qe=t=>{navigator.geolocation?navigator.geolocation.getCurrentPosition(s=>{t(s.coords.latitude,s.coords.longitude)},s=>{console.error("Error getting location:",s),C({message:"Unable to retrieve location. Please check permissions.",type:"error"})}):C({message:"Geolocation is not supported by this browser.",type:"error"})},Xe=t=>{se(t.address),t.location&&(Ne(t.location.lat),we(t.location.lng))},Je=async t=>{const s=t.target.files;if(s&&s.length>0){_(!0);try{const a=(await Promise.all(Array.from(s).map(o=>Ee(o)))).map(o=>({id:`pi-${Date.now()}-${Math.random().toString(36).substr(2,5)}`,image:o,receiverName:"Details in Photo",receiverPhone:"",destinationAddress:"Driver to extract details",productPrice:0,status:"PENDING"}));j(o=>[...o,...a])}catch(r){console.error("Error processing images",r),C({message:"Failed to process some images. Please try again.",type:"error"})}finally{_(!1)}}t.target.value=""},Ze=async t=>{var r;const s=(r=t.target.files)==null?void 0:r[0];if(s)try{const a=await Ee(s);j(o=>[...o,{id:`pi-${Date.now()}`,image:a,receiverName:"",receiverPhone:"",destinationAddress:"",productPrice:0,status:"PENDING"}])}catch(a){console.error("Error processing image",a),C({message:"Failed to process image.",type:"error"})}t.target.value=""},k=(t,s,r)=>{j(a=>{const o=[...a],l={...o[t],[s]:r};if(s==="productPrice"){const i=Number(r);l.codCurrency=i>=1e3?"KHR":"USD"}return o[t]=l,o})},et=(t,s,r)=>{j(a=>{const o=[...a];return o[t]={...o[t],destinationLocation:{lat:s,lng:r}},o})},tt=(t,s)=>{j(r=>{const a=[...r];return a[t]={...a[t],destinationAddress:s.address,destinationLocation:s.location},a})},me=t=>{j(s=>s.filter((r,a)=>a!==t))},b=n.useMemo(()=>{const t=$.find(c=>c.id===y);if(!t)return{subtotal:0,discount:0,total:0,isSpecialRate:!1};const s=x[0],r=(s==null?void 0:s.codCurrency)==="KHR";let a=r?t.defaultPriceKHR||0:t.defaultPrice||0,o=!1;if(F.length>0){const c=B,f=F.find(p=>p.serviceTypeId===y&&p.startDate.split("T")[0]<=c&&p.endDate.split("T")[0]>=c);if(f){if(r)if(f.priceKHR)a=f.priceKHR;else{const p=K||4100;a=f.price*p}else a=f.price;o=!0}}const l=u==="STOCK"?1:Math.max(x.length,1),i=a*l;let d=0;if(S){const c=T.find(f=>f.id===S);c&&(d=c.type==="FIXED_AMOUNT"?c.value:i*(c.value/100))}return d>i&&(d=i),{subtotal:i,discount:d,total:i-d,isSpecialRate:o}},[y,x.length,$,S,T,F,B,K]),Y=n.useMemo(()=>{if(u==="PHOTO")return{value:0,display:"$0.00"};let t=0,s=0;return x.forEach(r=>{const a=Number(r.productPrice)||0,o=r.quantity||1;r.codCurrency==="KHR"?s+=a*o:t+=a*o}),s>0&&t>0?{value:t+s/4100,display:`$${t.toFixed(2)} + ${s.toLocaleString()}áŸ›`}:s>0?{value:s/4100,display:`${s.toLocaleString()} áŸ›`}:{value:t,display:`$${t.toFixed(2)}`}},[x,u]),st=async()=>{var t,s,r,a;if(!y){C({message:"Please select a service.",type:"error"});return}if(x.length===0){C({message:"Please add at least one parcel.",type:"error"});return}if(u==="STOCK"&&I==="SINGLE"&&(!ce||!ue||!xe)){C({message:"Please fill in all receiver details at the top.",type:"error"});return}_(!0);try{const o=$.find(h=>h.id===y),l=`pb-${Date.now()}`;let i=te,d=A&&E?{lat:Number(A),lng:Number(E)}:void 0;if(R!=="custom"){const h=O.find(D=>D.id===R);h&&(i=h.address,d=h.coordinates)}else if(re&&ae&&i){const h={id:`loc-${Date.now()}`,label:ae,address:i,coordinates:d,isPrimary:!1},D=[...O,h];ke(D),N.updateUserLocations(D).catch(console.error)}const{calculateDeliveryFee:c}=await ht(async()=>{const{calculateDeliveryFee:h}=await import("./feeCalculator-CqfMMuNU.js");return{calculateDeliveryFee:h}},__vite__mapDeps([0,1,2])),f=u==="STOCK"?1:Math.max(x.length,1),p=await c({serviceTypeId:y,customerId:m.linkedCustomerId||"",itemCount:f,codCurrency:((t=x[0])==null?void 0:t.codCurrency)||"USD",exchangeRate:K,services:$,specialRates:F}),he=p.totalPrice||p.pricePerItem*f,rt=p.totalPriceUSD||p.pricePerItemUSD*f,at=p.totalPriceKHR||p.pricePerItemKHR*f,Pe=b.subtotal>0?b.total/b.subtotal:1,pe=Number((rt*Pe).toFixed(2)),ge=Math.round(at*Pe),Ie=((s=x[0])==null?void 0:s.codCurrency)==="KHR"?ge:pe,fe=Math.max(x.length,1),ot=Ie/fe,nt=pe/fe,lt=ge/fe;let L,Le;if(u==="STOCK"){const h=x.filter(v=>v.codCurrency!=="KHR").reduce((v,M)=>v+(Number(M.productPrice)||0)*(M.quantity||1),0),D=x.filter(v=>v.codCurrency==="KHR").reduce((v,M)=>v+(Number(M.productPrice)||0)*(M.quantity||1),0),Re=D>0?"KHR":"USD",xt=Re==="KHR"?D:h;L=[{id:`item-${Date.now()}`,image:((r=x[0])==null?void 0:r.image)||"",receiverName:ce||"Details in Photo",receiverPhone:ue||"",destinationAddress:xe||"Driver to Extract",productPrice:xt,codCurrency:Re,deliveryFee:Ie,deliveryFeeUSD:pe,deliveryFeeKHR:ge,status:"PENDING"}],Le=x.map(v=>({productId:v.productId||"",stockItemId:v.stockItemId||"",sku:v.sku||"",name:v.sku||"Product",image:v.image,quantity:v.quantity||1,unitPrice:Number(v.productPrice)||0,codCurrency:v.codCurrency||"USD"}))}else L=await Promise.all(x.map(async h=>({...h,productPrice:Number(h.productPrice)||0,codCurrency:h.codCurrency||(Number(h.productPrice)>=1e3?"KHR":"USD"),receiverName:h.receiverName||"Details in Photo",receiverPhone:h.receiverPhone||"",destinationAddress:h.destinationAddress||"Driver to Extract",deliveryFee:ot,deliveryFeeUSD:nt,deliveryFeeKHR:lt})));const De={id:l,bookingDate:B,senderId:m.linkedCustomerId,senderName:m.name,senderPhone:m.phone||"",pickupAddress:i||"Unknown Address",pickupLocation:d,serviceTypeId:y,serviceTypeName:(o==null?void 0:o.name)||"",items:L,stockProducts:Le,distance:0,subtotal:b.subtotal,discountAmount:b.discount,promotionId:S||void 0,taxAmount:0,totalDeliveryFee:b.total,currency:((a=L[0])==null?void 0:a.codCurrency)==="KHR"?"KHR":"USD",status:z,statusId:z==="PENDING"?"ps-pending":"ps-pickup",statusHistory:[{statusId:z==="PENDING"?"ps-pending":"ps-pickup",statusLabel:z==="PENDING"?"Pending":"Confirmed",timestamp:Date.now(),updatedBy:m.name,notes:"Booking created by customer"}],branchId:u==="STOCK"&&U?U:"b1",notes:oe,createdAt:Date.now(),exchangeRateForCOD:K};await N.saveParcelBooking(De);const Q={type:"INFO",read:!1,createdAt:Date.now(),metadata:{type:"BOOKING",bookingId:De.id}},it={...Q,id:`notif-driver-${Date.now()}`,targetAudience:"driver",title:"New Pickup Request",message:`ðŸ“¦ New booking from ${m.name} at ${(i==null?void 0:i.slice(0,50))||"Address"} - ${L.length} parcel(s)`};await N.sendNotification(it);const dt={...Q,id:`notif-warehouse-${Date.now()+1}`,targetAudience:"warehouse",title:"New Booking Alert",message:`ðŸ“‹ Booking #${l.slice(-6)} from ${m.name} - ${L.length} parcel(s) pending pickup`};await N.sendNotification(dt);const ct={...Q,id:`notif-admin-${Date.now()+2}`,targetAudience:"admin",title:"New Customer Booking",message:`${m.name} placed order #${l.slice(-6)} - ${L.length} parcel(s), Fee: $${b.total.toFixed(2)}`};await N.sendNotification(ct);const ut={...Q,id:`notif-cust-${Date.now()+3}`,targetAudience:m.uid,title:"Booking Received",message:`We received your booking #${l.slice(-6)}. Pickup at: ${i}`,type:"SUCCESS"};await N.sendNotification(ut),C({message:"Your booking has been placed successfully!",type:"success"}),setTimeout(()=>be(),1500)}catch(o){console.error(o),C({message:"Failed to request booking. Please try again.",type:"error"})}finally{_(!1)}};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"max-w-6xl mx-auto space-y-6 pb-32 px-2 sm:px-0",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-xl sm:text-2xl font-bold text-gray-900",children:g("new_booking")}),e.jsx("button",{onClick:be,className:"text-gray-500 hover:text-gray-900",children:g("cancel")})]}),e.jsxs("div",{className:"flex items-center space-x-2 mb-4",children:[e.jsx("div",{className:`h-1 flex-1 rounded-full ${P>=1?"bg-red-600":"bg-gray-200"}`}),e.jsx("div",{className:`h-1 flex-1 rounded-full ${P>=2?"bg-red-600":"bg-gray-200"}`})]}),P===1&&e.jsxs("div",{className:"space-y-6 animate-fade-in-up",children:[e.jsxs("div",{className:"bg-blue-50 border border-blue-100 rounded-lg p-3 text-xs text-blue-800 flex justify-between items-center",children:[e.jsx("span",{children:"Current Exchange Rate for COD:"}),e.jsxs("span",{className:"font-bold",children:["1 USD = ",K," KHR"]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{onClick:()=>{je("PHOTO"),j([])},className:`cursor-pointer p-4 rounded-2xl border-2 transition-all flex items-center justify-center space-x-3 ${u==="PHOTO"?"border-red-600 bg-red-50":"border-gray-200 bg-white hover:border-gray-300"}`,children:[e.jsx("div",{className:`p-2 rounded-full ${u==="PHOTO"?"bg-red-200 text-red-700":"bg-gray-100 text-gray-500"}`,children:e.jsxs("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M15 13a3 3 0 11-6 0 3 3 0 016 0z"})]})}),e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:`font-bold text-sm ${u==="PHOTO"?"text-red-900":"text-gray-700"}`,children:g("photo_booking")}),e.jsx("div",{className:"text-xs text-gray-500",children:"Upload & Go"})]})]}),e.jsxs("div",{onClick:()=>{je("STOCK"),j([]),de("")},className:`cursor-pointer p-4 rounded-2xl border-2 transition-all flex items-center justify-center space-x-3 ${u==="STOCK"?"border-red-600 bg-red-50":"border-gray-200 bg-white hover:border-gray-300"}`,children:[e.jsx("div",{className:`p-2 rounded-full ${u==="STOCK"?"bg-red-200 text-red-700":"bg-gray-100 text-gray-500"}`,children:e.jsx("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"})})}),e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:`font-bold text-sm ${u==="STOCK"?"text-red-900":"text-gray-700"}`,children:"Stock Request"}),e.jsx("div",{className:"text-xs text-gray-500",children:"From Inventory"})]})]})]}),u==="STOCK"&&e.jsx("div",{className:"bg-white border border-gray-200 rounded-2xl p-4 shadow-sm space-y-4",children:e.jsxs("div",{children:[e.jsx("div",{className:"flex justify-between items-center mb-2",children:e.jsx("h3",{className:"font-bold text-lg text-gray-800",children:"Source Location"})}),e.jsx("p",{className:"text-gray-500 text-sm mb-3",children:"Where should we pick up the stock from?"}),V.length>0?e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:V.map(t=>e.jsxs("div",{onClick:()=>{de(t.branchId),G("stock-"+t.branchId)},className:`cursor-pointer p-4 rounded-xl border-2 transition-all ${U===t.branchId?"border-red-600 bg-red-50":"border-gray-100 hover:border-gray-200"}`,children:[e.jsx("div",{className:"font-bold text-gray-900",children:t.branchName}),e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:[t.items.length," unique items in stock"]})]},t.id))}):e.jsx("div",{className:"text-center py-6 bg-gray-50 rounded-xl border border-dashed border-gray-300",children:e.jsx("p",{className:"text-gray-500",children:"No stock found in any warehouse."})})]})}),u!=="STOCK"&&e.jsxs("div",{className:"bg-white p-4 rounded-2xl border border-gray-200 shadow-sm",children:[e.jsxs("h3",{className:"font-bold text-gray-800 mb-3",children:["1. ",g("pickup_location")]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("select",{className:"block w-full px-3 py-2 border border-gray-300 rounded-xl focus:ring-red-500 focus:border-red-500 bg-gray-50 text-sm",value:R,onChange:t=>G(t.target.value),children:[O.map(t=>e.jsxs("option",{value:t.id,children:[t.label," - ",t.address]},t.id)),e.jsx("option",{value:"custom",children:"+ Use a different location"})]}),R==="custom"&&e.jsxs("div",{className:"space-y-2 pl-2 border-l-2 border-red-100",children:[e.jsx("div",{className:"flex gap-2",children:e.jsx("div",{className:"relative flex-1",children:e.jsx($e,{placeholder:"Enter Pickup Address",value:te,onChange:se,onSelect:Xe,onPickMap:()=>W({type:"PICKUP"}),className:"block w-full px-3 py-2 border border-gray-300 rounded-xl shadow-sm focus:outline-none focus:ring-indigo-500 sm:text-sm pr-10"})})}),e.jsx("div",{className:"flex gap-2 justify-between",children:e.jsx("span",{className:"text-xs text-gray-400",children:A?`${A}, ${E}`:"No coordinates selected"})}),e.jsxs("div",{className:"mt-2 pt-2 border-t border-gray-100",children:[e.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:re,onChange:t=>Ke(t.target.checked),className:"rounded text-red-600 focus:ring-red-500 border-gray-300"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Save this location for next time?"})]}),re&&e.jsx("div",{className:"mt-2 animate-fade-in-up",children:e.jsx(J,{placeholder:"Label (e.g. Home)",value:ae,onChange:t=>Ue(t.target.value),className:"text-sm",autoFocus:!0})})]})]})]})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"font-bold text-lg text-gray-800 mb-2",children:["2. ",g("select_vehicle")]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:$.map(t=>{const s=B,r=F.find(o=>o.serviceTypeId===t.id&&o.startDate.split("T")[0]<=s&&o.endDate.split("T")[0]>=s),a=r?r.price:t.defaultPrice;return e.jsxs("div",{onClick:()=>Ye(t.id),className:`relative p-4 rounded-2xl cursor-pointer border-2 transition-all flex flex-col items-center text-center space-y-2 ${y===t.id?"border-red-600 bg-red-50 shadow-md scale-105":"border-gray-100 bg-white hover:border-gray-300"}`,children:[e.jsx("div",{className:"h-12 w-12 bg-white rounded-full flex items-center justify-center shadow-sm border border-gray-100",children:t.image?e.jsx("img",{src:t.image,className:"w-full h-full object-cover rounded-full",alt:t.name}):e.jsx("div",{className:"text-xl",children:"ðŸ“¦"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold text-gray-900 text-sm",children:t.name}),e.jsx("p",{className:"text-xs text-gray-500 mt-1 line-clamp-1",children:t.description})]}),e.jsxs("div",{className:"font-bold text-red-700 text-xs flex flex-col items-center",children:[e.jsxs("span",{children:["From $",a]}),r&&e.jsx("span",{className:"text-[9px] bg-green-100 text-green-700 px-1.5 rounded-full mt-0.5",children:"Special Rate"})]}),y===t.id&&e.jsx("div",{className:"absolute top-2 right-2 bg-red-600 text-white rounded-full p-1 animate-bounce",children:e.jsx("svg",{className:"w-3 h-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"3",d:"M5 13l4 4L19 7"})})})]},t.id)})})]})]}),P===2&&e.jsxs("div",{className:"space-y-6 animate-fade-in-up",children:[u==="PHOTO"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-blue-50 border border-blue-100 p-4 rounded-xl flex items-start space-x-3",children:[e.jsx("div",{className:"text-blue-500 mt-0.5",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),e.jsxs("div",{className:"text-sm text-blue-800",children:[e.jsx("p",{className:"font-bold",children:"One Image = One Parcel"}),e.jsx("p",{className:"text-blue-700 mt-1",children:"Upload a clear photo of each parcel. Our driver will read the delivery details from the image."})]})]}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-4",children:[e.jsxs("label",{htmlFor:"photo-upload-input",className:"aspect-square rounded-xl border-2 border-dashed border-gray-300 bg-gray-50 flex flex-col items-center justify-center cursor-pointer hover:bg-white hover:border-red-300 hover:text-red-500 text-gray-400 transition-all",children:[e.jsx("svg",{className:"w-8 h-8 mb-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 4v16m8-8H4"})}),e.jsx("span",{className:"text-xs font-bold",children:"Add Photos"})]}),x.map((t,s)=>e.jsxs("div",{className:"relative aspect-square rounded-xl border border-gray-200 overflow-hidden group bg-white shadow-sm",children:[e.jsx("img",{src:t.image,alt:`Parcel ${s+1}`,className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute inset-0 bg-black/0 group-hover:bg-black/10 transition-colors"}),e.jsx("button",{onClick:()=>me(s),className:"absolute top-1 right-1 bg-red-500 text-white rounded-full p-1 shadow-md opacity-90 hover:opacity-100 transition-opacity",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/70 to-transparent p-2",children:e.jsxs("span",{className:"text-white text-xs font-bold",children:["Parcel ",s+1]})})]},t.id))]}),e.jsx("input",{type:"file",id:"photo-upload-input",className:"hidden",accept:"image/*",multiple:!0,onChange:Je}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-2xl p-4 shadow-sm space-y-4",children:[e.jsx("h3",{className:"font-bold text-sm text-gray-800 border-b border-gray-100 pb-2",children:g("parcel_details")}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-gray-500 mb-1",children:g("delivery_instructions")}),e.jsx("textarea",{className:"block w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-red-500 focus:border-red-500",rows:2,placeholder:"e.g. Call 012-345-678 upon arrival at destination...",value:oe,onChange:t=>Ce(t.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-gray-500 mb-1",children:g("promo_code")}),e.jsxs("select",{className:"block w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-red-500 focus:border-red-500",value:S,onChange:t=>q(t.target.value),children:[e.jsx("option",{value:"",children:"-- Select Promotion --"}),H.map(t=>e.jsxs("option",{value:t.id,children:[t.code," - ",t.name," (",t.type==="PERCENTAGE"?`${t.value}% Off`:`$${t.value} Off`,")"]},t.id))]})]})]})]}),u==="STOCK"&&e.jsxs("div",{className:"space-y-4",children:[I==="SINGLE"&&e.jsxs("div",{className:"bg-gray-50 p-4 rounded-xl border border-gray-200",children:[e.jsx("h3",{className:"text-sm font-bold text-gray-700 uppercase mb-3",children:"Receiver Details"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500 mb-1",children:"Receiver Name"}),e.jsx("input",{type:"text",value:ce,onChange:t=>We(t.target.value),className:"block w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-red-500 focus:border-red-500 text-sm",placeholder:"Name"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500 mb-1",children:"Receiver Phone"}),e.jsx("input",{type:"text",value:ue,onChange:t=>qe(t.target.value),className:"block w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-red-500 focus:border-red-500 text-sm",placeholder:"Phone"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500 mb-1",children:"Delivery Address"}),e.jsx("input",{type:"text",value:xe,onChange:t=>ze(t.target.value),className:"block w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-red-500 focus:border-red-500 text-sm",placeholder:"Full Address"})]})]})]}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl overflow-hidden shadow-sm",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-1/3",children:"Product / SKU"}),e.jsx("th",{className:"px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-24",children:"Qty"}),I!=="SINGLE"&&e.jsx("th",{className:"px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Receiver Info"}),e.jsx("th",{className:"px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-48",children:"COD & Currency"}),I!=="SINGLE"&&e.jsx("th",{className:"px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Address"}),e.jsx("th",{className:"px-3 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider w-10"})]})}),e.jsxs("tbody",{className:"bg-white divide-y divide-gray-200",children:[x.map((t,s)=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-3 py-3 align-top",children:e.jsxs("div",{className:"space-y-1",children:[e.jsxs("select",{className:"block w-full py-2 pl-3 pr-10 text-sm border-gray-300 bg-white rounded-md focus:outline-none focus:ring-red-500 focus:border-red-500 shadow-sm transition-colors cursor-pointer hover:border-gray-400",value:u==="STOCK"?t.stockItemId||"":t.productId||"",onChange:r=>{const a=r.target.value;if(u==="STOCK"){const o=V.find(i=>i.branchId===U),l=o==null?void 0:o.items.find(i=>i.id===a);l&&j(i=>{const d=[...i];return d[s]={...d[s],productId:l.productId,stockItemId:l.id,sku:l.sku,productPrice:l.unitPrice||0,codCurrency:l.unitPriceCurrency||"USD",image:l.image||""},d})}else{const o=ie.find(l=>l.id===a);o&&j(l=>{const i=[...l];return i[s]={...i[s],productId:o.id,sku:o.sku,productPrice:o.defaultPrice||0,codCurrency:o.priceCurrency||"USD",image:o.image||""},i})}},children:[e.jsx("option",{value:"",children:"Select Product..."}),(()=>{const r=V.find(a=>a.branchId===U);return u==="STOCK"&&r?r.items.map(a=>{const o=a.quantity-(a.reservedQuantity||0),l=ie.find(d=>d.id===a.productId),i=(l==null?void 0:l.sku)||a.sku;return e.jsxs("option",{value:a.id,disabled:o<=0,children:[i?`${i} - ${a.productName}`:a.productName," (Avail: ",o,")"]},a.id)}):ie.map(a=>e.jsxs("option",{value:a.id,children:[a.productName," (",a.sku,")"]},a.id))})()]}),t.sku&&e.jsxs("div",{className:"text-xs text-gray-500 font-mono",children:["SKU: ",t.sku]})]})}),e.jsx("td",{className:"px-3 py-3 align-top",children:e.jsx("input",{type:"number",min:"1",className:"block w-full py-2 px-2 text-sm border-gray-300 rounded-md focus:ring-red-500 focus:border-red-500 text-center",value:t.quantity||1,onChange:r=>{const a=parseInt(r.target.value)||1;k(s,"quantity",a)}})}),I!=="SINGLE"&&e.jsx("td",{className:"px-3 py-3 align-top",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"relative rounded-md shadow-sm",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx("svg",{className:"h-4 w-4 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})})}),e.jsx("input",{type:"text",placeholder:"Name",className:"block w-full pl-10 text-sm border-gray-300 rounded-md focus:ring-red-500 focus:border-red-500",value:t.receiverName,onChange:r=>k(s,"receiverName",r.target.value)})]}),e.jsxs("div",{className:"relative rounded-md shadow-sm",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx("svg",{className:"h-4 w-4 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"})})}),e.jsx("input",{type:"text",placeholder:"Phone",className:"block w-full pl-10 text-sm border-gray-300 rounded-md focus:ring-red-500 focus:border-red-500",value:t.receiverPhone,onChange:r=>k(s,"receiverPhone",r.target.value)})]})]})}),e.jsx("td",{className:"px-3 py-3 align-top",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"number",placeholder:"0.00",className:"block w-full py-2 px-3 text-sm border-gray-300 rounded-md focus:ring-red-500 focus:border-red-500 text-right",value:t.productPrice,onChange:r=>k(s,"productPrice",r.target.value)}),e.jsxs("select",{className:"block w-24 py-2 px-2 text-sm border-gray-300 rounded-md focus:ring-red-500 focus:border-red-500",value:t.codCurrency||"USD",onChange:r=>k(s,"codCurrency",r.target.value),children:[e.jsx("option",{value:"USD",children:"USD"}),e.jsx("option",{value:"KHR",children:"KHR"})]})]})}),I!=="SINGLE"&&e.jsx("td",{className:"px-3 py-3 align-top",children:e.jsxs("div",{className:"relative rounded-md shadow-sm",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsxs("svg",{className:"h-4 w-4 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M15 11a3 3 0 11-6 0 3 3 0 016 0z"})]})}),e.jsx("input",{type:"text",placeholder:"Location (Free text)",className:"block w-full pl-10 text-sm border-gray-300 rounded-md focus:ring-red-500 focus:border-red-500",value:t.destinationAddress||"",onChange:r=>k(s,"destinationAddress",r.target.value)}),e.jsx("div",{className:"absolute inset-y-0 right-0 pr-2 flex items-center",children:e.jsx("svg",{className:"h-3 w-3 text-gray-400 cursor-nw-resize",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"})})})]})}),e.jsx("td",{className:"px-3 py-3 align-top text-center",children:e.jsx("button",{onClick:()=>me(s),className:"text-gray-400 hover:text-red-600 transition-colors p-1",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})})]},t.id)),x.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:I==="SINGLE"?4:6,className:"px-6 py-10 text-center text-gray-500 italic",children:"Use the button below to add your first package."})})]})]})}),e.jsx("div",{onClick:()=>j(t=>[...t,{id:`pi-${Date.now()}-${Math.random()}`,image:"",receiverName:"",receiverPhone:"",destinationAddress:"",productPrice:0,codCurrency:"USD",status:"PENDING"}]),className:"w-full bg-gray-50 hover:bg-gray-100 py-3 text-center border-t border-dashed border-gray-300 cursor-pointer text-sm font-medium text-gray-600 hover:text-red-600 transition-colors",children:"+ Add Row"})]})]}),u==="MANUAL"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-lg text-gray-800",children:g("receiver_details")}),e.jsx("p",{className:"text-gray-500 text-sm",children:"Who are we delivering to?"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"manual-upload-input",className:"bg-red-600 text-white px-4 py-2 rounded-xl text-sm font-bold shadow-lg hover:bg-red-700 flex items-center cursor-pointer",children:"+ Add Parcel"}),e.jsx("input",{type:"file",id:"manual-upload-input",hidden:!0,accept:"image/*",onChange:Ze})]})]}),e.jsxs("div",{className:"space-y-4",children:[x.map((t,s)=>e.jsxs("div",{className:"bg-white border border-gray-200 rounded-2xl p-4 shadow-sm relative",children:[e.jsx("button",{onClick:()=>me(s),className:"absolute top-2 right-2 text-gray-300 hover:text-red-500 p-1",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})}),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 border-b border-gray-100 pb-4",children:[e.jsx("div",{className:"w-20 h-20 bg-gray-100 rounded-xl overflow-hidden border border-gray-200 flex-shrink-0 mx-auto sm:mx-0",children:e.jsx("img",{src:t.image,className:"w-full h-full object-cover",alt:"Item"})}),e.jsxs("div",{className:"flex-1 grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsx(J,{placeholder:"Receiver Name",value:t.receiverName,onChange:r=>k(s,"receiverName",r.target.value)}),e.jsx(J,{placeholder:"Receiver Phone",value:t.receiverPhone,onChange:r=>k(s,"receiverPhone",r.target.value)}),e.jsx("div",{className:"md:col-span-2",children:e.jsx(J,{placeholder:"Your Reference / Tracking Code (Optional)",value:t.trackingCode||"",onChange:r=>k(s,"trackingCode",r.target.value)})})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-gray-500 mb-1",children:"Drop-off Location"}),e.jsx("div",{className:"flex gap-2",children:e.jsx("div",{className:"relative flex-1",children:e.jsx($e,{value:t.destinationAddress,onChange:r=>k(s,"destinationAddress",r),onSelect:r=>tt(s,r),onPickMap:()=>W({type:"DROPOFF",index:s}),placeholder:"Search Place (e.g. Royal Palace) or Enter Address",className:"block w-full px-3 py-2 border border-gray-300 rounded-lg text-sm"})})}),e.jsxs("div",{className:"flex justify-between items-center mt-2",children:[e.jsx("div",{className:"flex gap-2",children:e.jsxs("button",{type:"button",onClick:()=>Qe((r,a)=>et(s,r,a)),className:"text-xs bg-gray-100 hover:bg-gray-200 px-2 py-1 rounded text-gray-700 flex items-center",children:[e.jsxs("svg",{className:"w-3 h-3 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M15 11a3 3 0 11-6 0 3 3 0 016 0z"})]}),"GPS"]})}),t.destinationLocation&&e.jsxs("span",{className:"text-[10px] text-green-600 font-mono flex items-center",children:[e.jsx("svg",{className:"w-3 h-3 mr-1",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})})," GPS Set"]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-gray-500 mb-1",children:"Collect Cash (COD)"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-2 text-gray-500 text-sm",children:t.codCurrency==="KHR"?"áŸ›":"$"}),e.jsx("input",{type:"number",className:"block w-full pl-8 px-3 py-2 border border-gray-300 rounded-lg text-sm font-bold text-red-900",placeholder:"0.00",value:t.productPrice||"",onChange:r=>k(s,"productPrice",r.target.value)}),e.jsx("div",{className:"absolute right-3 top-2 text-xs text-gray-400",children:t.codCurrency||"USD"})]}),e.jsx("p",{className:"text-[10px] text-gray-400 mt-1",children:"Amount driver collects from receiver."})]})]})]})]},s)),x.length===0&&e.jsx("label",{className:"block text-center py-16 bg-gray-50 rounded-3xl border-2 border-dashed border-gray-300 cursor-pointer hover:bg-gray-100 transition-colors",htmlFor:"manual-upload-input",children:e.jsx("p",{className:"text-gray-500 font-medium",children:"Tap to add your first parcel"})})]}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-2xl p-4 shadow-sm space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-gray-500 mb-1",children:g("delivery_instructions")}),e.jsx("textarea",{className:"block w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-red-500 focus:border-red-500",rows:2,placeholder:"e.g. Leave at front gate, Call on arrival...",value:oe,onChange:t=>Ce(t.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-gray-500 mb-1",children:g("promo_code")}),e.jsxs("select",{className:"block w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-red-500 focus:border-red-500",value:S,onChange:t=>q(t.target.value),children:[e.jsx("option",{value:"",children:"-- Select Promotion --"}),H.map(t=>e.jsxs("option",{value:t.id,children:[t.code," - ",t.name," (",t.type==="PERCENTAGE"?`${t.value}% Off`:`$${t.value} Off`,")"]},t.id))]})]})]})]})]}),e.jsx("div",{ref:ye}),e.jsx("div",{className:"fixed bottom-0 left-0 right-0 p-4 bg-white border-t border-gray-200 shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.05)] z-50 safe-area-pb",children:e.jsxs("div",{className:"max-w-2xl mx-auto flex flex-col sm:flex-row justify-between items-center gap-3",children:[e.jsxs("div",{className:"text-center sm:text-left w-full sm:w-auto",children:[b.discount>0&&e.jsxs("p",{className:"text-xs text-green-600 font-medium",children:["Discount: -$",(b.discount||0).toFixed(2)]}),e.jsxs("p",{className:"text-xs text-gray-500",children:[g("total"),": ",e.jsxs("span",{className:"font-bold text-gray-900",children:["$",(b.total||0).toFixed(2)]}),b.isSpecialRate&&e.jsx("span",{className:"ml-1 text-[9px] text-green-600 font-bold uppercase bg-green-50 px-1 rounded",children:"Special Rate"})]}),Y.value>0&&e.jsxs("p",{className:"text-xs text-red-600",children:["COD: ",e.jsx("span",{className:"font-bold",children:Y.display})]})]}),e.jsxs("div",{className:"flex gap-3 w-full sm:w-auto",children:[P>1&&e.jsx(X,{variant:"outline",onClick:()=>Z(t=>t-1),className:"flex-1 sm:flex-none justify-center",children:g("back")}),P===1&&e.jsx(X,{disabled:!y,onClick:()=>Z(2),className:"flex-1 sm:flex-none justify-center px-8 bg-red-600 hover:bg-red-700 text-white shadow-lg shadow-red-100",children:g("next")}),P===2&&e.jsx(X,{disabled:x.length===0,onClick:()=>Z(3),className:"flex-1 sm:flex-none justify-center px-8 bg-red-600 hover:bg-red-700 text-white shadow-lg shadow-red-100",children:g("next")}),P===3&&e.jsx(X,{onClick:st,isLoading:Te,className:"flex-1 sm:flex-none justify-center px-8 bg-red-600 hover:bg-red-700 text-white shadow-lg shadow-red-100",children:g("confirm_booking")})]})]})}),w&&e.jsx(ft,{initialLat:w.type==="PICKUP"&&A?Number(A):void 0,initialLng:w.type==="PICKUP"&&E?Number(E):void 0,onConfirm:Ve,onClose:()=>W(null)}),P===3&&e.jsx(pt,{title:"Review & Financials",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Apply Promotion"}),e.jsxs("select",{className:"block w-full px-3 py-2 border border-gray-300 rounded-xl shadow-sm focus:outline-none focus:ring-indigo-500 sm:text-sm",value:S,onChange:t=>q(t.target.value),children:[e.jsx("option",{value:"",children:"No Promotion"}),H.map(t=>e.jsxs("option",{value:t.id,children:[t.code," - ",t.name," (",t.type==="PERCENTAGE"?`${t.value}% Off`:`$${t.value} Off`,")"]},t.id))]})]}),e.jsxs("div",{className:"bg-blue-50 p-4 rounded-xl border border-blue-100 text-sm text-blue-800",children:[e.jsx("p",{className:"font-bold mb-1",children:"Estimated Pickup"}),e.jsxs("p",{children:["Our driver will contact you shortly after confirmation to arrange pickup at: ",e.jsx("strong",{children:R==="custom"?te:(Se=O.find(t=>t.id===R))==null?void 0:Se.address})]})]})]}),e.jsxs("div",{className:"bg-gray-50 p-6 rounded-xl border border-gray-200 space-y-3",children:[e.jsx("h4",{className:"text-sm font-bold text-gray-900 mb-2",children:"Payment Summary"}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("span",{className:"text-gray-600",children:["Subtotal ",b.isSpecialRate&&e.jsx("span",{className:"text-xs text-green-600 font-bold bg-green-50 px-1 rounded ml-1",children:"Special Rate"})]}),e.jsxs("span",{className:"font-medium",children:["$",(b.subtotal||0).toFixed(2)]})]}),(b.discount||0)>0&&e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:g("discount")}),e.jsxs("span",{className:"font-medium text-green-600",children:["-$",(b.discount||0).toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between text-lg font-bold pt-3 border-t border-gray-300",children:[e.jsx("span",{className:"text-gray-900",children:"Total Fee"}),e.jsxs("span",{className:"text-indigo-600",children:["$",(b.total||0).toFixed(2)]})]}),Y.value>0&&e.jsxs("div",{className:"flex justify-between text-sm pt-2 text-red-600 font-medium border-t border-gray-200 mt-2",children:[e.jsx("span",{children:"COD to Collect"}),e.jsx("span",{children:Y.display})]})]})]})})]}),ee&&e.jsx(gt,{message:ee.message,type:ee.type,onClose:()=>C(null)})]})};export{Rt as C};
