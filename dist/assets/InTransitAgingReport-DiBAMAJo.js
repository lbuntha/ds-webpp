import{r as i,j as e,f as w}from"./index-BUL6LB55.js";import{C as d}from"./Card-k44aVk4n.js";import{B as k}from"./Button-CqEssTF4.js";import{T as D}from"./TrackingTimeline--cIDV8xm.js";const R=()=>{const[l,f]=i.useState([]),[N,g]=i.useState(!1),[o,j]=i.useState(0),[m,h]=i.useState(null),[v,p]=i.useState(void 0);i.useEffect(()=>{(async()=>{g(!0);try{const r=await w.getParcelBookings();f(r)}catch(r){console.error(r)}finally{g(!1)}})()},[]);const n=i.useMemo(()=>{const t=[],r=Date.now();return l.forEach(s=>{s.status==="COMPLETED"||s.status==="CANCELLED"||(s.items||[]).forEach(a=>{if(a.status==="IN_TRANSIT"){let x=s.createdAt;if(a.modifications&&a.modifications.length>0){const u=[...a.modifications].reverse().find(y=>y.field==="Status"&&y.newValue==="IN_TRANSIT");u&&(x=u.timestamp)}const I=r-x,T=Math.floor(I/(1e3*60*60*24));t.push({bookingId:s.id,bookingRef:(s.id||"").slice(-6),itemId:a.id,trackingCode:a.trackingCode||"N/A",receiverName:a.receiverName,destination:a.destinationAddress,driverName:a.driverName||"Unassigned",senderName:s.senderName,transitStartTime:x,daysInTransit:T,status:a.status})}})}),t.filter(s=>s.daysInTransit>=o).sort((s,a)=>a.daysInTransit-s.daysInTransit)},[l,o]),c=i.useMemo(()=>({total:n.length,critical:n.filter(t=>t.daysInTransit>3).length,warning:n.filter(t=>t.daysInTransit>1&&t.daysInTransit<=3).length}),[n]),b=(t,r)=>{const s=l.find(a=>a.id===t);s&&(h(s),p(r))};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center gap-4 print:hidden",children:[e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Show Aging >"}),e.jsxs("select",{className:"border border-gray-300 rounded-lg px-3 py-1.5 text-sm focus:ring-indigo-500 focus:border-indigo-500",value:o,onChange:t=>j(Number(t.target.value)),children:[e.jsx("option",{value:0,children:"All In-Transit"}),e.jsx("option",{value:1,children:"1 Day"}),e.jsx("option",{value:3,children:"3 Days (Critical)"}),e.jsx("option",{value:7,children:"7 Days"})]})]}),e.jsx(k,{variant:"outline",onClick:()=>window.print(),children:"Print Report"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs(d,{className:"bg-blue-50 border-blue-200",children:[e.jsx("div",{className:"text-xs font-bold text-blue-800 uppercase",children:"Total In-Transit"}),e.jsx("div",{className:"text-2xl font-bold text-blue-900",children:c.total})]}),e.jsxs(d,{className:"bg-orange-50 border-orange-200",children:[e.jsx("div",{className:"text-xs font-bold text-orange-800 uppercase",children:"Delayed (>1 Day)"}),e.jsx("div",{className:"text-2xl font-bold text-orange-900",children:c.warning})]}),e.jsxs(d,{className:"bg-red-50 border-red-200",children:[e.jsx("div",{className:"text-xs font-bold text-red-800 uppercase",children:"Critical (>3 Days)"}),e.jsx("div",{className:"text-2xl font-bold text-red-900",children:c.critical})]})]}),e.jsx(d,{title:"In-Transit Aging Details",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 text-sm",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left font-medium text-gray-500 uppercase",children:"Aging"}),e.jsx("th",{className:"px-4 py-3 text-left font-medium text-gray-500 uppercase",children:"Since"}),e.jsx("th",{className:"px-4 py-3 text-left font-medium text-gray-500 uppercase",children:"Ref / Tracking"}),e.jsx("th",{className:"px-4 py-3 text-left font-medium text-gray-500 uppercase",children:"Receiver / Dest"}),e.jsx("th",{className:"px-4 py-3 text-left font-medium text-gray-500 uppercase",children:"Current Driver"}),e.jsx("th",{className:"px-4 py-3 text-right font-medium text-gray-500 uppercase",children:"Action"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 bg-white",children:N?e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"px-4 py-8 text-center text-gray-500",children:"Loading data..."})}):n.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"px-4 py-8 text-center text-gray-500",children:"No items matching criteria."})}):n.map((t,r)=>{const s=t.daysInTransit>3,a=t.daysInTransit>1;return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsxs("span",{className:`px-2 py-1 rounded font-bold text-xs ${s?"bg-red-100 text-red-800":a?"bg-orange-100 text-orange-800":"bg-green-100 text-green-800"}`,children:[t.daysInTransit," Days"]})}),e.jsxs("td",{className:"px-4 py-3 text-gray-600",children:[new Date(t.transitStartTime).toLocaleDateString(),e.jsx("div",{className:"text-[10px] text-gray-400",children:new Date(t.transitStartTime).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]}),e.jsxs("td",{className:"px-4 py-3",children:[e.jsx("div",{className:"font-mono font-bold text-gray-900",children:t.trackingCode}),e.jsxs("div",{className:"text-xs text-gray-500",children:["Booking #",t.bookingRef]})]}),e.jsxs("td",{className:"px-4 py-3",children:[e.jsx("div",{className:"font-medium text-gray-900",children:t.receiverName}),e.jsx("div",{className:"text-xs text-gray-500 truncate max-w-xs",title:t.destination,children:t.destination})]}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("div",{className:"text-indigo-600 font-medium",children:t.driverName})}),e.jsx("td",{className:"px-4 py-3 text-right",children:e.jsx("button",{onClick:()=>b(t.bookingId,t.itemId),className:"text-xs bg-gray-100 hover:bg-gray-200 text-gray-700 px-3 py-1 rounded border border-gray-300 transition-colors",children:"View"})})]},`${t.bookingId}-${t.itemId}`)})})]})})}),m&&e.jsx(D,{booking:m,initialChatItemId:v,onClose:()=>{h(null),p(void 0)}})]})};export{R as I};
