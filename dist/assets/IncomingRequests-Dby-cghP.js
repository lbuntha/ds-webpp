import{b as V,h as W,r as n,s as N,j as e}from"./index-BUL6LB55.js";import{t as x}from"./toast-DfW6NkLH.js";import{c as S}from"./createLucideIcon-CEuAjdeA.js";import{F as X}from"./funnel-Bpc5ey4e.js";import{P as y}from"./package-BdetSlVF.js";import{T as J,a as Z,C as ee}from"./truck-dDUXP_FN.js";import{X as se,C as P}from"./x-C56ZNX5h.js";import{T as q}from"./triangle-alert-caMmt7Ek.js";/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const te=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]],I=S("calendar",te);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ae=[["polyline",{points:"22 12 16 12 14 15 10 15 8 12 2 12",key:"o97t9d"}],["path",{d:"M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z",key:"oot6mr"}]],L=S("inbox",ae);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const re=[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]],le=S("user",re),ue=()=>{const{user:r}=V(),{branches:M}=W(),[O,_]=n.useState([]),[F,D]=n.useState(!0),[d,g]=n.useState(null),[v,U]=n.useState(""),[w,$]=n.useState("ALL"),[o,A]=n.useState("TODAY"),[u,E]=n.useState({start:"",end:""}),[m,b]=n.useState(null),[l,j]=n.useState(null),[p,k]=n.useState(null);n.useEffect(()=>{f()},[v]);const f=async()=>{D(!0);try{const s=await N.getPendingRequests(v||void 0);_(s)}catch(s){console.error("Error loading requests:",s),x.error("Failed to load requests")}finally{D(!1)}},C=O.filter(s=>{const t=w==="ALL"?!0:s.status===w;let a=!0;const i=new Date(s.createdAt),h=new Date;h.setHours(0,0,0,0);const R=new Date(h);if(R.setDate(R.getDate()-1),o==="TODAY")a=i>=h;else if(o==="YESTERDAY")a=i>=R&&i<h;else if(o==="LAST_WEEK"){const c=new Date(h);c.setDate(c.getDate()-7),a=i>=c}else if(o==="LAST_MONTH"){const c=new Date(h);c.setDate(c.getDate()-30),a=i>=c}else if(o==="CUSTOM"&&u.start&&u.end){const c=new Date(u.start);c.setHours(0,0,0,0);const T=new Date(u.end);T.setHours(23,59,59,999),a=i>=c&&i<=T}return t&&a}),Q=s=>{j({request:s,items:s.items.map(t=>({...t,actualQuantity:t.quantity}))})},H=async()=>{if(l){g(l.request.id);try{await N.approveRequest(l.request.id,l.request.customerId,(r==null?void 0:r.uid)||"",(r==null?void 0:r.name)||"",l.items),x.success("Request approved and notification sent!"),j(null),f()}catch(s){console.error("Error approving request:",s),x.error("Failed to approve request")}finally{g(null)}}},Y=(s,t)=>{if(!l)return;const a=[...l.items];a[s]={...a[s],actualQuantity:t},j({...l,items:a})},B=async()=>{if(!m||!m.reason.trim()){x.warning("Please provide a rejection reason");return}g(m.requestId);try{await N.rejectRequest(m.requestId,m.reason,(r==null?void 0:r.uid)||"",(r==null?void 0:r.name)||""),x.success("Request rejected"),b(null),f()}catch(s){console.error("Error rejecting request:",s),x.error("Failed to reject request")}finally{g(null)}},K=s=>{k(s)},z=async()=>{if(p){g(p.id);try{await N.receiveRequest(p,(r==null?void 0:r.uid)||"",(r==null?void 0:r.name)||""),x.success("Stock received and added to inventory!"),k(null),f()}catch(s){console.error("Error receiving stock:",s),x.error("Failed to receive stock")}finally{g(null)}}},G=s=>{const a={PENDING:{bg:"bg-yellow-100",text:"text-yellow-800"},APPROVED:{bg:"bg-blue-100",text:"text-blue-800"}}[s]||{bg:"bg-gray-100",text:"text-gray-800"};return e.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium ${a.bg} ${a.text}`,children:[s==="PENDING"?e.jsx(Z,{className:"w-3 h-3"}):e.jsx(ee,{className:"w-3 h-3"}),s]})};return F?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-red-600"})}):e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(L,{className:"w-8 h-8 text-red-600"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Incoming Stock Requests"}),e.jsx("p",{className:"text-gray-500",children:"Review and process customer stock requests"})]})]}),e.jsxs("div",{className:"bg-white p-4 rounded-xl shadow-sm border border-gray-200 space-y-4",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-4 flex-1",children:[e.jsxs("div",{className:"relative min-w-[200px]",children:[e.jsx(X,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsxs("select",{value:v,onChange:s=>U(s.target.value),className:"pl-9 pr-4 py-2 w-full border border-gray-300 rounded-xl focus:ring-2 focus:ring-red-500 text-sm bg-gray-50 bg-white",children:[e.jsx("option",{value:"",children:"All Branches"}),M.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]}),e.jsx("div",{className:"h-6 w-px bg-gray-200 mx-2 hidden sm:block"}),e.jsx("div",{className:"flex bg-gray-100 rounded-lg p-1",children:["ALL","PENDING","APPROVED"].map(s=>e.jsx("button",{onClick:()=>$(s),className:`px-3 py-1.5 rounded-md text-sm font-medium transition-all ${w===s?"bg-white text-gray-900 shadow-sm":"text-gray-500 hover:text-gray-700"}`,children:s==="ALL"?"All Status":s},s))})]}),e.jsxs("div",{className:"text-sm text-gray-500 font-medium whitespace-nowrap",children:[C.length," results"]})]}),e.jsxs("div",{className:"border-t border-gray-100 pt-4",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsxs("span",{className:"text-sm font-medium text-gray-700 mr-2 flex items-center gap-2",children:[e.jsx(I,{className:"w-4 h-4"}),"Time Period:"]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[["TODAY","YESTERDAY","LAST_WEEK","LAST_MONTH","ALL"].map(s=>e.jsx("button",{onClick:()=>A(s),className:`px-3 py-1.5 rounded-xl text-sm font-medium transition-colors ${o===s?"bg-red-100 text-red-700 border border-red-200":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:s.replace("_"," ")},s)),e.jsx("button",{onClick:()=>A("CUSTOM"),className:`px-3 py-1.5 rounded-xl text-sm font-medium transition-colors ${o==="CUSTOM"?"bg-red-100 text-red-700 border border-red-200":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:"CUSTOM"})]})]}),o==="CUSTOM"&&e.jsxs("div",{className:"flex items-center gap-2 mt-3 p-3 bg-gray-50 rounded-xl border border-dashed border-gray-300 animate-slide-down",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Select Range:"}),e.jsx("input",{type:"date",value:u.start,onChange:s=>E(t=>({...t,start:s.target.value})),className:"px-3 py-1.5 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500"}),e.jsx("span",{className:"text-gray-400",children:"to"}),e.jsx("input",{type:"date",value:u.end,onChange:s=>E(t=>({...t,end:s.target.value})),className:"px-3 py-1.5 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500"})]})]})]}),C.length===0?e.jsxs("div",{className:"text-center py-12 bg-gray-50 rounded-lg",children:[e.jsx(L,{className:"w-12 h-12 mx-auto text-gray-400 mb-3"}),e.jsx("p",{className:"text-gray-500",children:"No incoming requests"})]}):e.jsx("div",{className:"space-y-4",children:C.map(s=>e.jsxs("div",{className:"bg-white rounded-lg shadow border border-gray-200 overflow-hidden",children:[e.jsx("div",{className:"p-4 bg-gray-50 border-b",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(le,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"font-semibold text-gray-900",children:s.customerName}),G(s.status)]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-500",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(y,{className:"w-4 h-4"}),s.branchName]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(I,{className:"w-4 h-4"}),new Date(s.createdAt).toLocaleDateString()]}),s.expectedDate&&e.jsxs("span",{children:["Expected: ",s.expectedDate]})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:s.pickupPreference==="REQUEST_PICKUP"&&e.jsxs("span",{className:"flex items-center gap-1 px-2 py-1 bg-purple-100 text-purple-700 text-xs rounded-full",children:[e.jsx(J,{className:"w-3 h-3"}),"Pickup: ",s.pickupAddress||"Address needed"]})})]})}),e.jsxs("div",{className:"p-4",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:s.items.map((t,a)=>e.jsxs("div",{className:"flex items-center gap-3 p-2 bg-gray-50 rounded-lg",children:[t.image?e.jsx("img",{src:t.image,alt:t.productName,className:"w-12 h-12 rounded object-cover"}):e.jsx("div",{className:"w-12 h-12 bg-gray-200 rounded flex items-center justify-center",children:e.jsx(y,{className:"w-6 h-6 text-gray-400"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-gray-900",children:t.productName}),e.jsxs("p",{className:"text-sm text-gray-500",children:[t.sku&&`SKU: ${t.sku} • `,"Qty: ",t.quantity,t.unitPrice&&` • ${t.unitPrice} USD`]})]})]},a))}),s.notes&&e.jsxs("p",{className:"mt-3 text-sm text-gray-600 p-2 bg-yellow-50 rounded",children:[e.jsx("strong",{children:"Notes:"})," ",s.notes]})]}),e.jsxs("div",{className:"p-4 bg-gray-50 border-t flex justify-end gap-2",children:[s.status==="PENDING"&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>b({requestId:s.id,reason:""}),disabled:d===s.id,className:"flex items-center gap-1 px-4 py-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors disabled:opacity-50",children:[e.jsx(se,{className:"w-4 h-4"}),"Reject"]}),e.jsxs("button",{onClick:()=>Q(s),disabled:d===s.id,className:"flex items-center gap-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50",children:[e.jsx(P,{className:"w-4 h-4"}),"Approve"]})]}),s.status==="APPROVED"&&e.jsxs("button",{onClick:()=>K(s),disabled:d===s.id,className:"flex items-center gap-1 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors disabled:opacity-50",children:[e.jsx(y,{className:"w-4 h-4"}),"Receive Stock"]})]})]},s.id))}),m&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-md",children:[e.jsx("div",{className:"p-4 border-b",children:e.jsx("h2",{className:"text-lg font-semibold",children:"Reject Request"})}),e.jsxs("div",{className:"p-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Rejection Reason *"}),e.jsx("textarea",{value:m.reason,onChange:s=>b(t=>t?{...t,reason:s.target.value}:null),placeholder:"Explain why this request is being rejected...",rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500"})]}),e.jsxs("div",{className:"flex justify-end gap-3 p-4 border-t",children:[e.jsx("button",{onClick:()=>b(null),className:"px-4 py-2 text-gray-600 hover:bg-gray-100 rounded-lg",children:"Cancel"}),e.jsx("button",{onClick:B,disabled:d!==null,className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 disabled:opacity-50",children:"Reject Request"})]})]})}),l&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"p-4 border-b",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Approve Request"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Verify quantities before approving. Notification will be sent to customer."})]}),e.jsxs("div",{className:"p-4",children:[e.jsx("div",{className:"space-y-4",children:l.items.map((s,t)=>{const a=s.actualQuantity!==s.quantity;return e.jsxs("div",{className:`flex items-start gap-4 p-3 rounded-lg border ${a?"bg-yellow-50 border-yellow-200":"bg-gray-50 border-gray-200"}`,children:[s.image?e.jsx("img",{src:s.image,alt:s.productName,className:"w-16 h-16 rounded object-cover"}):e.jsx("div",{className:"w-16 h-16 bg-white rounded flex items-center justify-center border",children:e.jsx(y,{className:"w-8 h-8 text-gray-400"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-medium text-gray-900",children:s.productName}),s.sku&&e.jsxs("p",{className:"text-xs text-gray-500",children:["SKU: ",s.sku]}),e.jsxs("div",{className:"mt-2 flex items-center gap-4",children:[e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"text-gray-500",children:"Requested:"}),e.jsx("span",{className:"ml-1 font-semibold",children:s.quantity})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-gray-700",children:"Actual:"}),e.jsx("input",{type:"number",min:"0",value:s.actualQuantity,onChange:i=>Y(t,parseInt(i.target.value)||0),className:`w-20 px-2 py-1 text-sm border rounded focus:ring-2 ${a?"border-yellow-400 focus:ring-yellow-500":"border-gray-300 focus:ring-blue-500"}`})]})]}),a&&e.jsxs("div",{className:"mt-2 flex items-center gap-1 text-xs text-yellow-700",children:[e.jsx(q,{className:"w-3 h-3"}),"Quantity differs from request"]})]})]},t)})}),l.items.some(s=>s.actualQuantity!==s.quantity)&&e.jsxs("div",{className:"mt-4 p-3 bg-blue-50 text-blue-800 text-sm rounded-lg flex items-start gap-2",children:[e.jsx(q,{className:"w-4 h-4 shrink-0 mt-0.5"}),e.jsx("p",{children:"Since verified quantities are different, a warning notification will be sent to the customer."})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 p-4 border-t",children:[e.jsx("button",{onClick:()=>j(null),className:"px-4 py-2 text-gray-600 hover:bg-gray-100 rounded-lg",children:"Cancel"}),e.jsxs("button",{onClick:H,disabled:d!==null,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 flex items-center gap-2",children:[d===l.request.id?e.jsx("span",{className:"animate-spin",children:"⏳"}):e.jsx(P,{className:"w-4 h-4"}),"Confirm Approval"]})]})]})}),p&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-sm p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Receive Stock?"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Confirm that you have received the physical stock. This will add the items to the main inventory."}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx("button",{onClick:()=>k(null),className:"px-4 py-2 text-gray-600 hover:bg-gray-100 rounded-lg transition-colors",children:"Cancel"}),e.jsxs("button",{onClick:z,disabled:d!==null,className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors flex items-center gap-2 disabled:opacity-50",children:[d===p.id?e.jsx("span",{className:"animate-spin",children:"⏳"}):e.jsx(y,{className:"w-4 h-4"}),"Confirm Receive"]})]})]})})]})};export{ue as IncomingRequests,ue as default};
