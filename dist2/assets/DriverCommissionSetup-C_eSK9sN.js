import{r as s,j as e,f as u}from"./index-BjK2osQV.js";import{C as T}from"./Card-DROeE3UG.js";import{B as I}from"./Button-JCYNVMjR.js";import{I as k}from"./Input-B96Hj4QL.js";import{t as m}from"./toast-DTXa3ATd.js";const O=()=>{const[g,F]=s.useState([]),[$,i]=s.useState(!1),[l,D]=s.useState(null),[b,p]=s.useState(""),[h,n]=s.useState("DELIVERY"),[d,o]=s.useState("ALL"),[a,c]=s.useState("PERCENTAGE"),[A,y]=s.useState(70),[R,f]=s.useState(0),[C,v]=s.useState(0),[N,j]=s.useState(!1),[U,E]=s.useState(null),S=async()=>{i(!0);try{const t=await u.logisticsService.getDriverCommissionRules();F(t.sort((r,x)=>(x.isDefault?1:0)-(r.isDefault?1:0)))}catch(t){console.error(t)}finally{i(!1)}};s.useEffect(()=>{S()},[]);const L=()=>{D(null),p(""),n("DELIVERY"),o("ALL"),c("PERCENTAGE"),y(70),f(0),v(0),j(!1)},P=t=>{D(t.id),p(t.zoneName),n(t.commissionFor||"DELIVERY"),o(t.driverSalaryType||"ALL"),c(t.type),y(t.value),f(t.valueUSD??(t.currency==="USD"?t.value:0)),v(t.valueKHR??(t.currency==="KHR"?t.value:0)),j(t.isDefault)},_=async t=>{if(t.preventDefault(),!!b){i(!0);try{if(N){const x=g.find(w=>w.isDefault&&w.id!==l);x&&await u.logisticsService.saveDriverCommissionRule({...x,isDefault:!1})}const r={id:l||`comm-${Date.now()}`,zoneName:b,commissionFor:h,driverSalaryType:d,type:a,value:a==="PERCENTAGE"?A:0,valueUSD:a==="FIXED_AMOUNT"?R:void 0,valueKHR:a==="FIXED_AMOUNT"?C:void 0,isDefault:N};await u.logisticsService.saveDriverCommissionRule(r),L(),await S(),m.success(l?"Rule updated.":"Rule created.")}catch{m.error("Failed to save rule")}finally{i(!1)}}},H=async t=>{try{await u.logisticsService.deleteDriverCommissionRule(t),await S(),m.success("Rule deleted.")}catch{m.error("Failed to delete rule.")}finally{E(null)}};return e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-1",children:e.jsx(T,{title:l?"Edit Rule":"Add Commission Rule",children:e.jsxs("form",{onSubmit:_,className:"space-y-4",children:[e.jsx(k,{label:"Zone / Rule Name",value:b,onChange:t=>p(t.target.value),placeholder:"e.g. Phnom Penh Standard",required:!0}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Commission For"}),e.jsxs("div",{className:"flex rounded-md shadow-sm",children:[e.jsx("button",{type:"button",onClick:()=>n("DELIVERY"),className:`flex-1 py-2 text-xs font-bold border rounded-l-lg ${h==="DELIVERY"?"bg-green-600 text-white border-green-600":"bg-white text-gray-600 border-gray-300 hover:bg-gray-50"}`,children:"Delivery"}),e.jsx("button",{type:"button",onClick:()=>n("PICKUP"),className:`flex-1 py-2 text-xs font-bold border rounded-r-lg ${h==="PICKUP"?"bg-green-600 text-white border-green-600":"bg-white text-gray-600 border-gray-300 hover:bg-gray-50"}`,children:"Pickup"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Driver Salary Type"}),e.jsxs("div",{className:"flex rounded-md shadow-sm",children:[e.jsx("button",{type:"button",onClick:()=>o("ALL"),className:`flex-1 py-2 text-xs font-bold border rounded-l-lg ${d==="ALL"?"bg-blue-600 text-white border-blue-600":"bg-white text-gray-600 border-gray-300 hover:bg-gray-50"}`,children:"All Drivers"}),e.jsx("button",{type:"button",onClick:()=>o("WITH_BASE_SALARY"),className:`flex-1 py-2 text-xs font-bold border ${d==="WITH_BASE_SALARY"?"bg-blue-600 text-white border-blue-600":"bg-white text-gray-600 border-gray-300 hover:bg-gray-50"}`,children:"With Salary"}),e.jsx("button",{type:"button",onClick:()=>o("WITHOUT_BASE_SALARY"),className:`flex-1 py-2 text-xs font-bold border rounded-r-lg ${d==="WITHOUT_BASE_SALARY"?"bg-blue-600 text-white border-blue-600":"bg-white text-gray-600 border-gray-300 hover:bg-gray-50"}`,children:"No Salary"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Amount Type"}),e.jsxs("div",{className:"flex rounded-md shadow-sm",children:[e.jsx("button",{type:"button",onClick:()=>c("PERCENTAGE"),className:`flex-1 py-2 text-xs font-bold border rounded-l-lg ${a==="PERCENTAGE"?"bg-indigo-600 text-white border-indigo-600":"bg-white text-gray-600 border-gray-300 hover:bg-gray-50"}`,children:"Percentage (%)"}),e.jsx("button",{type:"button",onClick:()=>c("FIXED_AMOUNT"),className:`flex-1 py-2 text-xs font-bold border rounded-r-lg ${a==="FIXED_AMOUNT"?"bg-indigo-600 text-white border-indigo-600":"bg-white text-gray-600 border-gray-300 hover:bg-gray-50"}`,children:"Fixed Amount ($)"})]})]}),e.jsx(k,{label:"Percentage Value (e.g. 70 for 70%)",type:"number",step:"1",value:A,onChange:t=>y(parseFloat(t.target.value)||0),required:a==="PERCENTAGE",className:a!=="PERCENTAGE"?"hidden":""}),a==="FIXED_AMOUNT"&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-green-700 mb-1",children:"USD Amount ($)"}),e.jsx("input",{type:"number",step:"0.01",value:R,onChange:t=>f(parseFloat(t.target.value)||0),className:"block w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-indigo-500 focus:border-indigo-500",placeholder:"0.13"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-blue-700 mb-1",children:"KHR Amount (៛)"}),e.jsx("input",{type:"number",step:"100",value:C,onChange:t=>v(parseFloat(t.target.value)||0),className:"block w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-indigo-500 focus:border-indigo-500",placeholder:"500"})]})]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Driver earns the amount matching the parcel's COD currency."})]}),e.jsxs("div",{className:"flex items-center space-x-2 pt-2",children:[e.jsx("input",{type:"checkbox",id:"isDefault",checked:N,onChange:t=>j(t.target.checked),className:"rounded text-indigo-600 focus:ring-indigo-500 border-gray-300"}),e.jsx("label",{htmlFor:"isDefault",className:"text-sm font-medium text-gray-700 cursor-pointer",children:"Set as Default Rule"})]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Default rule applies to all bookings unless a specific zone is matched."}),e.jsxs("div",{className:"flex justify-end space-x-2 pt-4",children:[l&&e.jsx(I,{type:"button",variant:"outline",onClick:L,children:"Cancel"}),e.jsx(I,{type:"submit",isLoading:$,children:l?"Update Rule":"Save Rule"})]})]})})}),e.jsx("div",{className:"lg:col-span-2",children:e.jsx(T,{title:"Commission Configuration",children:g.length===0?e.jsx("div",{className:"text-center py-10 text-gray-500",children:"No rules configured. System will default to 70%."}):e.jsx("div",{className:"space-y-3",children:g.map(t=>{var r;return e.jsxs("div",{className:`flex justify-between items-center p-4 border rounded-xl hover:shadow-sm transition-shadow bg-white ${t.isDefault?"border-l-4 border-l-indigo-500":"border-gray-200"}`,children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("h4",{className:"font-bold text-gray-900",children:t.zoneName}),t.isDefault&&e.jsx("span",{className:"text-[10px] bg-indigo-100 text-indigo-700 px-2 py-0.5 rounded font-bold uppercase",children:"Default"}),e.jsx("span",{className:`text-[10px] px-2 py-0.5 rounded font-bold uppercase ${(t.commissionFor||"DELIVERY")==="DELIVERY"?"bg-green-100 text-green-700":"bg-blue-100 text-blue-700"}`,children:t.commissionFor||"DELIVERY"}),e.jsx("span",{className:`text-[10px] px-2 py-0.5 rounded font-bold ${(t.driverSalaryType||"ALL")==="ALL"?"bg-gray-100 text-gray-700":(t.driverSalaryType||"ALL")==="WITH_BASE_SALARY"?"bg-purple-100 text-purple-700":"bg-orange-100 text-orange-700"}`,children:(t.driverSalaryType||"ALL")==="ALL"?"All Drivers":(t.driverSalaryType||"ALL")==="WITH_BASE_SALARY"?"With Salary":"No Salary"})]}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["Driver gets: ",e.jsx("span",{className:"font-bold text-green-600",children:t.type==="PERCENTAGE"?`${t.value}%`:t.valueUSD||t.valueKHR?`$${(t.valueUSD||0).toFixed(2)} / ៛${(t.valueKHR||0).toLocaleString()}`:`${t.currency==="KHR"?"៛":"$"}${((r=t.value)==null?void 0:r.toFixed(2))||0} ${t.currency||""}`})," per ",(t.commissionFor||"delivery").toLowerCase()]})]}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("button",{onClick:()=>P(t),className:"text-indigo-600 hover:text-indigo-900 text-sm font-medium px-2",children:"Edit"}),U===t.id?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>H(t.id),className:"text-white bg-red-600 hover:bg-red-700 px-2 py-1 rounded text-xs font-bold",children:"Confirm"}),e.jsx("button",{onClick:()=>E(null),className:"text-gray-500 hover:text-gray-700 px-2 py-1 text-xs",children:"Cancel"})]}):e.jsx("button",{onClick:()=>E(t.id),className:"text-red-600 hover:text-red-900 text-sm font-medium px-2",children:"Delete"})]})]},t.id)})})})})]})};export{O as D};
