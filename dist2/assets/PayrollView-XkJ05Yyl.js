const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-BjK2osQV.js","assets/index-CY9_X8xj.css"])))=>i.map(i=>d[i]);
import{j as e,r as i,_ as $,h as G,b as O,a4 as V,a5 as U}from"./index-BjK2osQV.js";import{P as z}from"./payrollService-CAVDQbmV.js";import{C as I}from"./Card-DROeE3UG.js";import{B as f}from"./Button-JCYNVMjR.js";import{I as M}from"./Input-B96Hj4QL.js";import{t as P}from"./toast-DTXa3ATd.js";const W=({slip:t,onClose:u})=>{const o=(l,n)=>new Intl.NumberFormat("en-US",{style:"currency",currency:n}).format(l);return e.jsxs(I,{className:"max-w-3xl mx-auto shadow-2xl print:shadow-none print:max-w-none",children:[e.jsxs("div",{className:"flex justify-between items-start border-b border-gray-100 pb-6 mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-black text-gray-900 uppercase tracking-tight",children:"Payslip"}),e.jsxs("p",{className:"text-gray-500 text-sm mt-1",children:["ID: ",t.id]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-sm font-bold text-gray-900",children:t.employeeName}),e.jsx("div",{className:"text-xs text-gray-500",children:t.employeeRole}),e.jsx("div",{className:"text-xs text-gray-500",children:t.department})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-8 mb-8",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xs font-black text-gray-400 uppercase tracking-widest mb-4",children:"Earnings"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Base Salary"}),e.jsx("span",{className:"font-medium text-gray-900",children:o(t.baseSalary,t.currency)})]}),t.earnings.map((l,n)=>e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:l.description}),e.jsx("span",{className:"font-medium text-gray-900",children:o(l.amount,t.currency)})]},n)),e.jsxs("div",{className:"flex justify-between text-sm pt-3 border-t border-gray-100 font-bold",children:[e.jsx("span",{className:"text-gray-800",children:"Total Gross Pay"}),e.jsx("span",{className:"text-gray-900",children:o(t.grossPay,t.currency)})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xs font-black text-gray-400 uppercase tracking-widest mb-4",children:"Deductions"}),e.jsxs("div",{className:"space-y-3",children:[t.deductions.map((l,n)=>e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:l.description}),e.jsxs("span",{className:"font-medium text-red-600",children:["-",o(l.amount,t.currency)]})]},n)),t.deductions.length===0&&e.jsx("p",{className:"text-sm text-gray-400 italic",children:"No deductions"}),e.jsxs("div",{className:"flex justify-between text-sm pt-3 border-t border-gray-100 font-bold",children:[e.jsx("span",{className:"text-gray-800",children:"Total Deductions"}),e.jsxs("span",{className:"text-red-600",children:["-",o(t.totalDeductions,t.currency)]})]})]})]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-xl p-6 flex justify-between items-center border border-gray-100",children:[e.jsx("span",{className:"text-lg font-bold text-gray-700",children:"Net Pay"}),e.jsx("span",{className:"text-3xl font-black text-indigo-600",children:o(t.netPay,t.currency)})]}),u&&e.jsxs("div",{className:"mt-8 flex justify-end print:hidden",children:[e.jsx("button",{onClick:u,className:"px-4 py-2 text-sm font-bold text-gray-500 hover:text-gray-900",children:"Close"}),e.jsx("button",{onClick:()=>window.print(),className:"ml-4 px-6 py-2 bg-gray-900 text-white rounded-lg text-sm font-bold shadow-lg hover:bg-black",children:"Print Payslip"})]})]})},H=({payrollService:t,settings:u,accounts:o,currentUser:l,onComplete:n,onCancel:D})=>{const[y,j]=i.useState(1),[d,b]=i.useState(new Date().toISOString().slice(0,7)),[N,h]=i.useState(!1),[x,v]=i.useState(null),[a,k]=i.useState([]),[w,A]=i.useState(null),B=async()=>{h(!0);try{const{firebaseService:r}=await $(async()=>{const{firebaseService:p}=await import("./index-BjK2osQV.js").then(R=>R.ah);return{firebaseService:p}},__vite__mapDeps([0,1])),C=(await r.hrService.getEmployees()).filter(p=>p.status==="ACTIVE"||!p.status),T=parseInt(d.split("-")[0]),E=parseInt(d.split("-")[1])-1,F=new Date(T,E,1).toISOString().split("T")[0],L=new Date(T,E+1,0).toISOString().split("T")[0],m=await t.getPayrollSummary(F,L,C);if(m.draftPayslips.length===0)P.error("No eligible employees found for payroll.");else{const p={id:`run-${Date.now()}`,period:d,startDate:F,endDate:L,status:"DRAFT",stage:"DRAFT",totalAmount:m.summary.totalNetPay,totalBaseSalary:m.draftPayslips.reduce((s,c)=>s+c.baseSalary,0),totalAllowances:m.draftPayslips.reduce((s,c)=>s+c.totalAllowances,0),totalCommissions:m.draftPayslips.reduce((s,c)=>s+c.totalCommissions,0),totalDeductions:m.draftPayslips.reduce((s,c)=>s+c.totalDeductions,0),currency:"USD",exchangeRate:1,createdAt:Date.now(),createdBy:l.uid},R=m.draftPayslips.map(s=>{var c;return{id:`slip-${Date.now()}-${s.employeeId}`,payrollRunId:p.id,employeeId:s.employeeId,employeeName:s.employeeName,employeeRole:((c=C.find(g=>g.id===s.employeeId))==null?void 0:c.position)||"Staff",baseSalary:s.baseSalary,proRatedSalary:s.proRatedSalary,grossPay:s.proRatedSalary,totalAllowances:s.totalAllowances,totalCommissions:s.totalCommissions,totalDeductions:s.totalDeductions,totalTax:0,netPay:s.netPay,currency:s.currency,issueDate:new Date().toISOString().split("T")[0],status:"DRAFT",earnings:s.earnings.map(g=>({...g,type:g.type})),deductions:s.deductions.map(g=>({...g,type:g.type}))}});v(p),k(R),j(2)}}catch(r){console.error(r),P.error("Failed to generate payroll draft.")}finally{h(!1)}},_=async()=>{if(!(!x||a.length===0)){h(!0);try{const r=await t.finalizeRun(x,a,summary!=null&&summary.draftPayslips?summary.draftPayslips.flatMap(S=>S.transactionIds||[]):[],summary!=null&&summary.draftPayslips?summary.draftPayslips.flatMap(S=>S.walletTxnIds||[]):[]);P.success("Payroll Run Approved & Posted!"),n()}catch(r){console.error(r),P.error("Failed to approve payroll run.")}finally{h(!1)}}};return w?e.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto bg-gray-900 bg-opacity-90 flex items-center justify-center p-4",children:e.jsx(W,{slip:w,onClose:()=>A(null)})}):e.jsxs(I,{className:"max-w-4xl mx-auto",children:[e.jsxs("div",{className:"border-b border-gray-100 pb-4 mb-6 flex justify-between items-center",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Run Payroll"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-bold ${y===1?"bg-indigo-600 text-white":"bg-gray-100 text-gray-500"}`,children:"1. Select Period"}),e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-bold ${y===2?"bg-indigo-600 text-white":"bg-gray-100 text-gray-500"}`,children:"2. Review"}),e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-bold ${y===3?"bg-indigo-600 text-white":"bg-gray-100 text-gray-500"}`,children:"3. Finalize"})]})]}),y===1&&e.jsxs("div",{className:"space-y-6 py-8",children:[e.jsxs("div",{className:"max-w-xs mx-auto text-center space-y-4",children:[e.jsx("label",{className:"block text-sm font-bold text-gray-700",children:"Select Month"}),e.jsx(M,{type:"month",value:d,onChange:r=>b(r.target.value),className:"text-center text-lg font-bold"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Generating payroll for all active employees with a base salary."})]}),e.jsx("div",{className:"flex justify-center pt-4",children:e.jsx(f,{onClick:B,isLoading:N,children:"Generate Draft"})})]}),y===2&&x&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center bg-gray-50 p-4 rounded-xl border border-gray-200",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-bold text-gray-500 uppercase",children:"Total Payroll Cost"}),e.jsx("div",{className:"text-2xl font-black text-indigo-600",children:new Intl.NumberFormat("en-US",{style:"currency",currency:x.currency}).format(x.totalAmount)})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-xs font-bold text-gray-500 uppercase",children:"Employees"}),e.jsx("div",{className:"text-xl font-bold text-gray-900",children:a.length})]})]}),e.jsx("div",{className:"overflow-x-auto border border-gray-100 rounded-xl",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-bold text-gray-500 uppercase",children:"Employee"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-bold text-gray-500 uppercase",children:"Gross"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-bold text-gray-500 uppercase",children:"Deductions"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-bold text-gray-500 uppercase",children:"Net Pay"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-bold text-gray-500 uppercase",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-100",children:a.map(r=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsxs("td",{className:"px-4 py-3",children:[e.jsx("div",{className:"text-sm font-bold text-gray-900",children:r.employeeName}),e.jsx("div",{className:"text-xs text-gray-500",children:r.employeeRole})]}),e.jsx("td",{className:"px-4 py-3 text-right text-sm font-medium text-gray-600",children:r.grossPay.toFixed(2)}),e.jsxs("td",{className:"px-4 py-3 text-right text-sm font-medium text-red-500",children:["-",r.totalDeductions.toFixed(2)]}),e.jsxs("td",{className:"px-4 py-3 text-right text-sm font-bold text-gray-900",children:[r.netPay.toFixed(2)," ",r.currency]}),e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsx("button",{onClick:()=>A(r),className:"text-indigo-600 hover:text-indigo-900 text-xs font-bold border border-indigo-100 px-2 py-1 rounded bg-indigo-50",children:"View Slip"})})]},r.id))})]})}),e.jsxs("div",{className:"flex justify-between pt-4 border-t border-gray-100",children:[e.jsx(f,{variant:"outline",onClick:()=>j(1),children:"Back"}),e.jsxs("div",{className:"space-x-4",children:[e.jsx(f,{variant:"outline",onClick:D,children:"Cancel"}),e.jsx(f,{onClick:_,isLoading:N,className:"bg-green-600 hover:bg-green-700",children:"Approve & Post to GL"})]})]})]})]})};function Y(){const{settings:t,accounts:u,refreshData:o}=G(),{user:l}=O(),n=new V,D=new U,y=new z(n,D),[j,d]=i.useState("LIST"),[b,N]=i.useState([]),[h,x]=i.useState(!0),v=async()=>{x(!0);try{const a=await n.getPayrollRuns();a.sort((k,w)=>w.period.localeCompare(k.period)),N(a)}catch(a){console.error(a)}finally{x(!1)}};return i.useEffect(()=>{v()},[]),j==="WIZARD"?e.jsx(H,{payrollService:y,settings:t,accounts:u,currentUser:{uid:(l==null?void 0:l.uid)||"",name:(l==null?void 0:l.name)||"Admin"},onComplete:()=>{o(),v(),d("LIST")},onCancel:()=>d("LIST")}):e.jsxs("div",{className:"space-y-8 animate-in fade-in",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-extrabold text-gray-900 tracking-tight",children:"Payroll"}),e.jsx("p",{className:"text-gray-500 font-medium",children:"Process salaries, generate payslips, and manage staff payments."})]}),e.jsx(f,{onClick:()=>d("WIZARD"),className:"bg-indigo-600 shadow-lg shadow-indigo-200",children:"Run Payroll"})]}),e.jsxs(I,{children:[e.jsx("div",{className:"px-6 py-4 border-b border-gray-100",children:e.jsx("h3",{className:"font-bold text-gray-900",children:"Payroll History"})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-100",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-black text-gray-400 uppercase tracking-wider",children:"Period"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-black text-gray-400 uppercase tracking-wider",children:"Run Date"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-black text-gray-400 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-black text-gray-400 uppercase tracking-wider",children:"Total Amount"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-black text-gray-400 uppercase tracking-wider pl-8",children:"Approved By"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-black text-gray-400 uppercase tracking-wider",children:"GL Entry"})]})}),e.jsxs("tbody",{className:"divide-y divide-gray-50",children:[b.map(a=>e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-6 py-4 text-sm font-bold text-gray-900",children:a.period}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-500",children:new Date(a.createdAt).toLocaleDateString()}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:`px-2 py-1 rounded-md text-xs font-black uppercase tracking-wide ${a.status==="APPROVED"?"bg-green-100 text-green-700":a.status==="PAID"?"bg-blue-100 text-blue-700":"bg-gray-100 text-gray-600"}`,children:a.status})}),e.jsx("td",{className:"px-6 py-4 text-right text-sm font-bold text-indigo-900",children:new Intl.NumberFormat("en-US",{style:"currency",currency:a.currency}).format(a.totalAmount)}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-600 pl-8",children:a.approvedByName||"-"}),e.jsx("td",{className:"px-6 py-4 text-right text-xs font-mono text-gray-400",children:a.journalEntryId||"-"})]},a.id)),b.length===0&&!h&&e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"px-6 py-12 text-center text-gray-400 font-medium",children:"No payroll runs found. Start your first run above."})})]})]})})]})]})}export{Y as default};
