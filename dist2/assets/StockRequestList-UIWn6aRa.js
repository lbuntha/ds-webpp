import{b as X,h as Z,r as i,s as f,j as e}from"./index-BjK2osQV.js";import{t as x}from"./toast-DTXa3ATd.js";import{B as ee}from"./Button-JCYNVMjR.js";import{c as O}from"./createLucideIcon-D09dZYGY.js";import{P as q}from"./plus-mb1_Xzfx.js";import{F as te}from"./funnel-BH7WirRk.js";import{T as se,C as ae,a as re}from"./truck-yj_2gpYw.js";import{P as L}from"./package-Dvi4dam4.js";import{T as ce}from"./triangle-alert-CU0jYjXD.js";import{X as M,C as ne}from"./x-CcGktfwl.js";/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const le=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]],_=O("circle-x",le);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const de=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]],F=O("file-text",de),be=()=>{const{user:o}=X(),{branches:y}=Z(),[U,Q]=i.useState([]),[g,z]=i.useState([]),[H,b]=i.useState(!0),[E,D]=i.useState(!1),[$,h]=i.useState(!1),[j,K]=i.useState("ALL"),[m,P]=i.useState("TODAY"),[p,S]=i.useState({start:"",end:""}),[N,v]=i.useState(null),[k,I]=i.useState(!1),[r,u]=i.useState({branchId:"",expectedDate:"",pickupPreference:"SELF_DROP",pickupAddress:"",notes:"",items:[]});i.useEffect(()=>{C()},[o]);const w=()=>(o==null?void 0:o.linkedCustomerId)||(o==null?void 0:o.uid),C=async()=>{const t=w();if(!t){b(!1);return}b(!0);try{const[s,a]=await Promise.all([f.getCustomerRequests(t),f.getCustomerProducts(t)]);Q(s),z(a.filter(l=>l.isActive))}catch(s){console.error("Error loading data:",s),x.error("Failed to load data")}finally{b(!1)}},R=U.filter(t=>{const s=j==="ALL"?!0:t.status===j;let a=!0;const l=new Date(t.createdAt),n=new Date;n.setHours(0,0,0,0);const c=new Date(n);if(c.setDate(c.getDate()-1),m==="TODAY")a=l>=n;else if(m==="YESTERDAY")a=l>=c&&l<n;else if(m==="LAST_WEEK"){const d=new Date(n);d.setDate(d.getDate()-7),a=l>=d}else if(m==="LAST_MONTH"){const d=new Date(n);d.setDate(d.getDate()-30),a=l>=d}else if(m==="CUSTOM"&&p.start&&p.end){const d=new Date(p.start);d.setHours(0,0,0,0);const T=new Date(p.end);T.setHours(23,59,59,999),a=l>=d&&l<=T}return s&&a}),B=()=>{var t,s;if(g.length===0){x.warning("Please register products in My Products first");return}u({branchId:((t=y[0])==null?void 0:t.id)||"",expectedDate:"",pickupPreference:"SELF_DROP",pickupAddress:"",notes:"",items:[{productId:((s=g[0])==null?void 0:s.id)||"",quantity:1}]}),h(!0)},Y=()=>{u(t=>{var s;return{...t,items:[...t.items,{productId:((s=g[0])==null?void 0:s.id)||"",quantity:1}]}})},V=t=>{u(s=>({...s,items:s.items.filter((a,l)=>l!==t)}))},A=(t,s,a)=>{u(l=>({...l,items:l.items.map((n,c)=>c===t?{...n,[s]:a}:n)}))},W=async()=>{if(!r.branchId||r.items.length===0||r.items.some(s=>!s.productId||s.quantity<1)){x.warning("Please select a branch and add at least one product");return}if(!w()){x.error("Customer account not found");return}D(!0);try{const s=y.find(n=>n.id===r.branchId),a=r.items.map(n=>{const c=g.find(d=>d.id===n.productId);return{productId:n.productId,productName:(c==null?void 0:c.productName)||"",sku:c==null?void 0:c.sku,quantity:n.quantity,unitPrice:c==null?void 0:c.defaultPrice,image:c==null?void 0:c.image}}),l={id:`req-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,customerId:w(),customerName:(o==null?void 0:o.name)||"",branchId:r.branchId,branchName:(s==null?void 0:s.name)||"",status:"PENDING",items:a,totalQuantity:a.reduce((n,c)=>n+c.quantity,0),expectedDate:r.expectedDate||void 0,pickupPreference:r.pickupPreference,pickupAddress:r.pickupPreference==="REQUEST_PICKUP"?r.pickupAddress:void 0,notes:r.notes||void 0,createdAt:Date.now(),createdBy:o.uid};await f.createStockRequest(l),x.success("Stock request submitted!"),h(!1),C()}catch(s){console.error("Error creating request:",s),x.error("Failed to submit request")}finally{D(!1)}},G=async()=>{if(N){I(!0);try{await f.cancelRequest(N),x.success("Request cancelled"),v(null),C()}catch(t){console.error("Error cancelling request:",t),x.error("Failed to cancel request")}finally{I(!1)}}},J=t=>{const a={PENDING:{bg:"bg-yellow-100",text:"text-yellow-800",Icon:re},APPROVED:{bg:"bg-blue-100",text:"text-blue-800",Icon:ae},REJECTED:{bg:"bg-red-100",text:"text-red-800",Icon:_},RECEIVED:{bg:"bg-green-100",text:"text-green-800",Icon:L},CANCELLED:{bg:"bg-gray-100",text:"text-gray-800",Icon:_}}[t];return e.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium ${a.bg} ${a.text}`,children:[e.jsx(a.Icon,{className:"w-3 h-3"}),t]})};return H?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-red-600"})}):e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(F,{className:"w-8 h-8 text-red-600"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold text-gray-900",children:"Stock Requests"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Request to deposit products at doorstep locations"})]})]}),e.jsxs(ee,{onClick:B,children:[e.jsx(q,{className:"w-5 h-5 mr-2"}),"New Request"]})]}),e.jsxs("div",{className:"bg-white p-4 rounded-xl shadow-sm border border-gray-200 space-y-4",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700 mr-2",children:"Time Period:"}),["TODAY","YESTERDAY","LAST_WEEK","LAST_MONTH","ALL"].map(t=>e.jsx("button",{onClick:()=>P(t),className:`px-3 py-1.5 rounded-xl text-sm font-medium transition-colors ${m===t?"bg-red-100 text-red-700 border border-red-200":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:t.replace("_"," ")},t)),e.jsx("button",{onClick:()=>P("CUSTOM"),className:`px-3 py-1.5 rounded-full text-sm font-medium transition-colors ${m==="CUSTOM"?"bg-red-100 text-red-700 border border-red-200":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:"CUSTOM"})]}),m==="CUSTOM"&&e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-gray-50 rounded-lg",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Range:"}),e.jsx("input",{type:"date",value:p.start,onChange:t=>S(s=>({...s,start:t.target.value})),className:"px-2 py-1 text-sm border rounded"}),e.jsx("span",{className:"text-gray-400",children:"-"}),e.jsx("input",{type:"date",value:p.end,onChange:t=>S(s=>({...s,end:t.target.value})),className:"px-2 py-1 text-sm border rounded"})]}),e.jsxs("div",{className:"flex items-center gap-2 pt-2 border-t",children:[e.jsx(te,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Status:"}),e.jsxs("select",{value:j,onChange:t=>K(t.target.value),className:"text-sm px-2 py-1 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 bg-white",children:[e.jsx("option",{value:"ALL",children:"All Status"}),e.jsx("option",{value:"PENDING",children:"Pending"}),e.jsx("option",{value:"APPROVED",children:"Approved"}),e.jsx("option",{value:"RECEIVED",children:"Received"}),e.jsx("option",{value:"REJECTED",children:"Rejected"}),e.jsx("option",{value:"CANCELLED",children:"Cancelled"})]})]})]}),R.length===0?e.jsxs("div",{className:"text-center py-12 bg-gray-50 rounded-lg",children:[e.jsx(F,{className:"w-12 h-12 mx-auto text-gray-400 mb-3"}),e.jsx("p",{className:"text-gray-500",children:"No stock requests found"})]}):e.jsx("div",{className:"space-y-4",children:R.map(t=>e.jsxs("div",{className:"bg-white rounded-lg shadow border border-gray-200 p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:t.branchName}),J(t.status)]}),e.jsxs("p",{className:"text-sm text-gray-500",children:[new Date(t.createdAt).toLocaleDateString()," â€¢ ",t.totalQuantity," items"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[t.pickupPreference==="REQUEST_PICKUP"&&e.jsxs("span",{className:"flex items-center gap-1 px-2 py-1 bg-purple-100 text-purple-700 text-xs rounded-full",children:[e.jsx(se,{className:"w-3 h-3"}),"Pickup Requested"]}),t.status==="PENDING"&&e.jsx("button",{onClick:()=>v(t.id),className:"text-red-600 hover:bg-red-50 px-2 py-1 rounded text-sm",children:"Cancel"})]})]}),e.jsx("div",{className:"border-t pt-3 space-y-2",children:t.items.map((s,a)=>e.jsxs("div",{className:"flex items-center gap-3",children:[s.image?e.jsx("img",{src:s.image,alt:s.productName,className:"w-10 h-10 rounded object-cover"}):e.jsx("div",{className:"w-10 h-10 bg-gray-100 rounded flex items-center justify-center",children:e.jsx(L,{className:"w-5 h-5 text-gray-400"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-gray-900",children:s.productName}),s.sku&&e.jsxs("p",{className:"text-xs text-gray-500",children:["SKU: ",s.sku]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:`text-gray-600 ${s.actualQuantity!==void 0&&s.actualQuantity!==s.quantity?"line-through text-xs":""}`,children:["x",s.quantity]}),s.actualQuantity!==void 0&&s.actualQuantity!==s.quantity&&e.jsxs("p",{className:"text-yellow-600 font-medium text-sm flex items-center gap-1 justify-end",children:[e.jsx(ce,{className:"w-3 h-3"}),s.actualQuantity]})]})]},a))}),t.status==="REJECTED"&&t.rejectionReason&&e.jsxs("div",{className:"mt-3 p-2 bg-red-50 rounded text-sm text-red-700",children:[e.jsx("strong",{children:"Reason:"})," ",t.rejectionReason]}),t.notes&&e.jsxs("p",{className:"mt-3 text-sm text-gray-500",children:[e.jsx("strong",{children:"Notes:"})," ",t.notes]})]},t.id))}),$&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-lg max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"New Stock Request"}),e.jsx("button",{onClick:()=>h(!1),className:"p-1 hover:bg-gray-100 rounded",children:e.jsx(M,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Target Branch *"}),e.jsx("select",{value:r.branchId,onChange:t=>u(s=>({...s,branchId:t.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500",children:y.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Products *"}),e.jsxs("button",{onClick:Y,className:"text-sm text-red-600 hover:text-red-700 flex items-center gap-1",children:[e.jsx(q,{className:"w-4 h-4"})," Add Product"]})]}),e.jsx("div",{className:"space-y-2",children:r.items.map((t,s)=>e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("select",{value:t.productId,onChange:a=>A(s,"productId",a.target.value),className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500",children:g.map(a=>e.jsx("option",{value:a.id,children:a.sku?`${a.sku} - ${a.productName}`:a.productName},a.id))}),e.jsx("input",{type:"number",min:1,value:t.quantity,onChange:a=>A(s,"quantity",parseInt(a.target.value)||1),className:"w-20 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500"}),r.items.length>1&&e.jsx("button",{onClick:()=>V(s),className:"p-2 text-red-500 hover:bg-red-50 rounded",children:e.jsx(M,{className:"w-4 h-4"})})]},s))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Expected Delivery Date"}),e.jsx("input",{type:"date",value:r.expectedDate,onChange:t=>u(s=>({...s,expectedDate:t.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Delivery Method"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"radio",name:"pickup",checked:r.pickupPreference==="SELF_DROP",onChange:()=>u(t=>({...t,pickupPreference:"SELF_DROP"})),className:"text-red-600 focus:ring-red-500"}),e.jsx("span",{className:"text-sm",children:"I will drop off"})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"radio",name:"pickup",checked:r.pickupPreference==="REQUEST_PICKUP",onChange:()=>u(t=>({...t,pickupPreference:"REQUEST_PICKUP"})),className:"text-red-600 focus:ring-red-500"}),e.jsx("span",{className:"text-sm",children:"Request pickup"})]})]})]}),r.pickupPreference==="REQUEST_PICKUP"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Pickup Address"}),e.jsx("input",{type:"text",value:r.pickupAddress,onChange:t=>u(s=>({...s,pickupAddress:t.target.value})),placeholder:"Enter pickup address",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Notes"}),e.jsx("textarea",{value:r.notes,onChange:t=>u(s=>({...s,notes:t.target.value})),placeholder:"Optional notes...",rows:2,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500"})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 p-4 border-t",children:[e.jsx("button",{onClick:()=>h(!1),className:"px-4 py-2 text-gray-600 hover:bg-gray-100 rounded-lg transition-colors",children:"Cancel"}),e.jsx("button",{onClick:W,disabled:E,className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors flex items-center gap-2 disabled:opacity-50",children:E?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"animate-spin h-4 w-4",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4",fill:"none"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Submitting..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ne,{className:"w-4 h-4"}),"Submit Request"]})})]})]})}),N&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-sm p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Cancel Request?"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Are you sure you want to cancel this stock request?"}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx("button",{onClick:()=>v(null),disabled:k,className:"px-4 py-2 text-gray-600 hover:bg-gray-100 rounded-lg transition-colors disabled:opacity-50",children:"No, Keep It"}),e.jsxs("button",{onClick:G,disabled:k,className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors flex items-center gap-2 disabled:opacity-50",children:[k&&e.jsxs("svg",{className:"animate-spin h-4 w-4",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4",fill:"none"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Yes, Cancel"]})]})]})})]})};export{be as StockRequestList,be as default};
