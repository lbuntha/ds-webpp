import{r as j,A as p,j as e}from"./index-BjK2osQV.js";import{C as h}from"./Card-DROeE3UG.js";import{A as w}from"./accountingService-CShnyhxo.js";function R({accounts:o=[],transactions:x=[],invoices:E=[],bills:k=[]}){const g=j.useMemo(()=>{const r=new Date().getFullYear();w.generateTrialBalance(o,x);const l=x.filter(n=>new Date(n.date).getFullYear()===r),c=w.generateTrialBalance(o,l);let a=0,t=0;c.forEach(n=>{n.isHeader||(n.type===p.REVENUE&&(a+=n.credit-n.debit),n.type===p.EXPENSE&&(t+=n.debit-n.credit))});const s=a-t,i=a>0?s/a*100:0;return{revenue:a,expense:t,netIncome:s,margin:i}},[o,x]),v=j.useMemo(()=>{const r=new Date,l=[];for(let a=5;a>=0;a--){const t=new Date(r.getFullYear(),r.getMonth()-a,1),s=`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}`,i=t.toLocaleString("default",{month:"short"}),n=x.filter(b=>b.date.startsWith(s));let m=0,T=0;n.forEach(b=>{b.lines.forEach(f=>{const N=o.find(D=>D.id===f.accountId);N&&(N.type===p.REVENUE&&(m+=f.credit-f.debit),N.type===p.EXPENSE&&(T+=f.debit-f.credit))})}),l.push({label:i,revenue:m,expense:T})}const c=Math.max(...l.map(a=>Math.max(a.revenue,a.expense)),100);return{data:l,maxVal:c}},[o,x]),y=j.useMemo(()=>{const r={};let l=0;x.filter(s=>new Date(s.date).getFullYear()===new Date().getFullYear()).forEach(s=>{s.lines.forEach(i=>{const n=o.find(m=>m.id===i.accountId);if(n&&n.type===p.EXPENSE&&!n.isHeader){const m=i.debit-i.credit;m>0&&(r[n.name]=(r[n.name]||0)+m,l+=m)}})});const a=Object.entries(r).sort(([,s],[,i])=>i-s).slice(0,5),t=Object.entries(r).sort(([,s],[,i])=>i-s).slice(5).reduce((s,[,i])=>s+i,0);return t>0&&a.push(["Other Expenses",t]),{topExpenses:a,totalExp:l}},[o,x]),u=j.useMemo(()=>{const l=w.generateTrialBalance(o,x).filter(t=>t.type===p.ASSET&&(t.accountName.toLowerCase().includes("cash")||t.accountName.toLowerCase().includes("bank"))).reduce((t,s)=>t+(s.debit-s.credit),0),c=E.filter(t=>t.status==="POSTED").reduce((t,s)=>t+(s.totalAmount-s.amountPaid)/(s.exchangeRate||1),0),a=k.filter(t=>t.status==="POSTED").reduce((t,s)=>t+(s.totalAmount-s.amountPaid),0);return{cash:l,ar:c,ap:a}},[o,x,E,k]),d=r=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",maximumFractionDigits:0}).format(r);return e.jsxs("div",{className:"space-y-6 animate-fade-in-up",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs(h,{className:"border-l-4 border-l-indigo-500",children:[e.jsx("div",{className:"text-sm text-gray-500 font-medium",children:"Revenue (YTD)"}),e.jsx("div",{className:"text-2xl font-bold text-gray-900 mt-1",children:d(g.revenue)})]}),e.jsxs(h,{className:"border-l-4 border-l-red-500",children:[e.jsx("div",{className:"text-sm text-gray-500 font-medium",children:"Expenses (YTD)"}),e.jsx("div",{className:"text-2xl font-bold text-gray-900 mt-1",children:d(g.expense)})]}),e.jsxs(h,{className:`border-l-4 ${g.netIncome>=0?"border-l-green-500":"border-l-red-600"}`,children:[e.jsx("div",{className:"text-sm text-gray-500 font-medium",children:"Net Income"}),e.jsx("div",{className:`text-2xl font-bold mt-1 ${g.netIncome>=0?"text-green-700":"text-red-700"}`,children:d(g.netIncome)})]}),e.jsxs(h,{className:"border-l-4 border-l-blue-500",children:[e.jsx("div",{className:"text-sm text-gray-500 font-medium",children:"Profit Margin"}),e.jsxs("div",{className:"text-2xl font-bold text-gray-900 mt-1",children:[g.margin.toFixed(1),"%"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(h,{title:"Revenue & Expense Trend (6 Months)",children:[e.jsx("div",{className:"h-64 w-full flex items-end justify-between space-x-2 px-2 mt-4",children:v.data.map((r,l)=>{const c=r.revenue/v.maxVal*100,a=r.expense/v.maxVal*100;return e.jsxs("div",{className:"flex flex-col items-center justify-end h-full w-full group relative",children:[e.jsxs("div",{className:"w-full flex justify-center items-end space-x-1 h-full pb-6",children:[e.jsx("div",{style:{height:`${Math.max(c,1)}%`},className:"w-3 md:w-6 bg-indigo-500 rounded-t transition-all hover:bg-indigo-600 relative group-hover:opacity-100 opacity-90",children:e.jsxs("div",{className:"absolute -top-8 left-1/2 transform -translate-x-1/2 bg-gray-800 text-white text-xs rounded px-2 py-1 opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap z-10",children:["Rev: ",d(r.revenue)]})}),e.jsx("div",{style:{height:`${Math.max(a,1)}%`},className:"w-3 md:w-6 bg-red-400 rounded-t transition-all hover:bg-red-500 relative group-hover:opacity-100 opacity-90",children:e.jsxs("div",{className:"absolute -top-16 left-1/2 transform -translate-x-1/2 bg-gray-800 text-white text-xs rounded px-2 py-1 opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap z-10",children:["Exp: ",d(r.expense)]})})]}),e.jsx("div",{className:"absolute bottom-0 text-xs text-gray-500 font-medium",children:r.label})]},l)})}),e.jsxs("div",{className:"flex justify-center space-x-6 mt-4 text-xs text-gray-600",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-3 h-3 bg-indigo-500 rounded mr-2"}),"Revenue"]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-3 h-3 bg-red-400 rounded mr-2"}),"Expenses"]})]})]}),e.jsx(h,{title:"Where is the money going?",children:e.jsxs("div",{className:"flex flex-col h-full justify-center",children:[y.totalExp===0?e.jsx("div",{className:"text-center text-gray-400 py-10",children:"No expenses recorded this year."}):e.jsx("div",{className:"space-y-4 mt-2",children:y.topExpenses.map(([r,l],c)=>{const a=l/y.totalExp*100,t=["bg-red-500","bg-orange-500","bg-amber-500","bg-yellow-500","bg-gray-400","bg-gray-300"];return e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsx("span",{className:"text-gray-700 font-medium truncate w-2/3",children:r}),e.jsxs("span",{className:"text-gray-900 font-bold",children:[d(l)," (",a.toFixed(0),"%)"]})]}),e.jsx("div",{className:"w-full bg-gray-100 rounded-full h-2.5",children:e.jsx("div",{className:`h-2.5 rounded-full ${t[c%t.length]}`,style:{width:`${a}%`}})})]},r)})}),e.jsx("div",{className:"mt-6 pt-4 border-t border-gray-100 text-center",children:e.jsx("p",{className:"text-xs text-gray-500",children:"Top expense categories by volume (YTD)"})})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs(h,{title:"Cash & Liquidity",className:"lg:col-span-2",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-center divide-x divide-gray-100",children:[e.jsxs("div",{className:"p-2",children:[e.jsx("div",{className:"text-xs text-gray-500 uppercase tracking-wide mb-1",children:"Cash On Hand"}),e.jsx("div",{className:"text-xl font-bold text-green-600",children:d(u.cash)}),e.jsx("p",{className:"text-[10px] text-gray-400 mt-1",children:"Bank & Cash Accts"})]}),e.jsxs("div",{className:"p-2",children:[e.jsx("div",{className:"text-xs text-gray-500 uppercase tracking-wide mb-1",children:"Coming In"}),e.jsx("div",{className:"text-xl font-bold text-blue-600",children:d(u.ar)}),e.jsx("p",{className:"text-[10px] text-gray-400 mt-1",children:"Unpaid Invoices"})]}),e.jsxs("div",{className:"p-2",children:[e.jsx("div",{className:"text-xs text-gray-500 uppercase tracking-wide mb-1",children:"Going Out"}),e.jsx("div",{className:"text-xl font-bold text-red-600",children:d(u.ap)}),e.jsx("p",{className:"text-[10px] text-gray-400 mt-1",children:"Unpaid Bills"})]})]}),e.jsxs("div",{className:"mt-6",children:[e.jsx("h4",{className:"text-sm font-bold text-gray-700 mb-3",children:"Net Cash Position Estimate"}),e.jsxs("div",{className:"relative h-8 bg-gray-100 rounded-full overflow-hidden flex",children:[e.jsx("div",{className:"h-full bg-green-500 flex items-center justify-center text-white text-xs font-bold",style:{width:"50%"},children:"Cash"}),e.jsx("div",{className:"absolute top-0 bottom-0 w-1 bg-white z-10",style:{left:"50%"}})]}),e.jsxs("div",{className:"flex justify-between text-xs text-gray-500 mt-2",children:[e.jsxs("span",{children:["Real Liquidity: ",d(u.cash+u.ar-u.ap)]}),e.jsx("span",{children:"(Cash + Receivables - Payables)"})]})]})]}),e.jsx(h,{title:"Quick Actions",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("button",{className:"w-full flex items-center justify-between p-3 rounded-lg bg-indigo-50 text-indigo-700 hover:bg-indigo-100 transition-colors text-sm font-medium",onClick:()=>window.location.href="#",children:[e.jsx("span",{children:"View Detailed P&L"}),e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9 5l7 7-7 7"})})]}),e.jsxs("button",{className:"w-full flex items-center justify-between p-3 rounded-lg bg-green-50 text-green-700 hover:bg-green-100 transition-colors text-sm font-medium",children:[e.jsx("span",{children:"Analyze Receivables"}),e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9 5l7 7-7 7"})})]}),e.jsxs("button",{className:"w-full flex items-center justify-between p-3 rounded-lg bg-orange-50 text-orange-700 hover:bg-orange-100 transition-colors text-sm font-medium",children:[e.jsx("span",{children:"Review Expenses"}),e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9 5l7 7-7 7"})})]})]})})]})]})}export{R as AnalyticsDashboard};
