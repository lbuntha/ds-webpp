import{r as a,f as m,j as t}from"./index-BjK2osQV.js";import{C as M}from"./Card-DROeE3UG.js";import{B as E}from"./Button-JCYNVMjR.js";import{I as j}from"./Input-B96Hj4QL.js";import{t as c}from"./toast-DTXa3ATd.js";const W=[{label:"3 Months",months:3},{label:"6 Months",months:6},{label:"1 Year",months:12},{label:"Custom",months:0}],Y=()=>{const[y,L]=a.useState([]),[u,O]=a.useState([]),[T,P]=a.useState(!1),[n,x]=a.useState(""),[h,C]=a.useState(100),[d,N]=a.useState(5),[o,w]=a.useState(new Date().toISOString().split("T")[0]),[k,g]=a.useState(""),[b,p]=a.useState(3),[i,v]=a.useState(""),[l,I]=a.useState(null),[$,S]=a.useState(null),f=async()=>{const e=await m.getCustomerCashbackRules();L(e)};a.useEffect(()=>{f(),m.getCustomers().then(O)},[]),a.useEffect(()=>{if(b>0&&o){const e=new Date(o);e.setMonth(e.getMonth()+b),g(e.toISOString().split("T")[0])}},[o,b]);const R=()=>{x(""),C(100),N(5),w(new Date().toISOString().split("T")[0]),g(""),p(3),v(""),I(null)},q=e=>{I(e.id),x(e.customerId),C(e.minParcelsPerMonth),N(e.cashbackPercent),w(e.startDate),g(e.endDate),p(0),v(e.customerName)},F=async e=>{var s;if(e.preventDefault(),!n||!o||!k){c.warning("Please select a customer and set date range.");return}if(h<1||d<=0||d>100){c.warning("Please enter valid threshold and percentage.");return}P(!0);try{const r=u.find(D=>D.id===n),V={id:l||`cbr-${Date.now()}`,customerId:n,customerName:(r==null?void 0:r.name)||"Unknown",minParcelsPerMonth:h,cashbackPercent:d,startDate:o,endDate:k,isActive:!0,createdAt:l&&((s=y.find(D=>D.id===l))==null?void 0:s.createdAt)||Date.now(),updatedAt:Date.now()};await m.saveCustomerCashbackRule(V),R(),await f(),c.success(l?"Cashback rule updated.":"Cashback rule created.")}catch(r){console.error(r),c.error("Failed to save cashback rule.")}finally{P(!1)}},B=async e=>{try{await m.deleteCustomerCashbackRule(e),await f(),c.success("Cashback rule deleted.")}catch{c.error("Failed to delete rule.")}finally{S(null)}},U=async e=>{await m.saveCustomerCashbackRule({...e,isActive:!e.isActive,updatedAt:Date.now()}),await f(),c.success(e.isActive?"Rule deactivated.":"Rule activated.")},A=e=>{const s=u.find(r=>r.id===e);return(s==null?void 0:s.name)||e},z=e=>{const s=new Date().toISOString().split("T")[0];return e.isActive&&e.startDate<=s&&e.endDate>=s};return t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[t.jsx(M,{title:l?"Edit Cashback Rule":"Create Cashback Rule",children:t.jsxs("form",{onSubmit:F,className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Customer"}),t.jsxs("div",{className:"relative",children:[t.jsx("input",{type:"text",className:"w-full px-3 py-2 border border-gray-300 rounded-xl shadow-sm focus:outline-none focus:ring-emerald-500 sm:text-sm",placeholder:"ðŸ” Search customer by name or phone...",value:i,onChange:e=>{v(e.target.value),e.target.value||x("")}}),i.length>=2&&!n&&t.jsxs("div",{className:"absolute z-10 w-full mt-1 bg-white border border-gray-200 rounded-lg shadow-lg max-h-40 overflow-y-auto",children:[u.filter(e=>{var s,r;return((s=e.name)==null?void 0:s.toLowerCase().includes(i.toLowerCase()))||((r=e.phone)==null?void 0:r.includes(i))}).slice(0,6).map(e=>t.jsxs("button",{type:"button",className:"w-full px-3 py-2 text-left text-sm hover:bg-emerald-50 flex justify-between items-center border-b border-gray-100 last:border-0",onClick:()=>{x(e.id),v(e.name)},children:[t.jsx("span",{className:"font-medium text-gray-900",children:e.name}),t.jsx("span",{className:"text-xs text-gray-500",children:e.phone})]},e.id)),u.filter(e=>{var s,r;return((s=e.name)==null?void 0:s.toLowerCase().includes(i.toLowerCase()))||((r=e.phone)==null?void 0:r.includes(i))}).length===0&&t.jsx("div",{className:"px-3 py-2 text-xs text-gray-500 text-center",children:"No customers found"})]})]}),n&&t.jsxs("p",{className:"text-xs text-emerald-600 mt-1",children:["âœ“ Selected: ",A(n)]})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsx(j,{label:"Min Parcels/Month",type:"number",value:h,onChange:e=>C(parseInt(e.target.value)||0),min:1,required:!0}),t.jsx(j,{label:"Cashback %",type:"number",value:d,onChange:e=>N(parseFloat(e.target.value)||0),min:.1,max:100,step:.1,required:!0})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Duration"}),t.jsx("div",{className:"flex flex-wrap gap-2",children:W.map(e=>t.jsx("button",{type:"button",onClick:()=>p(e.months),className:`px-3 py-1.5 rounded-lg text-sm font-medium transition-all ${b===e.months?"bg-emerald-600 text-white":"bg-gray-100 text-gray-700 hover:bg-emerald-50"}`,children:e.label},e.months))})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsx(j,{label:"Start Date",type:"date",value:o,onChange:e=>w(e.target.value),required:!0}),t.jsx(j,{label:"End Date",type:"date",value:k,onChange:e=>{g(e.target.value),p(0)},required:!0})]}),t.jsx("div",{className:"bg-emerald-50 p-3 rounded-xl border border-emerald-100",children:t.jsxs("p",{className:"text-sm text-emerald-800",children:[t.jsx("strong",{children:"Preview:"})," If ",t.jsx("span",{className:"font-mono",children:A(n)||"(customer)"})," delivers"," ",t.jsxs("strong",{children:["â‰¥",h]})," parcels in a month, they get"," ",t.jsxs("strong",{children:[d,"%"]})," of delivery fees as cashback."]})}),t.jsxs("div",{className:"flex gap-2 pt-2",children:[t.jsx(E,{type:"submit",isLoading:T,children:l?"Update Rule":"Create Rule"}),l&&t.jsx(E,{type:"button",variant:"outline",onClick:R,children:"Cancel"})]})]})}),t.jsx(M,{title:"Cashback Rules",children:t.jsxs("div",{className:"space-y-3",children:[y.map(e=>{const s=z(e);return t.jsx("div",{className:`p-3 border rounded-lg transition-all ${s?"border-emerald-200 bg-emerald-50/50":"border-gray-200 bg-gray-50/50"}`,children:t.jsxs("div",{className:"flex justify-between items-start",children:[t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"font-semibold text-gray-900",children:e.customerName}),t.jsx("span",{className:`text-[10px] px-1.5 py-0.5 rounded font-medium ${s?"bg-emerald-100 text-emerald-700":"bg-gray-200 text-gray-600"}`,children:s?"â— Active":"Inactive"})]}),t.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["â‰¥",t.jsx("strong",{children:e.minParcelsPerMonth})," parcels â†’ ",t.jsxs("strong",{children:[e.cashbackPercent,"%"]})," cashback"]}),t.jsxs("p",{className:"text-xs text-gray-500 mt-0.5",children:[e.startDate," to ",e.endDate]})]}),t.jsxs("div",{className:"flex gap-1",children:[t.jsx("button",{onClick:()=>U(e),className:`text-xs px-2 py-1 rounded ${e.isActive?"text-amber-600 hover:bg-amber-50":"text-emerald-600 hover:bg-emerald-50"}`,children:e.isActive?"Pause":"Activate"}),t.jsx("button",{onClick:()=>q(e),className:"text-xs px-2 py-1 text-blue-600 hover:bg-blue-50 rounded",children:"Edit"}),$===e.id?t.jsxs("div",{className:"flex gap-1",children:[t.jsx("button",{onClick:()=>B(e.id),className:"text-white bg-red-600 hover:bg-red-700 px-2 py-1 rounded text-xs font-bold",children:"Confirm"}),t.jsx("button",{onClick:()=>S(null),className:"text-gray-500 text-xs px-1",children:"âœ•"})]}):t.jsx("button",{onClick:()=>S(e.id),className:"text-xs px-2 py-1 text-red-500 hover:bg-red-50 rounded",children:"Delete"})]})]})},e.id)}),y.length===0&&t.jsx("p",{className:"text-gray-500 text-sm text-center py-4",children:"No cashback rules configured."})]})})]})},Q=()=>t.jsxs("div",{className:"p-6 space-y-6",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"p-2 bg-gradient-to-br from-emerald-500 to-teal-600 rounded-xl",children:t.jsx("svg",{className:"w-6 h-6 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),t.jsxs("div",{children:[t.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Customer Cashback"}),t.jsx("p",{className:"text-sm text-gray-500",children:"Configure volume-based cashback rewards for customers"})]})]}),t.jsx(Y,{})]});export{Q as default};
