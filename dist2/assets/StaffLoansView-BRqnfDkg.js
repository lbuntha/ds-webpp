import{r,A as O,j as e,h as U,f as m}from"./index-BjK2osQV.js";import{C as u}from"./Card-DROeE3UG.js";import{B as T}from"./Button-JCYNVMjR.js";import{t as F}from"./toast-DTXa3ATd.js";const P=({loans:n,employees:j,accounts:h,branches:b,currencies:N=[],transactions:p,onCreateLoan:c,onRepayLoan:a,onAddEmployee:V,onUpdateEmployee:$,onSaveTransaction:z})=>{const[q,G]=r.useState("LIST"),[k,y]=r.useState(!1),[d,v]=r.useState(null),[g,w]=r.useState(0),[f,S]=r.useState(""),[A,E]=r.useState(new Date().toISOString().split("T")[0]),[I,R]=r.useState(!1),D=h.filter(t=>t.type===O.ASSET&&((t.name||"").toLowerCase().includes("cash")||(t.name||"").toLowerCase().includes("bank"))),i=t=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(t),W=t=>{var s;v(t),w(t.amount-t.amountRepaid),S(((s=D[0])==null?void 0:s.id)||""),y(!0)},B=async()=>{if(!(!d||!f||g<=0)){R(!0);try{const t={id:`lpay-${Date.now()}`,loanId:d.id,date:A,amount:g,depositAccountId:f,createdAt:Date.now()};await a(t),y(!1),v(null)}catch{F.error("Failed to record repayment")}finally{R(!1)}}},C=r.useMemo(()=>{const t=n.reduce((o,x)=>o+x.amount,0),s=n.reduce((o,x)=>o+x.amountRepaid,0),l=t-s;return{totalLent:t,totalRepaid:s,outstanding:l}},[n]),L=r.useMemo(()=>p.filter(t=>t.id.startsWith("je-settle-")||t.id.startsWith("je-dep-")||t.id.startsWith("je-loan-")||t.id.startsWith("je-lpay-")),[p]);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs(u,{className:"bg-indigo-50 border-indigo-100",children:[e.jsx("div",{className:"text-indigo-800 text-sm font-medium",children:"Total Outstanding"}),e.jsx("div",{className:"text-2xl font-bold text-indigo-900 mt-1",children:i(C.outstanding)})]}),e.jsxs(u,{children:[e.jsx("div",{className:"text-gray-500 text-sm font-medium",children:"Total Issued (All Time)"}),e.jsx("div",{className:"text-2xl font-bold text-gray-900 mt-1",children:i(C.totalLent)})]})]}),e.jsx("div",{className:"flex justify-between items-center",children:e.jsx("h2",{className:"text-lg font-medium text-gray-900",children:"Loan Records"})}),e.jsx(u,{children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Date"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Employee"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Description"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"Amount"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"Paid"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"Balance"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase pl-8",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"Action"})]})}),e.jsxs("tbody",{className:"bg-white divide-y divide-gray-200",children:[n.map(t=>{const s=t.amount-t.amountRepaid;return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 text-sm text-gray-500",children:t.date}),e.jsx("td",{className:"px-6 py-4 text-sm font-medium text-gray-900",children:t.employeeName}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-500",children:t.description}),e.jsx("td",{className:"px-6 py-4 text-sm text-right text-gray-900",children:i(t.amount)}),e.jsx("td",{className:"px-6 py-4 text-sm text-right text-green-600",children:i(t.amountRepaid)}),e.jsx("td",{className:"px-6 py-4 text-sm text-right font-bold text-gray-900",children:i(s)}),e.jsx("td",{className:"px-6 py-4 text-sm pl-8",children:e.jsx("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${t.status==="PAID"?"bg-green-100 text-green-800":"bg-yellow-100 text-yellow-800"}`,children:t.status})}),e.jsx("td",{className:"px-6 py-4 text-right text-sm",children:t.status==="ACTIVE"&&e.jsx("button",{onClick:()=>W(t),className:"text-indigo-600 hover:text-indigo-900 font-medium",children:"Repay"})})]},t.id)}),n.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:8,className:"text-center py-8 text-gray-500",children:"No loan records found."})})]})]})})}),e.jsx("h2",{className:"text-lg font-medium text-gray-900 pt-4",children:"Recent Staff Activity"}),e.jsx(u,{children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Date"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Activity Type"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Description"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"Amount"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:L.length>0?L.slice(0,15).map(t=>{let s="Transaction",l="bg-gray-100 text-gray-800";t.id.startsWith("je-settle-")?(s="Settlement",l="bg-blue-100 text-blue-800"):t.id.startsWith("je-dep-")?(s="Deposit",l="bg-green-100 text-green-800"):t.id.startsWith("je-loan-")?(s="Loan Issued",l="bg-orange-100 text-orange-800"):t.id.startsWith("je-lpay-")&&(s="Repayment",l="bg-teal-100 text-teal-800");const o=t.originalTotal||t.lines.reduce((x,M)=>x+M.debit,0);return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 text-sm text-gray-500",children:t.date}),e.jsx("td",{className:"px-6 py-4 text-sm",children:e.jsx("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${l}`,children:s})}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-900",children:t.description}),e.jsxs("td",{className:"px-6 py-4 text-sm text-right font-medium text-gray-900",children:[i(o),t.currency&&t.currency!=="USD"&&e.jsxs("span",{className:"text-xs text-gray-500 ml-1",children:["(",t.currency,")"]})]})]},t.id)}):e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:"text-center py-8 text-gray-500",children:"No recent activity found."})})})]})})}),k&&d&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-gray-900 bg-opacity-50 backdrop-blur-sm p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl w-full max-w-md overflow-hidden",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-gray-100 flex justify-between items-center",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Record Repayment"}),e.jsx("button",{onClick:()=>y(!1),className:"text-gray-400 hover:text-gray-500",children:"Ã—"})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("p",{className:"text-sm text-gray-500",children:["Recording payment from ",e.jsx("strong",{children:d.employeeName}),".",e.jsx("br",{}),"Outstanding Balance: ",e.jsx("span",{className:"font-semibold text-gray-900",children:i(d.amount-d.amountRepaid)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Repayment Amount"}),e.jsx("input",{type:"number",className:"block w-full px-3 py-2 border border-gray-300 rounded-xl shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",value:g,onChange:t=>w(parseFloat(t.target.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Date"}),e.jsx("input",{type:"date",className:"block w-full px-3 py-2 border border-gray-300 rounded-xl shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",value:A,onChange:t=>E(t.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Deposit To (Bank/Cash)"}),e.jsxs("select",{className:"block w-full px-3 py-2 border border-gray-300 rounded-xl shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",value:f,onChange:t=>S(t.target.value),children:[e.jsx("option",{value:"",children:"Select Account"}),D.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]})]}),e.jsxs("div",{className:"px-6 py-4 bg-gray-50 border-t border-gray-100 flex justify-end space-x-3",children:[e.jsx(T,{variant:"outline",onClick:()=>y(!1),children:"Cancel"}),e.jsx(T,{onClick:B,isLoading:I,children:"Save Repayment"})]})]})})]})};function X(){const{loans:n,employees:j,accounts:h,branches:b,currencies:N,transactions:p,refreshData:c}=U();return e.jsx(P,{loans:n,employees:j,accounts:h,branches:b,currencies:N,transactions:p,onCreateLoan:async a=>{await m.createStaffLoan(a),await c()},onRepayLoan:async a=>{await m.recordStaffLoanRepayment(a),await c()},onAddEmployee:async a=>{await m.addEmployee(a),await c()},onUpdateEmployee:async a=>{await m.updateEmployee(a),await c()},onSaveTransaction:async a=>{await m.addTransaction(a),await c()}})}export{X as default};
