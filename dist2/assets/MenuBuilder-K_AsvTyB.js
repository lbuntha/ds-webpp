import{u as M,r as d,j as e,h as E,f as N,D as K}from"./index-BjK2osQV.js";import{M as T}from"./Modal-B63ndL_a.js";import{M as C}from"./MenuIcon-DZT_vwr1.js";const O=["dashboard","analytics","journal","banking","receipt","settings","users","manual","reports","retention","aging","alert","places","driver","fleet","jobs","wallet","user","plus","operations","warehouse","dispatch","chat-delay","package","inbox","products","gift","money","checkCircle","closing","calendar","staff","telegram","inventory","fileText"],V=[{value:"system-admin",label:"System Admin"},{value:"accountant",label:"Accountant"},{value:"finance-manager",label:"Finance Manager"},{value:"warehouse",label:"Warehouse"},{value:"driver",label:"Driver"},{value:"customer",label:"Customer"},{value:"sales",label:"Sales"},{value:"fleet-driver",label:"Fleet Driver"}],B=({isOpen:g,onClose:c,onSave:k,onDelete:y,initialData:n})=>{const{t:v}=M(),[r,x]=d.useState({label:"",viewId:"",iconKey:"dashboard",order:0,section:"",allowedRoles:[]}),[m,b]=d.useState(!1);d.useEffect(()=>{x(n||{label:"",viewId:"",iconKey:"dashboard",order:0,section:"",allowedRoles:[]})},[n,g]);const u=s=>{const{name:a,value:l}=s.target;x(p=>({...p,[a]:l}))},f=s=>{x(a=>{const l=a.allowedRoles||[];return l.includes(s)?{...a,allowedRoles:l.filter(p=>p!==s)}:{...a,allowedRoles:[...l,s]}})},h=async s=>{if(s.preventDefault(),!(!r.label||!r.viewId)){b(!0);try{const a={id:(n==null?void 0:n.id)||`nav-${Date.now()}`,label:r.label,viewId:r.viewId,iconKey:r.iconKey||"dashboard",order:Number(r.order)||0,section:r.section||void 0,allowedRoles:r.allowedRoles||[],...n||{},...r};await k(a),c()}catch(a){console.error("Failed to save menu item",a)}finally{b(!1)}}},i=async()=>{if(!(!(n!=null&&n.id)||!y)&&window.confirm("Are you sure you want to delete this menu item?")){b(!0);try{await y(n.id),c()}catch(s){console.error("Failed to delete menu item",s)}finally{b(!1)}}};return e.jsx(T,{isOpen:g,onClose:c,title:n?"Edit Menu Item":"Add New Menu Item",children:e.jsxs("form",{onSubmit:h,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Label (Display Name)"}),e.jsx("input",{type:"text",name:"label",value:r.label,onChange:u,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm border p-2",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"View ID (Internal Route Key)"}),e.jsx("input",{type:"text",name:"viewId",value:r.viewId,onChange:u,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm border p-2",required:!0,placeholder:"e.g. ANALYTICS"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Must match route configuration (e.g. starts with DRIVER_ or CUSTOMER_ for portals)"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Order"}),e.jsx("input",{type:"number",name:"order",value:r.order,onChange:u,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm border p-2"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Icon"}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[r.iconKey&&e.jsx(C,{iconKey:r.iconKey,className:"w-5 h-5 text-gray-500"}),e.jsx("select",{name:"iconKey",value:r.iconKey,onChange:u,className:"block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm border p-2",children:O.map(s=>e.jsx("option",{value:s,children:s},s))})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Section (Group)"}),e.jsx("input",{type:"text",name:"section",value:r.section,onChange:u,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm border p-2",placeholder:"e.g. logistics, finance, system"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Visibility"}),e.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer bg-gray-50 p-2 rounded border border-gray-200",children:[e.jsx("input",{type:"checkbox",name:"hidden",checked:r.hidden||!1,onChange:s=>x(a=>({...a,hidden:s.target.checked})),className:"rounded border-gray-300 text-indigo-600 focus:ring-indigo-500"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Hide from Sidebar (even if allowed)"})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Useful for disabling items without deleting them, or for sub-views."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Visible To Roles"}),e.jsx("div",{className:"grid grid-cols-2 gap-2 max-h-40 overflow-y-auto border rounded p-2",children:V.map(s=>e.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:(r.allowedRoles||[]).includes(s.value),onChange:()=>f(s.value),className:"rounded border-gray-300 text-indigo-600 focus:ring-indigo-500"}),e.jsx("span",{className:"text-sm text-gray-700",children:s.label})]},s.value))})]}),e.jsxs("div",{className:"flex justify-between pt-4 border-t mt-6",children:[e.jsx("div",{children:n&&y&&e.jsx("button",{type:"button",onClick:i,className:"bg-red-50 text-red-700 px-4 py-2 rounded-md hover:bg-red-100 transition-colors text-sm font-medium",disabled:m,children:"Delete Item"})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"button",onClick:c,className:"bg-white text-gray-700 border border-gray-300 px-4 py-2 rounded-md hover:bg-gray-50 transition-colors text-sm font-medium",disabled:m,children:"Cancel"}),e.jsx("button",{type:"submit",className:"bg-indigo-600 text-white px-4 py-2 rounded-md hover:bg-indigo-700 transition-colors text-sm font-medium flex items-center",disabled:m,children:m?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Saving..."]}):"Save Changes"})]})]})]})})},U=()=>{const{menuItems:g,refreshData:c}=E(),{t:k}=M(),[y,n]=d.useState(!1),[v,r]=d.useState(!1),[x,m]=d.useState(!1),[b,u]=d.useState(null),[f,h]=d.useState([]),[i,s]=d.useState(!1),[a,l]=d.useState(!1);d.useEffect(()=>{i||h(g)},[g,i]);const p=t=>{u(t),m(!0)},S=()=>{u(null),m(!0)},L=async t=>{if(i)h(o=>{const j=o.findIndex(w=>w.id===t.id);if(j>=0){const w=[...o];return w[j]=t,w}else return[...o,t]}),l(!0);else try{await N.saveMenuItem(t),await c()}catch(o){console.error("Failed to save menu item",o),alert("Failed to save menu item")}},A=async t=>{if(i)h(o=>o.filter(j=>j.id!==t)),l(!0);else try{await N.deleteMenuItem(t),await c()}catch(o){console.error("Failed to delete menu item",o),alert("Failed to delete menu item")}},I=()=>{window.confirm("This will load the default system menu into the editor. You can customize it before saving. Proceed?")&&(h([...K]),s(!0),l(!0))},R=()=>{window.confirm("Discard changes and return to current menu?")&&(s(!1),h(g),l(!1))},F=async()=>{if(window.confirm("This will OVERWRITE the entire current menu configuration with the items shown below. This cannot be undone. Are you sure?")){r(!0);try{await N.configService.overwriteMenu(f),await c(),s(!1),l(!1),alert("Menu configuration updated successfully!")}catch(t){console.error("Failed to apply menu",t),alert("Failed to apply changes")}finally{r(!1)}}};return e.jsxs("div",{className:"p-6 bg-white rounded-lg shadow-sm",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center mb-6 gap-4",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold text-gray-800 flex items-center gap-2",children:["Menu & Navigation",i&&e.jsx("span",{className:"px-2 py-1 bg-yellow-100 text-yellow-800 text-xs rounded-full border border-yellow-200",children:"Draft Mode (Unsaved)"})]}),e.jsx("p",{className:"text-gray-500",children:"Configure the sidebar menu items, visibility, and roles."})]}),e.jsx("div",{className:"flex gap-3",children:i?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:R,disabled:v,className:"px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50 transition-colors",children:"Cancel"}),e.jsx("button",{onClick:F,disabled:v,className:"px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 transition-colors shadow-sm",children:v?"Saving...":"Apply Overwrite"})]}):e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:I,className:"px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50 transition-colors",children:"Load Defaults to Edit"}),e.jsxs("button",{onClick:S,className:"px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 transition-colors flex items-center gap-2",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 4v16m8-8H4"})}),"Add Item"]})]})})]}),i&&e.jsxs("div",{className:"mb-6 p-4 bg-yellow-50 border border-yellow-200 rounded-md flex items-start gap-3",children:[e.jsx("svg",{className:"w-6 h-6 text-yellow-600 mt-0.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-yellow-800",children:"Previewing Default Menu"}),e.jsxs("p",{className:"text-yellow-700 text-sm mt-1",children:["You are currently editing a ",e.jsx("strong",{children:"draft"})," of the menu based on system defaults. You can hide items, change labels, or reorder them here.",e.jsx("br",{}),e.jsx("strong",{children:'Nothing is saved until you click "Apply Overwrite".'})]})]})]}),e.jsxs("div",{className:`space-y-4 ${i?"opacity-100":""}`,children:[f.map(t=>e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg hover:shadow-md transition-shadow bg-white group",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"h-10 w-10 flex items-center justify-center bg-gray-100 rounded-lg text-gray-500 group-hover:bg-indigo-50 group-hover:text-indigo-600 transition-colors",children:e.jsx(C,{iconKey:t.iconKey,className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-semibold text-gray-900 flex items-center gap-2",children:[t.label,t.section&&e.jsx("span",{className:"text-xs px-2 py-0.5 bg-gray-100 text-gray-600 rounded-full font-normal uppercase tracking-wide",children:t.section})]}),e.jsxs("div",{className:"flex gap-2 text-xs mt-1 text-gray-500",children:[e.jsx("span",{className:"font-mono bg-gray-50 px-1 rounded border",children:t.viewId}),e.jsx("span",{children:"•"}),e.jsxs("span",{children:["Order: ",t.order]}),e.jsx("span",{children:"•"}),e.jsx("div",{className:"flex gap-1",children:(t.allowedRoles||["ALL"]).map(o=>e.jsx("span",{className:"bg-blue-50 text-blue-700 px-1 rounded",children:o},o))}),t.hidden&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"•"}),e.jsxs("span",{className:"flex items-center gap-1 text-red-500 font-medium",children:[e.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21"})}),"Hidden"]})]})]})]})]}),e.jsx("button",{onClick:()=>p(t),className:"p-2 text-gray-400 hover:text-indigo-600 hover:bg-indigo-50 rounded-full transition-colors",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"})})})]},t.id)),f.length===0&&e.jsxs("div",{className:"text-center py-12 text-gray-500 bg-gray-50 rounded-lg border border-dashed border-gray-300",children:[e.jsx("p",{children:"No menu items found."}),e.jsx("button",{onClick:I,className:"text-indigo-600 hover:underline mt-2",children:"Load Defaults"})]})]}),e.jsx(B,{isOpen:x,onClose:()=>m(!1),onSave:L,onDelete:A,initialData:b})]})};export{U as M};
