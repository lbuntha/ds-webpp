import{r,j as e,h as V,aa as q,f as F}from"./index-BjK2osQV.js";import{B as S}from"./Button-JCYNVMjR.js";import{I as $}from"./Input-B96Hj4QL.js";import{C as I}from"./Card-DROeE3UG.js";import{g as R}from"./errorUtils-CUS756ws.js";import{t as D}from"./toast-DTXa3ATd.js";import{p as G}from"./payrollService-CAVDQbmV.js";const J=({employees:c,accounts:a,branches:N,onSave:w,onCancel:g})=>{var z;const[y,A]=r.useState(!1),[p,o]=r.useState(null),[t,v]=r.useState(""),[x,j]=r.useState(""),[h,l]=r.useState("ALLOWANCE"),[s,d]=r.useState("GASOLINE"),[u,b]=r.useState(0),[m,k]=r.useState("USD"),[E,C]=r.useState(new Date().toISOString().split("T")[0]),[O,f]=r.useState(""),[L,T]=r.useState(((z=N[0])==null?void 0:z.id)||""),[n,P]=r.useState("PENDING_PAYROLL"),[M,W]=r.useState(""),H=["GASOLINE","PHONE_CARD","MEAL","ACCOMMODATION","OVERTIME","BONUS","OTHER_ALLOWANCE"],B=["LATENESS","ABSENCE","DAMAGED_GOODS","LOAN_REPAYMENT","OTHER_DEDUCTION"],U=a.filter(i=>(i.name.toLowerCase().includes("cash")||i.name.toLowerCase().includes("bank"))&&!i.isHeader),Q=i=>{const _=i.target.value;v(_);const Y=c.find(Z=>Z.id===_);Y&&j(Y.name)},X=async i=>{if(i.preventDefault(),!t||u<=0){o("Please fill all required fields.");return}if(n==="PAID_IMMEDIATELY"&&!M){o("Please select a Payment Account for immediate payment.");return}A(!0);const _={id:`txn-${Date.now()}`,employeeId:t,employeeName:x,type:h,category:s,amount:u,currency:m,date:E,description:O,branchId:L,status:n,paymentAccountId:n==="PAID_IMMEDIATELY"?M:void 0,createdAt:Date.now(),createdBy:"system"};try{await w(_)}catch(Y){o(R(Y))}finally{A(!1)}};return e.jsx(I,{title:"Record Staff Transaction",children:e.jsxs("form",{onSubmit:X,className:"space-y-6",children:[e.jsxs("div",{className:"flex space-x-4 border-b border-gray-100 pb-4",children:[e.jsxs("label",{className:`flex items-center space-x-2 cursor-pointer p-3 rounded-lg border transition-all ${h==="ALLOWANCE"?"border-green-500 bg-green-50":"border-gray-200 hover:bg-gray-50"}`,children:[e.jsx("input",{type:"radio",name:"type",checked:h==="ALLOWANCE",onChange:()=>{l("ALLOWANCE"),d("GASOLINE")},className:"w-4 h-4 text-green-600 focus:ring-green-500"}),e.jsx("span",{className:`font-medium ${h==="ALLOWANCE"?"text-green-700":"text-gray-600"}`,children:"Allowance"})]}),e.jsxs("label",{className:`flex items-center space-x-2 cursor-pointer p-3 rounded-lg border transition-all ${h==="DEDUCTION"?"border-red-500 bg-red-50":"border-gray-200 hover:bg-gray-50"}`,children:[e.jsx("input",{type:"radio",name:"type",checked:h==="DEDUCTION",onChange:()=>{l("DEDUCTION"),d("LATENESS")},className:"w-4 h-4 text-red-600 focus:ring-red-500"}),e.jsx("span",{className:`font-medium ${h==="DEDUCTION"?"text-red-700":"text-gray-600"}`,children:"Deduction"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx("div",{className:"w-full",children:e.jsx($,{label:"Date",type:"date",value:E,onChange:i=>C(i.target.value),required:!0})}),e.jsxs("div",{className:"w-full",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Employee"}),e.jsxs("select",{className:"block w-full px-3 py-2 border border-gray-300 rounded-xl shadow-sm focus:outline-none focus:ring-indigo-500 sm:text-sm",value:t,onChange:Q,required:!0,children:[e.jsx("option",{value:"",children:"Select Employee"}),c.map(i=>e.jsx("option",{value:i.id,children:i.name},i.id))]})]}),e.jsxs("div",{className:"w-full",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Category"}),e.jsx("select",{className:"block w-full px-3 py-2 border border-gray-300 rounded-xl shadow-sm focus:outline-none focus:ring-indigo-500 sm:text-sm",value:s,onChange:i=>d(i.target.value),required:!0,children:h==="ALLOWANCE"?H.map(i=>e.jsx("option",{value:i,children:i.replace(/_/g," ")},i)):B.map(i=>e.jsx("option",{value:i,children:i.replace(/_/g," ")},i))})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("div",{className:"col-span-1",children:e.jsx($,{label:"Amount",type:"number",min:"0",step:"0.01",value:u,onChange:i=>b(parseFloat(i.target.value)),required:!0})}),e.jsxs("div",{className:"col-span-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Currency"}),e.jsxs("select",{className:"block w-full px-3 py-2 border border-gray-300 rounded-xl shadow-sm focus:outline-none focus:ring-indigo-500 sm:text-sm",value:m,onChange:i=>k(i.target.value),children:[e.jsx("option",{value:"USD",children:"USD ($)"}),e.jsx("option",{value:"KHR",children:"KHR (áŸ›)"})]})]})]}),e.jsx("div",{className:"md:col-span-2",children:e.jsx($,{label:"Description",value:O,onChange:i=>f(i.target.value),placeholder:"Details about this transaction..."})}),e.jsxs("div",{className:"w-full",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Branch"}),e.jsx("select",{className:"block w-full px-3 py-2 border border-gray-300 rounded-xl shadow-sm focus:outline-none focus:ring-indigo-500 sm:text-sm",value:L,onChange:i=>T(i.target.value),required:!0,children:N.map(i=>e.jsx("option",{value:i.id,children:i.name},i.id))})]})]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-xl border border-gray-200",children:[e.jsx("h4",{className:"text-sm font-bold text-gray-800 mb-3",children:"Payment / Payroll Settings"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex space-x-4",children:[e.jsxs("label",{className:"inline-flex items-center",children:[e.jsx("input",{type:"radio",className:"form-radio text-indigo-600",name:"paymentMode",checked:n==="PENDING_PAYROLL",onChange:()=>P("PENDING_PAYROLL")}),e.jsx("span",{className:"ml-2 text-sm text-gray-700",children:"Include in Next Payroll"})]}),e.jsxs("label",{className:"inline-flex items-center",children:[e.jsx("input",{type:"radio",className:"form-radio text-indigo-600",name:"paymentMode",checked:n==="PAID_IMMEDIATELY",onChange:()=>P("PAID_IMMEDIATELY")}),e.jsx("span",{className:"ml-2 text-sm text-gray-700",children:"Pay / Deduct Immediately"})]})]}),n==="PAID_IMMEDIATELY"&&e.jsxs("div",{className:"mt-2 animate-fade-in-up",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:h==="ALLOWANCE"?"Paid From (Credit Asset)":"Deposit To (Debit Asset)"}),e.jsxs("select",{className:"block w-full px-3 py-2 border border-gray-300 rounded-xl shadow-sm focus:outline-none focus:ring-indigo-500 sm:text-sm",value:M,onChange:i=>W(i.target.value),required:!0,children:[e.jsx("option",{value:"",children:"Select Account"}),U.map(i=>e.jsx("option",{value:i.id,children:i.name},i.id))]})]})]})]}),p&&e.jsx("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg text-sm",children:p}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx(S,{type:"button",variant:"outline",onClick:g,children:"Cancel"}),e.jsx(S,{type:"submit",isLoading:y,children:h==="ALLOWANCE"?"Save Allowance":"Save Deduction"})]})]})})},ee=({employees:c,existingRecord:a,onSave:N,onCancel:w})=>{const[g,y]=r.useState((a==null?void 0:a.employeeId)||""),[A,p]=r.useState((a==null?void 0:a.employeeName)||""),[o,t]=r.useState((a==null?void 0:a.date)||new Date().toISOString().split("T")[0]),[v,x]=r.useState(a!=null&&a.clockIn?new Date(a.clockIn).toTimeString().slice(0,5):"08:00"),[j,h]=r.useState(a!=null&&a.clockOut?new Date(a.clockOut).toTimeString().slice(0,5):"17:00"),[l,s]=r.useState((a==null?void 0:a.status)||"PRESENT"),[d,u]=r.useState((a==null?void 0:a.notes)||""),[b,m]=r.useState(!1),[k,E]=r.useState(null);r.useEffect(()=>{a&&(y(a.employeeId),p(a.employeeName),t(a.date),a.clockIn&&x(new Date(a.clockIn).toTimeString().slice(0,5)),a.clockOut&&h(new Date(a.clockOut).toTimeString().slice(0,5)),s(a.status),u(a.notes||""))},[a]);const C=f=>{const L=f.target.value;y(L);const T=c.find(n=>n.id===L);T&&p(T.name)},O=async f=>{if(f.preventDefault(),!g||!o||!v){E("Please fill required fields (Employee, Date, Clock In)");return}m(!0);const L=new Date(o),[T,n]=v.split(":").map(Number),P=new Date(L.setHours(T,n)).getTime();let M;if(j){const[B,U]=j.split(":").map(Number);M=new Date(L.setHours(B,U)).getTime()}let W=l;l!=="ABSENT"&&l!=="LATE"&&l!=="LEFT_EARLY"&&(M?W="PRESENT":W="MISSING_CLOCK_OUT");const H={id:(a==null?void 0:a.id)||`att-${Date.now()}`,employeeId:g,employeeName:A,date:o,clockIn:P,clockOut:M,status:W,notes:d,isHoliday:!1};try{await N(H)}catch(B){E(R(B))}finally{m(!1)}};return e.jsx(I,{title:a?"Edit Attendance Record":"Manually Log Attendance",children:e.jsxs("form",{onSubmit:O,className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"w-full",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Employee"}),e.jsxs("select",{className:"block w-full px-3 py-2 border border-gray-300 rounded-xl shadow-sm focus:outline-none focus:ring-indigo-500 sm:text-sm disabled:bg-gray-100",value:g,onChange:C,required:!0,disabled:!!a,children:[e.jsx("option",{value:"",children:"Select Employee"}),c.map(f=>e.jsx("option",{value:f.id,children:f.name},f.id))]})]}),e.jsx($,{label:"Date",type:"date",value:o,onChange:f=>t(f.target.value),required:!0,disabled:!!a}),e.jsx($,{label:"Clock In Time",type:"time",value:v,onChange:f=>x(f.target.value),required:!0}),e.jsx($,{label:"Clock Out Time",type:"time",value:j,onChange:f=>h(f.target.value)}),e.jsxs("div",{className:"w-full",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Status Override"}),e.jsxs("select",{className:"block w-full px-3 py-2 border border-gray-300 rounded-xl shadow-sm focus:outline-none focus:ring-indigo-500 sm:text-sm",value:l,onChange:f=>s(f.target.value),children:[e.jsx("option",{value:"PRESENT",children:"Present (Regular)"}),e.jsx("option",{value:"LATE",children:"Late Arrival"}),e.jsx("option",{value:"LEFT_EARLY",children:"Left Early"}),e.jsx("option",{value:"MISSING_CLOCK_OUT",children:"Missing Clock Out"}),e.jsx("option",{value:"ABSENT",children:"Absent"})]})]}),e.jsx("div",{className:"md:col-span-2",children:e.jsx($,{label:"Notes",value:d,onChange:f=>u(f.target.value),placeholder:"Reason for lateness, manual adjustment, etc."})})]}),k&&e.jsx("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg text-sm",children:k}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx(S,{type:"button",variant:"outline",onClick:w,children:"Cancel"}),e.jsx(S,{type:"submit",isLoading:b,children:"Save Record"})]})]})})},te=()=>{const{employees:c}=V(),[a,N]=r.useState(new Date().toISOString().slice(0,7)),[w,g]=r.useState([]),[y,A]=r.useState(null),[p,o]=r.useState([]),[t,v]=r.useState({standardWorkingDays:26,standardDayOffs:4,paySchedule:"SEMI_MONTHLY",latenessDeductionAmount:1,minDaysForDayOff:15,dayOffsPerPeriod:2,attendanceAllowanceAmount:10,workStartTime:"08:00",workEndTime:"17:00",lateGracePeriodMinutes:15,excessLeavePenaltyAmount:10});r.useEffect(()=>{x()},[a]);const x=async()=>{const l=await q.getPayrollConfig();v(l);const d=(await F.getDailyAttendance()).filter(u=>u.date.startsWith(a));g(d)},j=()=>{const l=c.map(s=>{const u=w.filter(C=>C.employeeId===s.id).filter(C=>["PRESENT","LATE","LEFT_EARLY"].includes(C.status)).length,b=u-t.standardWorkingDays;let m=0;const k=s.baseSalaryAmount||0,E=k>0?k/t.standardWorkingDays:0;if(b>0)m=b*(t.attendanceAllowanceAmount||10);else if(b<0){const C=Math.abs(b),O=t.excessLeavePenaltyAmount||0;m=C*E+C*O}return{employee:s,daysWorked:u,variance:b,adjustmentAmount:m,baseSalary:k,type:b>=0?"ALLOWANCE":"DEDUCTION"}});o(l)},h=async l=>{if(l.variance!==0){A(l.employee.id);try{const s={id:`adj-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,employeeId:l.employee.id,employeeName:l.employee.name,type:l.type,category:l.type==="ALLOWANCE"?"INCENTIVE":"ABSENCE",amount:l.adjustmentAmount,currency:"USD",date:new Date().toISOString().split("T")[0],description:`Monthly Adjustment for ${a}: ${l.daysWorked} days worked. (${l.variance} days variance)`,status:"PENDING_PAYROLL",branchId:l.employee.branchId||"HEAD_OFFICE",createdAt:Date.now(),createdBy:"SYSTEM"};await F.createStaffTransaction(s),D.success(`Created adjustment for ${l.employee.name}`)}catch(s){console.error(s),D.error("Failed to create transaction")}finally{A(null)}}};return e.jsxs(I,{title:"Monthly Attendance Processing",children:[e.jsxs("div",{className:"flex gap-4 items-end mb-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Select Month"}),e.jsx("input",{type:"month",className:"border rounded-lg px-3 py-2 text-sm",value:a,onChange:l=>N(l.target.value)})]}),e.jsx(S,{onClick:j,children:"Calculate Adjustments"})]}),p.length>0&&e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Employee"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Days Worked"}),e.jsxs("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:["Variance (",t.standardWorkingDays,"d)"]}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Adjustment"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"Action"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:p.map((l,s)=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:[l.employee.name,e.jsxs("div",{className:"text-xs text-gray-500",children:["Base: $",l.baseSalary.toLocaleString()]}),l.baseSalary===0&&e.jsx("div",{className:"text-xs text-red-500 font-bold",children:"âš ï¸ No Salary Set"})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:l.daysWorked}),e.jsx("td",{className:`px-6 py-4 whitespace-nowrap text-sm font-bold ${l.variance>=0?"text-green-600":"text-red-600"}`,children:l.variance>0?`+${l.variance}`:l.variance}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-bold text-gray-900",children:["$",l.adjustmentAmount.toLocaleString(void 0,{minimumFractionDigits:2}),e.jsxs("span",{className:"text-xs font-normal text-gray-500 ml-1",children:["(",l.type,")"]})]}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm",children:[l.variance!==0&&e.jsx(S,{variant:"secondary",onClick:()=>h(l),isLoading:y===l.employee.id,disabled:l.baseSalary===0&&l.type==="DEDUCTION",children:"Post Adjustment"}),l.variance===0&&e.jsx("span",{className:"text-gray-400 text-sm italic",children:"No adjustment"})]})]},s))})]})})]})},K=["SETUP","REVIEW","PREVIEW","FINALIZE"],se=()=>{var h,l;const{employees:c}=V(),[a,N]=r.useState(0),[w,g]=r.useState(!1),[y,A]=r.useState(()=>{const s=new Date;return s.setDate(1),s.toISOString().split("T")[0]}),[p,o]=r.useState(()=>{const s=new Date;return s.getDate()<15?s.setDate(15):(s.setMonth(s.getMonth()+1),s.setDate(0)),s.toISOString().split("T")[0]}),[t,v]=r.useState(null),x=async()=>{if(a===0){g(!0);try{const s=await G.getPayrollSummary(y,p,c);v(s),N(1)}catch{D.error("Failed to fetch payroll data")}finally{g(!1)}}else a===1?N(2):a===2&&await j()},j=async()=>{if(t){g(!0);try{const s={id:`pr-${Date.now()}`,period:y.slice(0,7),startDate:y,endDate:p,stage:"COMPLETED",status:"PAID",totalAmount:t.summary.totalNetPay,totalBaseSalary:0,totalAllowances:0,totalCommissions:0,totalDeductions:0,currency:"USD",exchangeRate:1,createdAt:Date.now(),createdBy:"SYSTEM"},d=t.draftPayslips.map(m=>({payrollRunId:"",employeeId:m.employeeId,employeeName:m.employeeName,baseSalary:m.baseSalary,proRatedSalary:m.proRatedSalary,currency:"USD",earnings:m.earnings,deductions:m.deductions,grossPay:m.proRatedSalary+m.totalAllowances+(m.totalCommissions||0),totalTax:0,totalCommissions:m.totalCommissions||0,totalDeductions:m.totalDeductions,netPay:m.netPay,status:"PAID"})),u=t.draftPayslips.flatMap(m=>m.transactionIds),b=t.draftPayslips.flatMap(m=>m.walletTxnIds||[]);await G.finalizeRun(s,d,u,b),N(3),D.success("Payroll Finalized!")}catch{D.error("Failed to finalize payroll")}finally{g(!1)}}};return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex justify-between items-center bg-white p-4 rounded-xl border border-gray-100 shadow-sm",children:K.map((s,d)=>e.jsxs("div",{className:`flex items-center ${d<=a?"text-indigo-600":"text-gray-400"}`,children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center font-bold mr-2 ${d<=a?"bg-indigo-100":"bg-gray-100"}`,children:d+1}),e.jsx("span",{className:"font-medium text-sm hidden sm:block",children:s}),d<K.length-1&&e.jsx("div",{className:"h-0.5 w-8 bg-gray-200 mx-2 sm:mx-4"})]},s))}),a===0&&e.jsxs(I,{title:"1. Payroll Configuration",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 max-w-lg",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Start Date"}),e.jsx("input",{type:"date",className:"border rounded-lg px-3 py-2 w-full",value:y,onChange:s=>A(s.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"End Date"}),e.jsx("input",{type:"date",className:"border rounded-lg px-3 py-2 w-full",value:p,onChange:s=>o(s.target.value)})]})]}),e.jsx("div",{className:"mt-6",children:e.jsx(S,{onClick:x,isLoading:w,children:"Start Processing â†’"})})]}),a===1&&t&&e.jsx("div",{className:"space-y-6",children:e.jsxs(I,{title:"2. Big Picture Review",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:`p-4 rounded-lg border ${t.attendanceIssues.length>0?"bg-red-50 border-red-200":"bg-green-50 border-green-200"}`,children:[e.jsx("h3",{className:`font-bold ${t.attendanceIssues.length>0?"text-red-800":"text-green-800"}`,children:t.attendanceIssues.length>0?"âš ï¸ Attendance Issues Detected":"âœ… Attendance OK"}),t.attendanceIssues.length>0?e.jsx("ul",{className:"list-disc pl-5 mt-2 text-sm text-red-700",children:t.attendanceIssues.map((s,d)=>e.jsxs("li",{children:[s.employeeName," - ",s.date,": ",s.status]},d))}):e.jsx("p",{className:"text-sm text-green-700 mt-1",children:"No missing clock-outs found in this period."})]}),e.jsxs("div",{className:"p-4 rounded-lg border bg-blue-50 border-blue-200",children:[e.jsxs("h3",{className:"font-bold text-blue-800",children:["ðŸ“‹ Pending Transactions (",t.pendingTxns.length,")"]}),e.jsxs("p",{className:"text-sm text-blue-700 mt-1",children:["Found ",t.pendingTxns.filter(s=>s.type==="ALLOWANCE").length," Allowances and ",t.pendingTxns.filter(s=>s.type==="DEDUCTION").length," Deductions to process."]})]}),t.unprocessedLateness&&t.unprocessedLateness.length>0&&e.jsxs("div",{className:"p-4 rounded-lg border bg-yellow-50 border-yellow-200",children:[e.jsxs("h3",{className:"font-bold text-yellow-800",children:["ðŸ•’ Unprocessed Lateness (",t.unprocessedLateness.length,")"]}),e.jsx("p",{className:"text-sm text-yellow-700 mt-1 mb-3",children:"Staff were marked LATE but no deduction found."}),e.jsxs("ul",{className:"list-disc pl-5 mt-2 text-sm text-yellow-700 mb-3",children:[t.unprocessedLateness.slice(0,5).map((s,d)=>e.jsxs("li",{children:[s.employeeName," - ",s.date," (",s.status,")"]},d)),t.unprocessedLateness.length>5&&e.jsxs("li",{children:["...and ",t.unprocessedLateness.length-5," more"]})]}),e.jsx(S,{onClick:async()=>{g(!0),await G.createLatenessDeductions(t.unprocessedLateness),D.success("Applied deductions! Refreshing...");const s=await G.getPayrollSummary(y,p,c);v(s),g(!1)},isLoading:w,className:"bg-yellow-600 hover:bg-yellow-700 text-white",children:"Apply Lateness Deductions"})]}),parseInt(p.split("-")[2])>20&&e.jsxs("div",{className:"p-4 rounded-lg border bg-indigo-50 border-indigo-200 mt-4",children:[e.jsx("h3",{className:"font-bold text-indigo-800 flex items-center",children:"ðŸ“… End-of-Month Reminder"}),e.jsxs("p",{className:"text-sm text-indigo-700 mt-1",children:["Since this is an end-of-month run, please ensure you have completed the",e.jsx("strong",{children:" Monthly Attendance Processing"})," to calculate adjustments for Absences/Variance (based on the 26-day rule)."]})]})]}),e.jsxs("div",{className:"mt-6 flex justify-end gap-2",children:[e.jsx(S,{variant:"secondary",onClick:()=>N(0),children:"Back"}),e.jsx(S,{onClick:x,children:"Looks Good, Continue â†’"})]})]})}),a===2&&t&&e.jsxs(I,{title:"3. Calculation Preview",children:[e.jsxs("p",{className:"text-sm text-gray-500 mb-4",children:["Based on Period: ",y," to ",p,". Assuming ",y.slice(-2)," to ",p.slice(-2)," logic for pro-ration (",(((h=t.draftPayslips[0])==null?void 0:h.proRatedSalary)/(((l=t.draftPayslips[0])==null?void 0:l.baseSalary)||1)*100).toFixed(0),"% base)."]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Employee"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Base (Pro-rated)"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase text-blue-600",children:"Commissions"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase text-green-600",children:"+ Allowances"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase text-red-600",children:"- Deductions"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase font-bold",children:"Net Pay"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:t.draftPayslips.map((s,d)=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:s.employeeName}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:["$",s.proRatedSalary.toLocaleString(void 0,{minimumFractionDigits:2}),e.jsxs("span",{className:"text-xs ml-1 text-gray-400",children:["($",s.baseSalary.toLocaleString(),")"]})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-blue-600 font-medium",children:s.totalCommissions>0?`$${s.totalCommissions.toLocaleString(void 0,{minimumFractionDigits:2})}`:"-"}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-green-600 font-medium",children:["+$",s.totalAllowances.toLocaleString(void 0,{minimumFractionDigits:2}),s.earnings.length>0&&e.jsx("div",{className:"mt-1 flex flex-col gap-0.5",children:s.earnings.map((u,b)=>e.jsxs("span",{className:"text-xs text-green-700 bg-green-50 px-1.5 py-0.5 rounded -ml-1.5 w-fit whitespace-normal",children:[u.description,": $",u.amount.toLocaleString(void 0,{minimumFractionDigits:2})]},b))})]}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-red-600 font-medium",children:["-$",s.totalDeductions.toLocaleString(void 0,{minimumFractionDigits:2}),s.deductions.length>0&&e.jsx("div",{className:"mt-1 flex flex-col gap-0.5",children:s.deductions.map((u,b)=>e.jsxs("span",{className:"text-xs text-red-700 bg-red-50 px-1.5 py-0.5 rounded -ml-1.5 w-fit whitespace-normal",children:[u.description,": $",u.amount.toLocaleString(void 0,{minimumFractionDigits:2})]},b))})]}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-bold text-gray-900",children:["$",s.netPay.toLocaleString(void 0,{minimumFractionDigits:2})]})]},d))})]})}),e.jsxs("div",{className:"mt-6 flex justify-end gap-2",children:[e.jsx(S,{variant:"secondary",onClick:()=>N(1),children:"Back"}),e.jsx(S,{onClick:x,isLoading:w,children:"Complete & Finalize"})]})]}),a===3&&e.jsxs("div",{className:"text-center py-16",children:[e.jsx("div",{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx("svg",{className:"w-8 h-8 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Payroll Finalized!"}),e.jsx("p",{className:"text-gray-500 mb-6",children:"Transactions have been marked as paid and payslips archived."}),e.jsx(S,{onClick:()=>N(0),children:"Start New Run"})]})]})},ae=()=>{const[c,a]=r.useState({standardWorkingDays:26,standardDayOffs:4,paySchedule:"SEMI_MONTHLY",latenessDeductionAmount:1,minDaysForDayOff:15,dayOffsPerPeriod:2,attendanceAllowanceAmount:10,workStartTime:"08:00",workEndTime:"17:00",lateGracePeriodMinutes:15}),[N,w]=r.useState(!0),[g,y]=r.useState(!1);r.useEffect(()=>{A()},[]);const A=async()=>{try{const t=await q.getPayrollConfig();a(t)}catch(t){console.error(t),D.error("Failed to load settings")}finally{w(!1)}},p=async()=>{y(!0);try{await q.updatePayrollConfig(c),D.success("Settings saved successfully!")}catch(t){console.error(t),D.error("Failed to save settings")}finally{y(!1)}},o=(t,v)=>{a(x=>({...x,[t]:v}))};return N?e.jsx("div",{className:"p-8 text-center text-gray-500",children:"Loading settings..."}):e.jsxs(I,{title:"Payroll Configuration",children:[e.jsxs("div",{className:"space-y-6 max-w-2xl",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 border-b pb-2 mb-4",children:"General Rules"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Standard Working Days (Month)"}),e.jsx("input",{type:"number",className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2",value:c.standardWorkingDays,onChange:t=>o("standardWorkingDays",Number(t.target.value))}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Divider for Daily Rate (Base Salary / This). ",e.jsx("br",{}),"Example: $500 / 26 days = $19.23/day."]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Standard Day Offs (Month)"}),e.jsx("input",{type:"number",className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2",value:c.standardDayOffs,onChange:t=>o("standardDayOffs",Number(t.target.value))}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Expected number of rest days per month."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Pay Schedule"}),e.jsxs("select",{className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2",value:c.paySchedule,onChange:t=>o("paySchedule",t.target.value),children:[e.jsx("option",{value:"MONTHLY",children:"Monthly (Once a month)"}),e.jsx("option",{value:"SEMI_MONTHLY",children:"Semi-Monthly (Split 50%)"})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Determines how base salary is split (100% or 50%)."})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 border-b pb-2 mb-4 mt-2",children:"Work Shift & Lateness Rules"}),e.jsx("p",{className:"text-sm text-gray-600 mb-4 bg-blue-50 p-2 rounded",children:'These rules define when an employee is marked as "Late" or "Left Early".'}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Work Start Time"}),e.jsx("input",{type:"time",className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2",value:c.workStartTime||"08:00",onChange:t=>o("workStartTime",t.target.value)}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Expected clock-in time."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Work End Time"}),e.jsx("input",{type:"time",className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2",value:c.workEndTime||"17:00",onChange:t=>o("workEndTime",t.target.value)}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Expected clock-out time."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Grace Period (Minutes)"}),e.jsx("input",{type:"number",className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2",value:c.lateGracePeriodMinutes||15,onChange:t=>o("lateGracePeriodMinutes",Number(t.target.value))}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:['Buffer before "Late" status applies.',e.jsx("br",{}),"E.g., if 15m, 8:15 is OK, 8:16 is Late."]})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 border-b pb-2 mb-4 mt-2",children:"Deduction & Allowance Logic"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Lateness Deduction Amount ($)"}),e.jsxs("div",{className:"mt-1 relative rounded-md shadow-sm",children:[e.jsx("span",{className:"absolute inset-y-0 left-0 pl-3 flex items-center text-gray-500",children:"$"}),e.jsx("input",{type:"number",step:"0.01",className:"block w-full pl-7 border border-gray-300 rounded-md p-2",value:c.latenessDeductionAmount,onChange:t=>o("latenessDeductionAmount",Number(t.target.value))})]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:['Fixed amount deducted for each "Late" occurrence.',e.jsx("br",{}),'Applied manually via "Apply Lateness Deductions".']})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Attendance Allowance (Daily Bonus)"}),e.jsxs("div",{className:"mt-1 relative rounded-md shadow-sm",children:[e.jsx("span",{className:"absolute inset-y-0 left-0 pl-3 flex items-center text-gray-500",children:"$"}),e.jsx("input",{type:"number",step:"0.01",className:"block w-full pl-7 border border-gray-300 rounded-md p-2",value:c.attendanceAllowanceAmount||10,onChange:t=>o("attendanceAllowanceAmount",Number(t.target.value))})]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Bonus paid for every day worked ABOVE the Standard Working Days.",e.jsx("br",{}),"(Variance > 0) * This Amount."]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Detailed Penalty (Excess Leave)"}),e.jsxs("div",{className:"mt-1 relative rounded-md shadow-sm",children:[e.jsx("span",{className:"absolute inset-y-0 left-0 pl-3 flex items-center text-gray-500",children:"$"}),e.jsx("input",{type:"number",step:"0.01",className:"block w-full pl-7 border border-gray-300 rounded-md p-2",value:c.excessLeavePenaltyAmount||0,onChange:t=>o("excessLeavePenaltyAmount",Number(t.target.value))})]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["EXTRA penalty for days missed BELOW the Standard Working Days.",e.jsx("br",{}),"Formula: (Days Missed * Daily Rate) + (Days Missed * This Penalty)."]})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 border-b pb-2 mb-4 mt-2",children:"New Hire / Tenure Rules"}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-md border border-gray-200",children:[e.jsx("p",{className:"text-sm font-medium text-gray-800 mb-2",children:"Pro-rated Day Off Eligibility"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700",children:"Minimum Days to Qualify"}),e.jsx("input",{type:"number",className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2 text-sm",value:c.minDaysForDayOff,onChange:t=>o("minDaysForDayOff",Number(t.target.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700",children:"Day Offs per Period"}),e.jsx("input",{type:"number",className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2 text-sm",value:c.dayOffsPerPeriod,onChange:t=>o("dayOffsPerPeriod",Number(t.target.value))})]})]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-2 italic",children:['Condition: "If employee worked less than ',e.jsxs("b",{children:[c.minDaysForDayOff," days"]}),", they get 0 paid day offs. If they worked more, they get ",e.jsxs("b",{children:[c.dayOffsPerPeriod," days"]}),'."']})]})]})]}),e.jsxs("div",{className:"bg-indigo-50 border border-indigo-100 rounded-xl p-6 mt-8",children:[e.jsxs("h3",{className:"text-lg font-bold text-indigo-900 mb-4 flex items-center",children:[e.jsx("svg",{className:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z"})}),"Live Calculation Simulator"]}),e.jsx("p",{className:"text-sm text-indigo-700 mb-6",children:"See how your settings affect a payroll calculation in real-time."}),e.jsx(ne,{config:c})]}),e.jsx("div",{className:"flex justify-end pt-4",children:e.jsx(S,{onClick:p,isLoading:g,children:"Save Configuration"})})]})},ne=({config:c})=>{const[a,N]=r.useState(500),[w,g]=r.useState(25),[y,A]=r.useState(2),[p,o]=r.useState(50),t=c.standardWorkingDays||26,v=a/t,x=w-t;let j=0,h="";if(x>=0){const d=x*(c.attendanceAllowanceAmount||0);j=d,h=`Bonus: ${x} extra days Ã— $${c.attendanceAllowanceAmount} = +$${d.toFixed(2)}`}else{const d=Math.abs(x),u=d*v,b=d*(c.excessLeavePenaltyAmount||0);j=-(u+b),h=`Deduction: (${d} missed Ã— $${v.toFixed(2)} rate) + (${d} missed Ã— $${c.excessLeavePenaltyAmount} penalty) = -$${Math.abs(j).toFixed(2)}`}const l=y*(c.latenessDeductionAmount||0),s=a+j-l+p;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 items-end bg-white p-4 rounded-lg border border-indigo-100",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-indigo-800 uppercase",children:"Base Salary"}),e.jsxs("div",{className:"relative mt-1",children:[e.jsx("span",{className:"absolute inset-y-0 left-0 pl-3 flex items-center text-gray-500",children:"$"}),e.jsx("input",{type:"number",className:"pl-6 w-full border-indigo-200 rounded p-1 text-sm font-bold",value:a,onChange:d=>N(Number(d.target.value))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-indigo-800 uppercase",children:"Days Worked"}),e.jsx("input",{type:"number",className:"mt-1 w-full border-indigo-200 rounded p-1 text-sm font-bold",value:w,onChange:d=>g(Number(d.target.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-indigo-800 uppercase",children:"Lateness Count"}),e.jsx("input",{type:"number",className:"mt-1 w-full border-indigo-200 rounded p-1 text-sm font-bold",value:y,onChange:d=>A(Number(d.target.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-indigo-800 uppercase",children:"Commission"}),e.jsxs("div",{className:"relative mt-1",children:[e.jsx("span",{className:"absolute inset-y-0 left-0 pl-3 flex items-center text-gray-500",children:"$"}),e.jsx("input",{type:"number",className:"pl-6 w-full border-indigo-200 rounded p-1 text-sm font-bold",value:p,onChange:d=>o(Number(d.target.value))})]})]})]}),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-2 text-sm",children:[e.jsxs("div",{className:"bg-white p-3 rounded border border-gray-200 text-center",children:[e.jsx("div",{className:"text-xs text-gray-500 uppercase",children:"1. Daily Rate"}),e.jsxs("div",{className:"font-mono font-bold text-gray-800 mt-1",children:["$",a," / ",t,"d = $",v.toFixed(2)]})]}),e.jsxs("div",{className:"bg-white p-3 rounded border border-gray-200 text-center",children:[e.jsx("div",{className:"text-xs text-gray-500 uppercase",children:"2. Variance"}),e.jsxs("div",{className:`font-mono font-bold mt-1 ${x<0?"text-red-600":"text-green-600"}`,children:[w," - ",t," = ",x," days"]})]}),e.jsxs("div",{className:`p-3 rounded border text-center ${x<0?"bg-red-50 border-red-100":"bg-green-50 border-green-100"}`,children:[e.jsx("div",{className:`text-xs uppercase ${x<0?"text-red-600":"text-green-600"}`,children:"3. Final Adjustment"}),e.jsxs("div",{className:"font-mono font-bold text-gray-900 mt-1",children:[x>=0?"+":"",j.toFixed(2)]}),e.jsx("div",{className:"text-xs text-gray-500 mt-1 italic leading-tight",children:h})]})]}),e.jsxs("div",{className:"bg-indigo-900 text-white p-4 rounded-lg shadow-lg",children:[e.jsx("div",{className:"text-xs font-medium text-indigo-300 uppercase mb-2",children:"Final Calculation"}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-lg font-mono",children:[e.jsxs("span",{className:"opacity-70",title:"Base Salary",children:["$",a]}),e.jsxs("span",{children:[j>=0?"+":"-"," $",Math.abs(j).toFixed(2)]}),e.jsxs("span",{children:["- $",l.toFixed(2)]}),e.jsxs("span",{children:["+ $",p.toFixed(2)]}),e.jsx("span",{className:"mx-2 text-indigo-300",children:"="}),e.jsxs("span",{className:"font-bold text-2xl text-green-300",children:["$",s.toFixed(2)]})]}),e.jsxs("div",{className:"text-xs text-indigo-300 mt-1 flex gap-4",children:[e.jsx("span",{children:"(Base)"}),e.jsx("span",{children:"(Attendance Adj)"}),e.jsxs("span",{children:["(Lateness: ",y," Ã— $",c.latenessDeductionAmount,")"]}),e.jsx("span",{children:"(Commission)"}),e.jsx("span",{className:"font-bold text-white",children:"(Net Pay)"})]})]})]})]})};function xe(){const{employees:c,accounts:a,branches:N,refreshData:w}=V(),[g,y]=r.useState([]),[A,p]=r.useState(!0),[o,t]=r.useState("ALLOWANCES"),[v,x]=r.useState(!1),[j,h]=r.useState([]),[l,s]=r.useState(new Date().toISOString().slice(0,7)),[d,u]=r.useState(!1),[b,m]=r.useState(null);r.useEffect(()=>{k(),E()},[]);const k=async()=>{try{const n=await F.getStaffTransactions();y(n)}catch(n){console.error(n),D.error("Failed to load transactions")}finally{p(!1)}},E=async()=>{try{const n=await F.getDailyAttendance();h(n||[])}catch(n){console.error(n)}},C=async n=>{await F.createStaffTransaction(n),await k(),x(!1),D.success("Transaction saved successfully!")},O=async n=>{try{await F.saveDailyAttendance(n),await E(),u(!1),m(null),D.success("Attendance saved.")}catch{D.error("Failed to save attendance.")}},f=()=>{m(null),u(!0)},L=n=>{m(n),u(!0)},T=r.useMemo(()=>j.filter(n=>n.date.startsWith(l)).sort((n,P)=>P.date.localeCompare(n.date)),[j,l]);return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Staff Allowances & Attendance"}),o==="ALLOWANCES"&&!v&&e.jsxs(S,{onClick:()=>x(!0),className:"flex items-center",children:[e.jsx("svg",{className:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})}),"New Transaction"]})]}),e.jsxs("div",{className:"flex space-x-1 bg-white p-1 rounded-xl border border-gray-200 shadow-sm w-fit",children:[e.jsx("button",{onClick:()=>t("ALLOWANCES"),className:`px-4 py-2 rounded-lg text-sm font-medium transition-all ${o==="ALLOWANCES"?"bg-indigo-50 text-indigo-700":"text-gray-600 hover:bg-gray-50"}`,children:"Allowances & Deductions"}),e.jsx("button",{onClick:()=>t("ATTENDANCE"),className:`px-4 py-2 rounded-lg text-sm font-medium transition-all ${o==="ATTENDANCE"?"bg-indigo-50 text-indigo-700":"text-gray-600 hover:bg-gray-50"}`,children:"Daily Time Clock"}),e.jsx("button",{onClick:()=>t("MONTHLY"),className:`px-4 py-2 rounded-lg text-sm font-medium transition-all ${o==="MONTHLY"?"bg-indigo-50 text-indigo-700":"text-gray-600 hover:bg-gray-50"}`,children:"Monthly Processing"}),e.jsx("button",{onClick:()=>t("PAYROLL"),className:`px-4 py-2 rounded-lg text-sm font-medium transition-all ${o==="PAYROLL"?"bg-indigo-50 text-indigo-700":"text-gray-600 hover:bg-gray-50"}`,children:"Payroll Run"}),e.jsx("button",{onClick:()=>t("SETTINGS"),className:`px-4 py-2 rounded-lg text-sm font-medium transition-all ${o==="SETTINGS"?"bg-indigo-50 text-indigo-700":"text-gray-600 hover:bg-gray-50"}`,children:"Settings"})]}),o==="ALLOWANCES"&&e.jsx(e.Fragment,{children:v?e.jsx(J,{employees:c,accounts:a,branches:N,onSave:C,onCancel:()=>x(!1)}):e.jsx(I,{children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Employee"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Type"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Category"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Amount"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"})]})}),e.jsxs("tbody",{className:"bg-white divide-y divide-gray-200",children:[g.sort((n,P)=>P.date.localeCompare(n.date)).map(n=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:n.date}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:n.employeeName}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:e.jsx("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${n.type==="ALLOWANCE"?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:n.type})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:n.category}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-bold text-gray-900",children:[n.currency==="USD"?"$":"áŸ›"," ",n.amount.toLocaleString()]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:n.status==="PENDING_PAYROLL"?e.jsx("span",{className:"text-yellow-600 bg-yellow-50 px-2 py-1 rounded text-xs",children:"Pending Payroll"}):e.jsx("span",{className:"text-blue-600 bg-blue-50 px-2 py-1 rounded text-xs",children:"Paid"})})]},n.id)),g.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"px-6 py-12 text-center text-gray-500",children:'No transactions found. Click "New Transaction" to add one.'})})]})]})})})}),o==="ATTENDANCE"&&e.jsx(e.Fragment,{children:d?e.jsx(ee,{employees:c,existingRecord:b,onSave:O,onCancel:()=>{u(!1),m(null)}}):e.jsx(I,{action:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"month",className:"border rounded-lg px-3 py-2 text-sm",value:l,onChange:n=>s(n.target.value)}),e.jsx(S,{onClick:()=>f(),children:"+ Manual Entry"})]}),children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Employee"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Clock In"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Clock Out"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsxs("tbody",{className:"bg-white divide-y divide-gray-200",children:[T.map(n=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:n.date}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:n.employeeName}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:new Date(n.clockIn).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:n.clockOut?new Date(n.clockOut).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):e.jsx("span",{className:"text-red-400 italic",children:"Missing"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:e.jsx("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full 
                                                        ${n.status==="PRESENT"?"bg-green-100 text-green-800":""}
                                                        ${n.status==="LATE"?"bg-yellow-100 text-yellow-800":""}
                                                        ${n.status==="MISSING_CLOCK_OUT"?"bg-red-100 text-red-800":""}
                                                        ${n.status==="ABSENT"?"bg-gray-100 text-gray-800":""}
                                                    `,children:n.status.replace(/_/g," ")})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:e.jsx("button",{onClick:()=>L(n),className:"text-indigo-600 hover:text-indigo-900",children:"Edit"})})]},n.id)),T.length===0&&e.jsx("tr",{children:e.jsxs("td",{colSpan:6,className:"px-6 py-12 text-center text-gray-500",children:["No attendance records for ",l,"."]})})]})]})})})}),o==="MONTHLY"&&e.jsx(te,{}),o==="PAYROLL"&&e.jsx(se,{}),o==="SETTINGS"&&e.jsx(ae,{})]})}export{xe as default};
