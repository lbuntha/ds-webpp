import{r as o,f as h,j as t}from"./index-BjK2osQV.js";import{T as b}from"./Toast-DvmjtaFo.js";const y=({user:r})=>{const[c,g]=o.useState([]),[x,l]=o.useState(!1),[n,d]=o.useState(null),f=o.useRef(null);o.useEffect(()=>{if(!r)return;const e=h.subscribeToNotifications(r.uid,r.role,s=>{g(a=>{if(a.length>0&&s.length>0){const i=a[0],u=s[0];u.id!==i.id&&Date.now()-u.createdAt<1e4&&d(u)}else if(s.length>0){const i=s[0];Date.now()-i.createdAt<5e3&&d(i)}return s})});return()=>e()},[r]),o.useEffect(()=>{const e=s=>{f.current&&!f.current.contains(s.target)&&l(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]);const m=c.filter(e=>!e.read).length,p=async e=>{if(e.read||await h.markNotificationRead(e.id),e.metadata&&e.metadata.type==="CHAT"){const s=new CustomEvent("open-chat-view",{detail:{bookingId:e.metadata.bookingId,itemId:e.metadata.itemId}});window.dispatchEvent(s)}else e.link;l(!1)},v=e=>{const s=Date.now()-e,a=Math.floor(s/6e4);if(a<60)return`${a}m ago`;const i=Math.floor(a/60);return i<24?`${i}h ago`:new Date(e).toLocaleDateString()};return t.jsxs("div",{className:"relative",ref:f,children:[t.jsxs("button",{onClick:()=>l(!x),className:"p-2 rounded-full hover:bg-gray-100 transition-colors relative",children:[t.jsx("svg",{className:"w-6 h-6 text-gray-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"})}),m>0&&t.jsx("span",{className:"absolute top-1 right-1 h-4 w-4 bg-red-600 text-white text-[10px] font-bold flex items-center justify-center rounded-full ring-2 ring-white",children:m>9?"9+":m})]}),x&&t.jsxs("div",{className:"absolute right-0 mt-2 w-80 bg-white rounded-xl shadow-xl border border-gray-100 z-50 overflow-hidden animate-fade-in-up",children:[t.jsx("div",{className:"px-4 py-3 border-b border-gray-50 flex justify-between items-center bg-gray-50/50",children:t.jsx("h3",{className:"font-bold text-gray-800 text-sm",children:"Notifications"})}),t.jsx("div",{className:"max-h-96 overflow-y-auto",children:c.length===0?t.jsx("div",{className:"p-6 text-center text-gray-400 text-sm",children:"No notifications."}):t.jsx("div",{className:"divide-y divide-gray-50",children:c.map(e=>t.jsxs("div",{onClick:()=>p(e),className:`p-4 hover:bg-gray-50 cursor-pointer transition-colors ${e.read?"":"bg-red-50/10"}`,children:[t.jsxs("div",{className:"flex justify-between items-start mb-1",children:[t.jsx("span",{className:`text-sm font-semibold ${e.read?"text-gray-800":"text-red-700"}`,children:e.title}),t.jsx("span",{className:"text-[10px] text-gray-400 whitespace-nowrap ml-2",children:v(e.createdAt)})]}),t.jsx("p",{className:`text-xs ${e.read?"text-gray-500":"text-gray-700"}`,children:e.message})]},e.id))})})]}),n&&t.jsx(b,{message:n.message,type:n.type==="SUCCESS"?"success":n.type==="ERROR"?"error":"info",onClose:()=>d(null),duration:5e3})]})};export{y as N};
