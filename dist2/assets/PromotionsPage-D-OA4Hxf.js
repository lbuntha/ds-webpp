import{r,f as u,j as t}from"./index-BjK2osQV.js";import{C as k}from"./Card-DROeE3UG.js";import{B as ee}from"./Button-JCYNVMjR.js";import{I as m}from"./Input-B96Hj4QL.js";import{t as o}from"./toast-DTXa3ATd.js";const F=[{value:"ALL",label:"All Users",description:"No restrictions"},{value:"REGISTERED_LAST_7_DAYS",label:"New Users (Last 7 Days)",description:"Registered within the last 7 days"},{value:"REGISTERED_LAST_MONTH",label:"Recent Users (Last Month)",description:"Registered within the last 30 days"},{value:"REGISTERED_LAST_YEAR",label:"Users (Last Year)",description:"Registered within the last 12 months"},{value:"SPECIFIC_USERS",label:"Specific Users",description:"Select up to 10 users"}],te=()=>{const[E,O]=r.useState([]),[b,$]=r.useState([]),[f,G]=r.useState([]),[M,I]=r.useState(!1),[S,L]=r.useState(""),[j,R]=r.useState(""),[U,q]=r.useState("PERCENTAGE"),[D,A]=r.useState(0),[v,V]=r.useState(new Date().toISOString().split("T")[0]),[C,T]=r.useState(""),[c,_]=r.useState("ALL"),[a,x]=r.useState([]),[i,g]=r.useState(""),[d,y]=r.useState("ALL_PRODUCTS"),[l,h]=r.useState([]),[B,N]=r.useState(null),P=async()=>{const e=await u.getParcelPromotions();O(e)};r.useEffect(()=>{P(),u.getCustomers().then($),u.getParcelServices().then(G)},[]);const H=e=>{if(e){if(a.length>=10){o.warning("Maximum 10 users per promotion.");return}a.includes(e)||x([...a,e])}},Y=e=>{x(a.filter(s=>s!==e))},z=e=>{l.includes(e)?h(l.filter(s=>s!==e)):h([...l,e])},W=async e=>{if(e.preventDefault(),!(!S||!j||!v||!C)){if(c==="SPECIFIC_USERS"&&a.length===0){o.warning("Please select at least one user.");return}if(d==="SPECIFIC_PRODUCTS"&&l.length===0){o.warning("Please select at least one product.");return}I(!0);try{const s={id:`promo-${Date.now()}`,code:S.toUpperCase(),name:j,type:U,value:D,startDate:v,endDate:C,isActive:!0,eligibility:c,productScope:d,...c==="SPECIFIC_USERS"?{allowedUserIds:a}:{},...d==="SPECIFIC_PRODUCTS"?{allowedProductIds:l}:{}};await u.saveParcelPromotion(s),L(""),R(""),A(0),T(""),_("ALL"),x([]),g(""),y("ALL_PRODUCTS"),h([]),await P(),o.success("Promotion created.")}catch(s){console.error(s),o.error("Failed to save promotion.")}finally{I(!1)}}},X=async e=>{try{await u.deleteParcelPromotion(e),await P(),o.success("Promotion deleted.")}catch{o.error("Failed to delete promotion.")}finally{N(null)}},J=e=>{var n;if(e.eligibility==="SPECIFIC_USERS")return`Specific Users (${((n=e.allowedUserIds)==null?void 0:n.length)||0})`;const s=F.find(p=>p.value===e.eligibility);return(s==null?void 0:s.label)||"All Users"},K=e=>{var s;return e.productScope==="SPECIFIC_PRODUCTS"?((s=e.allowedProductIds)==null?void 0:s.map(p=>{const w=f.find(Z=>Z.id===p);return(w==null?void 0:w.name)||p}).join(", "))||"Specific Products":"All Products"},Q=e=>{const s=b.find(n=>n.id===e);return(s==null?void 0:s.name)||e};return t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[t.jsx(k,{title:"Create Promotion",children:t.jsxs("form",{onSubmit:W,className:"space-y-4",children:[t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsx(m,{label:"Promo Code",value:S,onChange:e=>L(e.target.value),placeholder:"SUMMER25",required:!0}),t.jsx(m,{label:"Campaign Name",value:j,onChange:e=>R(e.target.value),placeholder:"Summer Sale",required:!0})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Type"}),t.jsxs("select",{className:"block w-full px-3 py-2 border border-gray-300 rounded-xl shadow-sm focus:outline-none focus:ring-indigo-500 sm:text-sm",value:U,onChange:e=>q(e.target.value),children:[t.jsx("option",{value:"PERCENTAGE",children:"Percentage (%)"}),t.jsx("option",{value:"FIXED_AMOUNT",children:"Fixed Amount ($)"})]})]}),t.jsx(m,{label:"Discount Value",type:"number",value:D,onChange:e=>A(parseFloat(e.target.value)),required:!0})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsx(m,{label:"Start Date",type:"date",value:v,onChange:e=>V(e.target.value),required:!0}),t.jsx(m,{label:"End Date",type:"date",value:C,onChange:e=>T(e.target.value),required:!0})]}),t.jsxs("div",{className:"bg-green-50 p-3 rounded-xl border border-green-100",children:[t.jsx("label",{className:"block text-sm font-medium text-green-800 mb-2",children:"ðŸ“¦ Applies To"}),t.jsxs("div",{className:"flex gap-2 mb-2",children:[t.jsx("button",{type:"button",onClick:()=>{y("ALL_PRODUCTS"),h([])},className:`flex-1 py-2 px-3 rounded-lg text-sm font-medium transition-all ${d==="ALL_PRODUCTS"?"bg-green-600 text-white":"bg-white border border-green-200 text-green-700 hover:bg-green-50"}`,children:"All Products"}),t.jsx("button",{type:"button",onClick:()=>y("SPECIFIC_PRODUCTS"),className:`flex-1 py-2 px-3 rounded-lg text-sm font-medium transition-all ${d==="SPECIFIC_PRODUCTS"?"bg-green-600 text-white":"bg-white border border-green-200 text-green-700 hover:bg-green-50"}`,children:"Specific Products"})]}),d==="SPECIFIC_PRODUCTS"&&t.jsxs("div",{className:"mt-2 space-y-1",children:[f.map(e=>t.jsxs("label",{className:`flex items-center gap-2 p-2 rounded-lg cursor-pointer transition-all ${l.includes(e.id)?"bg-green-100 border border-green-300":"bg-white border border-gray-200 hover:bg-green-50"}`,children:[t.jsx("input",{type:"checkbox",checked:l.includes(e.id),onChange:()=>z(e.id),className:"rounded text-green-600 focus:ring-green-500"}),t.jsx("span",{className:"text-sm font-medium text-gray-900",children:e.name}),t.jsxs("span",{className:"text-xs text-gray-500 ml-auto",children:["$",e.defaultPrice]})]},e.id)),f.length===0&&t.jsx("p",{className:"text-xs text-gray-500 text-center py-2",children:"No services configured"})]})]}),t.jsxs("div",{className:"bg-indigo-50 p-3 rounded-xl border border-indigo-100",children:[t.jsx("label",{className:"block text-sm font-medium text-indigo-800 mb-2",children:"ðŸŽ¯ Target Audience"}),t.jsx("select",{className:"block w-full px-3 py-2 border border-indigo-200 rounded-lg shadow-sm focus:outline-none focus:ring-indigo-500 sm:text-sm bg-white",value:c,onChange:e=>{_(e.target.value),e.target.value!=="SPECIFIC_USERS"&&(x([]),g(""))},children:F.map(e=>t.jsxs("option",{value:e.value,children:[e.label," â€” ",e.description]},e.value))}),c==="SPECIFIC_USERS"&&t.jsxs("div",{className:"mt-3 space-y-2",children:[t.jsxs("div",{className:"relative",children:[t.jsx("input",{type:"text",className:"w-full px-3 py-2 border border-indigo-200 rounded-lg shadow-sm focus:outline-none focus:ring-indigo-500 sm:text-sm bg-white",placeholder:"ðŸ” Search by name or phone...",value:i,onChange:e=>g(e.target.value)}),i.length>=2&&t.jsxs("div",{className:"absolute z-10 w-full mt-1 bg-white border border-indigo-200 rounded-lg shadow-lg max-h-40 overflow-y-auto",children:[b.filter(e=>{var s,n;return!a.includes(e.id)&&(((s=e.name)==null?void 0:s.toLowerCase().includes(i.toLowerCase()))||((n=e.phone)==null?void 0:n.includes(i)))}).slice(0,6).map(e=>t.jsxs("button",{type:"button",className:"w-full px-3 py-2 text-left text-sm hover:bg-indigo-50 flex justify-between items-center border-b border-gray-100 last:border-0",onClick:()=>{H(e.id),g("")},children:[t.jsx("span",{className:"font-medium text-gray-900",children:e.name}),t.jsx("span",{className:"text-xs text-gray-500",children:e.phone})]},e.id)),b.filter(e=>{var s,n;return!a.includes(e.id)&&(((s=e.name)==null?void 0:s.toLowerCase().includes(i.toLowerCase()))||((n=e.phone)==null?void 0:n.includes(i)))}).length===0&&t.jsx("div",{className:"px-3 py-2 text-xs text-gray-500 text-center",children:"No customers found"})]})]}),a.length>0&&t.jsx("div",{className:"flex flex-wrap gap-1",children:a.map(e=>t.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 bg-white border border-indigo-200 rounded-full text-xs font-medium text-indigo-700",children:[Q(e),t.jsx("button",{type:"button",onClick:()=>Y(e),className:"text-indigo-400 hover:text-red-500",children:"Ã—"})]},e))}),t.jsxs("p",{className:"text-[10px] text-indigo-600",children:[a.length,"/10 users selected"]})]})]}),t.jsx("div",{className:"pt-2",children:t.jsx(ee,{type:"submit",isLoading:M,children:"Create Promotion"})})]})}),t.jsx(k,{title:"Active Promotions",children:t.jsxs("div",{className:"space-y-3",children:[E.map(e=>t.jsx("div",{className:"p-3 border border-gray-200 rounded-lg hover:bg-gray-50",children:t.jsxs("div",{className:"flex justify-between items-start",children:[t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"font-mono font-bold bg-gray-100 px-2 py-0.5 rounded text-indigo-600",children:e.code}),t.jsx("span",{className:"text-sm font-medium text-gray-900",children:e.name})]}),t.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[e.type==="PERCENTAGE"?`${e.value}% Off`:`$${e.value} Off`," | Valid: ",e.startDate," to ",e.endDate]}),t.jsxs("div",{className:"flex flex-wrap gap-1 mt-1",children:[t.jsxs("span",{className:"text-[10px] bg-indigo-100 text-indigo-700 px-1.5 py-0.5 rounded font-medium",children:["ðŸŽ¯ ",J(e)]}),t.jsxs("span",{className:"text-[10px] bg-green-100 text-green-700 px-1.5 py-0.5 rounded font-medium",children:["ðŸ“¦ ",K(e)]})]})]}),B===e.id?t.jsxs("div",{className:"flex gap-2",children:[t.jsx("button",{onClick:()=>X(e.id),className:"text-white bg-red-600 hover:bg-red-700 px-2 py-1 rounded text-xs font-bold",children:"Confirm"}),t.jsx("button",{onClick:()=>N(null),className:"text-gray-500 text-xs",children:"Cancel"})]}):t.jsx("button",{onClick:()=>N(e.id),className:"text-red-500 hover:text-red-700 text-sm",children:"Delete"})]})},e.id)),E.length===0&&t.jsx("p",{className:"text-gray-500 text-sm text-center py-4",children:"No promotions active."})]})})]})},oe=()=>t.jsxs("div",{className:"p-6 space-y-6",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"p-2 bg-gradient-to-br from-purple-500 to-indigo-600 rounded-xl",children:t.jsx("svg",{className:"w-6 h-6 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 8v13m0-13V6a4 4 0 00-4-4H5.45a4 4 0 00-3.743 2.596L.312 7.404A1.5 1.5 0 001.5 9.5H8m4-3.5V6a4 4 0 014-4h2.55a4 4 0 013.743 2.596l1.395 2.808A1.5 1.5 0 0122.5 9.5H16"})})}),t.jsxs("div",{children:[t.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Promotions"}),t.jsx("p",{className:"text-sm text-gray-500",children:"Create and manage promotional campaigns"})]})]}),t.jsx(te,{})]});export{oe as default};
