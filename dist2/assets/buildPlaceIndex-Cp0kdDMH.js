import{m as g,n as r,o as h,W as i,H as x}from"./index-BjK2osQV.js";function I(e){if(!e)return[];const a=e.toLowerCase().replace(/[^\u1780-\u17FFa-z0-9\s]/g," ").replace(/\s+/g," ").trim(),n=a.split(" ").filter(o=>o.length>=2),s=new Set;return n.forEach(o=>{s.add(o);for(let t=2;t<=o.length;t++)s.add(o.substring(0,t))}),a.length>=2&&s.add(a),Array.from(s).slice(0,50)}async function w(){const e={total:0,indexed:0,errors:[]};try{console.log("[INDEX] Starting place search index build...");const a=g(r,"place"),n=await h(a);e.total=n.size,console.log(`[INDEX] Found ${e.total} places to index`);const s=400;let o=i(r),t=0;for(const l of n.docs){const c=l.data(),m=c.main_text||c.name||"",f=c.secondary_text||c.description||c.address||"",d=`${m} ${f}`,p=I(d),u=x(r,"place",l.id);o.update(u,{keywords:p,searchIndex:d.toLowerCase()}),t++,e.indexed++,t>=s&&(await o.commit(),console.log(`[INDEX] Committed batch of ${t} places`),o=i(r),t=0)}t>0&&(await o.commit(),console.log(`[INDEX] Committed final batch of ${t} places`)),console.log(`[INDEX] ✅ Complete! Indexed ${e.indexed}/${e.total} places`)}catch(a){e.errors.push(a.message),console.error("[INDEX] ❌ Error:",a)}return e}export{w as buildPlaceSearchIndex,w as default};
