import{r as l,j as e,f as D,u as te,R as ge}from"./index-BjK2osQV.js";import{C as me}from"./Card-DROeE3UG.js";import{C as pe}from"./ChatModal-Bzjxc4YC.js";import{T as he}from"./TrackingTimeline-keA493kc.js";import{M as fe}from"./Modal-B63ndL_a.js";import{B as M}from"./Button-JCYNVMjR.js";import{t as $}from"./toast-DTXa3ATd.js";const ye=({options:n,value:m,onChange:g,placeholder:p="Select...",className:j="",disabled:h=!1})=>{const[y,N]=l.useState(!1),[f,v]=l.useState(""),o=l.useRef(null),i=l.useRef(null),w=n.find(d=>d.value===m);l.useEffect(()=>{const d=b=>{o.current&&!o.current.contains(b.target)&&N(!1)};return document.addEventListener("mousedown",d),()=>document.removeEventListener("mousedown",d)},[]),l.useEffect(()=>{i.current&&(i.current.scrollTop=0)},[f]);const S=n.filter(d=>d.label.toLowerCase().includes(f.toLowerCase())).sort((d,b)=>{const k=f.toLowerCase(),R=d.label.toLowerCase(),T=b.label.toLowerCase(),L=R.startsWith(k),P=T.startsWith(k);return L&&!P?-1:!L&&P?1:R.localeCompare(T)}),E=d=>{g(d),N(!1),v("")};return e.jsxs("div",{className:`relative ${j}`,ref:o,children:[e.jsxs("div",{className:`w-full border border-gray-300 rounded-lg px-3 py-2 bg-white flex justify-between items-center cursor-pointer ${h?"bg-gray-100 cursor-not-allowed":""}`,onClick:()=>!h&&N(!y),children:[e.jsx("span",{className:`block truncate ${w?"text-gray-900":"text-gray-400"}`,children:w?w.label:p}),e.jsx("svg",{className:"w-5 h-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M19 9l-7 7-7-7"})})]}),y&&e.jsxs("div",{className:"absolute z-50 w-full mt-1 bg-white border border-gray-300 rounded-lg shadow-lg max-h-60 overflow-hidden flex flex-col",children:[e.jsx("div",{className:"p-2 border-b border-gray-100",children:e.jsx("input",{type:"text",className:"w-full px-2 py-1 border border-gray-200 rounded text-sm focus:outline-none focus:border-indigo-500",placeholder:"Search...",value:f,onChange:d=>v(d.target.value),onClick:d=>d.stopPropagation(),autoFocus:!0})}),e.jsx("div",{className:"overflow-y-auto flex-1",ref:i,children:S.length>0?S.map(d=>e.jsx("div",{className:`px-4 py-2 cursor-pointer hover:bg-gray-100 text-sm ${d.value===m?"bg-indigo-50 text-indigo-700 font-medium":"text-gray-700"}`,onClick:()=>E(d.value),children:d.label},d.value)):e.jsx("div",{className:"px-4 py-2 text-sm text-gray-500 text-center",children:"No results found"})})]})]})},Ne=({isOpen:n,onClose:m,booking:g,drivers:p,onSuccess:j})=>{const[h,y]=l.useState(""),[N,f]=l.useState(!1),v=async()=>{if(!g||!h)return;const o=p.find(i=>i.id===h);if(o){if(!o.linkedUserId){$.error("This driver does not have a linked user account (UID). Cannot assign jobs to them.");return}f(!0);try{await D.logisticsService.assignBookingDriver(g.id,o.linkedUserId,o.name),$.success("Driver assigned successfully"),j(),m()}catch(i){console.error(i),$.error("Failed to assign driver")}finally{f(!1)}}};return e.jsx(fe,{isOpen:n,onClose:m,title:"Assign Driver",maxWidth:"max-w-lg",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-gray-50 p-3 rounded-lg border border-gray-100",children:[e.jsx("div",{className:"text-xs text-gray-500 uppercase font-bold tracking-wider mb-1",children:"Booking Info"}),e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsx("span",{className:"font-mono",children:g.id.slice(-6).toUpperCase()}),e.jsx("span",{className:"text-gray-600",children:new Date(g.createdAt||g.bookingDate).toLocaleString()})]}),e.jsxs("div",{className:"text-sm mt-1",children:[e.jsx("span",{className:"text-gray-500",children:"Sender:"})," ",e.jsx("span",{className:"font-medium",children:g.senderName})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Select Driver"}),e.jsx(ye,{options:p.sort((o,i)=>o.name.localeCompare(i.name)).map(o=>({value:o.id,label:`${o.name} ${o.vehiclePlateNumber?`(${o.vehiclePlateNumber})`:""}`})),value:h,onChange:o=>y(o),placeholder:"-- Select Driver --"})]}),e.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[e.jsx(M,{variant:"secondary",onClick:m,children:"Cancel"}),e.jsx(M,{variant:"primary",onClick:v,disabled:!h||N,isLoading:N,children:"Confirm Assignment"})]})]})})},ve=({isOpen:n,onClose:m,booking:g,statuses:p,onSuccess:j})=>{const{t:h}=te(),[y,N]=l.useState(g.statusId||""),[f,v]=l.useState(!1),o=async()=>{if(!g||!y)return;v(!0);const i=await D.getCurrentUser(),w=(i==null?void 0:i.name)||"Unknown Staff",S=(i==null?void 0:i.uid)||"uid-unknown";try{await D.updateParcelStatus(g.id,y,S,w),$.success("Status updated successfully"),j(),m()}catch(E){console.error(E),$.error("Failed to update status.")}finally{v(!1)}};return n?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-gray-900 bg-opacity-50 backdrop-blur-sm p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl w-full max-w-sm p-6",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-4",children:"Update Delivery Status"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("p",{className:"text-sm text-gray-600",children:["Move ",e.jsxs("strong",{children:[g.senderName,"'s"]})," parcel to:"]}),e.jsx("div",{className:"space-y-2 max-h-60 overflow-y-auto",children:p.map(i=>e.jsxs("label",{className:`flex items-center p-3 border rounded-lg cursor-pointer hover:bg-gray-50 ${y===i.id?"ring-2 ring-indigo-500 border-indigo-500 bg-indigo-50":"border-gray-200"}`,children:[e.jsx("input",{type:"radio",name:"status",value:i.id,checked:y===i.id,onChange:()=>N(i.id),className:"text-indigo-600 focus:ring-indigo-500"}),e.jsxs("div",{className:"ml-3 flex-1",children:[e.jsx("span",{className:"block text-sm font-medium text-gray-900",children:i.label}),i.triggersRevenue&&e.jsx("span",{className:"text-[10px] text-green-600 font-medium bg-green-50 px-1.5 rounded",children:"Records Revenue"})]})]},i.id))})]}),e.jsxs("div",{className:"flex justify-end space-x-3 mt-6",children:[e.jsx(M,{variant:"outline",onClick:m,children:h("cancel")}),e.jsx(M,{onClick:o,isLoading:f,disabled:f,children:h("save")})]})]})}):null},W=20,ee=[{id:"PENDING",label:"Pending",color:"bg-yellow-100 text-yellow-800",order:1,isDefault:!0,triggersRevenue:!1,isTerminal:!1},{id:"CONFIRMED",label:"Confirmed",color:"bg-blue-100 text-blue-800",order:2,isDefault:!1,triggersRevenue:!1,isTerminal:!1},{id:"PICKED_UP",label:"Picked Up",color:"bg-purple-100 text-purple-800",order:3,isDefault:!1,triggersRevenue:!1,isTerminal:!1},{id:"AT_WAREHOUSE",label:"At Warehouse",color:"bg-indigo-100 text-indigo-800",order:4,isDefault:!1,triggersRevenue:!1,isTerminal:!1},{id:"IN_TRANSIT",label:"In Transit",color:"bg-orange-100 text-orange-800",order:5,isDefault:!1,triggersRevenue:!1,isTerminal:!1},{id:"OUT_FOR_DELIVERY",label:"Out for Delivery",color:"bg-teal-100 text-teal-800",order:6,isDefault:!1,triggersRevenue:!1,isTerminal:!1},{id:"DELIVERED",label:"Delivered",color:"bg-green-100 text-green-800",order:7,isDefault:!1,triggersRevenue:!0,isTerminal:!0},{id:"CANCELLED",label:"Cancelled",color:"bg-red-100 text-red-800",order:8,isDefault:!1,triggersRevenue:!1,isTerminal:!0},{id:"RETURN_TO_SENDER",label:"Return to Sender",color:"bg-red-100 text-red-800",order:9,isDefault:!1,triggersRevenue:!1,isTerminal:!0}],be=()=>{const{t:n}=te(),[m,g]=l.useState([]),[p,j]=l.useState([]),[h,y]=l.useState([]),[N,f]=l.useState([]),[v,o]=l.useState(!1),i=()=>{const t=new Date,r=t.getFullYear(),a=String(t.getMonth()+1).padStart(2,"0"),s=String(t.getDate()).padStart(2,"0");return`${r}-${a}-${s}`},[w,S]=l.useState(""),[E,d]=l.useState(""),[b,k]=l.useState(""),[R,T]=l.useState(i()),[L,P]=l.useState(i()),[K,z]=l.useState({searchTerm:"",customerFilter:"",statusFilter:"",dateFrom:i(),dateTo:i()}),[F,U]=l.useState(1),[B,se]=l.useState(null),[I,Y]=l.useState(null),[V,q]=l.useState(null),[J,re]=l.useState(null),[Q,X]=l.useState(null),[Z,ae]=l.useState(null),le=t=>{ae(r=>r===t?null:t)},_=async()=>{o(!0);try{const[t,r,a,s,x]=await Promise.all([D.getParcelBookings(),D.getParcelStatuses(),D.getCustomers(),D.hrService.getEmployees(),D.getCurrentUser()]);g(t),!r||r.length===0?j(ee):j(r),y(a),f(s),re(x)}catch(t){console.error("Failed to load data",t),j(ee)}finally{o(!1)}};l.useEffect(()=>{_()},[]);const ie=async()=>{z({searchTerm:w,customerFilter:E,statusFilter:b,dateFrom:R,dateTo:L}),U(1),await _()},ne=()=>{const t=i();S(""),d(""),k(""),T(t),P(t),z({searchTerm:"",customerFilter:"",statusFilter:"",dateFrom:t,dateTo:t}),U(1)},A=l.useMemo(()=>{let t=m;const{searchTerm:r,customerFilter:a,statusFilter:s,dateFrom:x,dateTo:u}=K;if(r){const c=r.toLowerCase();t=t.filter(C=>(C.senderName||"").toLowerCase().includes(c)||(C.senderPhone||"").toLowerCase().includes(c)||(C.id||"").toLowerCase().includes(c)||(C.items||[]).some(O=>(O.receiverName||"").toLowerCase().includes(c)||(O.receiverPhone||"").toLowerCase().includes(c)||O.trackingCode&&O.trackingCode.toLowerCase().includes(c)))}return a&&(t=t.filter(c=>c.senderId===a)),s&&(t=t.filter(c=>(c.items||[]).some(C=>(C.status||"PENDING")===s))),x&&(t=t.filter(c=>c.bookingDate>=x)),u&&(t=t.filter(c=>c.bookingDate<=u)),t.sort((c,C)=>(C.createdAt||0)-(c.createdAt||0))},[m,K]),G=l.useMemo(()=>{const t=(F-1)*W;return A.slice(t,t+W)},[A,F]),H=Math.ceil(A.length/W);l.useEffect(()=>{U(1)},[w,E,b,R,L]);const oe=l.useMemo(()=>{const t={};return p.forEach(r=>t[r.id]=0),m.forEach(r=>{(r.items||[]).forEach(a=>{const s=a.status||"PENDING";t[s]=(t[s]||0)+1})}),t},[m,p]),de=t=>{if(!t)return"-";let r=0,a=0;return t.forEach(s=>{const x=Number(s.productPrice)||0;s.codCurrency==="KHR"?a+=x:r+=x}),r===0&&a===0?"-":r>0&&a>0?`$${r.toFixed(2)} + ${a.toLocaleString()}៛`:a>0?`${a.toLocaleString()} ៛`:`$${r.toFixed(2)} `},ce=t=>{if(!t||t.length===0)return"-";let r=0,a=0;return t.forEach(s=>{const x=s;if(x.deliveryFeeUSD&&Number(x.deliveryFeeUSD)>0)r+=Number(x.deliveryFeeUSD);else if(x.deliveryFeeKHR&&Number(x.deliveryFeeKHR)>0)a+=Number(x.deliveryFeeKHR);else{const u=Number(s.deliveryFee)||0;u>0&&(u>=100?a+=u:r+=u)}}),r===0&&a===0?"-":r>0&&a>0?`$${r.toFixed(2)} + ${a.toLocaleString()}៛`:a>0?`${a.toLocaleString()} ៛`:`$${r.toFixed(2)}`},xe=l.useMemo(()=>N.filter(t=>t.isDriver),[N]),ue=t=>{let r=t.status,a=t.statusId;if(t.items&&t.items.length>0){const u=Array.from(new Set(t.items.map(c=>c.status||"PENDING")));u.length===1&&(r=u[0],r!==t.status&&(a=void 0))}if(a){const u=p.find(c=>c.id===a);if(u)return e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-bold ${u.color}`,children:u.label})}const s={PENDING:"bg-yellow-100 text-yellow-800",CONFIRMED:"bg-blue-100 text-blue-800",PICKED_UP:"bg-purple-100 text-purple-800",AT_WAREHOUSE:"bg-indigo-100 text-indigo-800",IN_TRANSIT:"bg-orange-100 text-orange-800",OUT_FOR_DELIVERY:"bg-teal-100 text-teal-800",DELIVERED:"bg-green-100 text-green-800",COMPLETED:"bg-green-100 text-green-800",CANCELLED:"bg-red-100 text-red-800",RETURN_TO_SENDER:"bg-red-100 text-red-800"},x=r.replace(/_/g," ");return e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-bold whitespace-nowrap ${s[r]||"bg-gray-100"}`,children:x})};return e.jsxs(me,{title:n("parcel_list"),children:[e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-3 mb-6",children:p.map(t=>{const r=oe[t.id]||0,a=b===t.id;return e.jsx("div",{onClick:()=>k(a?"":t.id),className:`p-3 rounded-xl border cursor-pointer transition-all duration-200 ${a?"ring-2 ring-indigo-500 border-indigo-500 shadow-md transform scale-105":"border-gray-100 bg-white hover:border-indigo-200 hover:shadow-sm"}`,children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:`text-[10px] uppercase font-bold tracking-wider mb-1 ${a?"text-indigo-700":"text-gray-500"}`,children:t.label}),e.jsxs("div",{className:"flex items-end justify-between",children:[e.jsx("span",{className:`text-2xl font-bold leading-none ${a?"text-indigo-900":"text-gray-900"}`,children:r}),e.jsx("div",{className:`w-2 h-2 rounded-full ${t.color.split(" ")[0].replace("text-","bg-")}`})]})]})},t.id)})}),e.jsxs("div",{className:"mb-6 space-y-4 bg-gray-50 p-4 rounded-xl border border-gray-100",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4",children:[e.jsxs("div",{className:"lg:col-span-1",children:[e.jsx("label",{className:"block text-xs font-bold text-gray-500 mb-1",children:n("search")}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",placeholder:n("search_placeholder"),className:"w-full pl-8 pr-3 py-2 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 text-sm",value:w,onChange:t=>S(t.target.value)}),e.jsx("svg",{className:"w-4 h-4 text-gray-400 absolute left-2.5 top-2.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-gray-500 mb-1",children:n("customer")}),e.jsxs("select",{className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 text-sm",value:E,onChange:t=>d(t.target.value),children:[e.jsx("option",{value:"",children:n("all_customers")}),h.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-gray-500 mb-1",children:n("status")}),e.jsxs("select",{className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 text-sm",value:b,onChange:t=>k(t.target.value),children:[e.jsx("option",{value:"",children:n("all_statuses")}),p.map(t=>e.jsx("option",{value:t.id,children:t.label},t.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-gray-500 mb-1",children:n("from_date")}),e.jsx("input",{type:"date",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 text-sm",value:R,onChange:t=>T(t.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-gray-500 mb-1",children:n("to_date")}),e.jsx("input",{type:"date",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 text-sm",value:L,onChange:t=>P(t.target.value)})]})]}),e.jsxs("div",{className:"flex justify-between items-center pt-2",children:[e.jsxs("p",{className:"text-xs text-gray-500",children:[n("showing")," ",G.length," / ",A.length]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("button",{onClick:ie,disabled:v,className:"bg-indigo-600 hover:bg-indigo-700 disabled:bg-indigo-400 text-white text-xs font-bold py-2 px-4 rounded transition-colors flex items-center gap-2",children:v?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"animate-spin h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Filtering..."]}):"Filter"}),e.jsx("button",{onClick:ne,className:"text-xs text-red-600 hover:text-red-800 font-medium hover:underline",children:n("reset_filters")})]})]})]}),v?e.jsx("div",{className:"text-center py-12 text-gray-500",children:n("loading")}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:n("date")}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:n("sender")}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:n("service")}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Notes"}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase",children:n("items")}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"COD"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:n("fee")}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase",children:n("status")}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:n("actions")})]})}),e.jsxs("tbody",{className:"bg-white divide-y divide-gray-200",children:[G.map(t=>{var r,a;return e.jsxs(ge.Fragment,{children:[e.jsxs("tr",{className:`hover:bg-gray-50 transition-colors cursor-pointer ${Z===t.id?"bg-indigo-50/50":""}`,onClick:()=>le(t.id),children:[e.jsxs("td",{className:"px-6 py-4 text-nowrap text-sm text-gray-500",children:[e.jsx("div",{className:"font-bold text-gray-900",children:new Date(t.createdAt||t.bookingDate).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})}),e.jsxs("div",{className:"text-[10px] text-gray-400",children:[new Date(t.createdAt||t.bookingDate).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"})," • ",t.id.slice(-6).toUpperCase()]})]}),e.jsxs("td",{className:"px-6 py-4 text-sm font-medium text-gray-900",children:[e.jsx("span",{className:"text-gray-900 font-bold",children:t.senderName}),e.jsx("div",{className:"text-xs text-gray-500",children:t.senderPhone})]}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-700",children:e.jsx("div",{children:((a=(r=t.items)==null?void 0:r[0])==null?void 0:a.serviceName)||"Standard"})}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-500 max-w-[150px] truncate",title:t.notes,children:t.notes||"-"}),e.jsxs("td",{className:"px-6 py-4 text-center text-sm text-gray-600",children:[e.jsx("div",{className:"font-bold",children:(t.items||[]).length}),(t.items||[]).length===1&&t.items[0].trackingCode&&e.jsx("div",{className:"text-[10px] font-mono text-gray-400 mt-0.5",children:t.items[0].trackingCode})]}),e.jsx("td",{className:"px-6 py-4 text-right text-sm font-medium text-red-600 whitespace-nowrap",children:de(t.items)}),e.jsx("td",{className:"px-6 py-4 text-right text-sm font-bold text-indigo-600 whitespace-nowrap",children:ce(t.items)}),e.jsx("td",{className:"px-6 py-4 text-center",children:ue(t)}),e.jsx("td",{className:"px-6 py-4 text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{onClick:s=>{s.stopPropagation(),X(t)},className:"text-gray-600 hover:text-gray-900 text-xs font-medium border border-gray-200 px-2 py-1 rounded hover:bg-gray-50",title:"View Details",children:n("view")}),t.status==="PENDING"&&e.jsx("button",{onClick:s=>{s.stopPropagation(),q(t)},className:"text-indigo-600 hover:text-indigo-900 text-xs font-medium border border-indigo-200 px-2 py-1 rounded hover:bg-indigo-50",title:"Assign Driver",children:"Assign"})]})})]}),Z===t.id&&e.jsx("tr",{children:e.jsx("td",{colSpan:8,className:"px-0 py-0 border-b border-gray-200 bg-indigo-50/30",children:e.jsx("div",{className:"pl-12 pr-4 py-3",children:e.jsx("div",{className:"rounded-lg border border-gray-200 overflow-hidden bg-white shadow-sm",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Images"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Barcode"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Driver"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Receiver"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Phone"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Destination"}),e.jsx("th",{className:"px-4 py-2 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"COD"}),e.jsx("th",{className:"px-4 py-2 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Updated"}),e.jsx("th",{className:"px-4 py-2 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-4 py-2 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Chat"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:(t.items||[]).filter(s=>!b||(s.status||"PENDING")===b).map((s,x)=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-2 text-sm",children:e.jsxs("div",{className:"flex gap-2",children:[s.image&&e.jsx("a",{href:s.image,target:"_blank",rel:"noopener noreferrer",className:"block w-8 h-8 rounded bg-gray-100 border border-gray-200 overflow-hidden hover:opacity-80 transition-opacity",title:"Parcel Image",children:e.jsx("img",{src:s.image,alt:"Parcel",className:"w-full h-full object-cover"})}),s.proofOfDelivery?e.jsx("a",{href:s.proofOfDelivery,target:"_blank",rel:"noopener noreferrer",className:"block w-8 h-8 rounded bg-green-50 border border-green-200 overflow-hidden hover:opacity-80 transition-opacity",title:"Proof of Delivery",children:e.jsx("img",{src:s.proofOfDelivery,alt:"POD",className:"w-full h-full object-cover"})}):s.status==="DELIVERED"&&e.jsx("div",{className:"w-8 h-8 rounded bg-red-50 border border-red-200 flex items-center justify-center",title:"Missing Proof of Delivery",children:e.jsxs("span",{className:"text-[10px] text-red-500 font-bold leading-none text-center",children:["No",e.jsx("br",{}),"POD"]})}),!s.image&&!s.proofOfDelivery&&s.status!=="DELIVERED"&&e.jsx("span",{className:"text-gray-300 text-xs italic",children:"No img"})]})}),e.jsx("td",{className:"px-4 py-2 text-sm font-mono text-gray-600",children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-gray-300"}),s.barcode||s.trackingCode||"-"]})}),e.jsx("td",{className:"px-4 py-2 text-sm text-gray-900",children:s.driverName||t.driverName||e.jsx("span",{className:"text-gray-400 italic",children:"Unassigned"})}),e.jsx("td",{className:"px-4 py-2 text-sm text-gray-900 font-medium",children:s.receiverName}),e.jsx("td",{className:"px-4 py-2 text-sm text-gray-500",children:s.receiverPhone}),e.jsx("td",{className:"px-4 py-2 text-sm text-gray-500 truncate max-w-[150px]",title:s.destinationAddress,children:s.destinationAddress}),e.jsx("td",{className:"px-4 py-2 text-right text-sm font-medium text-red-600",children:s.productPrice>0?s.codCurrency==="KHR"?`${s.productPrice.toLocaleString()} ៛`:`$${s.productPrice.toFixed(2)}`:"-"}),e.jsx("td",{className:"px-4 py-2 text-center text-xs text-gray-500 whitespace-nowrap",children:s.modifications&&s.modifications.length>0?new Date(s.modifications[s.modifications.length-1].timestamp).toLocaleString():t.statusHistory&&t.statusHistory.length>0?new Date(t.statusHistory[t.statusHistory.length-1].timestamp).toLocaleString():"-"}),e.jsx("td",{className:"px-4 py-2 text-center",children:e.jsx("span",{className:`px-2 py-0.5 rounded-full text-[10px] font-bold ${(s.status||"PENDING")==="DELIVERED"?"bg-green-100 text-green-800":(s.status||"PENDING")==="CANCELLED"?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"}`,children:(s.status||t.status||"PENDING").replace(/_/g," ")})}),e.jsx("td",{className:"px-4 py-2 text-center",children:e.jsx("button",{onClick:async u=>{u.stopPropagation(),await D.getCurrentUser();const c=s.driverName||t.senderName||"Unknown";Y({itemId:s.id,bookingId:t.id,itemName:s.trackingCode?`${s.trackingCode} - ${s.receiverName}`:s.receiverName,recipientName:c,recipientId:s.driverId||void 0})},disabled:["DELIVERED","RETURN_TO_SENDER"].includes(s.status||""),className:`transition-colors p-1 rounded-full ${["DELIVERED","RETURN_TO_SENDER"].includes(s.status||"")?"text-gray-200 cursor-not-allowed":"text-gray-400 hover:text-indigo-600 hover:bg-indigo-50"}`,title:["DELIVERED","RETURN_TO_SENDER"].includes(s.status||"")?"Chat disabled for completed orders":"Chat / Comment",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})})})})]},x))})]})})})})})]},t.id)}),G.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:8,className:"text-center py-8 text-gray-500",children:"No bookings found matching your criteria."})})]})]})}),H>1&&e.jsxs("div",{className:"flex justify-center gap-2 pt-4",children:[e.jsx("button",{disabled:F===1,onClick:()=>U(t=>t-1),className:"px-3 py-1 rounded border hover:bg-gray-50 disabled:opacity-50 text-sm",children:"Prev"}),e.jsxs("span",{className:"px-3 py-1 text-sm text-gray-600 flex items-center",children:["Page ",F," of ",H]}),e.jsx("button",{disabled:F===H,onClick:()=>U(t=>t+1),className:"px-3 py-1 rounded border hover:bg-gray-50 disabled:opacity-50 text-sm",children:"Next"})]}),B&&e.jsx(ve,{isOpen:!!B,onClose:()=>se(null),booking:B,statuses:p,onSuccess:_}),Q&&e.jsx(he,{booking:Q,onClose:()=>X(null)}),I&&J&&e.jsx(pe,{itemId:I.itemId,bookingId:I.bookingId,itemName:I.itemName,currentUser:J,recipientName:I.recipientName,recipientId:I.recipientId,onClose:()=>Y(null)}),V&&e.jsx(Ne,{isOpen:!!V,onClose:()=>q(null),booking:V,drivers:xe,onSuccess:_})]})};function Re(){return e.jsx(be,{})}export{Re as default};
