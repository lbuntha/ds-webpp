import{h as k,r,f as p,A,i as P,j as s}from"./index-BjK2osQV.js";import{C as L}from"./Card-DROeE3UG.js";import{B as o}from"./Button-JCYNVMjR.js";import{I as h}from"./Input-B96Hj4QL.js";import{g as w}from"./errorUtils-CUS756ws.js";import{P as U}from"./plus-mb1_Xzfx.js";import{S as q}from"./save-BRQs9RZD.js";import{P as H,T as B}from"./trash-2-D4W_Kkj6.js";import"./createLucideIcon-D09dZYGY.js";function G(){const{accounts:c,taxRates:g}=k(),[f,S]=r.useState([]),[T,j]=r.useState(!0),[E,l]=r.useState(!1),[y,d]=r.useState(null),[b,m]=r.useState(!1),[a,t]=r.useState({});r.useEffect(()=>{u()},[]);const u=async()=>{try{j(!0);const e=await p.financeService.getExpenseTemplates();S(e||[])}catch(e){console.error(e),d("Failed to load templates")}finally{j(!1)}},x=e=>{t(e||{currency:"USD",fixedAmount:0}),m(!0),d(null)},C=async e=>{if(e.preventDefault(),d(null),!a.name||!a.debitAccountId||!a.creditAccountId){d("Name, Expense Account, and Payment Account are required.");return}try{l(!0);const n={id:a.id||`ext-${Date.now()}`,name:a.name,description:a.description||"",debitAccountId:a.debitAccountId,creditAccountId:a.creditAccountId,taxRateId:a.taxRateId,fixedAmount:a.fixedAmount,currency:a.currency||"USD",createdAt:a.createdAt||Date.now(),updatedAt:Date.now()};await p.financeService.saveExpenseTemplate(n),await u(),m(!1)}catch(n){d(w(n))}finally{l(!1)}},I=async e=>{if(confirm("Are you sure you want to delete this template?"))try{l(!0),await p.financeService.deleteExpenseTemplate(e),await u()}catch(n){d(w(n))}finally{l(!1)}},D=c.filter(e=>e.type===A.EXPENSE&&!e.isHeader),R=c.filter(e=>e.type===A.ASSET&&(e.subType===P.CURRENT_ASSET||e.name.toLowerCase().includes("cash")||e.name.toLowerCase().includes("bank"))&&!e.isHeader);return T?s.jsx("div",{children:"Loading..."}):s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"Expense Templates"}),s.jsxs(o,{onClick:()=>x(),children:[s.jsx(U,{className:"w-4 h-4 mr-2"}),"New Template"]})]}),y&&s.jsx("div",{className:"bg-red-50 text-red-600 p-4 rounded-lg",children:y}),b&&s.jsx(L,{title:a.id?"Edit Template":"New Expense Template",children:s.jsxs("form",{onSubmit:C,className:"space-y-4",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsx(h,{label:"Template Name",value:a.name||"",onChange:e=>t({...a,name:e.target.value}),required:!0}),s.jsx(h,{label:"Description",value:a.description||"",onChange:e=>t({...a,description:e.target.value})})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Expense Account (Debit)"}),s.jsxs("select",{className:"w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500",value:a.debitAccountId||"",onChange:e=>t({...a,debitAccountId:e.target.value}),required:!0,children:[s.jsx("option",{value:"",children:"Select Expense Account"}),D.map(e=>s.jsxs("option",{value:e.id,children:[e.code," - ",e.name," (",e.currency,")"]},e.id))]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Payment Account (Credit)"}),s.jsxs("select",{className:"w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500",value:a.creditAccountId||"",onChange:e=>t({...a,creditAccountId:e.target.value}),required:!0,children:[s.jsx("option",{value:"",children:"Select Bank/Cash Account"}),R.map(e=>s.jsxs("option",{value:e.id,children:[e.code," - ",e.name," (",e.currency,")"]},e.id))]})]})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Default Tax Rate"}),s.jsxs("select",{className:"w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500",value:a.taxRateId||"",onChange:e=>t({...a,taxRateId:e.target.value}),children:[s.jsx("option",{value:"",children:"No Tax"}),g.map(e=>s.jsxs("option",{value:e.id,children:[e.name," (",e.rate,"%)"]},e.id))]})]}),s.jsxs("div",{className:"md:col-span-1",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Default Currency"}),s.jsxs("select",{className:"w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500",value:a.currency||"USD",onChange:e=>t({...a,currency:e.target.value}),children:[s.jsx("option",{value:"USD",children:"USD"}),s.jsx("option",{value:"KHR",children:"KHR"})]})]}),s.jsx(h,{label:"Default Amount (Optional)",type:"number",value:a.fixedAmount||"",onChange:e=>t({...a,fixedAmount:parseFloat(e.target.value)})})]}),s.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[s.jsx(o,{type:"button",variant:"outline",onClick:()=>m(!1),children:"Cancel"}),s.jsxs(o,{type:"submit",isLoading:E,children:[s.jsx(q,{className:"w-4 h-4 mr-2"}),"Save Template"]})]})]})}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[f.map(e=>{var n,v,N;return s.jsxs("div",{className:"bg-white p-4 rounded-xl border border-gray-200 shadow-sm hover:shadow-md transition-shadow",children:[s.jsxs("div",{className:"flex justify-between items-start mb-2",children:[s.jsx("h3",{className:"font-bold text-gray-900",children:e.name}),s.jsxs("div",{className:"flex gap-1",children:[s.jsx("button",{onClick:()=>x(e),className:"p-1 text-gray-500 hover:text-indigo-600 rounded",children:s.jsx(H,{className:"w-4 h-4"})}),s.jsx("button",{onClick:()=>I(e.id),className:"p-1 text-gray-500 hover:text-red-600 rounded",children:s.jsx(B,{className:"w-4 h-4"})})]})]}),s.jsx("p",{className:"text-sm text-gray-500 mb-3",children:e.description||"No description"}),s.jsxs("div",{className:"space-y-1 text-xs bg-gray-50 p-2 rounded",children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-gray-500",children:"Expense:"}),s.jsx("span",{className:"font-medium",children:((n=c.find(i=>i.id===e.debitAccountId))==null?void 0:n.name)||e.debitAccountId})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-gray-500",children:"Payment:"}),s.jsx("span",{className:"font-medium",children:((v=c.find(i=>i.id===e.creditAccountId))==null?void 0:v.name)||e.creditAccountId})]}),e.taxRateId&&s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-gray-500",children:"Tax:"}),s.jsx("span",{className:"font-medium",children:(N=g.find(i=>i.id===e.taxRateId))==null?void 0:N.name})]})]})]},e.id)}),f.length===0&&!b&&s.jsxs("div",{className:"col-span-full py-12 text-center text-gray-500 bg-gray-50 rounded-xl border border-dashed border-gray-300",children:[s.jsx("p",{children:"No expense templates defined yet."}),s.jsx(o,{variant:"outline",onClick:()=>x(),children:"Create your first template"})]})]})]})}export{G as default};
