const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/cleanupUserData-DPGEBqDE.js","assets/index-BjK2osQV.js","assets/index-CY9_X8xj.css","assets/migratePlaces-BxQBYRhi.js","assets/buildPlaceIndex-Cp0kdDMH.js"])))=>i.map(i=>d[i]);
import{r,j as e,A as D,f as R,g as Wt,R as vt,ab as gt,ac as $t,u as Gt,i as L,_ as je,Z as yt,a as Vt,h as Yt}from"./index-BjK2osQV.js";import{C as H}from"./Card-DROeE3UG.js";import{B as v}from"./Button-JCYNVMjR.js";import{A as qt}from"./AccountForm-C9r7hRgr.js";import{t as g}from"./toast-DTXa3ATd.js";import{I as O}from"./Input-B96Hj4QL.js";import{D as Xt}from"./DriverCommissionSetup-C_eSK9sN.js";import{M as zt}from"./MenuBuilder-K_AsvTyB.js";import{M as Zt}from"./Modal-B63ndL_a.js";import"./ImageUpload-CVnIZI_m.js";import"./MenuIcon-DZT_vwr1.js";const Qt=({accounts:t,transactions:x=[],onEdit:d,onDelete:c})=>{const[p,i]=r.useState(""),[b,a]=r.useState("ALL"),[y,u]=r.useState(null),[m,o]=r.useState(null),C=r.useMemo(()=>{const l=new Set;return(x||[]).forEach(N=>{N.lines.forEach(w=>l.add(w.accountId))}),l},[x]),f=l=>{if(!c)return;if(t.some(A=>A.parentAccountId===l.id)){g.warning("Cannot delete this account because it has sub-accounts attached. Please delete or re-parent the sub-accounts first.");return}const w=(x||[]).filter(A=>A.lines.some(M=>M.accountId===l.id)).length;o({account:l,usageCount:w})},h=async()=>{if(!m||!c)return;const l=m.account.id;u(l);try{await c(l),o(null),g.success("Account deleted.")}catch(N){g.error(`Failed to delete account: ${N.message}`)}finally{u(null)}},j=r.useMemo(()=>t.filter(l=>{const N=(l.code||"").toLowerCase().includes(p.toLowerCase())||(l.name||"").toLowerCase().includes(p.toLowerCase()),w=b==="ALL"||l.type===b;return N&&w}).sort((l,N)=>l.code.localeCompare(N.code)),[t,p,b]);return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between md:items-center gap-4",children:[e.jsxs("div",{className:"relative w-full md:w-64",children:[e.jsx("input",{type:"text",placeholder:"Search code or name...",className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-xl focus:ring-indigo-500 focus:border-indigo-500 shadow-sm text-sm",value:p,onChange:l=>i(l.target.value)}),e.jsx("svg",{className:"w-5 h-5 text-gray-400 absolute left-3 top-2.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})]}),e.jsx("div",{className:"w-full md:w-auto",children:e.jsxs("select",{className:"block w-full px-3 py-2 border border-gray-300 rounded-xl shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 text-sm",value:b,onChange:l=>a(l.target.value),children:[e.jsx("option",{value:"ALL",children:"All Account Types"}),Object.values(D).map(l=>e.jsx("option",{value:l,children:l},l))]})})]}),e.jsx("div",{className:"overflow-x-auto border border-gray-200 rounded-xl shadow-sm bg-white",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Code"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Name"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Type"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Sub-Type"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Currency"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Action"})]})}),e.jsxs("tbody",{className:"divide-y divide-gray-200 bg-white",children:[j.map(l=>{const N=C.has(l.id);return e.jsxs("tr",{className:`hover:bg-gray-50 ${l.isHeader?"bg-gray-50/80":""}`,children:[e.jsx("td",{className:"px-4 py-2 text-sm font-mono text-gray-600 align-middle",children:l.code}),e.jsx("td",{className:"px-4 py-2 text-sm text-gray-900 align-middle",children:e.jsxs("div",{style:{paddingLeft:l.parentAccountId?"20px":"0px"},className:"flex items-center",children:[l.parentAccountId&&e.jsx("span",{className:"text-gray-300 mr-2",children:"â†³"}),e.jsx("span",{className:l.isHeader?"font-semibold":"",children:l.name}),l.isHeader&&e.jsx("span",{className:"ml-2 text-[10px] bg-gray-200 text-gray-600 px-1.5 py-0.5 rounded border border-gray-300 uppercase",children:"Header"})]})}),e.jsx("td",{className:"px-4 py-2 text-sm align-middle",children:e.jsx("span",{className:`px-2 py-0.5 inline-flex text-xs leading-5 font-semibold rounded-full border ${l.type==="Asset"?"bg-green-50 text-green-700 border-green-200":l.type==="Liability"?"bg-red-50 text-red-700 border-red-200":l.type==="Equity"?"bg-blue-50 text-blue-700 border-blue-200":l.type==="Revenue"?"bg-teal-50 text-teal-700 border-teal-200":"bg-orange-50 text-orange-700 border-orange-200"}`,children:l.type})}),e.jsx("td",{className:"px-4 py-2 text-sm text-gray-500 align-middle",children:l.subType}),e.jsx("td",{className:"px-4 py-2 text-sm text-gray-500 align-middle font-medium",children:l.currency||"USD"}),e.jsxs("td",{className:"px-4 py-2 text-sm text-right font-medium space-x-2 align-middle",children:[e.jsx("button",{onClick:()=>d(l),className:"text-indigo-600 hover:text-indigo-900 hover:bg-indigo-50 px-2 py-1 rounded transition-colors",children:"Edit"}),c&&e.jsx("button",{onClick:()=>f(l),className:`text-xs px-2 py-1 rounded border transition-colors ${N?"text-orange-600 border-orange-200 hover:bg-orange-50":"text-red-600 border-transparent hover:border-red-200 hover:bg-red-50"}`,disabled:y===l.id,title:N?"Warning: Account is used in transactions":"Delete Account",children:y===l.id?"...":"Delete"})]})]},l.id)}),j.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"px-4 py-8 text-center text-gray-500 text-sm",children:"No accounts found matching your criteria."})})]})]})}),m&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-gray-900 bg-opacity-50 backdrop-blur-sm p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl w-full max-w-sm p-6 animate-fade-in-up",children:[e.jsx("div",{className:"flex justify-center mb-4",children:e.jsx("div",{className:"bg-red-100 p-3 rounded-full",children:e.jsx("svg",{className:"w-8 h-8 text-red-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})}),e.jsx("h3",{className:"text-lg font-bold text-gray-900 text-center mb-2",children:"Delete Account?"}),e.jsxs("p",{className:"text-center text-gray-600 mb-4 text-sm",children:["Are you sure you want to delete ",e.jsxs("strong",{children:[m.account.code," - ",m.account.name]}),"?"]}),m.usageCount>0&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3 mb-4 text-left",children:[e.jsx("p",{className:"text-xs font-bold text-red-800 mb-1",children:"WARNING:"}),e.jsxs("p",{className:"text-xs text-red-700",children:["This account is used in ",e.jsxs("strong",{children:[m.usageCount," transaction(s)"]}),". Deleting it will cause reporting errors."]})]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx(v,{variant:"outline",onClick:()=>o(null),className:"w-full justify-center",children:"Cancel"}),e.jsx(v,{variant:"danger",onClick:h,className:"w-full justify-center bg-red-600 hover:bg-red-700 text-white",isLoading:!!y,children:m.usageCount>0?"Force Delete":"Confirm"})]})]})})]})},Jt=({initialData:t,onSave:x,onCancel:d})=>{const[c,p]=r.useState((t==null?void 0:t.name)||""),[i,b]=r.useState((t==null?void 0:t.code)||""),[a,y]=r.useState(!1),u=async m=>{if(m.preventDefault(),!(!c||!i)){y(!0);try{await x({id:(t==null?void 0:t.id)||`br-${Date.now()}`,name:c,code:i})}catch(o){console.error(o),g.error("Failed to save branch")}finally{y(!1)}}};return e.jsx(H,{title:t?"Edit Branch / Warehouse":"Add New Branch / Warehouse",children:e.jsxs("form",{onSubmit:u,className:"space-y-4",children:[e.jsx(O,{label:"Name (Warehouse/Branch)",value:c,onChange:m=>p(m.target.value),placeholder:"e.g. West Side Warehouse",required:!0}),e.jsx(O,{label:"Code",value:i,onChange:m=>b(m.target.value),placeholder:"e.g. WH-01",required:!0}),e.jsxs("div",{className:"flex justify-end space-x-2 pt-4",children:[e.jsx(v,{type:"button",variant:"outline",onClick:d,children:"Cancel"}),e.jsx(v,{type:"submit",isLoading:a,children:"Save Location"})]})]})})},es=({initialData:t,onSave:x,onCancel:d})=>{const[c,p]=r.useState((t==null?void 0:t.code)||""),[i,b]=r.useState((t==null?void 0:t.name)||""),[a,y]=r.useState((t==null?void 0:t.symbol)||""),[u,m]=r.useState((t==null?void 0:t.exchangeRate)||1),[o,C]=r.useState(!1),f=async h=>{if(h.preventDefault(),!(!c||!i||!a)){C(!0);try{await x({id:(t==null?void 0:t.id)||`curr-${c.toLowerCase()}`,code:c,name:i,symbol:a,exchangeRate:u,isBase:(t==null?void 0:t.isBase)||!1})}catch(j){console.error(j),g.error("Failed to save currency")}finally{C(!1)}}};return e.jsx(H,{title:t?"Edit Currency":"Add New Currency",children:e.jsxs("form",{onSubmit:f,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(O,{label:"Currency Code",value:c,onChange:h=>p(h.target.value.toUpperCase()),placeholder:"e.g. EUR",required:!0,disabled:t==null?void 0:t.isBase}),e.jsx(O,{label:"Symbol",value:a,onChange:h=>y(h.target.value),placeholder:"e.g. â‚¬",required:!0})]}),e.jsx(O,{label:"Currency Name",value:i,onChange:h=>b(h.target.value),placeholder:"e.g. Euro",required:!0}),e.jsx(O,{label:"Exchange Rate (vs Base USD)",type:"number",step:"any",value:u,onChange:h=>m(parseFloat(h.target.value)),required:!0,disabled:t==null?void 0:t.isBase}),(t==null?void 0:t.isBase)&&e.jsx("p",{className:"text-xs text-gray-500",children:"Base currency (USD) cannot have its code or rate changed."}),e.jsxs("div",{className:"flex justify-end space-x-2 pt-4",children:[e.jsx(v,{type:"button",variant:"outline",onClick:d,children:"Cancel"}),e.jsx(v,{type:"submit",isLoading:o,children:"Save Currency"})]})]})})},ts=({initialData:t,onSave:x,onCancel:d})=>{const[c,p]=r.useState((t==null?void 0:t.name)||""),[i,b]=r.useState((t==null?void 0:t.code)||""),[a,y]=r.useState((t==null?void 0:t.rate)||0),[u,m]=r.useState(!1),o=async C=>{if(C.preventDefault(),!(!c||!i)){m(!0);try{await x({id:(t==null?void 0:t.id)||`tax-${Date.now()}`,name:c,code:i,rate:a})}catch(f){console.error(f),g.error("Failed to save tax rate")}finally{m(!1)}}};return e.jsx(H,{title:t?"Edit Tax Rate":"Add New Tax Rate",children:e.jsxs("form",{onSubmit:o,className:"space-y-4",children:[e.jsx(O,{label:"Tax Name",value:c,onChange:C=>p(C.target.value),placeholder:"e.g. VAT 10%",required:!0}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(O,{label:"Tax Code",value:i,onChange:C=>b(C.target.value.toUpperCase()),placeholder:"e.g. VAT-10",required:!0}),e.jsx(O,{label:"Rate (%)",type:"number",step:"0.01",value:a,onChange:C=>y(parseFloat(C.target.value)),required:!0})]}),e.jsxs("div",{className:"flex justify-end space-x-2 pt-4",children:[e.jsx(v,{type:"button",variant:"outline",onClick:d,children:"Cancel"}),e.jsx(v,{type:"submit",isLoading:u,children:"Save Tax Rate"})]})]})})},ss=()=>{const[t,x]=r.useState([]),[d,c]=r.useState(!1),[p,i]=r.useState(null),[b,a]=r.useState(""),[y,u]=r.useState("FIRST_ORDER"),[m,o]=r.useState(1),[C,f]=r.useState(0),[h,j]=r.useState(0),[l,N]=r.useState("USD"),[w,A]=r.useState(0),[M,T]=r.useState("USD"),[S,I]=r.useState(!0),[ce,K]=r.useState(null),W=async()=>{c(!0);try{const n=await R.getReferralRules();x(n)}catch(n){console.error(n)}finally{c(!1)}};r.useEffect(()=>{W()},[]);const $=()=>{i(null),a(""),u("FIRST_ORDER"),o(1),f(0),j(0),A(0),I(!0)},G=n=>{i(n.id),a(n.name),u(n.trigger),o(n.milestoneCount||1),f(n.expiryDays||0),j(n.referrerAmount),N(n.referrerCurrency),A(n.refereeAmount),T(n.refereeCurrency),I(n.isActive),window.scrollTo({top:0,behavior:"smooth"})},V=async n=>{if(n.preventDefault(),!!b){c(!0);try{const Y={id:p||`rule-${Date.now()}`,name:b,isActive:S,trigger:y,milestoneCount:y==="ORDER_MILESTONE"?m:1,expiryDays:C,referrerAmount:h,referrerCurrency:l,refereeAmount:w,refereeCurrency:M};await R.saveReferralRule(Y),$(),await W(),g.success(p?"Rule updated.":"Rule created.")}catch{g.error("Failed to save rule")}finally{c(!1)}}},de=async n=>{try{await R.deleteReferralRule(n),await W(),g.success("Rule deleted.")}catch{g.error("Failed to delete rule.")}finally{K(null)}};return e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-1",children:e.jsx(H,{title:p?"Edit Rule":"Create Referral Rule",children:e.jsxs("form",{onSubmit:V,className:"space-y-4",children:[e.jsx(O,{label:"Rule Name",value:b,onChange:n=>a(n.target.value),placeholder:"e.g. First Order Bonus",required:!0}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Trigger Event"}),e.jsxs("select",{className:"block w-full px-3 py-2 border rounded-lg text-sm",value:y,onChange:n=>u(n.target.value),children:[e.jsx("option",{value:"FIRST_ORDER",children:"Referee's First Order"}),e.jsx("option",{value:"ORDER_MILESTONE",children:"Order Milestone (e.g. 5th)"})]})]}),y==="ORDER_MILESTONE"&&e.jsx(O,{label:"Milestone Count",type:"number",value:m,onChange:n=>o(Number(n.target.value))}),e.jsx(O,{label:"Expiry (Days from Signup)",type:"number",value:C,onChange:n=>f(Number(n.target.value)),placeholder:"0 = No Expiry"}),e.jsx("p",{className:"text-xs text-gray-500 -mt-2",children:"Order must be completed within this many days of user registration."}),e.jsxs("div",{className:"bg-indigo-50 p-3 rounded-lg border border-indigo-100 space-y-3",children:[e.jsx("p",{className:"text-xs font-bold text-indigo-800 uppercase",children:"Referrer Reward (Existing User)"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{className:"flex-1 border rounded-lg px-2 py-1 text-sm",type:"number",value:h,onChange:n=>j(parseFloat(n.target.value))}),e.jsxs("select",{className:"border rounded-lg px-2 py-1 text-sm",value:l,onChange:n=>N(n.target.value),children:[e.jsx("option",{value:"USD",children:"USD"}),e.jsx("option",{value:"KHR",children:"KHR"})]})]})]}),e.jsxs("div",{className:"bg-green-50 p-3 rounded-lg border border-green-100 space-y-3",children:[e.jsx("p",{className:"text-xs font-bold text-green-800 uppercase",children:"Referee Reward (New User)"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{className:"flex-1 border rounded-lg px-2 py-1 text-sm",type:"number",value:w,onChange:n=>A(parseFloat(n.target.value))}),e.jsxs("select",{className:"border rounded-lg px-2 py-1 text-sm",value:M,onChange:n=>T(n.target.value),children:[e.jsx("option",{value:"USD",children:"USD"}),e.jsx("option",{value:"KHR",children:"KHR"})]})]})]}),e.jsxs("label",{className:"flex items-center space-x-2 pt-2",children:[e.jsx("input",{type:"checkbox",checked:S,onChange:n=>I(n.target.checked),className:"rounded text-indigo-600"}),e.jsx("span",{className:"text-sm font-medium",children:"Rule Active"})]}),e.jsxs("div",{className:"flex justify-end space-x-2 pt-2",children:[p&&e.jsx(v,{type:"button",variant:"outline",onClick:$,children:"Cancel"}),e.jsx(v,{type:"submit",isLoading:d,children:p?"Update":"Create"})]})]})})}),e.jsx("div",{className:"lg:col-span-2",children:e.jsx(H,{title:"Active Referral Rules",children:e.jsxs("div",{className:"space-y-3",children:[t.map(n=>e.jsxs("div",{className:`flex justify-between items-center p-4 border rounded-xl bg-white ${n.isActive?"border-gray-200":"border-gray-200 opacity-60"}`,children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h4",{className:"font-bold text-gray-900",children:n.name}),!n.isActive&&e.jsx("span",{className:"text-xs bg-gray-100 px-2 py-0.5 rounded",children:"Inactive"})]}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["When: ",e.jsx("span",{className:"font-medium",children:n.trigger==="FIRST_ORDER"?"1st Order":`${n.milestoneCount}th Order`}),n.expiryDays?` within ${n.expiryDays} days`:""]}),e.jsxs("div",{className:"flex gap-4 mt-2 text-xs",children:[e.jsxs("span",{className:"text-indigo-600 font-bold",children:["Referrer: ",n.referrerAmount," ",n.referrerCurrency]}),e.jsxs("span",{className:"text-green-600 font-bold",children:["Referee: ",n.refereeAmount," ",n.refereeCurrency]})]})]}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("button",{onClick:()=>G(n),className:"text-indigo-600 hover:text-indigo-900 text-sm font-medium px-2",children:"Edit"}),ce===n.id?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>de(n.id),className:"text-white bg-red-600 hover:bg-red-700 px-2 py-1 rounded text-xs font-bold",children:"Confirm"}),e.jsx("button",{onClick:()=>K(null),className:"text-gray-500 hover:text-gray-700 px-2 py-1 text-xs",children:"Cancel"})]}):e.jsx("button",{onClick:()=>K(n.id),className:"text-red-600 hover:text-red-900 text-sm font-medium px-2",children:"Delete"})]})]},n.id)),t.length===0&&e.jsx("p",{className:"text-center py-8 text-gray-500",children:"No rules configured."})]})})})]})},ft=["system-admin","accountant","finance-manager","warehouse","driver","customer"],rs={FINANCE:"ðŸ’° Finance & Accounting",LOGISTICS:"ðŸ“¦ Logistics & Operations",REPORTS:"ðŸ“Š Reports & Analytics",SETTINGS:"âš™ï¸ Settings & Configuration",SYSTEM:"ðŸ”§ System Administration",DRIVER:"ðŸš— Driver Features",CUSTOMER:"ðŸ‘¤ Customer Features"},as={FINANCE:"bg-green-50 border-green-200",LOGISTICS:"bg-blue-50 border-blue-200",REPORTS:"bg-purple-50 border-purple-200",SETTINGS:"bg-orange-50 border-orange-200",SYSTEM:"bg-red-50 border-red-200",DRIVER:"bg-yellow-50 border-yellow-200",CUSTOMER:"bg-pink-50 border-pink-200"},ls=()=>{const{permissions:t,setPermissions:x,refreshPermissions:d}=Wt(),[c,p]=r.useState(t),[i,b]=r.useState(!1),[a,y]=r.useState(!1),[u,m]=r.useState({FINANCE:!0,LOGISTICS:!0,REPORTS:!1,SETTINGS:!1,SYSTEM:!1});vt.useEffect(()=>{p(t)},[t]);const o=(h,j)=>{const l=c[h]||[],N=l.includes(j);let w;N?w=l.filter(M=>M!==j):w=[...l,j];const A={...c,[h]:w};p(A),y(!0)},C=h=>{m(j=>({...j,[h]:!j[h]}))},f=async()=>{b(!0);try{await R.updateRolePermissions(c),x(c),await d(),y(!1),g.success("Permissions updated successfully.")}catch(h){console.error(h),g.error("Failed to save permissions.")}finally{b(!1)}};return e.jsxs(H,{title:"Role-Based Feature Access Control",action:e.jsx(v,{onClick:f,isLoading:i,disabled:!a&&!i,variant:a?"primary":"outline",children:"Save Changes"}),children:[e.jsx("div",{className:"space-y-4",children:Object.keys(gt).map(h=>{const j=gt[h],l=u[h];return e.jsxs("div",{className:`border rounded-lg overflow-hidden ${as[h]}`,children:[e.jsxs("button",{onClick:()=>C(h),className:"w-full flex items-center justify-between p-4 hover:bg-black/5 transition-colors",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("span",{className:"text-lg font-bold",children:rs[h]}),e.jsxs("span",{className:"text-xs text-gray-500 bg-white px-2 py-1 rounded-full",children:[j.length," permissions"]})]}),e.jsx("svg",{className:`w-5 h-5 transition-transform ${l?"rotate-180":""}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M19 9l-7 7-7-7"})})]}),l&&e.jsx("div",{className:"bg-white border-t",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-bold text-gray-500 uppercase tracking-wider sticky left-0 bg-gray-50 z-10 border-r border-gray-200",children:"Permission"}),ft.map(N=>e.jsx("th",{className:"px-4 py-3 text-center text-xs font-bold text-gray-500 uppercase tracking-wider min-w-[100px]",children:N.replace("-"," ")},N))]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:j.map(N=>e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-4 py-3 text-sm font-medium text-gray-900 sticky left-0 bg-white z-10 border-r border-gray-100",children:e.jsx("div",{className:"flex flex-col",children:e.jsx("span",{className:"text-[10px] text-gray-400 font-mono",children:N})})}),ft.map(w=>{const A=w==="system-admin",M=(c[w]||[]).includes(N);return e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsx("input",{type:"checkbox",checked:A?!0:M,disabled:A,onChange:()=>o(w,N),className:`w-5 h-5 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500 ${A?"opacity-50 cursor-not-allowed bg-gray-100":"cursor-pointer"}`})},`${w}-${N}`)})]},N))})]})})})]},h)})}),e.jsxs("div",{className:"mt-6 p-4 bg-blue-50 rounded-lg border border-blue-100 text-sm text-blue-800",children:[e.jsx("strong",{children:"ðŸ’¡ Tip:"})," Permissions control what features users can access. Use the ",e.jsx("strong",{children:"Menu Builder"})," (Settings â†’ Menu Builder) to control which menu items are visible in the sidebar."]}),e.jsxs("div",{className:"mt-4 p-4 bg-yellow-50 rounded-lg border border-yellow-100 text-xs text-yellow-800",children:[e.jsx("strong",{children:"Note:"})," System Admin permissions are immutable and include full access to all features. Changes to other roles apply immediately upon save, but users may need to refresh their browser to see updated menus."]})]})},ns=()=>{const[t,x]=r.useState(!1),[d,c]=r.useState({name:"",logo:"",contactCenterLogo:"",address:"",phone:"",email:"",website:"",taxId:"",operatingZonesMarkdown:""});r.useEffect(()=>{p()},[]);const p=async()=>{x(!0);try{const a=await R.getCompanyProfile();a&&a.name&&c(y=>({...y,...a}))}catch(a){console.error("Error loading profile:",a),g.error("Failed to load company profile")}finally{x(!1)}},i=(a,y)=>{c(u=>({...u,[a]:y}))},b=async()=>{x(!0);try{await R.saveCompanyProfile(d),g.success("Company profile saved successfully")}catch(a){console.error("Error saving profile:",a),g.error("Failed to save profile")}finally{x(!1)}};return e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-800",children:"Company Profile"}),e.jsx("button",{onClick:b,disabled:t,className:"px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 disabled:opacity-50",children:t?"Saving...":"Save Changes"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-semibold text-gray-700 border-b pb-2",children:"General Information"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Company Name"}),e.jsx("input",{type:"text",value:d.name,onChange:a=>i("name",a.target.value),className:"w-full p-2 border rounded focus:ring-2 focus:ring-indigo-500",placeholder:"e.g. Doorstep Logistics"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email"}),e.jsx("input",{type:"email",value:d.email||"",onChange:a=>i("email",a.target.value),className:"w-full p-2 border rounded focus:ring-2 focus:ring-indigo-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Phone"}),e.jsx("input",{type:"text",value:d.phone||"",onChange:a=>i("phone",a.target.value),className:"w-full p-2 border rounded focus:ring-2 focus:ring-indigo-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Website"}),e.jsx("input",{type:"text",value:d.website||"",onChange:a=>i("website",a.target.value),className:"w-full p-2 border rounded focus:ring-2 focus:ring-indigo-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Tax ID / VAT"}),e.jsx("input",{type:"text",value:d.taxId||"",onChange:a=>i("taxId",a.target.value),className:"w-full p-2 border rounded focus:ring-2 focus:ring-indigo-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Address"}),e.jsx("textarea",{value:d.address||"",onChange:a=>i("address",a.target.value),className:"w-full p-2 border rounded focus:ring-2 focus:ring-indigo-500",rows:3})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-semibold text-gray-700 border-b pb-2",children:"Branding (Mobile App)"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Main Logo URL"}),e.jsx("input",{type:"text",value:d.logo||"",onChange:a=>i("logo",a.target.value),className:"w-full p-2 border rounded focus:ring-2 focus:ring-indigo-500",placeholder:"https://..."}),d.logo&&e.jsx("img",{src:d.logo,alt:"Preview",className:"mt-2 h-16 object-contain border p-1 rounded bg-gray-50"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Contact Center Logo URL"}),e.jsx("input",{type:"text",value:d.contactCenterLogo||"",onChange:a=>i("contactCenterLogo",a.target.value),className:"w-full p-2 border rounded focus:ring-2 focus:ring-indigo-500",placeholder:"https://..."}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Displayed in the mobile app contact section."}),d.contactCenterLogo&&e.jsx("img",{src:d.contactCenterLogo,alt:"Preview",className:"mt-2 h-16 object-contain border p-1 rounded bg-gray-50"})]})]})]}),e.jsxs("div",{className:"mt-8",children:[e.jsx("h3",{className:"font-semibold text-gray-700 border-b pb-2 mb-4",children:"Operating Zones & Services (Markdown)"}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Editor"}),e.jsx("textarea",{value:d.operatingZonesMarkdown||"",onChange:a=>i("operatingZonesMarkdown",a.target.value),className:"w-full p-3 border rounded font-mono text-sm focus:ring-2 focus:ring-indigo-500",rows:15,placeholder:`# Our Services
- Zone 1: Phnom Penh...`})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Preview"}),e.jsx("div",{className:"w-full h-[370px] p-4 border rounded bg-gray-50 overflow-y-auto prose prose-sm max-w-none",children:e.jsx("div",{className:"whitespace-pre-wrap font-sans",children:d.operatingZonesMarkdown||e.jsx("span",{className:"text-gray-400 italic",children:"Preview will appear here..."})})}),e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"Supports basic Markdown: # Header, - List items, *Bold*, etc."})]})]})]})]})},os=({settings:t,accounts:x=[],onUpdateSettings:d})=>{const[c,p]=r.useState({}),[i,b]=r.useState(!1),[a,y]=r.useState(!1);r.useEffect(()=>{t!=null&&t.transactionRules&&p(t.transactionRules)},[t]);const u=(f,h)=>{p(j=>({...j,[f]:h})),b(!0)},m=async()=>{if(!(!d||!t)){y(!0);try{await d({...t,transactionRules:c}),b(!1),g.success("Posting rules updated successfully.")}catch{g.error("Failed to save rules.")}finally{y(!1)}}},o=f=>[4,5,10,12,13,14].includes(f),C=f=>{switch(f){case 1:return"Defined in Parcel Status Config";case 7:return"Defined in Parcel Status Config";case 9:return"Defined per Service Type";default:return""}};return e.jsxs(H,{title:"Posting Rules & Account Mapping",action:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"text-xs text-gray-500 italic hidden md:block",children:"Map standard system events to GL accounts"}),i&&e.jsx(v,{onClick:m,isLoading:a,className:"text-xs",children:"Save Mappings"})]}),children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-16",children:"ID"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Description"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Mapped Account"}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider w-24",children:"Auto"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:$t.map(f=>{const h=o(f.id),j=C(f.id);return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 font-mono",children:f.id}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:[f.description,j&&e.jsx("span",{className:"block text-xs text-gray-400 font-normal mt-0.5",children:j})]}),e.jsx("td",{className:"px-6 py-3",children:h?e.jsxs("select",{className:"block w-full max-w-sm px-2 py-1 text-sm border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500",value:c[f.id]||"",onChange:l=>u(f.id,l.target.value),children:[e.jsx("option",{value:"",children:"-- Select Default Account --"}),x.map(l=>e.jsxs("option",{value:l.id,children:[l.code," - ",l.name]},l.id))]}):e.jsx("span",{className:"text-xs text-gray-400 italic",children:j?"Dynamic / Contextual":"System Managed"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center",children:e.jsx("span",{className:`px-2 py-1 inline-flex text-xs leading-5 font-semibold rounded-full ${f.auto==="Y"?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:f.auto==="Y"?"Yes":"No"})})]},f.id)})})]})}),e.jsxs("div",{className:"mt-4 p-4 bg-gray-50 rounded-lg text-xs text-gray-600 border border-gray-200",children:[e.jsx("p",{className:"font-bold mb-1",children:"About Transaction Rules:"}),e.jsxs("p",{children:["These definitions control which General Ledger accounts are used when the system automatically creates Journal Entries.",e.jsx("br",{}),e.jsx("strong",{children:"Note:"}),' Some rules (like "Service Fee") are mapped dynamically within other configurations (e.g., inside Service Type settings) to allow for granular control. Rules exposed here are global defaults.']})]})]})},bt=({title:t,items:x,onItemsChange:d,description:c})=>{const[p,i]=r.useState(""),b=()=>{p.trim()&&(d([...x,p.trim()]),i(""))},a=u=>{const m=[...x];m.splice(u,1),d(m)},y=u=>{u.key==="Enter"&&(u.preventDefault(),b())};return e.jsxs("div",{className:"bg-gray-50 p-4 rounded-xl border border-gray-200",children:[e.jsx("h5",{className:"text-xs font-bold text-gray-500 uppercase mb-3",children:t}),c&&e.jsx("p",{className:"text-[10px] text-gray-500 mb-3 italic",children:c}),e.jsxs("div",{className:"space-y-2 mb-4",children:[x.map((u,m)=>e.jsxs("div",{className:"flex items-center justify-between bg-white p-2 rounded border border-gray-200 shadow-sm",children:[e.jsx("span",{className:"text-sm text-gray-700",children:u}),e.jsx("button",{onClick:()=>a(m),className:"text-gray-400 hover:text-red-500 transition-colors p-1",title:"Remove",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})})]},m)),x.length===0&&e.jsx("p",{className:"text-xs text-gray-400 text-center py-2",children:"No suggestions added yet."})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:p,onChange:u=>i(u.target.value),onKeyDown:y,placeholder:"Type a new suggestion...",className:"flex-1 block w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-indigo-500 focus:border-indigo-500"}),e.jsx(v,{onClick:b,disabled:!p.trim(),variant:"secondary",className:"whitespace-nowrap",children:"Add"})]})]})},cs=({settings:t,accounts:x,branches:d,currencies:c,taxRates:p=[],transactions:i=[],onAddAccount:b,onUpdateAccount:a,onDeleteAccount:y,onImportAccounts:u,onAddBranch:m,onUpdateBranch:o,onDeleteBranch:C,onAddCurrency:f,onUpdateCurrency:h,onAddTaxRate:j,onUpdateTaxRate:l,onRunSetup:N,onUpdateSettings:w,onClearData:A,onMenuUpdate:M})=>{const{t:T}=Gt(),[S,I]=r.useState("GENERAL"),[ce,K]=r.useState(!1),[W,$]=r.useState(void 0),[G,V]=r.useState(!1),[de,n]=r.useState(!1),[Y,ie]=r.useState(void 0),[jt,ee]=r.useState(!1),[Ne,xe]=r.useState(void 0),[Nt,te]=r.useState(!1),[Se,ue]=r.useState(void 0),[q,se]=r.useState(void 0),[me,Ce]=r.useState(!1),[he,we]=r.useState((t==null?void 0:t.customerWalletAccountUSD)||(t==null?void 0:t.defaultCustomerWalletAccountId)||""),[Re,Ae]=r.useState((t==null?void 0:t.customerWalletAccountKHR)||""),[pe,Ee]=r.useState((t==null?void 0:t.driverWalletAccountUSD)||(t==null?void 0:t.defaultDriverWalletAccountId)||""),[ke,Te]=r.useState((t==null?void 0:t.driverWalletAccountKHR)||""),[Ie,Ue]=r.useState((t==null?void 0:t.driverCommissionExpenseAccountUSD)||""),[Le,De]=r.useState((t==null?void 0:t.driverCommissionExpenseAccountKHR)||""),[He,Oe]=r.useState((t==null?void 0:t.commissionExchangeRate)||4100),[re,Be]=r.useState((t==null?void 0:t.defaultDriverSettlementBankIdUSD)||(t==null?void 0:t.defaultSettlementBankAccountId)||""),[Pe,Me]=r.useState((t==null?void 0:t.defaultDriverSettlementBankIdKHR)||""),[ge,Ke]=r.useState((t==null?void 0:t.defaultCustomerSettlementBankIdUSD)||(t==null?void 0:t.defaultSettlementBankAccountId)||""),[Fe,_e]=r.useState((t==null?void 0:t.defaultCustomerSettlementBankIdKHR)||""),[We,$e]=r.useState((t==null?void 0:t.defaultDriverCashAccountIdUSD)||""),[Ge,Ve]=r.useState((t==null?void 0:t.defaultDriverCashAccountIdKHR)||""),[Ye,qe]=r.useState((t==null?void 0:t.defaultRevenueAccountUSD)||""),[Xe,ze]=r.useState((t==null?void 0:t.defaultRevenueAccountKHR)||""),[Ze,ye]=r.useState((t==null?void 0:t.defaultTaxAccountUSD)||""),[Qe,Je]=r.useState((t==null?void 0:t.defaultTaxAccountKHR)||""),[et,tt]=r.useState((t==null?void 0:t.cus_suggestion)||[]),[st,rt]=r.useState((t==null?void 0:t.drv_suggestion)||[]),[St,at]=r.useState(!1),[Ct,fe]=r.useState(!1),[wt,lt]=r.useState(!1),[Rt,nt]=r.useState(!1),[At,ot]=r.useState(!1);vt.useEffect(()=>{t&&(we(t.customerWalletAccountUSD||t.defaultCustomerWalletAccountId||""),Ae(t.customerWalletAccountKHR||""),Ee(t.driverWalletAccountUSD||t.defaultDriverWalletAccountId||""),Te(t.driverWalletAccountKHR||""),Ue(t.driverCommissionExpenseAccountUSD||""),De(t.driverCommissionExpenseAccountKHR||""),Oe(t.commissionExchangeRate||4100),Be(t.defaultDriverSettlementBankIdUSD||t.defaultSettlementBankAccountId||""),Me(t.defaultDriverSettlementBankIdKHR||""),Ke(t.defaultCustomerSettlementBankIdUSD||t.defaultSettlementBankAccountId||""),_e(t.defaultCustomerSettlementBankIdKHR||""),$e(t.defaultDriverCashAccountIdUSD||""),Ve(t.defaultDriverCashAccountIdKHR||""),qe(t.defaultRevenueAccountUSD||""),ze(t.defaultRevenueAccountKHR||""),ye(t.defaultTaxAccountUSD||""),ye(t.defaultTaxAccountUSD||""),Je(t.defaultTaxAccountKHR||""),tt(t.cus_suggestion||[]),rt(t.drv_suggestion||[]))},[t]);const X=x.filter(s=>s.type===D.LIABILITY&&!s.isHeader),ct=x.filter(s=>s.type===D.EXPENSE&&!s.isHeader),z=x.filter(s=>s.type===D.ASSET&&(s.subType===L.CURRENT_ASSET||s.name.toLowerCase().includes("bank")||s.name.toLowerCase().includes("cash")||s.name.toLowerCase().includes("settlement"))&&!s.isHeader),k=(s,E)=>s.filter(U=>!U.currency||U.currency===E),ae=(s,E,U,le)=>e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-gray-700 mb-1",children:s}),e.jsxs("select",{className:"block w-full px-3 py-2 border border-gray-300 rounded-lg text-sm",value:E,onChange:F=>U(F.target.value),children:[e.jsx("option",{value:"",children:"-- Select Account --"}),le.map(F=>e.jsxs("option",{value:F.id,children:[F.code," - ",F.name]},F.id))]})]}),Et=async s=>{W?await a(s):await b(s),K(!1),$(void 0)},kt=s=>{var le;const E=(le=s.target.files)==null?void 0:le[0];if(!E)return;if(!u){alert("Import function not connected.");return}V(!0);const U=new FileReader;U.onload=async F=>{var dt,it,xt,ut,mt,ht;const Mt=(dt=F.target)==null?void 0:dt.result;try{const ne=Mt.split(`
`),J=[];for(let be=0;be<ne.length;be++){const oe=ne[be].trim();if(!oe)continue;const _=oe.split("	").length>1?oe.split("	"):oe.split(",");if(_[0].toLowerCase()==="gl"||_[0].toLowerCase()==="code"||_.length<2)continue;const ve=(it=_[0])==null?void 0:it.trim(),pt=(xt=_[1])==null?void 0:xt.trim(),Kt=(ut=_[2])==null?void 0:ut.trim(),Ft=(mt=_[3])==null?void 0:mt.trim(),_t=(ht=_[4])==null?void 0:ht.trim();if(!ve||!pt)continue;let Z=D.ASSET;const Q=(Kt||"").toUpperCase();Q.includes("ASSET")?Z=D.ASSET:Q.includes("LIAB")?Z=D.LIABILITY:Q.includes("EQUITY")?Z=D.EQUITY:Q.includes("REV")||Q.includes("INCOME")?Z=D.REVENUE:Q.includes("EXP")&&(Z=D.EXPENSE);let B=L.CURRENT_ASSET;const P=(Ft||"").toUpperCase();P.includes("NON-CURRENT")||P.includes("FIXED")?B=L.NON_CURRENT_ASSET:P.includes("CURRENT ASSET")?B=L.CURRENT_ASSET:P.includes("CURRENT LIAB")?B=L.CURRENT_LIABILITY:P.includes("LONG-TERM LIAB")?B=L.LONG_TERM_LIABILITY:P.includes("EQUITY")?B=L.EQUITY:P.includes("OPERATING REV")?B=L.OPERATING_REVENUE:P.includes("OTHER REV")?B=L.OTHER_REVENUE:P.includes("COGS")?B=L.COST_OF_GOODS_SOLD:P.includes("OPERATING EXP")?B=L.OPERATING_EXPENSE:P.includes("OTHER EXP")&&(B=L.OTHER_EXPENSE),J.push({id:ve,code:ve,name:pt.replace(/^"|"$/g,""),type:Z,subType:B,currency:(_t||"USD").replace(/^"|"$/g,""),description:"Imported via CSV",isHeader:!1})}J.length>0?confirm(`Ready to import ${J.length} accounts? Existing accounts with same Code will be updated.`)&&(await u(J),g.success(`Successfully processed ${J.length} accounts.`)):g.warning("No valid account rows found in CSV.")}catch(ne){console.error(ne),g.error("Failed to parse CSV.")}finally{V(!1),s.target.value=""}},U.readAsText(E)},Tt=async()=>{if(u&&confirm(`This will merge ${yt.length} accounts from the Master COA into your database. Existing accounts with matching codes will be updated. Continue?`)){V(!0);try{await u(yt),g.success("Master COA loaded successfully.")}catch(s){console.error(s),g.error("Failed to load master COA.")}finally{V(!1)}}},It=async s=>{Y?await o(s):await m(s),n(!1),ie(void 0)},Ut=async s=>{Ne?await h(s):await f(s),ee(!1),xe(void 0)},Lt=async s=>{!j||!l||(Se?await l(s):await j(s),te(!1),ue(void 0))},Dt=async()=>{at(!0);try{await w({...t,customerWalletAccountUSD:he,customerWalletAccountKHR:Re,defaultCustomerWalletAccountId:he,driverWalletAccountUSD:pe,driverWalletAccountKHR:ke,defaultDriverWalletAccountId:pe,driverCommissionExpenseAccountUSD:Ie,driverCommissionExpenseAccountKHR:Le,commissionExchangeRate:He,defaultDriverSettlementBankIdUSD:re,defaultDriverSettlementBankIdKHR:Pe,defaultDriverCashAccountIdUSD:We,defaultDriverCashAccountIdKHR:Ge,defaultCustomerSettlementBankIdUSD:ge,defaultCustomerSettlementBankIdKHR:Fe,defaultDriverSettlementBankId:re,defaultCustomerSettlementBankId:ge,defaultSettlementBankAccountId:re,defaultRevenueAccountUSD:Ye,defaultRevenueAccountKHR:Xe,defaultTaxAccountUSD:Ze,defaultTaxAccountKHR:Qe,cus_suggestion:et,drv_suggestion:st}),g.success("Configuration saved successfully.")}catch{g.error("Failed to save settings.")}finally{at(!1)}},Ht=async()=>{A&&(await A(),fe(!1))},Ot=async()=>{if(confirm("This will clean up inconsistent fields in user profiles (remove _dev_password, rename authProvider->authMethod, add missing uid/status). Continue?")){lt(!0);try{const{cleanupUserData:s}=await je(async()=>{const{cleanupUserData:U}=await import("./cleanupUserData-DPGEBqDE.js");return{cleanupUserData:U}},__vite__mapDeps([0,1,2])),E=await s();g.success(`Cleaned up ${E.updated}/${E.total} users`)}catch(s){console.error("Cleanup error:",s),g.error("Failed to cleanup users: "+s.message)}finally{lt(!1)}}},Bt=async()=>{if(confirm("This will import places from dsaccounting-18f75 to this project. Continue?")){nt(!0);try{const{migratePlaces:s}=await je(async()=>{const{migratePlaces:U}=await import("./migratePlaces-BxQBYRhi.js");return{migratePlaces:U}},__vite__mapDeps([3,1,2])),E=await s();E.success?g.success(`Migrated ${E.migrated}/${E.total} places`):g.error("Migration failed: "+E.errors.join(", "))}catch(s){console.error("Migration error:",s),g.error("Failed to migrate places: "+s.message)}finally{nt(!1)}}},Pt=async()=>{if(confirm("This will build search keywords for all places. This is safe but may take a moment. Continue?")){ot(!0);try{const{buildPlaceSearchIndex:s}=await je(async()=>{const{buildPlaceSearchIndex:U}=await import("./buildPlaceIndex-Cp0kdDMH.js");return{buildPlaceSearchIndex:U}},__vite__mapDeps([4,1,2])),E=await s();g.success(`Built search index for ${E.indexed}/${E.total} places`)}catch(s){console.error("Build index error:",s),g.error("Failed to build index: "+s.message)}finally{ot(!1)}}};return ce?e.jsx(qt,{initialData:W,accounts:x,onSubmit:Et,onCancel:()=>K(!1)}):de?e.jsx(Jt,{initialData:Y,onSave:It,onCancel:()=>n(!1)}):jt?e.jsx(es,{initialData:Ne,onSave:Ut,onCancel:()=>ee(!1)}):Nt?e.jsx(ts,{initialData:Se,onSave:Lt,onCancel:()=>te(!1)}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex space-x-1 bg-white p-1 rounded-xl shadow-sm border border-gray-100 max-w-fit overflow-x-auto",children:[e.jsx("button",{onClick:()=>I("GENERAL"),className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors whitespace-nowrap ${S==="GENERAL"?"bg-indigo-50 text-indigo-700":"text-gray-600 hover:bg-gray-50"}`,children:T("general_config")}),e.jsx("button",{onClick:()=>I("COMPANY"),className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors whitespace-nowrap ${S==="COMPANY"?"bg-indigo-50 text-indigo-700":"text-gray-600 hover:bg-gray-50"}`,children:"Company Profile"}),e.jsx("button",{onClick:()=>I("PERMISSIONS"),className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors whitespace-nowrap ${S==="PERMISSIONS"?"bg-indigo-50 text-indigo-700":"text-gray-600 hover:bg-gray-50"}`,children:"Role Permissions"}),e.jsx("button",{onClick:()=>I("COA"),className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors whitespace-nowrap ${S==="COA"?"bg-indigo-50 text-indigo-700":"text-gray-600 hover:bg-gray-50"}`,children:T("chart_of_accounts")}),e.jsx("button",{onClick:()=>I("RULES"),className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors whitespace-nowrap ${S==="RULES"?"bg-indigo-50 text-indigo-700":"text-gray-600 hover:bg-gray-50"}`,children:"Posting Rules"}),e.jsx("button",{onClick:()=>I("BRANCHES"),className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors whitespace-nowrap ${S==="BRANCHES"?"bg-indigo-50 text-indigo-700":"text-gray-600 hover:bg-gray-50"}`,children:T("branches")}),e.jsx("button",{onClick:()=>I("COMMISSIONS"),className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors whitespace-nowrap ${S==="COMMISSIONS"?"bg-indigo-50 text-indigo-700":"text-gray-600 hover:bg-gray-50"}`,children:"Commissions"}),e.jsx("button",{onClick:()=>I("TAXES"),className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors whitespace-nowrap ${S==="TAXES"?"bg-indigo-50 text-indigo-700":"text-gray-600 hover:bg-gray-50"}`,children:T("taxes")}),e.jsx("button",{onClick:()=>I("CURRENCIES"),className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors whitespace-nowrap ${S==="CURRENCIES"?"bg-indigo-50 text-indigo-700":"text-gray-600 hover:bg-gray-50"}`,children:T("currencies")}),e.jsx("button",{onClick:()=>I("MENU"),className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors whitespace-nowrap ${S==="MENU"?"bg-indigo-50 text-indigo-700":"text-gray-600 hover:bg-gray-50"}`,children:"Menu Builder"}),e.jsx("button",{onClick:()=>I("REFERRAL"),className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors whitespace-nowrap ${S==="REFERRAL"?"bg-indigo-50 text-indigo-700":"text-gray-600 hover:bg-gray-50"}`,children:"Referrals"})]}),S==="COMPANY"&&e.jsx(ns,{}),S==="PERMISSIONS"&&e.jsx(ls,{}),S==="GENERAL"&&e.jsx(H,{title:T("general_config"),children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:T("company_name")}),e.jsx("div",{className:"mt-1 text-lg font-semibold text-gray-900",children:(t==null?void 0:t.companyName)||"Not Configured"})]}),e.jsxs("div",{className:"pt-6 border-t border-gray-100",children:[e.jsx("h4",{className:"text-sm font-bold text-gray-900 mb-4",children:"Financial Integration Mapping"}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gray-50 p-4 rounded-xl border border-gray-200",children:[e.jsx("h5",{className:"text-xs font-bold text-gray-500 uppercase mb-3",children:"Service Revenue & Tax Liability (Global)"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[ae("Default Revenue Account (USD)",Ye,qe,k(x.filter(s=>s.type===D.REVENUE),"USD")),ae("Default Revenue Account (KHR)",Xe,ze,k(x.filter(s=>s.type===D.REVENUE),"KHR"))]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 border-t border-gray-200 pt-3",children:[ae("Default Tax Payable (USD)",Ze,ye,k(X,"USD")),ae("Default Tax Payable (KHR)",Qe,Je,k(X,"KHR"))]}),e.jsx("p",{className:"text-[10px] text-gray-500 mt-2 italic",children:'These accounts are used for all products. Tax is only applied if the customer is marked as "Taxable".'})]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-xl border border-gray-200",children:[e.jsx("h5",{className:"text-xs font-bold text-gray-500 uppercase mb-3",children:"Customer Wallets (Liability)"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-green-700 mb-1",children:"USD Wallet ($)"}),e.jsxs("select",{className:"block w-full px-3 py-2 border border-gray-300 rounded-lg text-sm",value:he,onChange:s=>we(s.target.value),children:[e.jsx("option",{value:"",children:"-- Select USD Liability --"}),k(X,"USD").map(s=>e.jsxs("option",{value:s.id,children:[s.code," - ",s.name]},s.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-blue-700 mb-1",children:"KHR Wallet (áŸ›)"}),e.jsxs("select",{className:"block w-full px-3 py-2 border border-gray-300 rounded-lg text-sm",value:Re,onChange:s=>Ae(s.target.value),children:[e.jsx("option",{value:"",children:"-- Select KHR Liability --"}),k(X,"KHR").map(s=>e.jsxs("option",{value:s.id,children:[s.code," - ",s.name]},s.id))]})]})]})]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-xl border border-gray-200",children:[e.jsx("h5",{className:"text-xs font-bold text-gray-500 uppercase mb-3",children:"Driver Commission Payable (Liability)"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-green-700 mb-1",children:"USD Payable ($)"}),e.jsxs("select",{className:"block w-full px-3 py-2 border border-gray-300 rounded-lg text-sm",value:pe,onChange:s=>Ee(s.target.value),children:[e.jsx("option",{value:"",children:"-- Select USD Liability --"}),k(X,"USD").map(s=>e.jsxs("option",{value:s.id,children:[s.code," - ",s.name]},s.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-blue-700 mb-1",children:"KHR Payable (áŸ›)"}),e.jsxs("select",{className:"block w-full px-3 py-2 border border-gray-300 rounded-lg text-sm",value:ke,onChange:s=>Te(s.target.value),children:[e.jsx("option",{value:"",children:"-- Select KHR Liability --"}),k(X,"KHR").map(s=>e.jsxs("option",{value:s.id,children:[s.code," - ",s.name]},s.id))]})]})]})]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-xl border border-gray-200",children:[e.jsx("h5",{className:"text-xs font-bold text-gray-500 uppercase mb-3",children:"Driver Commission Expense (COGS)"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-green-700 mb-1",children:"USD Expense ($)"}),e.jsxs("select",{className:"block w-full px-3 py-2 border border-gray-300 rounded-lg text-sm",value:Ie,onChange:s=>Ue(s.target.value),children:[e.jsx("option",{value:"",children:"-- Select USD Expense --"}),k(ct,"USD").map(s=>e.jsxs("option",{value:s.id,children:[s.code," - ",s.name]},s.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-blue-700 mb-1",children:"KHR Expense (áŸ›)"}),e.jsxs("select",{className:"block w-full px-3 py-2 border border-gray-300 rounded-lg text-sm",value:Le,onChange:s=>De(s.target.value),children:[e.jsx("option",{value:"",children:"-- Select KHR Expense --"}),k(ct,"KHR").map(s=>e.jsxs("option",{value:s.id,children:[s.code," - ",s.name]},s.id))]})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mt-4 pt-4 border-t border-gray-100",children:e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-gray-700 mb-1",children:"Commission Exchange Rate (USD â†’ KHR)"}),e.jsx("input",{type:"number",className:"block w-full px-3 py-2 border border-gray-300 rounded-lg text-sm",value:He,onChange:s=>Oe(Number(s.target.value)||4100),placeholder:"4100"}),e.jsx("p",{className:"text-[10px] text-gray-500 mt-1",children:"Used to convert USD commissions to KHR when item COD is in KHR."})]})})]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-xl border border-gray-200",children:[e.jsx("h5",{className:"text-xs font-bold text-gray-500 uppercase mb-3",children:"Customer Settlement Payout Asset (Bank/Cash)"}),e.jsx("p",{className:"text-[10px] text-gray-500 mb-3 italic",children:"This is the bank account used when paying out settlements to customers (e.g., COD payouts)."}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-green-700 mb-1",children:"USD Settlement Asset ($)"}),e.jsxs("select",{className:"block w-full px-3 py-2 border border-gray-300 rounded-lg text-sm",value:ge,onChange:s=>Ke(s.target.value),children:[e.jsx("option",{value:"",children:"-- Select USD Asset --"}),k(z,"USD").map(s=>e.jsxs("option",{value:s.id,children:[s.code," - ",s.name]},s.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-blue-700 mb-1",children:"KHR Settlement Asset (áŸ›)"}),e.jsxs("select",{className:"block w-full px-3 py-2 border border-gray-300 rounded-lg text-sm",value:Fe,onChange:s=>_e(s.target.value),children:[e.jsx("option",{value:"",children:"-- Select KHR Asset --"}),k(z,"KHR").map(s=>e.jsxs("option",{value:s.id,children:[s.code," - ",s.name]},s.id))]})]})]})]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-xl border border-gray-200",children:[e.jsx("h5",{className:"text-xs font-bold text-gray-500 uppercase mb-3",children:"Driver Settlement Asset (Internal/Clearing)"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-green-700 mb-1",children:"USD Settlement Asset ($)"}),e.jsxs("select",{className:"block w-full px-3 py-2 border border-gray-300 rounded-lg text-sm",value:re,onChange:s=>Be(s.target.value),children:[e.jsx("option",{value:"",children:"-- Select USD Asset --"}),k(z,"USD").map(s=>e.jsxs("option",{value:s.id,children:[s.code," - ",s.name]},s.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-blue-700 mb-1",children:"KHR Settlement Asset (áŸ›)"}),e.jsxs("select",{className:"block w-full px-3 py-2 border border-gray-300 rounded-lg text-sm",value:Pe,onChange:s=>Me(s.target.value),children:[e.jsx("option",{value:"",children:"-- Select KHR Asset --"}),k(z,"KHR").map(s=>e.jsxs("option",{value:s.id,children:[s.code," - ",s.name]},s.id))]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mt-4 pt-4 border-t border-gray-100",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-green-700 mb-1",children:"USD Cash on Hand Asset ($)"}),e.jsxs("select",{className:"block w-full px-3 py-2 border border-gray-300 rounded-lg text-sm",value:We,onChange:s=>$e(s.target.value),children:[e.jsx("option",{value:"",children:"-- Select USD Cash --"}),k(z,"USD").map(s=>e.jsxs("option",{value:s.id,children:[s.code," - ",s.name]},s.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-blue-700 mb-1",children:"KHR Cash on Hand Asset (áŸ›)"}),e.jsxs("select",{className:"block w-full px-3 py-2 border border-gray-300 rounded-lg text-sm",value:Ge,onChange:s=>Ve(s.target.value),children:[e.jsx("option",{value:"",children:"-- Select KHR Cash --"}),k(z,"KHR").map(s=>e.jsxs("option",{value:s.id,children:[s.code," - ",s.name]},s.id))]})]})]}),e.jsx("p",{className:"text-[10px] text-gray-500 mt-2 italic",children:"Separating Bank/Settlement from Cash Handover allows tracking where the money is currently held."})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(bt,{title:"Customer Suggestions",description:"Quick replies for customer interactions",items:et,onItemsChange:tt}),e.jsx(bt,{title:"Driver Suggestions",description:"Quick replies for driver interactions",items:st,onItemsChange:rt})]})]}),e.jsx("div",{className:"mt-6",children:e.jsx(v,{onClick:Dt,isLoading:St,className:"text-xs",children:"Save Configuration"})})]}),e.jsxs("div",{className:"pt-6 border-t border-gray-100",children:[e.jsx("h4",{className:"text-sm font-bold text-gray-900 mb-4",children:"System Maintenance"}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsx(v,{onClick:N,variant:"secondary",children:"Re-run Setup Wizard"}),e.jsx(v,{onClick:Ot,variant:"secondary",isLoading:wt,className:"bg-amber-50 hover:bg-amber-100 text-amber-700 border-amber-200",children:"ðŸ§¹ Cleanup User Data"}),e.jsx(v,{onClick:Bt,variant:"secondary",isLoading:Rt,className:"bg-blue-50 hover:bg-blue-100 text-blue-700 border-blue-200",children:"ðŸ“¥ Import Places"}),e.jsx(v,{onClick:Pt,variant:"secondary",isLoading:At,className:"bg-green-50 hover:bg-green-100 text-green-700 border-green-200",children:"ðŸ” Build Search Index"}),A&&e.jsx(v,{onClick:()=>fe(!0),variant:"danger",children:"Clear Data"})]}),e.jsx("p",{className:"text-[10px] text-gray-500 mt-2",children:'"Import Places" migrates location data from dsaccounting-18f75 project.'})]})]})}),S==="MENU"&&e.jsx(zt,{}),S==="REFERRAL"&&e.jsx(ss,{}),S==="COMMISSIONS"&&e.jsx(Xt,{}),S==="RULES"&&e.jsx(os,{settings:t,accounts:x,onUpdateSettings:w}),S==="COA"&&e.jsx(H,{title:T("chart_of_accounts"),action:e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsxs(v,{variant:"secondary",onClick:()=>{$(void 0),K(!0)},className:"text-xs flex-shrink-0",children:["+ ",T("add_account")]}),u&&e.jsxs(e.Fragment,{children:[e.jsx(v,{variant:"outline",onClick:Tt,disabled:G,className:"text-xs bg-white text-indigo-700 border-indigo-200 hover:bg-indigo-50",children:"Load Master Data"}),e.jsxs("label",{className:`cursor-pointer bg-white border border-gray-300 text-gray-700 hover:bg-gray-50 px-3 py-1.5 rounded-xl text-xs font-medium transition-colors flex items-center ${G?"opacity-50 cursor-not-allowed":""}`,children:[e.jsx("svg",{className:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"})}),G?"Importing...":"Import CSV",e.jsx("input",{type:"file",accept:".csv, .txt",className:"hidden",onChange:kt,disabled:G})]})]})]}),children:e.jsx(Qt,{accounts:x,transactions:i,onEdit:s=>{$(s),K(!0)},onDelete:y})}),S==="BRANCHES"&&e.jsx(H,{title:T("branches"),action:e.jsx(v,{variant:"secondary",onClick:()=>{ie(void 0),n(!0)},className:"text-xs",children:"+ Add Branch"}),children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Name"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Code"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Action"})]})}),e.jsxs("tbody",{className:"bg-white divide-y divide-gray-200",children:[d.map(s=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 text-sm font-medium text-gray-900",children:s.name}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-500 font-mono",children:s.code}),e.jsxs("td",{className:"px-6 py-4 text-right text-sm font-medium space-x-2",children:[e.jsx("button",{onClick:()=>{ie(s),n(!0)},className:"text-indigo-600 hover:text-indigo-900",children:"Edit"}),C&&e.jsx("button",{onClick:()=>se(s),className:"text-red-600 hover:text-red-900",children:"Delete"})]})]},s.id)),d.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:3,className:"px-6 py-4 text-center text-sm text-gray-500",children:"No branches found."})})]})]})})}),e.jsx(Zt,{isOpen:!!q,onClose:()=>!me&&se(void 0),title:"Delete Branch",maxWidth:"max-w-md",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("p",{className:"text-sm text-gray-500",children:["Are you sure you want to delete branch ",e.jsx("span",{className:"font-bold text-gray-900",children:q==null?void 0:q.name}),"? This action cannot be undone."]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx(v,{variant:"secondary",onClick:()=>se(void 0),disabled:me,children:"Cancel"}),e.jsx(v,{variant:"danger",isLoading:me,onClick:async()=>{if(q&&C){Ce(!0);try{await C(q.id),se(void 0)}finally{Ce(!1)}}},children:"Delete"})]})]})}),S==="CURRENCIES"&&e.jsx(H,{title:T("currencies"),action:e.jsx(v,{variant:"secondary",onClick:()=>{xe(void 0),ee(!0)},className:"text-xs",children:"+ Add Currency"}),children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Code"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Name"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Symbol"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Rate"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Action"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:c.map(s=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 text-sm font-bold text-gray-900",children:s.code}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-900",children:s.name}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-500",children:s.symbol}),e.jsx("td",{className:"px-6 py-4 text-right text-sm text-gray-900",children:s.exchangeRate}),e.jsx("td",{className:"px-6 py-4 text-right text-sm font-medium",children:e.jsx("button",{onClick:()=>{xe(s),ee(!0)},className:"text-indigo-600 hover:text-indigo-900",children:"Edit"})})]},s.id))})]})})}),S==="TAXES"&&e.jsx(H,{title:T("taxes"),action:e.jsx(v,{variant:"secondary",onClick:()=>{ue(void 0),te(!0)},className:"text-xs",children:"+ Add Tax Rate"}),children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Name"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Code"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Rate"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Action"})]})}),e.jsxs("tbody",{className:"bg-white divide-y divide-gray-200",children:[p.map(s=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 text-sm text-gray-900",children:s.name}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-500",children:s.code}),e.jsxs("td",{className:"px-6 py-4 text-right text-sm font-bold text-gray-900",children:[s.rate,"%"]}),e.jsx("td",{className:"px-6 py-4 text-right text-sm font-medium",children:e.jsx("button",{onClick:()=>{ue(s),te(!0)},className:"text-indigo-600 hover:text-indigo-900",children:"Edit"})})]},s.id)),p.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:"px-6 py-4 text-center text-sm text-gray-500",children:"No tax rates defined."})})]})]})})}),Ct&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-gray-900 bg-opacity-50 backdrop-blur-sm p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl w-full max-w-lg p-6 animate-fade-in-up",children:[e.jsx("div",{className:"flex justify-center mb-4",children:e.jsx("div",{className:"bg-red-100 p-3 rounded-full",children:e.jsx("svg",{className:"w-8 h-8 text-red-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})})}),e.jsx("h3",{className:"text-xl font-bold text-gray-900 text-center mb-2",children:"Delete All Operational Data?"}),e.jsxs("p",{className:"text-center text-gray-500 mb-6 text-sm",children:["This action allows you to restart operations while keeping your system configuration intact.",e.jsx("br",{}),e.jsx("strong",{children:"This action cannot be undone."})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-6 text-sm",children:[e.jsxs("div",{className:"bg-red-50 p-3 rounded-lg border border-red-100",children:[e.jsx("h4",{className:"font-bold text-red-800 mb-2 uppercase text-xs",children:"âš ï¸ Will Be Deleted"}),e.jsxs("ul",{className:"space-y-1 text-red-700 list-disc list-inside text-xs",children:[e.jsx("li",{children:"All Financial Transactions"}),e.jsx("li",{children:"Invoices & Bills"}),e.jsx("li",{children:"Parcel Bookings & History"}),e.jsx("li",{children:"Wallet Transactions"}),e.jsx("li",{children:"Chat & Notifications"})]})]}),e.jsxs("div",{className:"bg-green-50 p-3 rounded-lg border border-green-100",children:[e.jsx("h4",{className:"font-bold text-green-800 mb-2 uppercase text-xs",children:"âœ… Will Remain Safe"}),e.jsxs("ul",{className:"space-y-1 text-green-700 list-disc list-inside text-xs",children:[e.jsx("li",{children:"User Accounts (Logins)"}),e.jsx("li",{children:"Customers & Vendors"}),e.jsx("li",{children:"Chart of Accounts"}),e.jsx("li",{children:"Employee/Driver Profiles"}),e.jsx("li",{children:"Branch Configurations"}),e.jsx("li",{children:"Tax & Currency Settings"}),e.jsx("li",{children:"Parcel Services & Prices"})]})]})]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx(v,{variant:"outline",onClick:()=>fe(!1),className:"w-full justify-center",children:"Cancel"}),e.jsx(v,{variant:"danger",onClick:Ht,className:"w-full justify-center bg-red-600 hover:bg-red-700 text-white",children:"Confirm Reset"})]})]})})]})};function vs(){const t=Vt(),{settings:x,accounts:d,branches:c,currencies:p,taxRates:i,transactions:b,refreshData:a}=Yt(),[y,u]=r.useState(!1),m=async()=>{u(!0);try{await R.clearFinancialAndLogisticsData(),await a(),g.success("Data cleared successfully.")}catch(o){console.error(o),g.error("Failed to clear data.")}finally{u(!1)}};return e.jsx(cs,{settings:x,accounts:d,branches:c,currencies:p,taxRates:i,transactions:b,onAddAccount:async o=>{await R.addAccount(o),await a()},onUpdateAccount:async o=>{await R.updateAccount(o),await a()},onDeleteAccount:async o=>{await R.deleteAccount(o),await a()},onAddBranch:async o=>{await R.addBranch(o),await a()},onUpdateBranch:async o=>{await R.updateBranch(o),await a()},onDeleteBranch:async o=>{await R.deleteBranch(o),await a()},onAddCurrency:async o=>{await R.addCurrency(o),await a()},onUpdateCurrency:async o=>{await R.updateCurrency(o),await a()},onAddTaxRate:async o=>{await R.addTaxRate(o),await a()},onUpdateTaxRate:async o=>{await R.updateTaxRate(o),await a()},onRunSetup:async()=>{await R.updateSettings({...x,setupComplete:!1}),await a(),t("/onboarding")},onUpdateSettings:async o=>{await R.updateSettings(o),await a()},onClearData:m,onMenuUpdate:a})}export{vs as default};
