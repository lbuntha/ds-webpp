import{u as M,r as h,j as e,R as A,f as B}from"./index-BjK2osQV.js";import{C as D}from"./Card-DROeE3UG.js";import{B as H}from"./Button-JCYNVMjR.js";const G=({user:k})=>{const{t:l}=M(),[w,U]=h.useState([]),[$,F]=h.useState(!0),[K,L]=h.useState(new Set),[N,m]=h.useState(()=>{const t=new Date;return t.setDate(1),t.toISOString().split("T")[0]}),[v,y]=h.useState(()=>new Date().toISOString().split("T")[0]);h.useEffect(()=>{(async()=>{F(!0);try{const r=await B.getUserBookings(k);U(r)}catch(r){console.error("Failed to load bookings",r)}finally{F(!1)}})()},[k]);const p=h.useMemo(()=>w.filter(t=>t.bookingDate>=N&&t.bookingDate<=v),[w,N,v]),a=h.useMemo(()=>{let t=0,r=0,n=0,o=0,d=0,c=0,s=0,g=0,j=p.length,C=0;return p.forEach(E=>{E.status!=="CANCELLED"&&(E.items||[]).forEach(i=>{C++;const f=i.productPrice||0,S=i.codCurrency==="KHR",R=i.status==="DELIVERED";if(R)if(i.deliveryFeeUSD!==void 0||i.deliveryFeeKHR!==void 0)S?r+=i.deliveryFeeKHR||0:t+=i.deliveryFeeUSD||0;else{const _=i.deliveryFee||0;S?r+=_:t+=_}f>0&&(R?S?c+=f:d+=f:i.status!=="RETURN_TO_SENDER"&&i.status!=="CANCELLED"&&(S?g+=f:s+=f)),R&&i.isTaxiDelivery&&i.taxiFee&&i.taxiFee>0&&(i.taxiFeeCurrency==="KHR"?o+=i.taxiFee:n+=i.taxiFee)})}),{deliveryFeesUSD:t,deliveryFeesKHR:r,taxiFeesUSD:n,taxiFeesKHR:o,codCollectedUSD:d,codCollectedKHR:c,codPendingUSD:s,codPendingKHR:g,totalOrders:j,totalItems:C}},[p]),b=t=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(t),x=(t,r)=>{if(t===0&&r===0)return"$0.00";const n=[];return t>0&&n.push(b(t)),r>0&&n.push(`${r.toLocaleString()} áŸ›`),n.join(" + ")},T=t=>{L(r=>{const n=new Set(r);return n.has(t)?n.delete(t):n.add(t),n})},I=t=>{let r=0,n=0;return t.forEach(o=>{if(o.deliveryFeeUSD!==void 0||o.deliveryFeeKHR!==void 0)o.codCurrency==="KHR"?n+=o.deliveryFeeKHR||0:r+=o.deliveryFeeUSD||0;else{const d=o.deliveryFee||0;o.codCurrency==="KHR"?n+=d:r+=d}}),{usd:r,khr:n}},P=()=>{window.print()},O=()=>{const t=[];t.push(["Date","Booking Ref","Receiver","Destination","Status","Delivery Fee","COD Amount","Currency"]),p.forEach(d=>{(d.items||[]).forEach(c=>{t.push([d.bookingDate,`#${(d.id||"").slice(-6)}`,c.receiverName||"-",(c.destinationAddress||"-").replace(/,/g," "),c.status||"PENDING",(c.deliveryFee||0).toString(),(c.productPrice||0).toString(),c.codCurrency||"USD"])})});const r=t.map(d=>d.map(c=>`"${c}"`).join(",")).join(`
`),n=new Blob([r],{type:"text/csv;charset=utf-8;"}),o=document.createElement("a");o.href=URL.createObjectURL(n),o.download=`summary_report_${N}_${v}.csv`,o.click(),URL.revokeObjectURL(o.href)},u=t=>{const r=new Date,n=r.toISOString().split("T")[0];switch(t){case"today":m(n),y(n);break;case"yesterday":const o=new Date(r);o.setDate(o.getDate()-1);const d=o.toISOString().split("T")[0];m(d),y(d);break;case"this_week":const c=new Date(r);c.setDate(r.getDate()-r.getDay()),m(c.toISOString().split("T")[0]),y(n);break;case"this_month":const s=new Date(r.getFullYear(),r.getMonth(),1);m(s.toISOString().split("T")[0]),y(n);break;case"last_month":const g=new Date(r.getFullYear(),r.getMonth()-1,1),j=new Date(r.getFullYear(),r.getMonth(),0);m(g.toISOString().split("T")[0]),y(j.toISOString().split("T")[0]);break}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col gap-4 print:hidden",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:l("summary_report")}),e.jsx("p",{className:"text-sm text-gray-500",children:l("financial_overview")})]}),e.jsxs("div",{className:"flex items-end gap-2",children:[e.jsx(H,{variant:"outline",onClick:P,className:"h-[30px] text-xs px-3",children:l("print")}),e.jsxs(H,{variant:"outline",onClick:O,className:"h-[30px] text-xs px-3",children:[e.jsx("svg",{className:"w-3 h-3 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),"Export CSV"]})]})]}),e.jsx("div",{className:"bg-white p-3 rounded-xl border border-gray-200 shadow-sm",children:e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("span",{className:"text-xs font-medium text-gray-500 mr-2",children:"Quick:"}),e.jsx("button",{onClick:()=>u("today"),className:"px-3 py-1.5 text-xs font-medium rounded-lg border border-gray-200 hover:bg-gray-100 hover:border-gray-300 transition-colors",children:"Today"}),e.jsx("button",{onClick:()=>u("yesterday"),className:"px-3 py-1.5 text-xs font-medium rounded-lg border border-gray-200 hover:bg-gray-100 hover:border-gray-300 transition-colors",children:"Yesterday"}),e.jsx("button",{onClick:()=>u("this_week"),className:"px-3 py-1.5 text-xs font-medium rounded-lg border border-gray-200 hover:bg-gray-100 hover:border-gray-300 transition-colors",children:"This Week"}),e.jsx("button",{onClick:()=>u("this_month"),className:"px-3 py-1.5 text-xs font-medium rounded-lg border border-gray-200 hover:bg-gray-100 hover:border-gray-300 transition-colors",children:"This Month"}),e.jsx("button",{onClick:()=>u("last_month"),className:"px-3 py-1.5 text-xs font-medium rounded-lg border border-gray-200 hover:bg-gray-100 hover:border-gray-300 transition-colors",children:"Last Month"}),e.jsx("div",{className:"hidden md:block w-px h-6 bg-gray-200 mx-2"}),e.jsxs("div",{className:"flex items-center gap-2 ml-auto",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] font-medium text-gray-400 mb-0.5",children:l("from_date")}),e.jsx("input",{type:"date",className:"border border-gray-300 rounded-lg px-2 py-1 text-sm focus:ring-indigo-500 focus:border-indigo-500",value:N,onChange:t=>m(t.target.value)})]}),e.jsx("span",{className:"text-gray-400 mt-4",children:"â†’"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] font-medium text-gray-400 mb-0.5",children:l("to_date")}),e.jsx("input",{type:"date",className:"border border-gray-300 rounded-lg px-2 py-1 text-sm focus:ring-indigo-500 focus:border-indigo-500",value:v,onChange:t=>y(t.target.value)})]})]})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs(D,{className:"bg-red-50 border-red-100",children:[e.jsx("div",{className:"text-red-800 text-sm font-medium uppercase tracking-wide",children:l("delivery_expenses")}),e.jsx("div",{className:"text-3xl font-bold text-red-900 mt-1 truncate",title:x(a.deliveryFeesUSD+a.taxiFeesUSD,a.deliveryFeesKHR+a.taxiFeesKHR),children:x(a.deliveryFeesUSD+a.taxiFeesUSD,a.deliveryFeesKHR+a.taxiFeesKHR)}),e.jsxs("p",{className:"text-xs text-red-600 mt-2",children:[l("total_spent_orders").replace("{0}",a.totalOrders.toString()),(a.taxiFeesUSD>0||a.taxiFeesKHR>0)&&e.jsxs("span",{className:"ml-2 text-orange-600",children:["(incl. ðŸš• ",x(a.taxiFeesUSD,a.taxiFeesKHR),")"]})]})]}),e.jsxs(D,{className:"bg-green-50 border-green-100",children:[e.jsx("div",{className:"text-green-800 text-sm font-medium uppercase tracking-wide",children:l("cod_collected")}),e.jsx("div",{className:"text-3xl font-bold text-green-900 mt-1 truncate",title:x(a.codCollectedUSD,a.codCollectedKHR),children:x(a.codCollectedUSD,a.codCollectedKHR)}),e.jsx("p",{className:"text-xs text-green-600 mt-2",children:l("cash_collected_desc")})]}),e.jsxs(D,{className:"bg-blue-50 border-blue-100",children:[e.jsx("div",{className:"text-blue-800 text-sm font-medium uppercase tracking-wide",children:l("cod_pending")}),e.jsx("div",{className:"text-3xl font-bold text-blue-900 mt-1 truncate",title:x(a.codPendingUSD,a.codPendingKHR),children:x(a.codPendingUSD,a.codPendingKHR)}),e.jsx("p",{className:"text-xs text-blue-600 mt-2",children:l("cod_pending_desc")})]})]}),e.jsx(D,{title:l("transaction_details"),children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 text-sm",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left font-medium text-gray-500 w-8"}),e.jsx("th",{className:"px-4 py-3 text-left font-medium text-gray-500",children:l("date")}),e.jsx("th",{className:"px-4 py-3 text-left font-medium text-gray-500",children:l("booking_ref")}),e.jsx("th",{className:"px-4 py-3 text-left font-medium text-gray-500",children:l("items")}),e.jsx("th",{className:"px-4 py-3 text-center font-medium text-gray-500",children:l("status")}),e.jsx("th",{className:"px-4 py-3 text-right font-medium text-gray-500",children:l("delivery_fee")}),e.jsx("th",{className:"px-4 py-3 text-right font-medium text-gray-500",children:l("cod_amount_table")})]})}),e.jsxs("tbody",{className:"divide-y divide-gray-200 bg-white",children:[p.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"px-4 py-8 text-center text-gray-500",children:l("no_transactions_period")})}):p.map(t=>{let r=0,n=0;(t.items||[]).forEach(s=>{if(s.status==="DELIVERED"){const g=s.productPrice||0;s.codCurrency==="KHR"?n+=g:r+=g}});const o=(t.items||[]).length,d=I(t.items||[]),c=K.has(t.id);return e.jsxs(A.Fragment,{children:[e.jsxs("tr",{className:"hover:bg-gray-50 cursor-pointer",onClick:()=>T(t.id),children:[e.jsx("td",{className:"px-4 py-3",children:e.jsx("svg",{className:`w-4 h-4 text-gray-400 transition-transform ${c?"rotate-90":""}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9 5l7 7-7 7"})})}),e.jsx("td",{className:"px-4 py-3 text-gray-600",children:t.bookingDate}),e.jsxs("td",{className:"px-4 py-3 font-mono text-gray-900",children:["#",(t.id||"").slice(-6)]}),e.jsxs("td",{className:"px-4 py-3 text-gray-600",children:[o," Items"]}),e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsx("span",{className:`px-2 py-1 rounded text-[10px] font-bold uppercase ${t.status==="COMPLETED"||(t.items||[]).every(s=>s.status==="DELIVERED")?"bg-green-100 text-green-800":t.status==="CANCELLED"?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"}`,children:t.status==="PENDING"&&(t.items||[]).some(s=>s.status==="IN_TRANSIT")?"IN TRANSIT":t.status})}),e.jsx("td",{className:"px-4 py-3 text-right text-red-600 font-medium whitespace-nowrap",children:t.status==="CANCELLED"?"-":x(d.usd,d.khr)}),e.jsx("td",{className:"px-4 py-3 text-right font-bold text-gray-900 whitespace-nowrap",children:r>0||n>0?x(r,n):"-"})]}),c&&(t.items||[]).length>0&&e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"bg-gray-50 p-0",children:e.jsx("div",{className:"px-6 py-3",children:e.jsxs("table",{className:"w-full text-xs",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-gray-500",children:[e.jsx("th",{className:"text-left py-1 px-2",children:"#"}),e.jsx("th",{className:"text-left py-1 px-2",children:"Image"}),e.jsx("th",{className:"text-left py-1 px-2",children:"Receiver"}),e.jsx("th",{className:"text-left py-1 px-2",children:"Destination"}),e.jsx("th",{className:"text-center py-1 px-2",children:l("status")}),e.jsx("th",{className:"text-right py-1 px-2",children:l("fee")}),e.jsx("th",{className:"text-right py-1 px-2",children:"ðŸš• Taxi"}),e.jsx("th",{className:"text-right py-1 px-2",children:"COD"})]})}),e.jsx("tbody",{children:(t.items||[]).map((s,g)=>e.jsxs("tr",{className:"border-t border-gray-100",children:[e.jsx("td",{className:"py-2 px-2 text-gray-400",children:g+1}),e.jsx("td",{className:"py-2 px-2",children:s.image?e.jsx("img",{src:s.image,alt:"Parcel",className:"w-10 h-10 object-cover rounded border border-gray-200 cursor-pointer hover:opacity-80",onClick:j=>{j.stopPropagation(),window.open(s.image,"_blank")}}):e.jsx("div",{className:"w-10 h-10 bg-gray-100 rounded flex items-center justify-center text-gray-400",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1.5",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})})})}),e.jsx("td",{className:"py-2 px-2 font-medium text-gray-800",children:s.receiverName||"-"}),e.jsx("td",{className:"py-2 px-2 text-gray-600 max-w-[200px] truncate",title:s.destinationAddress,children:s.destinationAddress||"-"}),e.jsx("td",{className:"py-2 px-2 text-center",children:e.jsx("span",{className:`px-1.5 py-0.5 rounded text-[9px] font-bold ${s.status==="DELIVERED"?"bg-green-100 text-green-700":s.status==="IN_TRANSIT"?"bg-blue-100 text-blue-700":s.status==="AT_WAREHOUSE"?"bg-purple-100 text-purple-700":s.status==="RETURN_TO_SENDER"?"bg-orange-100 text-orange-700":"bg-gray-100 text-gray-600"}`,children:s.status||"PENDING"})}),e.jsx("td",{className:"py-2 px-2 text-right text-red-600",children:s.deliveryFeeUSD!==void 0||s.deliveryFeeKHR!==void 0?x(s.deliveryFeeUSD||0,s.deliveryFeeKHR||0):s.codCurrency==="KHR"?`${(s.deliveryFee||0).toLocaleString()} áŸ›`:b(s.deliveryFee||0)}),e.jsx("td",{className:"py-2 px-2 text-right text-orange-600",children:s.isTaxiDelivery&&s.taxiFee&&s.taxiFee>0?s.taxiFeeCurrency==="KHR"?`${s.taxiFee.toLocaleString()} áŸ›`:b(s.taxiFee):"-"}),e.jsx("td",{className:"py-2 px-2 text-right font-medium",children:s.productPrice?s.codCurrency==="KHR"?`${s.productPrice.toLocaleString()} áŸ›`:b(s.productPrice):"-"})]},s.id||g))})]})})})})]},t.id)}),p.length>0&&e.jsxs("tr",{className:"bg-gray-100 font-bold border-t-2 border-gray-200",children:[e.jsx("td",{colSpan:5,className:"px-4 py-3 text-right text-gray-800",children:l("total")}),e.jsx("td",{className:"px-4 py-3 text-right text-red-700 whitespace-nowrap",children:x(a.deliveryFeesUSD+a.taxiFeesUSD,a.deliveryFeesKHR+a.taxiFeesKHR)}),e.jsx("td",{className:"px-4 py-3 text-right text-gray-900 whitespace-nowrap",children:x(a.codCollectedUSD+a.codPendingUSD,a.codCollectedKHR+a.codPendingKHR)})]})]})]})})})]})};export{G as C};
