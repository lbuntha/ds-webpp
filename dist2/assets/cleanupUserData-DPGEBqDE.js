import{m as p,n as c,o as f,W as P,H as m,X as g}from"./index-BjK2osQV.js";async function C(){const o={total:0,updated:0,errors:[]};try{const d=p(c,"users"),u=await f(d);console.log(`[CLEANUP] Found ${u.size} users to check`);const i=P(c);let s=0;for(const r of u.docs){o.total++;const t=r.data(),a={},e=[];if("_dev_password"in t&&e.push("_dev_password"),"created_date"in t&&e.push("created_date"),"authProvider"in t&&!("authMethod"in t)?(a.authMethod=t.authProvider,e.push("authProvider")):"authProvider"in t&&"authMethod"in t&&e.push("authProvider"),t.uid||(a.uid=r.id),t.status||(a.status=t.role==="customer"?"APPROVED":"PENDING"),"pin"in t&&e.push("pin"),"hasPin"in t&&e.push("hasPin"),"pinUpdatedAt"in t&&e.push("pinUpdatedAt"),Object.keys(a).length>0||e.length>0){const l=m(c,"users",r.id);for(const[n,h]of Object.entries(a))i.update(l,{[n]:h});for(const n of e)i.update(l,{[n]:g()});s++,o.updated++,console.log(`[CLEANUP] User ${r.id}: +${Object.keys(a).length} updates, -${e.length} deletes`)}s>=400&&(await i.commit(),console.log(`[CLEANUP] Committed batch of ${s} updates`),s=0)}s>0&&(await i.commit(),console.log(`[CLEANUP] Committed final batch of ${s} updates`)),console.log(`[CLEANUP] Complete! Updated ${o.updated}/${o.total} users`)}catch(d){o.errors.push(d.message),console.error("[CLEANUP] Error:",d)}return o}export{C as cleanupUserData,C as default};
