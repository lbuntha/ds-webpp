import{r as a,j as e,f as R}from"./index-BjK2osQV.js";import{B as N}from"./Button-JCYNVMjR.js";import{M as T}from"./Modal-B63ndL_a.js";import{t as y}from"./toast-DTXa3ATd.js";import{I as g}from"./Input-B96Hj4QL.js";import{I as $}from"./ImageUpload-CVnIZI_m.js";import{P as z}from"./plus-mb1_Xzfx.js";import{P as A}from"./package-Dvi4dam4.js";import{P as L,T as B}from"./trash-2-D4W_Kkj6.js";const O=({initialData:t,taxRates:S,onSave:k,onCancel:h,isLoading:K=!1})=>{const[p,m]=a.useState(""),[v,i]=a.useState(""),[l,c]=a.useState(0),[f,d]=a.useState(0),[x,u]=a.useState(0),[j,o]=a.useState(0),[P,b]=a.useState(""),[s,n]=a.useState(""),[I,w]=a.useState(""),[E,C]=a.useState(""),[F,H]=a.useState("");a.useEffect(()=>{t?(m(t.name),i(t.nameKH||""),c(t.defaultPrice),d(t.pricePerKm||0),u(t.defaultPriceKHR||0),o(t.pricePerKmKHR||0),b(t.description||""),n(t.image||""),w(t.taxRateId||""),C(t.rule||""),H(t.ruleKH||"")):(m(""),i(""),c(0),d(0),u(0),o(0),b(""),n(""),w(""),C(""),H(""))},[t]);const M=async r=>{r.preventDefault(),await k({name:p,nameKH:v||void 0,defaultPrice:l,pricePerKm:f,defaultPriceKHR:x,pricePerKmKHR:j,description:P,image:s,taxRateId:I||void 0,rule:E||void 0,ruleKH:F||void 0})};return e.jsxs("form",{onSubmit:M,className:"space-y-6",children:[e.jsx("div",{className:"bg-gray-50 p-4 rounded-xl border border-gray-200 flex flex-col items-center justify-center",children:e.jsx("div",{className:"w-40 text-center",children:e.jsx($,{value:s,onChange:n,label:"Service Icon"})})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsx(g,{label:"Service Name",placeholder:"e.g. Express Delivery",value:p,onChange:r=>m(r.target.value),required:!0}),e.jsx(g,{label:"ឈ្មោះសេវាកម្ម (Khmer)",placeholder:"ឧ. ដឹកជញ្ជូនរហ័ស",value:v,onChange:r=>i(r.target.value)})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(g,{label:"Base Price ($)",type:"number",step:"0.01",value:l,onChange:r=>c(parseFloat(r.target.value))}),e.jsx(g,{label:"Price/Km ($)",type:"number",step:"0.01",value:f,onChange:r=>d(parseFloat(r.target.value))})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 bg-orange-50 p-2 rounded-lg border border-orange-100",children:[e.jsx(g,{label:"Base Price (KHR)",type:"number",value:x,onChange:r=>u(parseFloat(r.target.value))}),e.jsx(g,{label:"Price/Km (KHR)",type:"number",value:j,onChange:r=>o(parseFloat(r.target.value))})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Rule (English)"}),e.jsx("textarea",{className:"block w-full px-3 py-2 border border-gray-300 rounded-xl shadow-sm sm:text-sm focus:ring-indigo-500 focus:border-indigo-500 min-h-[80px]",placeholder:"e.g. Max weight 5kg...",value:E,onChange:r=>C(r.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Rule (Khmer)"}),e.jsx("textarea",{className:"block w-full px-3 py-2 border border-gray-300 rounded-xl shadow-sm sm:text-sm focus:ring-indigo-500 focus:border-indigo-500 min-h-[80px]",placeholder:"ឧ. ទម្ងន់អតិបរមា ៥គីឡូ...",value:F,onChange:r=>H(r.target.value)})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Tax Rate"}),e.jsxs("select",{className:"block w-full px-3 py-2 border border-gray-300 rounded-xl shadow-sm sm:text-sm",value:I,onChange:r=>w(r.target.value),children:[e.jsx("option",{value:"",children:"No Tax Applied"}),S.map(r=>e.jsxs("option",{value:r.id,children:[r.name," (",r.rate,"%)"]},r.id))]})]})]}),e.jsx("div",{className:"bg-gray-50 p-3 rounded-lg border border-gray-200 mt-4",children:e.jsxs("p",{className:"text-xs text-gray-600",children:[e.jsx("strong",{children:"Note:"})," Revenue & Tax accounting is now configured globally in ",e.jsx("strong",{children:"Settings > General"}),"."]})}),e.jsxs("div",{className:"flex justify-end pt-4 gap-2 border-t border-gray-100",children:[e.jsx(N,{type:"button",variant:"outline",onClick:h,children:"Cancel"}),e.jsx(N,{type:"submit",isLoading:K,children:t?"Update Configuration":"Save Configuration"})]})]})},Z=({accounts:t,taxRates:S,onBookService:k})=>{const[h,K]=a.useState([]),[p,m]=a.useState(!1),[v,i]=a.useState(!1),[l,c]=a.useState(null),[f,d]=a.useState(null),x=async()=>{const s=await R.getParcelServices();K(s)};a.useEffect(()=>{x()},[]);const u=()=>{c(null),i(!0)},j=s=>{c(s),i(!0)},o=()=>{i(!1),c(null)},P=async s=>{m(!0);try{const n={id:l?l.id:`ps-${Date.now()}`,name:s.name,nameKH:s.nameKH,defaultPrice:s.defaultPrice,pricePerKm:s.pricePerKm||0,defaultPriceKHR:s.defaultPriceKHR||0,pricePerKmKHR:s.pricePerKmKHR||0,revenueAccountId:l?l.revenueAccountId:void 0,description:s.description,image:s.image,taxRateId:s.taxRateId,rule:s.rule,ruleKH:s.ruleKH};await R.saveParcelService(n),o(),await x(),y.success(l?"Service updated.":"Service created.")}catch(n){console.error(n),y.error("Failed to save service.")}finally{m(!1)}},b=async s=>{try{await R.deleteParcelService(s),await x(),y.success("Service deleted.")}catch{y.error("Failed to delete service.")}finally{d(null)}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Configured Services"}),e.jsxs(N,{onClick:u,className:"flex items-center gap-2",children:[e.jsx(z,{size:16}),"Add New Service"]})]}),e.jsx("div",{className:"bg-white shadow overflow-hidden sm:rounded-md border border-gray-200",children:e.jsx("ul",{role:"list",className:"divide-y divide-gray-200",children:h.length===0?e.jsxs("li",{className:"px-6 py-12 text-center text-gray-500",children:[e.jsx(A,{className:"mx-auto h-12 w-12 text-gray-300 mb-3"}),e.jsx("p",{children:"No services configured yet."}),e.jsx(N,{variant:"outline",onClick:u,className:"mt-4",children:"Create your first service"})]}):h.map(s=>e.jsx("li",{children:e.jsxs("div",{className:"px-4 py-4 flex items-center sm:px-6 hover:bg-gray-50 transition-colors duration-150",children:[e.jsx("div",{className:"min-w-0 flex-1 sm:flex sm:items-center sm:justify-between",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0 h-12 w-12 rounded-lg bg-gray-100 border border-gray-200 overflow-hidden flex items-center justify-center",children:s.image?e.jsx("img",{className:"h-full w-full object-cover",src:s.image,alt:s.name}):e.jsx(A,{className:"h-6 w-6 text-gray-400"})}),e.jsxs("div",{className:"ml-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"font-bold text-gray-900 truncate",children:s.name}),s.nameKH&&e.jsx("span",{className:"text-xs text-gray-500 font-medium px-1.5 py-0.5 bg-gray-100 rounded",children:s.nameKH})]}),e.jsxs("div",{className:"mt-1 flex items-center text-sm text-gray-500 gap-4",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsxs("span",{className:"font-medium text-gray-900",children:["$",s.defaultPrice]})," base"]}),e.jsx("span",{className:"text-gray-300",children:"|"}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsxs("span",{className:"font-medium text-gray-900",children:["$",s.pricePerKm]})," / km"]})]})]})]})}),e.jsxs("div",{className:"ml-5 flex-shrink-0 flex items-center gap-2",children:[e.jsx("button",{onClick:()=>j(s),className:"p-2 text-gray-400 hover:text-indigo-600 hover:bg-indigo-50 rounded-full transition-colors",title:"Edit",children:e.jsx(L,{size:18})}),f===s.id?e.jsxs("div",{className:"flex items-center gap-2 bg-red-50 p-1 rounded-full animate-in fade-in slide-in-from-right-4 duration-200",children:[e.jsx("span",{className:"text-xs text-red-600 font-medium px-2",children:"Confirm?"}),e.jsx("button",{onClick:()=>b(s.id),className:"p-1 bg-red-600 text-white rounded-full hover:bg-red-700",title:"Yes, delete",children:e.jsx(B,{size:14})}),e.jsxs("button",{onClick:()=>d(null),className:"p-1 bg-gray-200 text-gray-600 rounded-full hover:bg-gray-300",title:"Cancel",children:[e.jsx("span",{className:"sr-only",children:"Cancel"}),e.jsxs("svg",{className:"w-3.5 h-3.5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})]})]}):e.jsx("button",{onClick:()=>d(s.id),className:"p-2 text-gray-400 hover:text-red-600 hover:bg-red-50 rounded-full transition-colors",title:"Delete",children:e.jsx(B,{size:18})})]})]})},s.id))})}),e.jsx(T,{isOpen:v,onClose:o,title:l?`Edit ${l.name}`:"Add New Service",maxWidth:"max-w-3xl",children:e.jsx(O,{initialData:l,taxRates:S,onSave:P,onCancel:o,isLoading:p})})]})};export{Z as P};
