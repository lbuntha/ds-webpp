import{r as o,A as C,i as t,T as S,j as e}from"./index-BjK2osQV.js";import{B as A}from"./Button-JCYNVMjR.js";import{I as a}from"./Input-B96Hj4QL.js";import{C as O}from"./Card-DROeE3UG.js";import{I as F}from"./ImageUpload-CVnIZI_m.js";const z=({initialData:r,accounts:u=[],onSubmit:T,onCancel:w})=>{const[m,E]=o.useState((r==null?void 0:r.code)||""),[d,k]=o.useState((r==null?void 0:r.name)||""),[n,b]=o.useState((r==null?void 0:r.type)||C.ASSET),[l,x]=o.useState((r==null?void 0:r.subType)||t.CURRENT_ASSET),[g,R]=o.useState((r==null?void 0:r.description)||""),[j,U]=o.useState((r==null?void 0:r.currency)||"USD"),[y,I]=o.useState((r==null?void 0:r.qrCode)||""),[f,H]=o.useState((r==null?void 0:r.isHeader)||!1),[c,_]=o.useState((r==null?void 0:r.parentAccountId)||""),[P,v]=o.useState(!1),[N,p]=o.useState(null);o.useEffect(()=>{if(c){const s=u.find(h=>h.id===c);s&&(b(s.type),x(s.subType))}},[c,u]),o.useEffect(()=>{const s=S[n];s.includes(l)||x(s[0])},[n,l]);const q=async s=>{if(s.preventDefault(),p(null),!m||!d){p("Code and Name are required.");return}const h={id:(r==null?void 0:r.id)||`acc-${Date.now()}`,code:m,name:d,type:n,subType:l,description:g,currency:j,isHeader:f,parentAccountId:c||void 0,qrCode:y||void 0};try{v(!0),await T(h)}catch{p("Failed to save account."),v(!1)}},B=u.filter(s=>s.id!==(r==null?void 0:r.id)),L=d.toLowerCase().includes("bank")||d.toLowerCase().includes("cash")||l===t.CURRENT_ASSET;return e.jsx(O,{title:r?"Edit Account":"New Account",children:e.jsxs("form",{onSubmit:q,className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(a,{label:"Account Code",value:m,onChange:s=>E(s.target.value),placeholder:"e.g. 100001",required:!0}),e.jsx(a,{label:"Account Name",value:d,onChange:s=>k(s.target.value),placeholder:"e.g. Cash on Hand USD",required:!0}),e.jsxs("div",{className:"md:col-span-2 bg-gray-50 p-4 rounded-xl border border-gray-200",children:[e.jsx("h4",{className:"text-sm font-bold text-gray-700 mb-3",children:"Structure & Hierarchy"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-3 h-full",children:[e.jsx("input",{id:"isHeader",type:"checkbox",className:"h-5 w-5 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded",checked:f,onChange:s=>H(s.target.checked)}),e.jsxs("label",{htmlFor:"isHeader",className:"text-sm font-medium text-gray-700",children:["Is Header Account? ",e.jsx("span",{className:"text-xs text-gray-500 font-normal block",children:"Headers cannot be used in transactions. Used for grouping."})]})]}),e.jsxs("div",{className:"w-full",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Parent Account (Optional)"}),e.jsxs("select",{className:"block w-full px-3 py-2 border border-gray-300 rounded-xl shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",value:c,onChange:s=>_(s.target.value),children:[e.jsx("option",{value:"",children:"-- No Parent (Top Level) --"}),B.map(s=>e.jsxs("option",{value:s.id,children:[s.code," - ",s.name]},s.id))]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Sub-ledger under this account."})]})]})]}),e.jsxs("div",{className:"w-full",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Account Type"}),e.jsx("select",{className:"block w-full px-3 py-2 border border-gray-300 rounded-xl shadow-sm",value:n,onChange:s=>b(s.target.value),disabled:!!c,children:Object.values(C).map(s=>e.jsx("option",{value:s,children:s},s))})]}),e.jsxs("div",{className:"w-full",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Sub Type"}),e.jsxs("select",{className:"block w-full px-3 py-2 border border-gray-300 rounded-xl shadow-sm",value:l,onChange:s=>x(s.target.value),disabled:!!c,children:[e.jsx("option",{value:t.CURRENT_ASSET,children:"Current Asset"}),e.jsx("option",{value:t.NON_CURRENT_ASSET,children:"Non-Current Asset"}),S[n].map(s=>e.jsx("option",{value:s,children:s},s))]})]}),e.jsxs("div",{className:"w-full",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Currency"}),e.jsxs("select",{className:"block w-full px-3 py-2 border border-gray-300 rounded-xl shadow-sm",value:j,onChange:s=>U(s.target.value),children:[e.jsx("option",{value:"USD",children:"USD ($)"}),e.jsx("option",{value:"KHR",children:"KHR (áŸ›)"})]})]}),e.jsx("div",{className:"md:col-span-2",children:e.jsx(a,{label:"Description (Optional)",value:g,onChange:s=>R(s.target.value)})}),L&&e.jsxs("div",{className:"md:col-span-2 bg-blue-50 p-4 rounded-xl border border-blue-100",children:[e.jsx("h4",{className:"text-sm font-bold text-blue-900 mb-2",children:"Nostro Account Configuration (Bank Integration)"}),e.jsx(F,{label:"Company QR Code (For Deposits)",value:y,onChange:I}),e.jsxs("p",{className:"text-xs text-blue-700 mt-2",children:[e.jsx("strong",{children:"Important:"})," Uploading a QR code here will display it to Drivers and Customers when they select this account for Settlements or Wallet Top-ups."]})]})]}),N&&e.jsx("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg text-sm",children:N}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx(A,{type:"button",variant:"outline",onClick:w,children:"Cancel"}),e.jsx(A,{type:"submit",isLoading:P,children:r?"Update Account":"Create Account"})]})]})})};export{z as A};
