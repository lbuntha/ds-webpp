import{r as n,j as e,F as I}from"./index-BjK2osQV.js";import{B as x}from"./Button-JCYNVMjR.js";const d=new I,F=({onSuccess:p,onBackToLogin:g})=>{const[r,i]=n.useState("phone"),[o,P]=n.useState(""),[h,S]=n.useState(""),[b,f]=n.useState(""),[c,y]=n.useState(""),[N,j]=n.useState(""),[u,l]=n.useState(!1),[v,s]=n.useState(null),[q,C]=n.useState(null),O=async t=>{t.preventDefault(),s(null),l(!0);try{const a=await d.requestOTP(o,"SIGNUP");if(!a.success)throw new Error(a.message);const m=await d.getOTP(o);m.code&&C(m),i("otp")}catch(a){s(a.message||"Failed to request OTP")}finally{l(!1)}},k=async t=>{t.preventDefault(),s(null),l(!0);try{const a=o.replace(/\s+/g,""),w=await d.authService.otpService.verifyOTP(a,b);if(!w.success)throw new Error(w.message);i("pin")}catch(a){s(a.message||"Failed to verify OTP")}finally{l(!1)}},T=async t=>{if(t.preventDefault(),s(null),c.length<4){s("PIN must be at least 4 digits");return}if(c!==N){s("PINs do not match");return}l(!0);try{await d.registerWithPhone(o,c,h,{pin:c}),p&&p()}catch(a){s(a.message||"Failed to create account")}finally{l(!1)}};return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-white to-red-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"mx-auto w-full max-w-md bg-white p-8 rounded-2xl shadow-sm border border-gray-100",children:[e.jsxs("div",{className:"mb-10 text-center",children:[e.jsx("div",{className:"flex justify-center mb-6",children:e.jsx("img",{src:"/logo/icon.png",alt:"Doorstep",className:"h-10 w-auto object-contain"})}),e.jsx("h2",{className:"text-2xl font-bold text-slate-900",children:r==="phone"?"Sign Up with Phone":r==="otp"?"Verify OTP":"Set Up Your PIN"}),e.jsx("p",{className:"mt-2 text-sm text-slate-600",children:r==="phone"?"Enter your phone number to get started":r==="otp"?"Enter the OTP code sent to your phone":"Create a secure PIN for your account"})]}),e.jsxs("div",{className:"mb-6 flex items-center justify-center gap-2",children:[e.jsx("div",{className:`h-2 w-16 rounded-full ${r==="phone"||r==="otp"||r==="pin"?"bg-red-500":"bg-gray-200"}`}),e.jsx("div",{className:`h-2 w-16 rounded-full ${r==="otp"||r==="pin"?"bg-red-500":"bg-gray-200"}`}),e.jsx("div",{className:`h-2 w-16 rounded-full ${r==="pin"?"bg-red-500":"bg-gray-200"}`})]}),v&&e.jsx("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg text-sm text-red-700",children:v}),r==="phone"&&e.jsxs("form",{onSubmit:O,className:"space-y-5",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Full Name"}),e.jsx("input",{type:"text",required:!0,className:"w-full rounded-lg border border-gray-300 px-3 py-2.5 text-sm focus:border-red-500 focus:ring-red-500 outline-none transition-colors",placeholder:"John Doe",value:h,onChange:t=>S(t.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Phone Number"}),e.jsx("input",{type:"tel",required:!0,className:"w-full rounded-lg border border-gray-300 px-3 py-2.5 text-sm focus:border-red-500 focus:ring-red-500 outline-none transition-colors",placeholder:"+1234567890",value:o,onChange:t=>P(t.target.value)}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Include country code (e.g., +1 for US, +855 for Cambodia)"})]}),e.jsx(x,{type:"submit",isLoading:u,className:"w-full",children:"Request OTP Code"}),g&&e.jsx("button",{type:"button",onClick:g,className:"w-full text-sm text-gray-600 hover:text-gray-900",children:"Back to Login"})]}),r==="otp"&&e.jsxs("form",{onSubmit:k,className:"space-y-5",children:[e.jsxs("div",{className:"p-4 bg-gray-50 border border-gray-200 rounded-lg text-center",children:[e.jsxs("p",{className:"text-sm text-gray-600",children:["We've sent a code to ",e.jsx("span",{className:"font-bold text-gray-900",children:o})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Please check your messages."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Enter OTP Code"}),e.jsx("input",{type:"text",required:!0,maxLength:6,className:"w-full rounded-lg border border-gray-300 px-3 py-2.5 text-sm text-center text-2xl font-bold tracking-widest focus:border-red-500 focus:ring-red-500 outline-none transition-colors",placeholder:"123456",value:b,onChange:t=>f(t.target.value.replace(/\D/g,""))})]}),e.jsx(x,{type:"submit",isLoading:u,className:"w-full",children:"Verify OTP"}),e.jsx("button",{type:"button",onClick:()=>{i("phone"),f(""),s(null)},className:"w-full text-sm text-gray-600 hover:text-gray-900",children:"← Change Phone Number"})]}),r==="pin"&&e.jsxs("form",{onSubmit:T,className:"space-y-5",children:[e.jsx("div",{className:"p-4 bg-green-50 border border-green-200 rounded-lg mb-4",children:e.jsx("p",{className:"text-sm text-green-900",children:"✅ Phone number verified! Now create a secure PIN."})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Create PIN"}),e.jsx("input",{type:"password",required:!0,inputMode:"numeric",pattern:"[0-9]*",maxLength:6,className:"w-full rounded-lg border border-gray-300 px-3 py-2.5 text-sm text-center text-2xl font-bold tracking-widest focus:border-red-500 focus:ring-red-500 outline-none transition-colors",placeholder:"••••",value:c,onChange:t=>y(t.target.value.replace(/\D/g,""))}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"4-6 digits recommended"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Confirm PIN"}),e.jsx("input",{type:"password",required:!0,inputMode:"numeric",pattern:"[0-9]*",maxLength:6,className:"w-full rounded-lg border border-gray-300 px-3 py-2.5 text-sm text-center text-2xl font-bold tracking-widest focus:border-red-500 focus:ring-red-500 outline-none transition-colors",placeholder:"••••",value:N,onChange:t=>j(t.target.value.replace(/\D/g,""))})]}),e.jsx(x,{type:"submit",isLoading:u,className:"w-full",children:"Create Account"}),e.jsx("button",{type:"button",onClick:()=>{i("otp"),y(""),j(""),s(null)},className:"w-full text-sm text-gray-600 hover:text-gray-900",children:"← Back to OTP"})]})]})})};export{F as OTPSignup};
