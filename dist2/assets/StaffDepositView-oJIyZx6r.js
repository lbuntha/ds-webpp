import{r as t,A as E,i as _,j as s,h as z,a as G,f as J}from"./index-BjK2osQV.js";import{B as T}from"./Button-JCYNVMjR.js";import{I as j}from"./Input-B96Hj4QL.js";import{C as K}from"./Card-DROeE3UG.js";import{g as Q}from"./errorUtils-CUS756ws.js";const X=({accounts:u,branches:m,employees:n,currencies:x,onSave:f,onCancel:c})=>{var A,k;const r=x.length>0?x:[{id:"curr-usd",code:"USD",name:"US Dollar",symbol:"$",exchangeRate:1,isBase:!0}],[i,R]=t.useState(""),[v,B]=t.useState(new Date().toISOString().split("T")[0]),[S,q]=t.useState(((A=m[0])==null?void 0:A.id)||""),[g,L]=t.useState(0),[p,N]=t.useState(""),[o,$]=t.useState(()=>{const e=r.find(a=>a.isBase);return e?e.code:r[0].code}),[d,w]=t.useState(()=>(r.find(a=>a.code===o)||r.find(a=>a.isBase)||r[0]).exchangeRate),[h,F]=t.useState(""),[b,U]=t.useState(""),[H,C]=t.useState(!1),[D,y]=t.useState(null),P=u.filter(e=>e.type===E.ASSET&&(e.subType===_.CURRENT_ASSET||e.name.toLowerCase().includes("cash")||e.name.toLowerCase().includes("bank"))&&!e.isHeader),M=u.filter(e=>e.type===E.LIABILITY&&!e.isHeader);t.useEffect(()=>{const e=r.find(a=>a.code===o);e&&w(e.exchangeRate)},[o,r]),t.useEffect(()=>{if(i&&!p){const e=n.find(a=>a.id===i);e&&N(`Security Deposit - ${e.name}`)}},[i,n,p]);const O=async e=>{e.preventDefault(),y(null);const a=d&&!isNaN(d)&&d!==0?d:1;if(!i||!h||!b||g<=0){y("Please fill in all required fields.");return}C(!0);try{const l=n.find(Y=>Y.id===i),V=`je-dep-${Date.now()}`,I=g/a,W={id:V,date:v,description:p||`Staff Deposit - ${l==null?void 0:l.name}`,reference:`DEP-${Date.now().toString().slice(-6)}`,branchId:S,currency:o,exchangeRate:a,originalTotal:g,lines:[{accountId:h,debit:I,credit:0},{accountId:b,debit:0,credit:I}],createdAt:Date.now()};await f(W)}catch(l){console.error(l),y(Q(l))}finally{C(!1)}};return s.jsx(K,{title:"Receive Staff Deposit",children:s.jsxs("form",{onSubmit:O,className:"space-y-6",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsxs("div",{className:"w-full",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Employee"}),s.jsxs("select",{className:"block w-full px-3 py-2 border border-gray-300 rounded-xl shadow-sm focus:outline-none focus:ring-indigo-500 sm:text-sm",value:i,onChange:e=>R(e.target.value),required:!0,children:[s.jsx("option",{value:"",children:"Select Employee"}),n.map(e=>s.jsx("option",{value:e.id,children:e.name},e.id))]})]}),s.jsx(j,{label:"Date",type:"date",value:v,onChange:e=>B(e.target.value),required:!0})]}),s.jsxs("div",{className:"bg-gray-50 p-4 rounded-xl border border-gray-200 grid grid-cols-1 md:grid-cols-3 gap-4",children:[s.jsxs("div",{className:"w-full",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Amount"}),s.jsx("input",{type:"number",step:"0.01",className:"block w-full px-3 py-2 border border-gray-300 rounded-xl shadow-sm focus:outline-none focus:ring-indigo-500 sm:text-sm font-semibold",value:g,onChange:e=>L(parseFloat(e.target.value)),required:!0})]}),s.jsxs("div",{className:"w-full",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Currency"}),s.jsx("select",{className:"block w-full px-3 py-2 border border-gray-300 rounded-xl shadow-sm focus:outline-none focus:ring-indigo-500 sm:text-sm",value:o,onChange:e=>$(e.target.value),children:r.map(e=>s.jsxs("option",{value:e.code,children:[e.code," - ",e.name]},e.id))})]}),s.jsx(j,{label:"Exchange Rate",type:"number",step:"any",value:d,onChange:e=>w(parseFloat(e.target.value)),disabled:(k=r.find(e=>e.code===o))==null?void 0:k.isBase,required:!0})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-green-700 mb-1",children:"Deposit To (Debit Asset)"}),s.jsxs("select",{className:"block w-full px-3 py-2 border border-green-300 rounded-xl shadow-sm focus:outline-none focus:ring-green-500 sm:text-sm bg-green-50",value:h,onChange:e=>F(e.target.value),required:!0,children:[s.jsx("option",{value:"",children:"Select Cash/Bank Account"}),P.map(e=>s.jsx("option",{value:e.id,children:e.name},e.id))]}),s.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Where is the money being kept?"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-red-700 mb-1",children:"Deposit Type (Credit Liability)"}),s.jsxs("select",{className:"block w-full px-3 py-2 border border-red-300 rounded-xl shadow-sm focus:outline-none focus:ring-red-500 sm:text-sm bg-red-50",value:b,onChange:e=>U(e.target.value),required:!0,children:[s.jsx("option",{value:"",children:"Select Liability Account"}),M.map(e=>s.jsxs("option",{value:e.id,children:[e.code," - ",e.name]},e.id))]}),s.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"e.g. Staff Security Deposits"})]})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsxs("div",{className:"w-full",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Branch"}),s.jsx("select",{className:"block w-full px-3 py-2 border border-gray-300 rounded-xl shadow-sm focus:outline-none focus:ring-indigo-500 sm:text-sm",value:S,onChange:e=>q(e.target.value),required:!0,children:m.map(e=>s.jsx("option",{value:e.id,children:e.name},e.id))})]}),s.jsx(j,{label:"Description / Notes",value:p,onChange:e=>N(e.target.value),required:!0})]}),D&&s.jsx("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg text-sm",children:D}),s.jsxs("div",{className:"flex justify-end space-x-3",children:[s.jsx(T,{type:"button",variant:"outline",onClick:c,children:"Cancel"}),s.jsx(T,{type:"submit",isLoading:H,children:"Record Deposit"})]})]})})};function re(){const{employees:u,accounts:m,branches:n,currencies:x,refreshData:f}=z(),c=G();return s.jsxs("div",{className:"p-6",children:[s.jsxs("div",{className:"flex justify-between items-center mb-6",children:[s.jsx("h1",{className:"text-2xl font-bold",children:"Accept Deposit"}),s.jsx("button",{onClick:()=>c("/app/staff"),className:"text-gray-500 hover:text-gray-700",children:"Back"})]}),s.jsx(X,{employees:u,accounts:m,branches:n,currencies:x,onSave:async r=>{await J.addTransaction(r),await f(),c("/app/staff")},onCancel:()=>c("/app/staff")})]})}export{re as default};
